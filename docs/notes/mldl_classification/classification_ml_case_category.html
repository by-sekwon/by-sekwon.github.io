<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>MLDL ë¨¸ì‹ ëŸ¬ë‹ ë¶„ë¥˜ - kNN SVM ì‚¬ë¡€ë¶„ì„ (3ê°œ ì´ìƒ ë²”ì£¼í˜•) â€“ ì„¸ìƒì˜ ëª¨ë“  í†µê³„ ì´ì•¼ê¸°</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-44962e3d41ec9ccc254fd50f1af5efbe.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-sidebar docked nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">ì„¸ìƒì˜ ëª¨ë“  í†µê³„ ì´ì•¼ê¸°</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../notes/math_stat/index.html"> 
<span class="menu-text">ê¸°ì´ˆìˆ˜í•™Â·ìˆ˜ë¦¬í†µê³„</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../notes/intro_stat/index.html"> 
<span class="menu-text">ê¸°ì´ˆí†µê³„|ì¡°ì‚¬ë°©ë²•</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../notes/linear_model/index.html"> 
<span class="menu-text">íšŒê·€Â·ë‹¤ë³€ëŸ‰ë¶„ì„</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../notes/mldl_intro/index.html"> 
<span class="menu-text">MLDLê°œë…</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../notes/mldl_prediction/index.html"> 
<span class="menu-text">MLDLì˜ˆì¸¡</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../../notes/mldl_classification/index.html" aria-current="page"> 
<span class="menu-text">MLDLë¶„ë¥˜</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../notes/data_reduction/index.html"> 
<span class="menu-text">ì°¨ì›ì¶•ì†Œ|êµ°ì§‘</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../cardnews/index.html"> 
<span class="menu-text">ì¹´ë“œë‰´ìŠ¤</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../consult.html"> 
<span class="menu-text">í†µê³„ìƒë‹´</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../notes/mldl_classification/classification_ml_case_category.html">ğŸ“„ ë¨¸ì‹ ëŸ¬ë‹ k&gt;=3 ì‚¬ë¡€</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notes/mldl_classification/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ã€ë¨¸ì‹ Â·ë”¥ëŸ¬ë‹ ë¶„ë¥˜ë¬¸ì œã€‘</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notes/mldl_classification/classification_intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ğŸ“„ ë¶„ë¥˜ë¬¸ì œ: ì •ì˜</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notes/mldl_classification/lm_logistic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ğŸ“„ ì˜ˆì¸¡ë¶„ë¥˜-ë¡œì§€ìŠ¤í‹±íšŒê·€</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notes/mldl_classification/mda_discriminant.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ğŸ“„ ì˜ˆì¸¡ë¶„ë¥˜-íŒë³„ë¶„ì„</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notes/mldl_classification/prediction_treebase.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ğŸ“„ ì˜ˆì¸¡ë¶„ë¥˜-ML íŠ¸ë¦¬ê¸°ë°˜</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notes/mldl_classification/classification_ml_methods.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ğŸ“„ ë¨¸ì‹ ëŸ¬ë‹ kNN SVM ì´ë¡ </span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notes/mldl_classification/classification_evaluation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ğŸ“„ ë¶„ë¥˜ëª¨ë¸ í‰ê°€</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notes/mldl_classification/classification_ml_case_binary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ğŸ“„ ë¨¸ì‹ ëŸ¬ë‹ ì´ì§„í˜• ì‚¬ë¡€</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notes/mldl_classification/classification_ml_case_category.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">ğŸ“„ ë¨¸ì‹ ëŸ¬ë‹ k&gt;=3 ì‚¬ë¡€</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notes/mldl_classification/classification_deeplearning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ğŸ“„ ë”¥ëŸ¬ë‹ ë¶„ë¥˜ ì´ë¡ </span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notes/mldl_classification/classification_dl_rare_case.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ğŸ“„ ë”¥ëŸ¬ë‹ ë¶„ë¥˜ (í¬ì†Œì„±ê³µ)ì‚¬ë¡€</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notes/mldl_classification/classification_dl_image_case.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ğŸ“„ ë”¥ëŸ¬ë‹ ë¶„ë¥˜ (ì´ë¯¸ì§€)ì‚¬ë¡€</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notes/mldl_classification/classification_dl_text_case.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ğŸ“„ ë”¥ëŸ¬ë‹ ë¶„ë¥˜ (í…ìŠ¤íŠ¸)ì‚¬ë¡€</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">ëª©ì°¨</h2>
   
  <ul>
  <li><a href="#ë¨¸ì‹ ëŸ¬ë‹-ë¶„ë¥˜-k-nn-svm-3ê°œ-ì´ìƒ-ë²”ì£¼í˜•-ë¶„ë¥˜-ì‚¬ë¡€ë¶„ì„" id="toc-ë¨¸ì‹ ëŸ¬ë‹-ë¶„ë¥˜-k-nn-svm-3ê°œ-ì´ìƒ-ë²”ì£¼í˜•-ë¶„ë¥˜-ì‚¬ë¡€ë¶„ì„" class="nav-link active" data-scroll-target="#ë¨¸ì‹ ëŸ¬ë‹-ë¶„ë¥˜-k-nn-svm-3ê°œ-ì´ìƒ-ë²”ì£¼í˜•-ë¶„ë¥˜-ì‚¬ë¡€ë¶„ì„">ë¨¸ì‹ ëŸ¬ë‹ ë¶„ë¥˜ (k-NN | SVM) 3ê°œ ì´ìƒ ë²”ì£¼í˜• ë¶„ë¥˜ ì‚¬ë¡€ë¶„ì„</a>
  <ul>
  <li><a href="#ë°ì´í„°" id="toc-ë°ì´í„°" class="nav-link" data-scroll-target="#ë°ì´í„°">1. ë°ì´í„°</a></li>
  <li><a href="#ì „ì²˜ë¦¬" id="toc-ì „ì²˜ë¦¬" class="nav-link" data-scroll-target="#ì „ì²˜ë¦¬">2. ì „ì²˜ë¦¬</a></li>
  <li><a href="#ë¨¸ì‹ ëŸ¬ë‹-ë¶„ë¥˜" id="toc-ë¨¸ì‹ ëŸ¬ë‹-ë¶„ë¥˜" class="nav-link" data-scroll-target="#ë¨¸ì‹ ëŸ¬ë‹-ë¶„ë¥˜">3. ë¨¸ì‹ ëŸ¬ë‹ ë¶„ë¥˜</a></li>
  <li><a href="#íŠ¸ë¦¬ê¸°ë°˜-ë¶„ë¥˜" id="toc-íŠ¸ë¦¬ê¸°ë°˜-ë¶„ë¥˜" class="nav-link" data-scroll-target="#íŠ¸ë¦¬ê¸°ë°˜-ë¶„ë¥˜">4. íŠ¸ë¦¬ê¸°ë°˜ ë¶„ë¥˜</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">MLDL ë¨¸ì‹ ëŸ¬ë‹ ë¶„ë¥˜ - kNN SVM ì‚¬ë¡€ë¶„ì„ (3ê°œ ì´ìƒ ë²”ì£¼í˜•)</h1>
</div>



<div class="quarto-title-meta column-body">

    
  
    
  </div>
  


</header>


<section id="ë¨¸ì‹ ëŸ¬ë‹-ë¶„ë¥˜-k-nn-svm-3ê°œ-ì´ìƒ-ë²”ì£¼í˜•-ë¶„ë¥˜-ì‚¬ë¡€ë¶„ì„" class="level3">
<h3 class="anchored" data-anchor-id="ë¨¸ì‹ ëŸ¬ë‹-ë¶„ë¥˜-k-nn-svm-3ê°œ-ì´ìƒ-ë²”ì£¼í˜•-ë¶„ë¥˜-ì‚¬ë¡€ë¶„ì„">ë¨¸ì‹ ëŸ¬ë‹ ë¶„ë¥˜ (k-NN | SVM) 3ê°œ ì´ìƒ ë²”ì£¼í˜• ë¶„ë¥˜ ì‚¬ë¡€ë¶„ì„</h3>
<section id="ë°ì´í„°" class="level4">
<h4 class="anchored" data-anchor-id="ë°ì´í„°">1. ë°ì´í„°</h4>
<p>seabornì˜ <code>penguins</code> ë°ì´í„°ì…‹ì„ ë¶ˆëŸ¬ì˜¨ ê²°ê³¼, ì „ì²´ ë°ì´í„°ëŠ” 344ê°œ í–‰ê³¼ 7ê°œ ì—´ë¡œ êµ¬ì„±ë˜ì–´ ìˆìœ¼ë©°, ì´ ì¤‘ íƒ€ê¹ƒ(y)ì€ species 1ê°œ ì—´, ì„¤ëª…ë³€ìˆ˜(X)ëŠ” speciesë¥¼ ì œì™¸í•œ 6ê°œ ì—´ë¡œ ë¶„ë¦¬ëœë‹¤. ì¢…(species)ì€ Adelie, Chinstrap, Gentooì˜ 3ê°œ ë²”ì£¼ë¡œ ì´ë£¨ì–´ì§„ ë‹¤ì¤‘ë¶„ë¥˜ ë¬¸ì œì— í•´ë‹¹í•œë‹¤.</p>
<p>ë°ì´í„°ì˜ ë³€ìˆ˜ êµ¬ì„±ì€ ì¢…(species)ê³¼ ì„¬(island), ê·¸ë¦¬ê³  ë¶€ë¦¬ ê¸¸ì´/ê¹Šì´(bill_length_mm, bill_depth_mm), ë‚ ê°œ ê¸¸ì´(flipper_length_mm), ì²´ì¤‘(body_mass_g) ê°™ì€ ì—°ì†í˜• ìˆ˜ì¹˜ ë³€ìˆ˜ì™€ ì„±ë³„(sex) ê°™ì€ ë²”ì£¼í˜• ë³€ìˆ˜ë¡œ ë˜ì–´ ìˆë‹¤. ìë£Œí˜•ì„ ë³´ë©´ ìˆ˜ì¹˜í˜•(float64) ë³€ìˆ˜ê°€ 4ê°œ, ë¬¸ìì—´(object) ë³€ìˆ˜ê°€ 3ê°œë¡œ í˜¼í•©ë˜ì–´ ìˆë‹¤.</p>
<p>ê²°ì¸¡ì¹˜ë„ ì¼ë¶€ ì¡´ì¬í•œë‹¤. ë¶€ë¦¬ ê¸¸ì´, ë¶€ë¦¬ ê¹Šì´, ë‚ ê°œ ê¸¸ì´, ì²´ì¤‘ì€ ê°ê° 342ê°œë§Œ ê´€ì¸¡ë˜ì–´ ìˆì–´ ê° ë³€ìˆ˜ë§ˆë‹¤ 2ê°œì”© ê²°ì¸¡ì¹˜ê°€ ìˆê³ , ì„±ë³„(sex)ì€ 333ê°œë§Œ ê´€ì¸¡ë˜ì–´ 11ê°œì˜ ê²°ì¸¡ì¹˜ê°€ í™•ì¸ëœë‹¤. ë°˜ë©´ ì¢…(species)ê³¼ ì„¬(island)ì€ ëª¨ë“  344ê°œê°€ ê²°ì¸¡ ì—†ì´ ì±„ì›Œì ¸ ìˆë‹¤. ë”°ë¼ì„œ ì´í›„ ëª¨ë¸ë§ì„ ìœ„í•´ì„œëŠ” ê²°ì¸¡ì¹˜ ì²˜ë¦¬(ëŒ€ì¹˜)ì™€ ë²”ì£¼í˜• ë³€ìˆ˜ ì¸ì½”ë”©(ì˜ˆ: ì›-í•« ì¸ì½”ë”©), ê·¸ë¦¬ê³  k-NN/SVMì²˜ëŸ¼ ìŠ¤ì¼€ì¼ì— ë¯¼ê°í•œ ëª¨ë¸ì„ ìœ„í•œ í‘œì¤€í™”ê°€ í•„ìš”í•˜ë‹¤.</p>
</section>
<section id="ì „ì²˜ë¦¬" class="level4">
<h4 class="anchored" data-anchor-id="ì „ì²˜ë¦¬">2. ì „ì²˜ë¦¬</h4>
<p>í•´ë‹¹ ì „ì²˜ë¦¬ ê³¼ì •ì€ k-NNê³¼ SVM ëª¨ë¸ì—ì„œ ì„±ëŠ¥ì— í° ì˜í–¥ì„ ì£¼ëŠ” ìŠ¤ì¼€ì¼ë§(í‘œì¤€í™”)ì„ íŒŒì´í”„ë¼ì¸ ì•ˆì— ìë™ìœ¼ë¡œ í¬í•¨í•˜ë„ë¡ êµ¬ì„±ë˜ì–´ ìˆë‹¤. ë˜í•œ ë°ì´í„°ì— ê²°ì¸¡ì¹˜ê°€ ì¡´ì¬í•˜ë”ë¼ë„ ìˆ˜ì¹˜í˜• ë³€ìˆ˜ëŠ” ì ì ˆí•œ ë°©ì‹ìœ¼ë¡œ ëŒ€ì¹˜í•œ ë’¤ í‘œì¤€í™”ë¥¼ ìˆ˜í–‰í•˜ê³ , ë²”ì£¼í˜• ë³€ìˆ˜ëŠ” ì›-í•« ì¸ì½”ë”©ìœ¼ë¡œ ë³€í™˜í•´ ëª¨ë¸ì´ ë°”ë¡œ í•™ìŠµí•  ìˆ˜ ìˆëŠ” í˜•íƒœë¡œ ì²˜ë¦¬í•œë‹¤.</p>
<p>ì¦‰, ë°ì´í„°ì˜ ëˆ„ë½ê°’ê³¼ ë²”ì£¼í˜• ë³€ìˆ˜ë¥¼ ë³„ë„ë¡œ ìˆ˜ì‘ì—… ì²˜ë¦¬í•˜ì§€ ì•Šì•„ë„ ì¼ê´€ëœ ë°©ì‹ìœ¼ë¡œ ì „ì²˜ë¦¬ê°€ ì§„í–‰ë˜ë©°, k-NN/SVMì— í•„ìš”í•œ ì…ë ¥ í˜•íƒœë¥¼ ì•ˆì •ì ìœ¼ë¡œ ë³´ì¥í•œë‹¤.</p>
<p>ì´ ì½”ë“œëŠ” ì „ì²´ ë°ì´í„°ì—ì„œ ì…ë ¥ ë³€ìˆ˜(X)ì™€ ì •ë‹µ ë¼ë²¨(y)ë¥¼ í•™ìŠµìš©ê³¼ í…ŒìŠ¤íŠ¸ìš©ìœ¼ë¡œ ë‚˜ëˆ„ê¸° ìœ„í•´ <code>train_test_split()</code>ì„ ì‚¬ìš©í•œ ê²ƒì…ë‹ˆë‹¤. ì—¬ê¸°ì„œ <code>test_size=0.2</code>ëŠ” ì „ì²´ ë°ì´í„°ì˜ 20%ë¥¼ í…ŒìŠ¤íŠ¸ ì„¸íŠ¸ë¡œ ë–¼ì–´ ë‚´ê³ , ë‚˜ë¨¸ì§€ 80%ë¥¼ í•™ìŠµ ì„¸íŠ¸ë¡œ ì“°ê² ë‹¤ëŠ” ì˜ë¯¸ì…ë‹ˆë‹¤. ì´ë ‡ê²Œ ë¶„ë¦¬í•˜ë©´ ëª¨ë¸ì„ í•™ìŠµí•  ë•ŒëŠ” <code>X_train, y_train</code>ë§Œ ì‚¬ìš©í•˜ê³ , í•™ìŠµì— ì“°ì§€ ì•Šì€ ë°ì´í„°ì¸ <code>X_test, y_test</code>ë¡œ ì„±ëŠ¥ì„ í‰ê°€í•  ìˆ˜ ìˆì–´ â€œìƒˆ ë°ì´í„°ì—ì„œë„ ì˜ ë§íˆëŠ”ì§€(ì¼ë°˜í™” ì„±ëŠ¥)â€ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<p>íŠ¹íˆ <code>stratify=y</code>ëŠ” ë¶„ë¥˜ ë¬¸ì œì—ì„œ ë§¤ìš° ì¤‘ìš”í•œ ì˜µì…˜ì¸ë°, í•™ìŠµ/í…ŒìŠ¤íŠ¸ë¡œ ë‚˜ëˆŒ ë•Œ ê° í´ë˜ìŠ¤ì˜ ë¹„ìœ¨ì´ ì›ë³¸ ë°ì´í„°ì™€ ìµœëŒ€í•œ ë¹„ìŠ·í•˜ê²Œ ìœ ì§€ë˜ë„ë¡(ì¸µí™” ì¶”ì¶œ) í•´ì¤ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ë°ì´í„°ê°€ ë¶ˆê· í˜•(í•œ í´ë˜ìŠ¤ê°€ í›¨ì”¬ ë§ìŒ)í•œ ê²½ìš°, ì¸µí™” ì—†ì´ ë¬´ì‘ì • ë‚˜ëˆ„ë©´ í…ŒìŠ¤íŠ¸ ì„¸íŠ¸ì— íŠ¹ì • í´ë˜ìŠ¤ê°€ ê±°ì˜ ì—†ê±°ë‚˜ ì•„ì˜ˆ ë¹ ì§€ëŠ” ì¼ì´ ìƒê¸¸ ìˆ˜ ìˆê³ , ê·¸ëŸ¬ë©´ í‰ê°€ ê²°ê³¼ê°€ ì™œê³¡ë˜ê±°ë‚˜ ROC/PR ê°™ì€ ì§€í‘œ ê³„ì‚° ìì²´ê°€ ì–´ë ¤ì›Œì§ˆ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. <code>stratify=y</code>ë¥¼ ì£¼ë©´ ì´ëŸ° ìœ„í—˜ì„ í¬ê²Œ ì¤„ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.compose <span class="im">import</span> ColumnTransformer</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> Pipeline</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler, OneHotEncoder</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.impute <span class="im">import</span> SimpleImputer</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------------------------------</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># (0) X, y ì¤€ë¹„ (ì˜ˆ: dfì—ì„œ íƒ€ê¹ƒ ë¶„ë¦¬)</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------------------------------</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># y = df["Class"]  # ë˜ëŠ” df["species"] ë“±</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co"># X = df.drop(columns=["Class"])</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------------------------------</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co"># (1) Train/Test split (ë¶„ë¥˜ë©´ stratify ê¶Œì¥)</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------------------------------</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    X, y,</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    test_size<span class="op">=</span><span class="fl">0.2</span>,</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    stratify<span class="op">=</span>y,          <span class="co"># ë¶ˆê· í˜•/ë¶„ë¥˜ì—ì„œ ë§¤ìš° ì¤‘ìš”</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    random_state<span class="op">=</span><span class="dv">42</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------------------------------</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="co"># (2) ì»¬ëŸ¼ íƒ€ì… ë¶„ë¦¬</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------------------------------</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>num_cols <span class="op">=</span> X_train.select_dtypes(include<span class="op">=</span>[<span class="st">"number"</span>]).columns.tolist()</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>cat_cols <span class="op">=</span> X_train.select_dtypes(exclude<span class="op">=</span>[<span class="st">"number"</span>]).columns.tolist()</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------------------------------</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="co"># (3) ì „ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="co">#   - ìˆ˜ì¹˜í˜•: ê²°ì¸¡ì¹˜ ì¤‘ì•™ê°’ ëŒ€ì¹˜ + í‘œì¤€í™”</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="co">#   - ë²”ì£¼í˜•: ìµœë¹ˆê°’ ëŒ€ì¹˜ + ì›í•«ì¸ì½”ë”©</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------------------------------</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>numeric_pipe <span class="op">=</span> Pipeline([</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"imputer"</span>, SimpleImputer(strategy<span class="op">=</span><span class="st">"median"</span>)),</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"scaler"</span>, StandardScaler())</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a><span class="co"># sklearn ë²„ì „ì— ë”°ë¼ sparse ì˜µì…˜ëª…ì´ ë‹¤ë¥¼ ìˆ˜ ìˆì–´ try ì²˜ë¦¬</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>    ohe <span class="op">=</span> OneHotEncoder(handle_unknown<span class="op">=</span><span class="st">"ignore"</span>, sparse_output<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">TypeError</span>:</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>    ohe <span class="op">=</span> OneHotEncoder(handle_unknown<span class="op">=</span><span class="st">"ignore"</span>, sparse<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>categorical_pipe <span class="op">=</span> Pipeline([</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"imputer"</span>, SimpleImputer(strategy<span class="op">=</span><span class="st">"most_frequent"</span>)),</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"onehot"</span>, ohe)</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>preprocess <span class="op">=</span> ColumnTransformer(</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>    transformers<span class="op">=</span>[</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>        (<span class="st">"num"</span>, numeric_pipe, num_cols),</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>        (<span class="st">"cat"</span>, categorical_pipe, cat_cols),</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>    remainder<span class="op">=</span><span class="st">"drop"</span>   <span class="co"># ì•ˆ ì“°ëŠ” ì»¬ëŸ¼ ë²„ë¦´ì§€/ì‚´ë¦´ì§€ ì„ íƒ</span></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="ë¨¸ì‹ ëŸ¬ë‹-ë¶„ë¥˜" class="level4">
<h4 class="anchored" data-anchor-id="ë¨¸ì‹ ëŸ¬ë‹-ë¶„ë¥˜">3. ë¨¸ì‹ ëŸ¬ë‹ ë¶„ë¥˜</h4>
<section id="knn" class="level5">
<h5 class="anchored" data-anchor-id="knn">(1) kNN</h5>
<p><strong>ì‹¤í–‰ì½”ë“œ</strong></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.neighbors <span class="im">import</span> KNeighborsClassifier</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>knn_model <span class="op">=</span> Pipeline([</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"preprocess"</span>, preprocess),</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"knn"</span>, KNeighborsClassifier(</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>        n_neighbors<span class="op">=</span><span class="dv">15</span>,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>        weights<span class="op">=</span><span class="st">"distance"</span>,</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>        p<span class="op">=</span><span class="dv">2</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>knn_model.fit(X_train, y_train)         <span class="co"># (ì „ì²´í•™ìŠµ ì‹œ)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/classification_ml_category_knn.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:40.0%"></p>
</figure>
</div>
<p>confusion matrix</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> confusion_matrix, ConfusionMatrixDisplay, classification_report</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ì˜ˆì¸¡</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> knn_model.predict(X_test)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co"># (ë©€í‹°í´ë˜ìŠ¤/ë¬¸ìì—´ ë¼ë²¨ í¬í•¨) ë¼ë²¨ ìˆœì„œ ê³ ì •</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> knn_model.named_steps[<span class="st">"knn"</span>].classes_  <span class="co"># Pipelineì´ë©´ ë§ˆì§€ë§‰ ëª¨ë¸ì˜ classes_</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co"># confusion matrix</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>cm <span class="op">=</span> confusion_matrix(y_test, y_pred, labels<span class="op">=</span>labels)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Confusion matrix:</span><span class="ch">\n</span><span class="st">"</span>, cm)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="co"># (ì„ íƒ) classification report</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Classification report:</span><span class="ch">\n</span><span class="st">"</span>,</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>      classification_report(y_test, y_pred, labels<span class="op">=</span>labels, target_names<span class="op">=</span>labels.tolist()))</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="co"># (ì„ íƒ) ì‹œê°í™”</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>disp <span class="op">=</span> ConfusionMatrixDisplay(confusion_matrix<span class="op">=</span>cm, display_labels<span class="op">=</span>labels)</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>disp.plot(values_format<span class="op">=</span><span class="st">"d"</span>)</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre class="text"><code>Confusion matrix:
 [[30  0  0]
 [ 0 14  0]
 [ 0  0 25]]

Classification report:
               precision    recall  f1-score   support

      Adelie       1.00      1.00      1.00        30
   Chinstrap       1.00      1.00      1.00        14
      Gentoo       1.00      1.00      1.00        25

    accuracy                           1.00        69
   macro avg       1.00      1.00      1.00        69
weighted avg       1.00      1.00      1.00        69</code></pre>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/classification_ml_category_knnconfusion.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:40.0%"></p>
</figure>
</div>
<p><strong>ì‚¬í›„í™•ë¥  ì¶œë ¥</strong></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#ì‚¬í›„ í™•ë¥  ê³„ì‚°</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># (n_samples, n_classes)</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>proba_knn <span class="op">=</span> knn_model.predict_proba(X_test)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Pipelineì´ë©´ classes_ëŠ” ë§ˆì§€ë§‰ ëª¨ë¸ì—ì„œ ê°€ì ¸ì˜¤ê¸°</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>classes_knn <span class="op">=</span> knn_model.named_steps[<span class="st">"knn"</span>].classes_</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>proba_knn_df <span class="op">=</span> pd.DataFrame(proba_knn, columns<span class="op">=</span>classes_knn)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>display(proba_knn_df.head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre class="text"><code>Adelie  Chinstrap   Gentoo
0   1.000000    0.000000    0.0
1   1.000000    0.000000    0.0
2   0.000000    0.000000    1.0
3   0.000000    0.000000    1.0
4   0.053935    0.946065    0.0</code></pre>
<p><strong>ë¶„ë¥˜ ì˜í–¥ë³€ì¸ ì¶œë ¥</strong></p>
<p>ë‹¤ìŒ ì½”ë“œëŠ” í…ŒìŠ¤íŠ¸ ë°ì´í„°ì—ì„œ íŠ¹ì • 1ê°œ ìƒ˜í”Œì„ ê³¨ë¼, ê·¸ ìƒ˜í”Œì´ preprocess(ì „ì²˜ë¦¬ê¸°: ê²°ì¸¡ì¹˜ ì²˜ë¦¬/ìŠ¤ì¼€ì¼ë§/ì›í•«ì¸ì½”ë”© ë“±)ë¥¼ ê±°ì¹œ ë’¤ ì–´ë–¤ â€œì „ì²˜ë¦¬ëœ í”¼ì²˜ë“¤â€ë¡œ ë³€í™˜ë˜ëŠ”ì§€ë¥¼ í™•ì¸í•´ì„œ, ê·¸ì¤‘ ì˜í–¥(ê°’ì˜ ì ˆëŒ“ê°’)ì´ í° í”¼ì²˜ Top-kë§Œ ë³´ê¸° ì¢‹ê²Œ ì¶œë ¥í•˜ëŠ” ì½”ë“œì´ë‹¤.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># íŠ¹ì • ìƒ˜í”Œì´ ì „ì²˜ë¦¬ í›„ ì–´ë–¤ í”¼ì²˜ë¡œ ë°”ë€ŒëŠ”ì§€ ì¶œë ¥</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> show_transformed_features(preprocess, X_row, topk<span class="op">=</span><span class="dv">20</span>):</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    Xt <span class="op">=</span> preprocess.transform(X_row)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    feat <span class="op">=</span> preprocess.get_feature_names_out()</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    s <span class="op">=</span> pd.Series(Xt.ravel(), index<span class="op">=</span>feat)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ê°’ì´ í° ìˆœìœ¼ë¡œ(ì›í•«ì€ 0/1ì´ë¼ topkë¡œ ë³´ë©´ í¸í•¨)</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> s.reindex(s.<span class="bu">abs</span>().sort_values(ascending<span class="op">=</span><span class="va">False</span>).head(topk).index)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>x0 <span class="op">=</span> X_test.iloc[[i]]</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>display(show_transformed_features(preprocess, x0, topk<span class="op">=</span><span class="dv">30</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>ì¶œë ¥ì€ ì „ì²˜ë¦¬(preprocess)ë¥¼ ê±°ì¹œ ë’¤, í…ŒìŠ¤íŠ¸ ë°ì´í„° 0ë²ˆ ìƒ˜í”Œì´ â€œëª¨ë¸ ì…ë ¥ í”¼ì²˜ ë²¡í„°â€ë¡œ ë°”ë€ ê°’ì„ ë³´ì—¬ì¤€ë‹¤. (ì½”ë“œì—ì„œ get_feature_names_out() + preprocess.transform() ê²°ê³¼ë¥¼ Seriesë¡œ ë§Œë“  ê²ƒ)</p>
<p>cat__â€¦ (ë²”ì£¼í˜• ì›-í•« ì¸ì½”ë”©) í•´ì„</p>
<p>ì›-í•« ì¸ì½”ë”©ì€ í•´ë‹¹ ë²”ì£¼ë©´ 1, ì•„ë‹ˆë©´ 0ì…ë‹ˆë‹¤.</p>
<p>cat__sex_Male = 1.0 â†’ ì´ ìƒ˜í”Œì˜ ì„±ë³„ì€ Male <br> cat__sex_Female = 0.0 â†’ Femaleì´ ì•„ë‹˜ <br> cat__island_Dream = 1.0 â†’ ì„¬ì€ Dream <br> cat__island_Biscoe = 0.0, cat__island_Torgersen = 0.0 â†’ ë‹¤ë¥¸ ì„¬ì´ ì•„ë‹˜ <br> ì¦‰, â€œDream ì„¬ì˜ ìˆ˜ì»·â€ì´ë¼ëŠ” ëœ»ì´ë‹¤.</p>
<p>num__â€¦ (ìˆ˜ì¹˜í˜• í‘œì¤€í™” z-score) í•´ì„</p>
<p>ìˆ˜ì¹˜í˜•ì€ StandardScaler()ê°€ ì ìš©ë˜ì–´ (ê°’ âˆ’ í‰ê· ) / í‘œì¤€í¸ì°¨ í˜•íƒœì˜ í‘œì¤€í™” ì ìˆ˜(z-score) ë¡œ ë³€í™˜ëœë‹¤. ê·¸ë˜ì„œ ë‹¨ìœ„(mm, g)ê°€ ì‚¬ë¼ì§€ê³ , â€œí›ˆë ¨ ë°ì´í„° í‰ê·  ëŒ€ë¹„ ëª‡ í‘œì¤€í¸ì°¨ ìœ„/ì•„ë˜ì¸ê°€â€ë¡œ í•´ì„ëœë‹¤.</p>
<p>num__bill_depth_mm = 0.663 â†’ ë¶€ë¦¬ ê¹Šì´ê°€ í‰ê· ë³´ë‹¤ 0.66 í‘œì¤€í¸ì°¨ ì •ë„ í¼ (ì¡°ê¸ˆ í° í¸) <br> num__bill_length_mm = -0.471 â†’ ë¶€ë¦¬ ê¸¸ì´ê°€ í‰ê· ë³´ë‹¤ 0.47 í‘œì¤€í¸ì°¨ ì •ë„ ì‘ìŒ (ì¡°ê¸ˆ ì‘ì€ í¸) <br> num__body_mass_g = -0.262 â†’ ëª¸ë¬´ê²Œê°€ í‰ê· ë³´ë‹¤ 0.26 í‘œì¤€í¸ì°¨ ì •ë„ ì‘ìŒ (ì•½ê°„ ê°€ë²¼ìš´ í¸) <br> num__flipper_length_mm = 0.013 â†’ ì§€ëŠëŸ¬ë¯¸ ê¸¸ì´ê°€ ê±°ì˜ í‰ê·  ìˆ˜ì¤€ (í‰ê· ê³¼ ë§¤ìš° ë¹„ìŠ·)</p>
<p>ì´ ê°’ë“¤ì´ ëª¨ë¸ì—ì„œ ì˜ë¯¸í•˜ëŠ” ê²ƒ</p>
<p>k-NN: ì´ ë²¡í„°ë“¤ë¡œ ê±°ë¦¬ë¥¼ ê³„ì‚°í•˜ë‹ˆ, ì ˆëŒ“ê°’ì´ í° í•­ëª©(ì˜ˆ: bill_depth 0.66, bill_length -0.47)ì´ ê±°ë¦¬/ì´ì›ƒ ì„ íƒì— ë” ì˜í–¥ì„ ì£¼ê¸° ì‰¬ì›€</p>
<pre class="text"><code>cat__sex_Male   1.000000
cat__island_Dream   1.000000
num__bill_depth_mm  0.663008
num__bill_length_mm -0.470502
num__body_mass_g    -0.262136
num__flipper_length_mm  0.013088
cat__island_Biscoe  0.000000
cat__island_Torgersen   0.000000
cat__sex_Female 0.000000</code></pre>
<p>ì´ì›ƒ ê°œì²´ ê±°ë¦¬ ì •ë³´</p>
<p>ë‹¤ìŒ ì½”ë“œëŠ” k-NN ëª¨ë¸ì´ íŠ¹ì • ìƒ˜í”Œ 1ê°œ(<code>X_row</code>)ë¥¼ ì–´ë–¤ ê·¼ê±°ë¡œ ë¶„ë¥˜í–ˆëŠ”ì§€ë¥¼ â€œì´ì›ƒ ê¸°ë°˜â€ìœ¼ë¡œ ì„¤ëª…í•˜ê¸° ìœ„í•œ í•¨ìˆ˜ì´ë‹¤. ì…ë ¥ìœ¼ë¡œëŠ” ì „ì²˜ë¦¬+ëª¨ë¸ì´ ë¬¶ì¸ <code>Pipeline</code>(<code>pipeline</code>), í•™ìŠµ ë°ì´í„° <code>X_train</code>, í•™ìŠµ ë¼ë²¨ <code>y_train</code>, ì„¤ëª… ëŒ€ìƒ 1í–‰ ë°ì´í„°í”„ë ˆì„ <code>X_row</code>, ê·¸ë¦¬ê³  ì´ì›ƒ ìˆ˜ <code>k</code>ë¥¼ ë°›ëŠ”ë‹¤.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#kNN ë¶„ë¥˜ ê³¼ì • ì¶œë ¥: â€œì–´ë–¤ ì´ì›ƒë“¤ì´ ê²°ì •í–ˆëŠ”ì§€â€</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> explain_knn(pipeline, X_train, y_train, X_row, k<span class="op">=</span><span class="dv">15</span>):</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    pre <span class="op">=</span> pipeline.named_steps[<span class="st">"preprocess"</span>]</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    knn <span class="op">=</span> pipeline.named_steps[<span class="st">"knn"</span>]</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    Xt_row <span class="op">=</span> pre.transform(X_row)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    dist, ind <span class="op">=</span> knn.kneighbors(Xt_row, n_neighbors<span class="op">=</span>k, return_distance<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    dist, ind <span class="op">=</span> dist[<span class="dv">0</span>], ind[<span class="dv">0</span>]</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    neigh <span class="op">=</span> X_train.iloc[ind].copy()</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    neigh[<span class="st">"y"</span>] <span class="op">=</span> y_train.iloc[ind].to_numpy()</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    neigh[<span class="st">"distance"</span>] <span class="op">=</span> dist</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># weights="distance"ì¸ ê²½ìš° ê°€ì¤‘ì¹˜(ê±°ë¦¬ì˜ ì—­ìˆ˜)ë¡œ íˆ¬í‘œê°€ ì´ë£¨ì–´ì§</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">getattr</span>(knn, <span class="st">"weights"</span>, <span class="va">None</span>) <span class="op">==</span> <span class="st">"distance"</span>:</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>        w <span class="op">=</span> <span class="fl">1.0</span> <span class="op">/</span> (dist <span class="op">+</span> <span class="fl">1e-12</span>)</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>        w <span class="op">=</span> np.ones_like(dist)</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>    vote <span class="op">=</span> pd.Series(w).groupby(neigh[<span class="st">"y"</span>]).<span class="bu">sum</span>().sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>    pred <span class="op">=</span> pipeline.predict(X_row)[<span class="dv">0</span>]</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>    proba <span class="op">=</span> pipeline.predict_proba(X_row)[<span class="dv">0</span>]</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>    classes <span class="op">=</span> knn.classes_</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"pred ="</span>, pred)</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"proba ="</span>, <span class="bu">dict</span>(<span class="bu">zip</span>(classes, proba)))</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">[weighted vote by class]"</span>)</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>    display(vote)</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> neigh.sort_values(<span class="st">"distance"</span>)</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>x0 <span class="op">=</span> X_test.iloc[[i]]</span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>display(explain_knn(knn_model, X_train, y_train, x0, k<span class="op">=</span><span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>ì¶œë ¥ì€ â€œk-NNì´ ì™œ Adelieë¼ê³  ì˜ˆì¸¡í–ˆëŠ”ì§€â€ë¥¼ ì•„ì£¼ ì§ê´€ì ìœ¼ë¡œ ë³´ì—¬ì¤€ë‹¤.</p>
<p>pred = Adelie: k-NNì˜ ìµœì¢… ì˜ˆì¸¡ í´ë˜ìŠ¤ê°€ Adelieë¼ëŠ” ëœ»ì´ë‹¤. kê°œì˜ ì´ì›ƒ(ì˜ˆ: k=15)ì´ ì–´ëŠ í´ë˜ìŠ¤ì— ë” â€œê°€ê¹ê²Œ/ë§ì´â€ ëª°ë ¤ìˆëŠëƒë¡œ ê²°ì •ëœë‹¤.</p>
<p>proba = {â€˜Adelieâ€™: 1.0, â€˜Chinstrapâ€™: 0.0, â€˜Gentooâ€™: 0.0}: predict_probaëŠ” ì´ì›ƒë“¤ì˜ íˆ¬í‘œ ê²°ê³¼ë¥¼ í™•ë¥ ì²˜ëŸ¼ ì •ê·œí™”í•´ì„œ ë³´ì—¬ì¤€ë‹¤.</p>
<p>ì§€ê¸ˆì€ Adelieê°€ 1.0(=100%)ì¸ ê±¸ ë³´ë©´, (ê±°ì˜ í™•ì‹¤í•˜ê²Œ) ì„ íƒëœ kê°œ ì´ì›ƒì´ ì „ë¶€ Adelieì´ê±°ë‚˜ ê±°ë¦¬ ê°€ì¤‘ì¹˜ í•©ì´ Adelie ìª½ì—ë§Œ ëª°ë ¤ ìˆë‹¤ëŠ” ëœ»ì´ë‹¤. ê·¸ë˜ì„œ ëª¨ë¸ì´ â€œì´ ìƒ˜í”Œì€ Adelieì¼ ê°€ëŠ¥ì„±ì´ ë§¤ìš° ë†’ë‹¤â€ê³  íŒë‹¨í•œ ê²ë‹ˆë‹¤.</p>
<p>[weighted vote by class]: weights=â€œdistanceâ€ë¥¼ ì“°ë©´, ê° ì´ì›ƒì˜ í‘œ(íˆ¬í‘œ)ê°€ ê°€ê¹Œìš¸ìˆ˜ë¡ ë” í¬ê²Œ ë°˜ì˜ëœë‹¤. ë³´í†µ ê°€ì¤‘ì¹˜ê°€ 1 / distance í˜•íƒœë¡œ ë“¤ì–´ê°„ë‹¤. ê·¸ë˜ì„œ [weighted vote by class]ëŠ” í´ë˜ìŠ¤ë³„ë¡œ ê°€ì¤‘ì¹˜ í•©(=íˆ¬í‘œ ì ìˆ˜ í•©) ì„ ë³´ì—¬ì¤€ë‹¤. ì§€ê¸ˆ ê²°ê³¼ê°€ ì‚¬ì‹¤ìƒ Adelieë¡œë§Œ ì°íŒ ê±´ â€œê°€ê¹Œìš´ ì´ì›ƒë“¤ì´ Adelieë¡œë§Œ êµ¬ì„±â€ë˜ì—ˆìŒì„ ì˜ë¯¸í•œë‹¤.</p>
<p>ì´ í‘œëŠ” ê°€ì¥ ê°€ê¹Œìš´ ì´ì›ƒë“¤ ì¼ë¶€ë¥¼ ë³´ì—¬ì¤€ ê±°ê³ , distanceëŠ” â€œì „ì²˜ë¦¬(í‘œì¤€í™” + ì›í•«)â€ ì´í›„ ê³µê°„ì—ì„œì˜ ê±°ë¦¬ë¼ì„œ ì›ë˜ ë‹¨ìœ„(mm, g) ê·¸ëŒ€ë¡œì˜ ê±°ë¦¬ëŠ” ì•„ë‹ˆë‹¤. ê°€ê¹Œìš´ ì´ì›ƒë“¤ì´ ì „ë¶€ Adelie â†’ ê·¸ë˜ì„œ ì˜ˆì¸¡ë„ Adelieë¡œ ê°•í•˜ê²Œ ì ë¦¼.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>pred <span class="op">=</span> Adelie</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>proba <span class="op">=</span> {<span class="st">'Adelie'</span>: np.float64(<span class="fl">1.0</span>), <span class="st">'Chinstrap'</span>: np.float64(<span class="fl">0.0</span>), <span class="st">'Gentoo'</span>: np.float64(<span class="fl">0.0</span>)}</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>island  bill_length_mm  bill_depth_mm   flipper_length_mm   body_mass_g sex y   distance</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="dv">97</span>  Dream   <span class="fl">40.3</span>    <span class="fl">18.5</span>    <span class="fl">196.0</span>   <span class="fl">4350.0</span>  Male    Adelie  <span class="fl">0.606939</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="dv">95</span>  Dream   <span class="fl">40.8</span>    <span class="fl">18.9</span>    <span class="fl">208.0</span>   <span class="fl">4300.0</span>  Male    Adelie  <span class="fl">0.671009</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="dv">139</span> Dream   <span class="fl">39.7</span>    <span class="fl">17.9</span>    <span class="fl">193.0</span>   <span class="fl">4250.0</span>  Male    Adelie  <span class="fl">0.791762</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="dv">137</span> Dream   <span class="fl">40.2</span>    <span class="fl">20.1</span>    <span class="fl">200.0</span>   <span class="fl">3975.0</span>  Male    Adelie  <span class="fl">0.836881</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="dv">135</span> Dream   <span class="fl">41.1</span>    <span class="fl">17.5</span>    <span class="fl">190.0</span>   <span class="fl">3900.0</span>  Male    Adelie  <span class="fl">0.947113</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="dv">133</span> Dream   <span class="fl">37.5</span>    <span class="fl">18.5</span>    <span class="fl">199.0</span>   <span class="fl">4475.0</span>  Male    Adelie  <span class="fl">0.952186</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="dv">149</span> Dream   <span class="fl">37.8</span>    <span class="fl">18.1</span>    <span class="fl">193.0</span>   <span class="fl">3750.0</span>  Male    Adelie  <span class="fl">0.962429</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="dv">43</span>  Dream   <span class="fl">44.1</span>    <span class="fl">19.7</span>    <span class="fl">196.0</span>   <span class="fl">4400.0</span>  Male    Adelie  <span class="fl">0.981460</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="dv">143</span> Dream   <span class="fl">40.7</span>    <span class="fl">17.0</span>    <span class="fl">190.0</span>   <span class="fl">3725.0</span>  Male    Adelie  <span class="fl">1.151793</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="dv">45</span>  Dream   <span class="fl">39.6</span>    <span class="fl">18.8</span>    <span class="fl">190.0</span>   <span class="fl">4600.0</span>  Male    Adelie  <span class="fl">1.153475</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="dv">85</span>  Dream   <span class="fl">41.3</span>    <span class="fl">20.3</span>    <span class="fl">194.0</span>   <span class="fl">3550.0</span>  Male    Adelie  <span class="fl">1.173729</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="dv">36</span>  Dream   <span class="fl">38.8</span>    <span class="fl">20.0</span>    <span class="fl">190.0</span>   <span class="fl">3950.0</span>  Male    Adelie  <span class="fl">1.197918</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="dv">33</span>  Dream   <span class="fl">40.9</span>    <span class="fl">18.9</span>    <span class="fl">184.0</span>   <span class="fl">3900.0</span>  Male    Adelie  <span class="fl">1.250992</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="dv">93</span>  Dream   <span class="fl">39.6</span>    <span class="fl">18.1</span>    <span class="fl">186.0</span>   <span class="fl">4450.0</span>  Male    Adelie  <span class="fl">1.281267</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="dv">145</span> Dream   <span class="fl">39.0</span>    <span class="fl">18.7</span>    <span class="fl">185.0</span>   <span class="fl">3650.0</span>  Male    Adelie  <span class="fl">1.317596</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="svm" class="level5">
<h5 class="anchored" data-anchor-id="svm">(2) SVM</h5>
<p><strong>ì‹¤í–‰ ì½”ë“œ</strong></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.neighbors <span class="im">import</span> KNeighborsClassifier</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>knn_model <span class="op">=</span> Pipeline([</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"preprocess"</span>, preprocess),</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"knn"</span>, KNeighborsClassifier(</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>        n_neighbors<span class="op">=</span><span class="dv">15</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>        weights<span class="op">=</span><span class="st">"distance"</span>,</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>        p<span class="op">=</span><span class="dv">2</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>knn_model.fit(X_train, y_train)         <span class="co"># (ì „ì²´í•™ìŠµ ì‹œ)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/classification_ml_category_svm.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:40.0%"></p>
</figure>
</div>
<div class="sourceCode" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score, confusion_matrix, classification_report, ConfusionMatrixDisplay</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ì˜ˆì¸¡</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>y_pred_svm <span class="op">=</span> svm_model.predict(X_test)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co"># âœ… ë¼ë²¨(í´ë˜ìŠ¤ ì´ë¦„) ê°€ì ¸ì˜¤ê¸°: data.target_names ëŒ€ì‹  ì‚¬ìš©</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> svm_model.named_steps[<span class="st">"svm"</span>].classes_   <span class="co"># ì˜ˆ: ['Adelie','Chinstrap','Gentoo']</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co"># í‰ê°€</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"[k-NN] Accuracy:"</span>, accuracy_score(y_test, y_pred_svm))</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>cm <span class="op">=</span> confusion_matrix(y_test, y_pred_svm, labels<span class="op">=</span>labels)</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"[k-NN] Confusion matrix:</span><span class="ch">\n</span><span class="st">"</span>, cm)</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"[k-NN] Classification report:</span><span class="ch">\n</span><span class="st">"</span>,</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>      classification_report(y_test, y_pred_svm,</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>                            labels<span class="op">=</span>labels,</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>                            target_names<span class="op">=</span>labels.tolist()))</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="co"># (ì„ íƒ) ë³´ê¸° ì¢‹ê²Œ ê·¸ë¦¼ìœ¼ë¡œ ì¶œë ¥</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>disp <span class="op">=</span> ConfusionMatrixDisplay(confusion_matrix<span class="op">=</span>cm, display_labels<span class="op">=</span>labels)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>disp.plot(values_format<span class="op">=</span><span class="st">"d"</span>)</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre class="text"><code>[k-NN] Accuracy: 0.9855072463768116
[k-NN] Confusion matrix:
 [[29  1  0]
 [ 0 14  0]
 [ 0  0 25]]
[k-NN] Classification report:
               precision    recall  f1-score   support

      Adelie       1.00      0.97      0.98        30
   Chinstrap       0.93      1.00      0.97        14
      Gentoo       1.00      1.00      1.00        25

    accuracy                           0.99        69
   macro avg       0.98      0.99      0.98        69
weighted avg       0.99      0.99      0.99        69</code></pre>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/classification_ml_category_svmconfusion.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:40.0%"></p>
</figure>
</div>
<p><strong>ì‚¬í›„í™•ë¥  ì¶œë ¥</strong></p>
<div class="sourceCode" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">#ì‚¬í›„í™•ë¥  </span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.calibration <span class="im">import</span> CalibratedClassifierCV</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co"># svm_model ìì²´ê°€ Pipelineì´ì–´ë„ ê·¸ëŒ€ë¡œ ê°ìŒ€ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>svm_cal <span class="op">=</span> CalibratedClassifierCV(svm_model, method<span class="op">=</span><span class="st">"sigmoid"</span>, cv<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>svm_cal.fit(X_train, y_train)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>proba_svm <span class="op">=</span> svm_cal.predict_proba(X_test)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>classes_svm <span class="op">=</span> svm_cal.classes_</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>proba_svm_df <span class="op">=</span> pd.DataFrame(proba_svm, columns<span class="op">=</span>classes_svm)</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>display(proba_svm_df.head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre class="text"><code>
Adelie  Chinstrap   Gentoo
0   0.895637    0.077118    0.027245
1   0.944391    0.029562    0.026046
2   0.017208    0.026771    0.956021
3   0.036579    0.002759    0.960662
4   0.122979    0.866984    0.010037</code></pre>
<p><strong>ì„ê³„ê°’ ì¶œë ¥</strong></p>
<p>POS_LABEL = â€œGentooâ€: ì–‘ì„±, ë‹¤ë¥¸ ë‘ ì¢…ì€ â€œAdelieâ€ / â€œChinstrapâ€ ìŒì„±ìœ¼ë¡œ ë¶„ë¥˜í•˜ëŠ” ROC/PR(AUC/AP) ê³„ì‚°, ì„ê³„ê°’ 3ì¢…(Youden / FPR ì œì•½ / ë¹„ìš©ê¸°ë°˜) ì„ íƒ, ëª¨ë¸ë³„ ë¹„êµí‘œ(DataFrame) ìƒì„±í•œë‹¤.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> roc_curve, auc, average_precision_score, confusion_matrix</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co"># âœ… ë©€í‹°í´ë˜ìŠ¤ì—ì„œ "ì–‘ì„± í´ë˜ìŠ¤" í•˜ë‚˜ë¥¼ ì§€ì • (ì›í•˜ëŠ” ê±¸ë¡œ ë°”ê¾¸ì„¸ìš”)</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>POS_LABEL <span class="op">=</span> <span class="st">"Gentoo"</span>   <span class="co"># "Adelie" / "Chinstrap" ë„ ê°€ëŠ¥</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _get_classes(model):</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Pipelineì´ë©´ ë§ˆì§€ë§‰ estimatorì˜ classes_ë¥¼ ê°€ì ¸ì˜¤ë„ë¡ ë³´ê°•</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    classes <span class="op">=</span> <span class="bu">getattr</span>(model, <span class="st">"classes_"</span>, <span class="va">None</span>)</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> classes <span class="kw">is</span> <span class="va">None</span> <span class="kw">and</span> <span class="bu">hasattr</span>(model, <span class="st">"named_steps"</span>):</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>        last <span class="op">=</span> <span class="bu">list</span>(model.named_steps.values())[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>        classes <span class="op">=</span> <span class="bu">getattr</span>(last, <span class="st">"classes_"</span>, <span class="va">None</span>)</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">None</span> <span class="cf">if</span> classes <span class="kw">is</span> <span class="va">None</span> <span class="cf">else</span> np.array(classes)</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_pos_score(model, X, pos_label):</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    classes <span class="op">=</span> _get_classes(model)</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 1) predict_proba ìš°ì„ </span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">hasattr</span>(model, <span class="st">"predict_proba"</span>):</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>        proba <span class="op">=</span> model.predict_proba(X)</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>        proba <span class="op">=</span> np.asarray(proba)</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> proba.ndim <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> proba</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> classes <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"classes_ë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. (Pipeline/Estimator í™•ì¸ í•„ìš”)"</span>)</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>        idx <span class="op">=</span> np.where(classes <span class="op">==</span> pos_label)[<span class="dv">0</span>]</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(idx) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"pos_label=</span><span class="sc">{</span>pos_label<span class="sc">}</span><span class="ss"> ê°€ classes_ì— ì—†ìŠµë‹ˆë‹¤: </span><span class="sc">{</span>classes<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> proba[:, idx[<span class="dv">0</span>]]</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 2) ì—†ìœ¼ë©´ decision_function ì‚¬ìš© (LinearSVCëŠ” ì—¬ê¸°ë¡œ ì˜´)</span></span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">hasattr</span>(model, <span class="st">"decision_function"</span>):</span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>        s <span class="op">=</span> np.asarray(model.decision_function(X))</span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> s.ndim <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> s</span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> s.ndim <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> classes <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>                <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"decision_functionì´ 2Dì¸ë° classes_ë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤."</span>)</span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a>            idx <span class="op">=</span> np.where(classes <span class="op">==</span> pos_label)[<span class="dv">0</span>]</span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">len</span>(idx) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a>                <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"pos_label=</span><span class="sc">{</span>pos_label<span class="sc">}</span><span class="ss"> ê°€ classes_ì— ì—†ìŠµë‹ˆë‹¤: </span><span class="sc">{</span>classes<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> s[:, idx[<span class="dv">0</span>]]</span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"</span><span class="sc">{</span><span class="bu">type</span>(model)<span class="sc">}</span><span class="ss">: predict_proba/decision_function ë‘˜ ë‹¤ ì—†ìŠµë‹ˆë‹¤."</span>)</span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> metrics_at_threshold(y_true01, score, t):</span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a>    y_hat <span class="op">=</span> (score <span class="op">&gt;=</span> t).astype(<span class="bu">int</span>)</span>
<span id="cb16-49"><a href="#cb16-49" aria-hidden="true" tabindex="-1"></a>    cm <span class="op">=</span> confusion_matrix(y_true01, y_hat, labels<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb16-50"><a href="#cb16-50" aria-hidden="true" tabindex="-1"></a>    tn, fp, fn, tp <span class="op">=</span> cm.ravel()</span>
<span id="cb16-51"><a href="#cb16-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-52"><a href="#cb16-52" aria-hidden="true" tabindex="-1"></a>    tpr <span class="op">=</span> tp <span class="op">/</span> (tp <span class="op">+</span> fn) <span class="cf">if</span> (tp <span class="op">+</span> fn) <span class="cf">else</span> <span class="fl">0.0</span></span>
<span id="cb16-53"><a href="#cb16-53" aria-hidden="true" tabindex="-1"></a>    fpr <span class="op">=</span> fp <span class="op">/</span> (fp <span class="op">+</span> tn) <span class="cf">if</span> (fp <span class="op">+</span> tn) <span class="cf">else</span> <span class="fl">0.0</span></span>
<span id="cb16-54"><a href="#cb16-54" aria-hidden="true" tabindex="-1"></a>    prec <span class="op">=</span> tp <span class="op">/</span> (tp <span class="op">+</span> fp) <span class="cf">if</span> (tp <span class="op">+</span> fp) <span class="cf">else</span> <span class="fl">0.0</span></span>
<span id="cb16-55"><a href="#cb16-55" aria-hidden="true" tabindex="-1"></a>    acc <span class="op">=</span> (tp <span class="op">+</span> tn) <span class="op">/</span> (tp <span class="op">+</span> tn <span class="op">+</span> fp <span class="op">+</span> fn) <span class="cf">if</span> (tp <span class="op">+</span> tn <span class="op">+</span> fp <span class="op">+</span> fn) <span class="cf">else</span> <span class="fl">0.0</span></span>
<span id="cb16-56"><a href="#cb16-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-57"><a href="#cb16-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb16-58"><a href="#cb16-58" aria-hidden="true" tabindex="-1"></a>        <span class="st">"t"</span>: <span class="bu">float</span>(t),</span>
<span id="cb16-59"><a href="#cb16-59" aria-hidden="true" tabindex="-1"></a>        <span class="st">"tn"</span>: <span class="bu">int</span>(tn), <span class="st">"fp"</span>: <span class="bu">int</span>(fp), <span class="st">"fn"</span>: <span class="bu">int</span>(fn), <span class="st">"tp"</span>: <span class="bu">int</span>(tp),</span>
<span id="cb16-60"><a href="#cb16-60" aria-hidden="true" tabindex="-1"></a>        <span class="st">"recall(tpr)"</span>: <span class="bu">float</span>(tpr),</span>
<span id="cb16-61"><a href="#cb16-61" aria-hidden="true" tabindex="-1"></a>        <span class="st">"fpr"</span>: <span class="bu">float</span>(fpr),</span>
<span id="cb16-62"><a href="#cb16-62" aria-hidden="true" tabindex="-1"></a>        <span class="st">"precision"</span>: <span class="bu">float</span>(prec),</span>
<span id="cb16-63"><a href="#cb16-63" aria-hidden="true" tabindex="-1"></a>        <span class="st">"accuracy"</span>: <span class="bu">float</span>(acc),</span>
<span id="cb16-64"><a href="#cb16-64" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-65"><a href="#cb16-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-66"><a href="#cb16-66" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> best_thresholds(y_true01, score, alpha<span class="op">=</span><span class="fl">0.001</span>, c_fn<span class="op">=</span><span class="fl">100.0</span>, c_fp<span class="op">=</span><span class="fl">1.0</span>):</span>
<span id="cb16-67"><a href="#cb16-67" aria-hidden="true" tabindex="-1"></a>    fpr, tpr, thr <span class="op">=</span> roc_curve(y_true01, score)  <span class="co"># y_true01ì€ 0/1ì´ì–´ì•¼ í•¨</span></span>
<span id="cb16-68"><a href="#cb16-68" aria-hidden="true" tabindex="-1"></a>    roc_auc <span class="op">=</span> auc(fpr, tpr)</span>
<span id="cb16-69"><a href="#cb16-69" aria-hidden="true" tabindex="-1"></a>    ap <span class="op">=</span> average_precision_score(y_true01, score)</span>
<span id="cb16-70"><a href="#cb16-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-71"><a href="#cb16-71" aria-hidden="true" tabindex="-1"></a>    finite <span class="op">=</span> np.isfinite(thr)</span>
<span id="cb16-72"><a href="#cb16-72" aria-hidden="true" tabindex="-1"></a>    thr_fin, fpr_fin, tpr_fin <span class="op">=</span> thr[finite], fpr[finite], tpr[finite]</span>
<span id="cb16-73"><a href="#cb16-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-74"><a href="#cb16-74" aria-hidden="true" tabindex="-1"></a>    <span class="co"># (A) Youden</span></span>
<span id="cb16-75"><a href="#cb16-75" aria-hidden="true" tabindex="-1"></a>    J <span class="op">=</span> tpr_fin <span class="op">-</span> fpr_fin</span>
<span id="cb16-76"><a href="#cb16-76" aria-hidden="true" tabindex="-1"></a>    t_y <span class="op">=</span> <span class="bu">float</span>(thr_fin[np.argmax(J)])</span>
<span id="cb16-77"><a href="#cb16-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-78"><a href="#cb16-78" aria-hidden="true" tabindex="-1"></a>    <span class="co"># (B) FPR&lt;=alpha ì¤‘ TPR ìµœëŒ€</span></span>
<span id="cb16-79"><a href="#cb16-79" aria-hidden="true" tabindex="-1"></a>    cand <span class="op">=</span> np.where((fpr_fin <span class="op">&lt;=</span> alpha) <span class="op">&amp;</span> (tpr_fin <span class="op">&gt;</span> <span class="dv">0</span>))[<span class="dv">0</span>]</span>
<span id="cb16-80"><a href="#cb16-80" aria-hidden="true" tabindex="-1"></a>    t_f <span class="op">=</span> <span class="bu">float</span>(thr_fin[cand[np.argmax(tpr_fin[cand])]]) <span class="cf">if</span> <span class="bu">len</span>(cand) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb16-81"><a href="#cb16-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-82"><a href="#cb16-82" aria-hidden="true" tabindex="-1"></a>    <span class="co"># (C) ë¹„ìš© ê¸°ë°˜</span></span>
<span id="cb16-83"><a href="#cb16-83" aria-hidden="true" tabindex="-1"></a>    cand_thr <span class="op">=</span> np.r_[<span class="op">-</span>np.inf, thr_fin, np.inf]</span>
<span id="cb16-84"><a href="#cb16-84" aria-hidden="true" tabindex="-1"></a>    best_t, best_cost <span class="op">=</span> <span class="va">None</span>, np.inf</span>
<span id="cb16-85"><a href="#cb16-85" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> t <span class="kw">in</span> cand_thr:</span>
<span id="cb16-86"><a href="#cb16-86" aria-hidden="true" tabindex="-1"></a>        m <span class="op">=</span> metrics_at_threshold(y_true01, score, t)</span>
<span id="cb16-87"><a href="#cb16-87" aria-hidden="true" tabindex="-1"></a>        cost <span class="op">=</span> c_fn <span class="op">*</span> m[<span class="st">"fn"</span>] <span class="op">+</span> c_fp <span class="op">*</span> m[<span class="st">"fp"</span>]</span>
<span id="cb16-88"><a href="#cb16-88" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> cost <span class="op">&lt;</span> best_cost:</span>
<span id="cb16-89"><a href="#cb16-89" aria-hidden="true" tabindex="-1"></a>            best_cost, best_t <span class="op">=</span> cost, <span class="bu">float</span>(t)</span>
<span id="cb16-90"><a href="#cb16-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-91"><a href="#cb16-91" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {<span class="st">"roc_auc"</span>: <span class="bu">float</span>(roc_auc), <span class="st">"ap"</span>: <span class="bu">float</span>(ap),</span>
<span id="cb16-92"><a href="#cb16-92" aria-hidden="true" tabindex="-1"></a>            <span class="st">"t_youden"</span>: t_y, <span class="st">"t_fpr"</span>: t_f,</span>
<span id="cb16-93"><a href="#cb16-93" aria-hidden="true" tabindex="-1"></a>            <span class="st">"t_cost"</span>: best_t, <span class="st">"best_cost"</span>: <span class="bu">float</span>(best_cost)}</span>
<span id="cb16-94"><a href="#cb16-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-95"><a href="#cb16-95" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> summarize_model(model_name, y_true01, score, alpha<span class="op">=</span><span class="fl">0.001</span>, c_fn<span class="op">=</span><span class="fl">100.0</span>, c_fp<span class="op">=</span><span class="fl">1.0</span>):</span>
<span id="cb16-96"><a href="#cb16-96" aria-hidden="true" tabindex="-1"></a>    info <span class="op">=</span> best_thresholds(y_true01, score, alpha<span class="op">=</span>alpha, c_fn<span class="op">=</span>c_fn, c_fp<span class="op">=</span>c_fp)</span>
<span id="cb16-97"><a href="#cb16-97" aria-hidden="true" tabindex="-1"></a>    rows <span class="op">=</span> []</span>
<span id="cb16-98"><a href="#cb16-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-99"><a href="#cb16-99" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Youden</span></span>
<span id="cb16-100"><a href="#cb16-100" aria-hidden="true" tabindex="-1"></a>    m <span class="op">=</span> metrics_at_threshold(y_true01, score, info[<span class="st">"t_youden"</span>])</span>
<span id="cb16-101"><a href="#cb16-101" aria-hidden="true" tabindex="-1"></a>    m.update({<span class="st">"model"</span>: model_name, <span class="st">"rule"</span>: <span class="st">"Youden (TPR-FPR)"</span>,</span>
<span id="cb16-102"><a href="#cb16-102" aria-hidden="true" tabindex="-1"></a>              <span class="st">"roc_auc"</span>: info[<span class="st">"roc_auc"</span>], <span class="st">"ap"</span>: info[<span class="st">"ap"</span>],</span>
<span id="cb16-103"><a href="#cb16-103" aria-hidden="true" tabindex="-1"></a>              <span class="st">"cost"</span>: c_fn<span class="op">*</span>m[<span class="st">"fn"</span>] <span class="op">+</span> c_fp<span class="op">*</span>m[<span class="st">"fp"</span>]})</span>
<span id="cb16-104"><a href="#cb16-104" aria-hidden="true" tabindex="-1"></a>    rows.append(m)</span>
<span id="cb16-105"><a href="#cb16-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-106"><a href="#cb16-106" aria-hidden="true" tabindex="-1"></a>    <span class="co"># FPR constraint</span></span>
<span id="cb16-107"><a href="#cb16-107" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> info[<span class="st">"t_fpr"</span>] <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb16-108"><a href="#cb16-108" aria-hidden="true" tabindex="-1"></a>        m <span class="op">=</span> metrics_at_threshold(y_true01, score, info[<span class="st">"t_fpr"</span>])</span>
<span id="cb16-109"><a href="#cb16-109" aria-hidden="true" tabindex="-1"></a>        m.update({<span class="st">"model"</span>: model_name, <span class="st">"rule"</span>: <span class="ss">f"FPR &lt;= </span><span class="sc">{</span>alpha<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb16-110"><a href="#cb16-110" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"roc_auc"</span>: info[<span class="st">"roc_auc"</span>], <span class="st">"ap"</span>: info[<span class="st">"ap"</span>],</span>
<span id="cb16-111"><a href="#cb16-111" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"cost"</span>: c_fn<span class="op">*</span>m[<span class="st">"fn"</span>] <span class="op">+</span> c_fp<span class="op">*</span>m[<span class="st">"fp"</span>]})</span>
<span id="cb16-112"><a href="#cb16-112" aria-hidden="true" tabindex="-1"></a>        rows.append(m)</span>
<span id="cb16-113"><a href="#cb16-113" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb16-114"><a href="#cb16-114" aria-hidden="true" tabindex="-1"></a>        rows.append({<span class="st">"model"</span>: model_name, <span class="st">"rule"</span>: <span class="ss">f"FPR &lt;= </span><span class="sc">{</span>alpha<span class="sc">}</span><span class="ss">"</span>, <span class="st">"t"</span>: <span class="va">None</span>,</span>
<span id="cb16-115"><a href="#cb16-115" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"tn"</span>: <span class="va">None</span>, <span class="st">"fp"</span>: <span class="va">None</span>, <span class="st">"fn"</span>: <span class="va">None</span>, <span class="st">"tp"</span>: <span class="va">None</span>,</span>
<span id="cb16-116"><a href="#cb16-116" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"recall(tpr)"</span>: <span class="va">None</span>, <span class="st">"fpr"</span>: <span class="va">None</span>, <span class="st">"precision"</span>: <span class="va">None</span>, <span class="st">"accuracy"</span>: <span class="va">None</span>,</span>
<span id="cb16-117"><a href="#cb16-117" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"roc_auc"</span>: info[<span class="st">"roc_auc"</span>], <span class="st">"ap"</span>: info[<span class="st">"ap"</span>], <span class="st">"cost"</span>: <span class="va">None</span>})</span>
<span id="cb16-118"><a href="#cb16-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-119"><a href="#cb16-119" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Cost-based</span></span>
<span id="cb16-120"><a href="#cb16-120" aria-hidden="true" tabindex="-1"></a>    m <span class="op">=</span> metrics_at_threshold(y_true01, score, info[<span class="st">"t_cost"</span>])</span>
<span id="cb16-121"><a href="#cb16-121" aria-hidden="true" tabindex="-1"></a>    m.update({<span class="st">"model"</span>: model_name, <span class="st">"rule"</span>: <span class="ss">f"Cost (c_fn=</span><span class="sc">{</span>c_fn<span class="sc">}</span><span class="ss">, c_fp=</span><span class="sc">{</span>c_fp<span class="sc">}</span><span class="ss">)"</span>,</span>
<span id="cb16-122"><a href="#cb16-122" aria-hidden="true" tabindex="-1"></a>              <span class="st">"roc_auc"</span>: info[<span class="st">"roc_auc"</span>], <span class="st">"ap"</span>: info[<span class="st">"ap"</span>],</span>
<span id="cb16-123"><a href="#cb16-123" aria-hidden="true" tabindex="-1"></a>              <span class="st">"cost"</span>: info[<span class="st">"best_cost"</span>]})</span>
<span id="cb16-124"><a href="#cb16-124" aria-hidden="true" tabindex="-1"></a>    rows.append(m)</span>
<span id="cb16-125"><a href="#cb16-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-126"><a href="#cb16-126" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> rows</span>
<span id="cb16-127"><a href="#cb16-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-128"><a href="#cb16-128" aria-hidden="true" tabindex="-1"></a><span class="co"># -----------------------------</span></span>
<span id="cb16-129"><a href="#cb16-129" aria-hidden="true" tabindex="-1"></a><span class="co"># âœ… ì‹¤í–‰ë¶€ (ë©€í‹°í´ë˜ìŠ¤ â†’ one-vs-restë¡œ 0/1 ë§Œë“¤ê¸°)</span></span>
<span id="cb16-130"><a href="#cb16-130" aria-hidden="true" tabindex="-1"></a><span class="co"># -----------------------------</span></span>
<span id="cb16-131"><a href="#cb16-131" aria-hidden="true" tabindex="-1"></a>y_test_arr <span class="op">=</span> np.asarray(y_test)</span>
<span id="cb16-132"><a href="#cb16-132" aria-hidden="true" tabindex="-1"></a>y_pos <span class="op">=</span> (y_test_arr <span class="op">==</span> POS_LABEL).astype(<span class="bu">int</span>)</span>
<span id="cb16-133"><a href="#cb16-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-134"><a href="#cb16-134" aria-hidden="true" tabindex="-1"></a><span class="co"># ì–‘ì„±/ìŒì„±ì´ ë‘˜ ë‹¤ ìˆì–´ì•¼ ROC ê³„ì‚° ê°€ëŠ¥</span></span>
<span id="cb16-135"><a href="#cb16-135" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> y_pos.<span class="bu">sum</span>() <span class="op">==</span> <span class="dv">0</span> <span class="kw">or</span> y_pos.<span class="bu">sum</span>() <span class="op">==</span> <span class="bu">len</span>(y_pos):</span>
<span id="cb16-136"><a href="#cb16-136" aria-hidden="true" tabindex="-1"></a>    <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"y_testì— '</span><span class="sc">{</span>POS_LABEL<span class="sc">}</span><span class="ss">' ì–‘ì„±/ìŒì„±ì´ í•œìª½ë§Œ ìˆìŠµë‹ˆë‹¤. POS_LABELì´ë‚˜ splitì„ í™•ì¸í•˜ì„¸ìš”."</span>)</span>
<span id="cb16-137"><a href="#cb16-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-138"><a href="#cb16-138" aria-hidden="true" tabindex="-1"></a>models <span class="op">=</span> {</span>
<span id="cb16-139"><a href="#cb16-139" aria-hidden="true" tabindex="-1"></a>    <span class="st">"k-NN"</span>: knn_model,</span>
<span id="cb16-140"><a href="#cb16-140" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SVM(LinearSVC)"</span>: svm_model,</span>
<span id="cb16-141"><a href="#cb16-141" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-142"><a href="#cb16-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-143"><a href="#cb16-143" aria-hidden="true" tabindex="-1"></a>alpha <span class="op">=</span> <span class="fl">0.001</span></span>
<span id="cb16-144"><a href="#cb16-144" aria-hidden="true" tabindex="-1"></a>c_fn, c_fp <span class="op">=</span> <span class="fl">100.0</span>, <span class="fl">1.0</span></span>
<span id="cb16-145"><a href="#cb16-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-146"><a href="#cb16-146" aria-hidden="true" tabindex="-1"></a>rows <span class="op">=</span> []</span>
<span id="cb16-147"><a href="#cb16-147" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name, model <span class="kw">in</span> models.items():</span>
<span id="cb16-148"><a href="#cb16-148" aria-hidden="true" tabindex="-1"></a>    score <span class="op">=</span> get_pos_score(model, X_test, pos_label<span class="op">=</span>POS_LABEL)  <span class="co"># âœ… POS_LABEL ì»¬ëŸ¼ ì ìˆ˜</span></span>
<span id="cb16-149"><a href="#cb16-149" aria-hidden="true" tabindex="-1"></a>    rows <span class="op">+=</span> summarize_model(name, y_pos, score, alpha<span class="op">=</span>alpha, c_fn<span class="op">=</span>c_fn, c_fp<span class="op">=</span>c_fp)</span>
<span id="cb16-150"><a href="#cb16-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-151"><a href="#cb16-151" aria-hidden="true" tabindex="-1"></a>df_cmp <span class="op">=</span> pd.DataFrame(rows)[</span>
<span id="cb16-152"><a href="#cb16-152" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"model"</span>,<span class="st">"rule"</span>,<span class="st">"t"</span>,<span class="st">"tn"</span>,<span class="st">"fp"</span>,<span class="st">"fn"</span>,<span class="st">"tp"</span>,<span class="st">"recall(tpr)"</span>,<span class="st">"fpr"</span>,<span class="st">"precision"</span>,<span class="st">"accuracy"</span>,<span class="st">"roc_auc"</span>,<span class="st">"ap"</span>,<span class="st">"cost"</span>]</span>
<span id="cb16-153"><a href="#cb16-153" aria-hidden="true" tabindex="-1"></a>].sort_values([<span class="st">"rule"</span>,<span class="st">"model"</span>]).reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb16-154"><a href="#cb16-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-155"><a href="#cb16-155" aria-hidden="true" tabindex="-1"></a>display(df_cmp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>ì™œ k-NN ì ìˆ˜ê°€ 1.0ì´ ìì£¼ ë‚˜ì˜¤ë‚˜?</strong></p>
<p>ê²°ê³¼ë¥¼ ë³´ë©´ ( tn=44, tp=25, fp=0, fn=0 )ë¥¼ ë³´ë©´, k-NNì˜ POS_LABEL(Gentoo) ì ìˆ˜ê°€ â€œ1.0ì¸ ìƒ˜í”Œ = ì „ë¶€ Gentooâ€, â€œ1.0 ë¯¸ë§Œ = ì „ë¶€ ë¹„-Gentooâ€ë¡œ ì™„ë²½ ë¶„ë¦¬ê°€ ëœ ìƒíƒœì´ë‹¤. ê·¸ë˜ì„œ Youden / FPRâ‰¤0.001 / Cost ê°™ì€ ì„ê³„ê°’ ì„ íƒ ê·œì¹™ì´ ì „ë¶€ â€œê°€ì¥ ë†’ì€ ì„ê³„ê°’â€ ìª½(=1.0)ì„ ê³¨ë¼ë„ ì„±ëŠ¥ì´ ì•ˆ ë–¨ì–´ì ¸ì„œ tê°€ í•­ìƒ 1.0ìœ¼ë¡œ ê³ ì •ë©ë‹ˆë‹¤.</p>
<p>k-NNì˜ predict_probaëŠ” ì´ì›ƒë“¤ì˜ â€œíˆ¬í‘œ ë¹„ìœ¨â€ì´ë¼ì„œ ì´ë¡ ì ìœ¼ë¡œ 0~1 ì‚¬ì´ì˜ ì´ì‚°ê°’ë§Œ ë‚˜ì˜¨ë‹¤. íŠ¹íˆ weights=â€œdistanceâ€ì¼ ë•ŒëŠ” ì•„ë˜ ìƒí™©ì—ì„œ í™•ë¥ ì´ ì •í™•íˆ 1.0ì´ ì‰½ê²Œ ë‚˜ì˜¨ë‹¤. ê±°ë¦¬ 0ì¸ ì´ì›ƒ(ì™„ì „íˆ ë™ì¼í•œ ì „ì²˜ë¦¬ ê²°ê³¼) ì´ ì¡´ì¬ â†’ scikit-learnì€ ê±°ë¦¬ 0ì´ë©´ ê·¸ ì´ì›ƒ(ë“¤)ì—ê²Œ ì‚¬ì‹¤ìƒ ëª¨ë“  ê°€ì¤‘ì¹˜ê°€ ëª°ë ¤ì„œ í•œ í´ë˜ìŠ¤ í™•ë¥ ì´ 1.0ì´ ë  ìˆ˜ ìˆë‹¤.</p>
<p>ë˜ëŠ” kê°œ ì´ì›ƒì´ ì „ë¶€ ê°™ì€ í´ë˜ìŠ¤ â†’ ê·¸ í´ë˜ìŠ¤ í™•ë¥ ì´ 1.0. í­ê·„ ë°ì´í„°ì²˜ëŸ¼ í´ë˜ìŠ¤ê°€ ì˜ ë¶„ë¦¬ë˜ê±°ë‚˜, ê²°ì¸¡ì¹˜ ëŒ€ì¹˜/ì›í•«/ìŠ¤ì¼€ì¼ë§ í›„ì— ë™ì¼í•œ íŒ¨í„´ì´ ìƒê¸°ë©´ ì´ëŸ° ì¼ì´ ë” ì˜ ìƒê¹ë‹ˆë‹¤.</p>
<pre class="text"><code>    model   rule    t   tn  fp  fn  tp  recall(tpr) fpr precision   accuracy    roc_auc ap  cost
0   SVM(LinearSVC)  Cost (c_fn=100.0, c_fp=1.0) 0.656852    44  0   0   25  1.0 0.0 1.0 1.0 1.0 1.0 0.0
1   k-NN    Cost (c_fn=100.0, c_fp=1.0) 1.000000    44  0   0   25  1.0 0.0 1.0 1.0 1.0 1.0 0.0
2   SVM(LinearSVC)  FPR &lt;= 0.001    0.656852    44  0   0   25  1.0 0.0 1.0 1.0 1.0 1.0 0.0
3   k-NN    FPR &lt;= 0.001    1.000000    44  0   0   25  1.0 0.0 1.0 1.0 1.0 1.0 0.0
4   SVM(LinearSVC)  Youden (TPR-FPR)    0.656852    44  0   0   25  1.0 0.0 1.0 1.0 1.0 1.0 0.0
5   k-NN    Youden (TPR-FPR)    1.000000    44  0   0   25  1.0 0.0 1.0 1.0 1.0 1.0 0.0</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>score_knn <span class="op">=</span> get_pos_score(knn_model, X_test, pos_label<span class="op">=</span>POS_LABEL)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>y_pos <span class="op">=</span> (np.asarray(y_test) <span class="op">==</span> POS_LABEL).astype(<span class="bu">int</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>pos_scores <span class="op">=</span> score_knn[y_pos <span class="op">==</span> <span class="dv">1</span>]</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>neg_scores <span class="op">=</span> score_knn[y_pos <span class="op">==</span> <span class="dv">0</span>]</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"unique scores (top 20):"</span>, np.unique(score_knn)[:<span class="dv">20</span>])</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"count(score==1):"</span>, np.<span class="bu">sum</span>(score_knn <span class="op">==</span> <span class="fl">1.0</span>))</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"pos min:"</span>, pos_scores.<span class="bu">min</span>(), <span class="st">"neg max:"</span>, neg_scores.<span class="bu">max</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>ì§€ê¸ˆ ì¶œë ¥ì€ k-NNì´ Gentoo(POS_LABEL)ë¥¼ ê±°ì˜ ì™„ë²½í•˜ê²Œ ë¶„ë¦¬í•˜ê³  ìˆë‹¤ëŠ” ì‹ í˜¸ì˜ˆìš”.</p>
<p>ì´ ê²°ê³¼ê°€ ì˜ë¯¸í•˜ëŠ” ê²ƒ</p>
<p>unique scores = [0, 0.03668, 0.05069, 1] â†’ Gentoo í™•ë¥ (p(Gentoo))ì´ ë”± 4ê°€ì§€ ê°’ë§Œ ë‚˜ì˜µë‹ˆë‹¤.</p>
<p>count(score==1): 25 â†’ í…ŒìŠ¤íŠ¸ì—ì„œ p(Gentoo)=1ì¸ ìƒ˜í”Œì´ 25ê°œ.</p>
<p>pos min: 1.0 â†’ ì‹¤ì œ Gentooì¸ ìƒ˜í”Œì€ ì „ë¶€ p(Gentoo)=1 (ìµœì†Œê°€ 1ì´ë‹ˆê¹Œ ì „ë¶€ 1).</p>
<p>neg max: 0.050686â€¦ â†’ Gentooê°€ ì•„ë‹Œ ìƒ˜í”Œ ì¤‘ ê°€ì¥ í° p(Gentoo)ë„ 0.05 ì •ë„.</p>
<p>ì¦‰, í…ŒìŠ¤íŠ¸ì…‹ì—ì„œ</p>
<p>ì–‘ì„±(Gentoo): ì ìˆ˜ = ì „ë¶€ 1</p>
<p>ìŒì„±(ë¹„ Gentoo): ì ìˆ˜ = ìµœëŒ€ 0.0507</p>
<p>ì´ë¼ì„œ <strong>0.0507ê³¼ 1 ì‚¬ì´ì— í° â€œê°„ê²©(gap)â€</strong>ì´ ìƒê¹ë‹ˆë‹¤. ê·¸ë˜ì„œ ì„ê³„ê°’ì„ të¡œ ì¡ì„ ë•Œ 0.0507 &lt; t â‰¤ 1 ì•„ë¬´ê±°ë‚˜ ì„ íƒí•´ë„ TPR=1, FPR=0 (ì™„ë²½ ë¶„ë¥˜)ê°€ ë©ë‹ˆë‹¤. ì´ëŸ° ê²½ìš° ROC/AUC, ì„ê³„ê°’ íƒìƒ‰ì´ â€œì´ìƒí•˜ê²Œ ì‰¬ì›Œ ë³´ì´ê±°ë‚˜â€ ê°’ì´ ë­‰ì³ ë³´ì´ëŠ” ê²Œ ì •ìƒì´ì—ìš”.</p>
<p>ì™œ ì ìˆ˜ê°€ ì´ë ‡ê²Œ â€œì´ì‚°ì (ëª‡ ê°œ ê°’ë§Œ)â€ì¼ê¹Œ?</p>
<p>k-NNì˜ í™•ë¥ ì€ ë³¸ì§ˆì ìœ¼ë¡œ <strong>ì´ì›ƒë“¤ì˜ íˆ¬í‘œ(ê°€ì¤‘ì¹˜ í•© / ì „ì²´ ê°€ì¤‘ì¹˜ í•©)</strong>ë¼ì„œ,</p>
<p>ë°ì´í„°ê°€ ì˜ ë¶„ë¦¬ë˜ì–´ ìˆìœ¼ë©´ ë§ì€ ì ë“¤ì´ ì´ì›ƒì´ ì „ë¶€ Gentoo â†’ í™•ë¥  1,</p>
<p>í˜¹ì€ Gentoo ì´ì›ƒì´ ì•„ì˜ˆ ì—†ìŒ â†’ í™•ë¥  0,</p>
<p>ê²½ê³„ ê·¼ì²˜ ì¼ë¶€ë§Œ â€œì¡°ê¸ˆ ì„ì—¬â€ì„œ 0.03~0.05 ê°™ì€ ê°’ì´ ë‚˜ì˜µë‹ˆë‹¤.</p>
<p>(íŠ¹íˆ í­ê·„ ë°ì´í„°ëŠ” Gentooê°€ ëª‡ ê°œ ìˆ˜ì¹˜ íŠ¹ì„±ì—ì„œ ê½¤ ê¹”ë”í•˜ê²Œ êµ¬ë¶„ë˜ëŠ” í¸ì´ë¼ ì´ëŸ° íŒ¨í„´ì´ ìì£¼ ë‚˜ì˜µë‹ˆë‹¤.)</p>
<pre class="text"><code>unique scores (top 20): [0.         0.03668167 0.05068641 1.        ]
count(score==1): 25
pos min: 1.0 neg max: 0.0506864093164956</code></pre>
</section>
</section>
<section id="íŠ¸ë¦¬ê¸°ë°˜-ë¶„ë¥˜" class="level4">
<h4 class="anchored" data-anchor-id="íŠ¸ë¦¬ê¸°ë°˜-ë¶„ë¥˜">4. íŠ¸ë¦¬ê¸°ë°˜ ë¶„ë¥˜</h4>
<section id="logittreerfgb-ëª¨ë¸-í•™ìŠµ" class="level5">
<h5 class="anchored" data-anchor-id="logittreerfgb-ëª¨ë¸-í•™ìŠµ">(1) logit/tree/rf/gb ëª¨ë¸ í•™ìŠµ</h5>
<div class="sourceCode" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LogisticRegression</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.tree <span class="im">import</span> DecisionTreeClassifier</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier, GradientBoostingClassifier</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Logit</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>logit_model <span class="op">=</span> Pipeline([</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"preprocess"</span>, preprocess),</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"logit"</span>, LogisticRegression(max_iter<span class="op">=</span><span class="dv">2000</span>))</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>logit_model.fit(X_train, y_train)</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Tree</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>tree_model <span class="op">=</span> Pipeline([</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"preprocess"</span>, preprocess),</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"tree"</span>, DecisionTreeClassifier(random_state<span class="op">=</span><span class="dv">42</span>))</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>tree_model.fit(X_train, y_train)</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a><span class="co"># RandomForest</span></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>rf_model <span class="op">=</span> Pipeline([</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"preprocess"</span>, preprocess),</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"rf"</span>, RandomForestClassifier(</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>        n_estimators<span class="op">=</span><span class="dv">300</span>, random_state<span class="op">=</span><span class="dv">42</span></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>rf_model.fit(X_train, y_train)</span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a><span class="co"># GradientBoosting</span></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>gb_model <span class="op">=</span> Pipeline([</span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"preprocess"</span>, preprocess),</span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"gb"</span>, GradientBoostingClassifier(random_state<span class="op">=</span><span class="dv">42</span>))</span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>gb_model.fit(X_train, y_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/classification_ml_category_treebase.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:40.0%"></p>
</figure>
</div>
<p><strong>ëª¨ë¸í‰ê°€ ë° ì„ê³„ê°’ t ê²°ì •</strong></p>
<div class="sourceCode" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> roc_curve, auc, average_precision_score, confusion_matrix</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _get_classes(model):</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 1) ì¼ë°˜ estimator</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">hasattr</span>(model, <span class="st">"classes_"</span>):</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> np.array(model.classes_)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 2) Pipelineì´ë©´ ë§ˆì§€ë§‰ stepì—ì„œ classes_</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">hasattr</span>(model, <span class="st">"named_steps"</span>):</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>        last <span class="op">=</span> <span class="bu">list</span>(model.named_steps.values())[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">hasattr</span>(last, <span class="st">"classes_"</span>):</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> np.array(last.classes_)</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_pos_score(model, X, pos_label<span class="op">=</span><span class="dv">1</span>):</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 1) predict_proba ìš°ì„ </span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">hasattr</span>(model, <span class="st">"predict_proba"</span>):</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>        proba <span class="op">=</span> np.asarray(model.predict_proba(X))</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> proba.ndim <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> proba</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>        classes <span class="op">=</span> _get_classes(model)</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> classes <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"classes_ë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. (Pipeline/Estimator í™•ì¸ í•„ìš”)"</span>)</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>        idx <span class="op">=</span> np.where(classes <span class="op">==</span> pos_label)[<span class="dv">0</span>]</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(idx) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"pos_label=</span><span class="sc">{</span>pos_label<span class="sc">}</span><span class="ss"> ê°€ classes_ì— ì—†ìŠµë‹ˆë‹¤: </span><span class="sc">{</span>classes<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> proba[:, idx[<span class="dv">0</span>]]</span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 2) ì—†ìœ¼ë©´ decision_function (LinearSVC ë“±)</span></span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">hasattr</span>(model, <span class="st">"decision_function"</span>):</span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>        s <span class="op">=</span> np.asarray(model.decision_function(X))</span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> s.ndim <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> s.ravel()</span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a>        classes <span class="op">=</span> _get_classes(model)</span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> classes <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"decision_functionì´ 2Dì¸ë° classes_ë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤."</span>)</span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a>        idx <span class="op">=</span> np.where(classes <span class="op">==</span> pos_label)[<span class="dv">0</span>]</span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(idx) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"pos_label=</span><span class="sc">{</span>pos_label<span class="sc">}</span><span class="ss"> ê°€ classes_ì— ì—†ìŠµë‹ˆë‹¤: </span><span class="sc">{</span>classes<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> s[:, idx[<span class="dv">0</span>]]</span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"</span><span class="sc">{</span><span class="bu">type</span>(model)<span class="sc">}</span><span class="ss">: predict_proba/decision_function ë‘˜ ë‹¤ ì—†ìŒ"</span>)</span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-45"><a href="#cb21-45" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> metrics_at_threshold(y_true01, score, t):</span>
<span id="cb21-46"><a href="#cb21-46" aria-hidden="true" tabindex="-1"></a>    y_hat <span class="op">=</span> (score <span class="op">&gt;=</span> t).astype(<span class="bu">int</span>)</span>
<span id="cb21-47"><a href="#cb21-47" aria-hidden="true" tabindex="-1"></a>    cm <span class="op">=</span> confusion_matrix(y_true01, y_hat, labels<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">1</span>])  <span class="co"># âœ… í•­ìƒ 2x2 ë³´ì¥</span></span>
<span id="cb21-48"><a href="#cb21-48" aria-hidden="true" tabindex="-1"></a>    tn, fp, fn, tp <span class="op">=</span> cm.ravel()</span>
<span id="cb21-49"><a href="#cb21-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-50"><a href="#cb21-50" aria-hidden="true" tabindex="-1"></a>    tpr <span class="op">=</span> tp <span class="op">/</span> (tp <span class="op">+</span> fn) <span class="cf">if</span> (tp <span class="op">+</span> fn) <span class="cf">else</span> <span class="fl">0.0</span></span>
<span id="cb21-51"><a href="#cb21-51" aria-hidden="true" tabindex="-1"></a>    fpr <span class="op">=</span> fp <span class="op">/</span> (fp <span class="op">+</span> tn) <span class="cf">if</span> (fp <span class="op">+</span> tn) <span class="cf">else</span> <span class="fl">0.0</span></span>
<span id="cb21-52"><a href="#cb21-52" aria-hidden="true" tabindex="-1"></a>    prec <span class="op">=</span> tp <span class="op">/</span> (tp <span class="op">+</span> fp) <span class="cf">if</span> (tp <span class="op">+</span> fp) <span class="cf">else</span> <span class="fl">0.0</span></span>
<span id="cb21-53"><a href="#cb21-53" aria-hidden="true" tabindex="-1"></a>    acc <span class="op">=</span> (tp <span class="op">+</span> tn) <span class="op">/</span> (tp <span class="op">+</span> tn <span class="op">+</span> fp <span class="op">+</span> fn) <span class="cf">if</span> (tp <span class="op">+</span> tn <span class="op">+</span> fp <span class="op">+</span> fn) <span class="cf">else</span> <span class="fl">0.0</span></span>
<span id="cb21-54"><a href="#cb21-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {<span class="st">"t"</span>: <span class="bu">float</span>(t), <span class="st">"tn"</span>: <span class="bu">int</span>(tn), <span class="st">"fp"</span>: <span class="bu">int</span>(fp), <span class="st">"fn"</span>: <span class="bu">int</span>(fn), <span class="st">"tp"</span>: <span class="bu">int</span>(tp),</span>
<span id="cb21-55"><a href="#cb21-55" aria-hidden="true" tabindex="-1"></a>            <span class="st">"recall(tpr)"</span>: <span class="bu">float</span>(tpr), <span class="st">"fpr"</span>: <span class="bu">float</span>(fpr), <span class="st">"precision"</span>: <span class="bu">float</span>(prec), <span class="st">"accuracy"</span>: <span class="bu">float</span>(acc)}</span>
<span id="cb21-56"><a href="#cb21-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-57"><a href="#cb21-57" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> best_thresholds(y_true01, score, alpha<span class="op">=</span><span class="fl">0.001</span>, c_fn<span class="op">=</span><span class="fl">100.0</span>, c_fp<span class="op">=</span><span class="fl">1.0</span>):</span>
<span id="cb21-58"><a href="#cb21-58" aria-hidden="true" tabindex="-1"></a>    <span class="co"># âœ… ROC ê³„ì‚° ê°€ëŠ¥ ì—¬ë¶€ ì²´í¬ (í•œ í´ë˜ìŠ¤ë§Œ ìˆìœ¼ë©´ roc_curveê°€ ì—ëŸ¬)</span></span>
<span id="cb21-59"><a href="#cb21-59" aria-hidden="true" tabindex="-1"></a>    y_true01 <span class="op">=</span> np.asarray(y_true01).astype(<span class="bu">int</span>)</span>
<span id="cb21-60"><a href="#cb21-60" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> y_true01.<span class="bu">sum</span>() <span class="op">==</span> <span class="dv">0</span> <span class="kw">or</span> y_true01.<span class="bu">sum</span>() <span class="op">==</span> <span class="bu">len</span>(y_true01):</span>
<span id="cb21-61"><a href="#cb21-61" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"y_true01ì— 0/1ì´ ë‘˜ ë‹¤ ìˆì–´ì•¼ ROC ê³„ì‚°ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. split/ë°ì´í„° í™•ì¸!"</span>)</span>
<span id="cb21-62"><a href="#cb21-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-63"><a href="#cb21-63" aria-hidden="true" tabindex="-1"></a>    fpr, tpr, thr <span class="op">=</span> roc_curve(y_true01, score)</span>
<span id="cb21-64"><a href="#cb21-64" aria-hidden="true" tabindex="-1"></a>    roc_auc <span class="op">=</span> auc(fpr, tpr)</span>
<span id="cb21-65"><a href="#cb21-65" aria-hidden="true" tabindex="-1"></a>    ap <span class="op">=</span> average_precision_score(y_true01, score)</span>
<span id="cb21-66"><a href="#cb21-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-67"><a href="#cb21-67" aria-hidden="true" tabindex="-1"></a>    finite <span class="op">=</span> np.isfinite(thr)</span>
<span id="cb21-68"><a href="#cb21-68" aria-hidden="true" tabindex="-1"></a>    thr_fin, fpr_fin, tpr_fin <span class="op">=</span> thr[finite], fpr[finite], tpr[finite]</span>
<span id="cb21-69"><a href="#cb21-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-70"><a href="#cb21-70" aria-hidden="true" tabindex="-1"></a>    <span class="co"># (A) Youden</span></span>
<span id="cb21-71"><a href="#cb21-71" aria-hidden="true" tabindex="-1"></a>    J <span class="op">=</span> tpr_fin <span class="op">-</span> fpr_fin</span>
<span id="cb21-72"><a href="#cb21-72" aria-hidden="true" tabindex="-1"></a>    t_y <span class="op">=</span> <span class="bu">float</span>(thr_fin[np.argmax(J)])</span>
<span id="cb21-73"><a href="#cb21-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-74"><a href="#cb21-74" aria-hidden="true" tabindex="-1"></a>    <span class="co"># (B) FPR&lt;=alpha ì¤‘ TPR ìµœëŒ€</span></span>
<span id="cb21-75"><a href="#cb21-75" aria-hidden="true" tabindex="-1"></a>    cand <span class="op">=</span> np.where((fpr_fin <span class="op">&lt;=</span> alpha) <span class="op">&amp;</span> (tpr_fin <span class="op">&gt;</span> <span class="dv">0</span>))[<span class="dv">0</span>]</span>
<span id="cb21-76"><a href="#cb21-76" aria-hidden="true" tabindex="-1"></a>    t_f <span class="op">=</span> <span class="bu">float</span>(thr_fin[cand[np.argmax(tpr_fin[cand])]]) <span class="cf">if</span> <span class="bu">len</span>(cand) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb21-77"><a href="#cb21-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-78"><a href="#cb21-78" aria-hidden="true" tabindex="-1"></a>    <span class="co"># (C) ë¹„ìš© ê¸°ë°˜</span></span>
<span id="cb21-79"><a href="#cb21-79" aria-hidden="true" tabindex="-1"></a>    cand_thr <span class="op">=</span> np.r_[<span class="op">-</span>np.inf, thr_fin, np.inf]</span>
<span id="cb21-80"><a href="#cb21-80" aria-hidden="true" tabindex="-1"></a>    best_t, best_cost <span class="op">=</span> <span class="va">None</span>, np.inf</span>
<span id="cb21-81"><a href="#cb21-81" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> t <span class="kw">in</span> cand_thr:</span>
<span id="cb21-82"><a href="#cb21-82" aria-hidden="true" tabindex="-1"></a>        m <span class="op">=</span> metrics_at_threshold(y_true01, score, t)</span>
<span id="cb21-83"><a href="#cb21-83" aria-hidden="true" tabindex="-1"></a>        cost <span class="op">=</span> c_fn <span class="op">*</span> m[<span class="st">"fn"</span>] <span class="op">+</span> c_fp <span class="op">*</span> m[<span class="st">"fp"</span>]</span>
<span id="cb21-84"><a href="#cb21-84" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> cost <span class="op">&lt;</span> best_cost:</span>
<span id="cb21-85"><a href="#cb21-85" aria-hidden="true" tabindex="-1"></a>            best_cost, best_t <span class="op">=</span> cost, <span class="bu">float</span>(t)</span>
<span id="cb21-86"><a href="#cb21-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-87"><a href="#cb21-87" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {<span class="st">"roc_auc"</span>: <span class="bu">float</span>(roc_auc), <span class="st">"ap"</span>: <span class="bu">float</span>(ap),</span>
<span id="cb21-88"><a href="#cb21-88" aria-hidden="true" tabindex="-1"></a>            <span class="st">"t_youden"</span>: t_y, <span class="st">"t_fpr"</span>: t_f, <span class="st">"t_cost"</span>: best_t,</span>
<span id="cb21-89"><a href="#cb21-89" aria-hidden="true" tabindex="-1"></a>            <span class="st">"best_cost"</span>: <span class="bu">float</span>(best_cost)}</span>
<span id="cb21-90"><a href="#cb21-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-91"><a href="#cb21-91" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> summarize_model(model_name, y_true01, score, alpha<span class="op">=</span><span class="fl">0.001</span>, c_fn<span class="op">=</span><span class="fl">100.0</span>, c_fp<span class="op">=</span><span class="fl">1.0</span>):</span>
<span id="cb21-92"><a href="#cb21-92" aria-hidden="true" tabindex="-1"></a>    info <span class="op">=</span> best_thresholds(y_true01, score, alpha<span class="op">=</span>alpha, c_fn<span class="op">=</span>c_fn, c_fp<span class="op">=</span>c_fp)</span>
<span id="cb21-93"><a href="#cb21-93" aria-hidden="true" tabindex="-1"></a>    rows <span class="op">=</span> []</span>
<span id="cb21-94"><a href="#cb21-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-95"><a href="#cb21-95" aria-hidden="true" tabindex="-1"></a>    m <span class="op">=</span> metrics_at_threshold(y_true01, score, info[<span class="st">"t_youden"</span>])</span>
<span id="cb21-96"><a href="#cb21-96" aria-hidden="true" tabindex="-1"></a>    m.update({<span class="st">"model"</span>: model_name, <span class="st">"rule"</span>: <span class="st">"Youden (TPR-FPR)"</span>,</span>
<span id="cb21-97"><a href="#cb21-97" aria-hidden="true" tabindex="-1"></a>              <span class="st">"roc_auc"</span>: info[<span class="st">"roc_auc"</span>], <span class="st">"ap"</span>: info[<span class="st">"ap"</span>],</span>
<span id="cb21-98"><a href="#cb21-98" aria-hidden="true" tabindex="-1"></a>              <span class="st">"cost"</span>: c_fn<span class="op">*</span>m[<span class="st">"fn"</span>] <span class="op">+</span> c_fp<span class="op">*</span>m[<span class="st">"fp"</span>]})</span>
<span id="cb21-99"><a href="#cb21-99" aria-hidden="true" tabindex="-1"></a>    rows.append(m)</span>
<span id="cb21-100"><a href="#cb21-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-101"><a href="#cb21-101" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> info[<span class="st">"t_fpr"</span>] <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb21-102"><a href="#cb21-102" aria-hidden="true" tabindex="-1"></a>        m <span class="op">=</span> metrics_at_threshold(y_true01, score, info[<span class="st">"t_fpr"</span>])</span>
<span id="cb21-103"><a href="#cb21-103" aria-hidden="true" tabindex="-1"></a>        m.update({<span class="st">"model"</span>: model_name, <span class="st">"rule"</span>: <span class="ss">f"FPR &lt;= </span><span class="sc">{</span>alpha<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb21-104"><a href="#cb21-104" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"roc_auc"</span>: info[<span class="st">"roc_auc"</span>], <span class="st">"ap"</span>: info[<span class="st">"ap"</span>],</span>
<span id="cb21-105"><a href="#cb21-105" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"cost"</span>: c_fn<span class="op">*</span>m[<span class="st">"fn"</span>] <span class="op">+</span> c_fp<span class="op">*</span>m[<span class="st">"fp"</span>]})</span>
<span id="cb21-106"><a href="#cb21-106" aria-hidden="true" tabindex="-1"></a>        rows.append(m)</span>
<span id="cb21-107"><a href="#cb21-107" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb21-108"><a href="#cb21-108" aria-hidden="true" tabindex="-1"></a>        rows.append({<span class="st">"model"</span>: model_name, <span class="st">"rule"</span>: <span class="ss">f"FPR &lt;= </span><span class="sc">{</span>alpha<span class="sc">}</span><span class="ss">"</span>, <span class="st">"t"</span>: <span class="va">None</span>,</span>
<span id="cb21-109"><a href="#cb21-109" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"tn"</span>: <span class="va">None</span>, <span class="st">"fp"</span>: <span class="va">None</span>, <span class="st">"fn"</span>: <span class="va">None</span>, <span class="st">"tp"</span>: <span class="va">None</span>,</span>
<span id="cb21-110"><a href="#cb21-110" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"recall(tpr)"</span>: <span class="va">None</span>, <span class="st">"fpr"</span>: <span class="va">None</span>, <span class="st">"precision"</span>: <span class="va">None</span>, <span class="st">"accuracy"</span>: <span class="va">None</span>,</span>
<span id="cb21-111"><a href="#cb21-111" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"roc_auc"</span>: info[<span class="st">"roc_auc"</span>], <span class="st">"ap"</span>: info[<span class="st">"ap"</span>], <span class="st">"cost"</span>: <span class="va">None</span>})</span>
<span id="cb21-112"><a href="#cb21-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-113"><a href="#cb21-113" aria-hidden="true" tabindex="-1"></a>    m <span class="op">=</span> metrics_at_threshold(y_true01, score, info[<span class="st">"t_cost"</span>])</span>
<span id="cb21-114"><a href="#cb21-114" aria-hidden="true" tabindex="-1"></a>    m.update({<span class="st">"model"</span>: model_name, <span class="st">"rule"</span>: <span class="ss">f"Cost (c_fn=</span><span class="sc">{</span>c_fn<span class="sc">}</span><span class="ss">, c_fp=</span><span class="sc">{</span>c_fp<span class="sc">}</span><span class="ss">)"</span>,</span>
<span id="cb21-115"><a href="#cb21-115" aria-hidden="true" tabindex="-1"></a>              <span class="st">"roc_auc"</span>: info[<span class="st">"roc_auc"</span>], <span class="st">"ap"</span>: info[<span class="st">"ap"</span>], <span class="st">"cost"</span>: info[<span class="st">"best_cost"</span>]})</span>
<span id="cb21-116"><a href="#cb21-116" aria-hidden="true" tabindex="-1"></a>    rows.append(m)</span>
<span id="cb21-117"><a href="#cb21-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-118"><a href="#cb21-118" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> rows</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># âœ… ì–‘ì„±ìœ¼ë¡œ ë³¼ í´ë˜ìŠ¤ ì§€ì • (ì›í•˜ëŠ” ê±¸ë¡œ ë°”ê¾¸ì„¸ìš”)</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>POS_LABEL <span class="op">=</span> <span class="st">"Gentoo"</span>   <span class="co"># "Adelie" / "Chinstrap" ë„ ê°€ëŠ¥</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co"># âœ… y_test(ë¬¸ìì—´) -&gt; 0/1ë¡œ ë³€í™˜</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>y_pos <span class="op">=</span> (np.asarray(y_test) <span class="op">==</span> POS_LABEL).astype(<span class="bu">int</span>)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>models <span class="op">=</span> {</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"k-NN"</span>: knn_model,</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SVM(Linear+Calib)"</span>: svm_cal,   <span class="co"># í™•ë¥  ì“°ë ¤ë©´ calibration ë²„ì „</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Logit"</span>: logit_model,</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Tree"</span>: tree_model,</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"RandomForest"</span>: rf_model,</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"GradientBoosting"</span>: gb_model</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>alpha <span class="op">=</span> <span class="fl">0.001</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>c_fn, c_fp <span class="op">=</span> <span class="fl">100.0</span>, <span class="fl">1.0</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>rows <span class="op">=</span> []</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name, model <span class="kw">in</span> models.items():</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># âœ… pos_labelì„ 1ì´ ì•„ë‹ˆë¼ POS_LABEL(ë¬¸ìì—´)ë¡œ!</span></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>    score <span class="op">=</span> get_pos_score(model, X_test, pos_label<span class="op">=</span>POS_LABEL)</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>    rows <span class="op">+=</span> summarize_model(name, y_pos, score, alpha<span class="op">=</span>alpha, c_fn<span class="op">=</span>c_fn, c_fp<span class="op">=</span>c_fp)</span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>df_cmp <span class="op">=</span> pd.DataFrame(rows)[</span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"model"</span>,<span class="st">"rule"</span>,<span class="st">"t"</span>,<span class="st">"tn"</span>,<span class="st">"fp"</span>,<span class="st">"fn"</span>,<span class="st">"tp"</span>,<span class="st">"recall(tpr)"</span>,<span class="st">"fpr"</span>,<span class="st">"precision"</span>,<span class="st">"accuracy"</span>,<span class="st">"roc_auc"</span>,<span class="st">"ap"</span>,<span class="st">"cost"</span>]</span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>].sort_values([<span class="st">"rule"</span>,<span class="st">"model"</span>]).reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>display(df_cmp)</span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>df_t <span class="op">=</span> df_cmp.pivot(index<span class="op">=</span><span class="st">"model"</span>, columns<span class="op">=</span><span class="st">"rule"</span>, values<span class="op">=</span><span class="st">"t"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre class="text"><code>
model   rule    t   tn  fp  fn  tp  recall(tpr) fpr precision   accuracy    roc_auc ap  cost
0   GradientBoosting    Cost (c_fn=100.0, c_fp=1.0) 0.999803    44  0   0   25  1.0 0.0 1.0 1.0 1.0 1.0 0.0
1   Logit   Cost (c_fn=100.0, c_fp=1.0) 0.930046    44  0   0   25  1.0 0.0 1.0 1.0 1.0 1.0 0.0
2   RandomForest    Cost (c_fn=100.0, c_fp=1.0) 0.746667    44  0   0   25  1.0 0.0 1.0 1.0 1.0 1.0 0.0
3   SVM(Linear+Calib)   Cost (c_fn=100.0, c_fp=1.0) 0.635238    44  0   0   25  1.0 0.0 1.0 1.0 1.0 1.0 0.0
4   Tree    Cost (c_fn=100.0, c_fp=1.0) 1.000000    44  0   0   25  1.0 0.0 1.0 1.0 1.0 1.0 0.0
5   k-NN    Cost (c_fn=100.0, c_fp=1.0) 1.000000    44  0   0   25  1.0 0.0 1.0 1.0 1.0 1.0 0.0
6   GradientBoosting    FPR &lt;= 0.001    0.999803    44  0   0   25  1.0 0.0 1.0 1.0 1.0 1.0 0.0
7   Logit   FPR &lt;= 0.001    0.930046    44  0   0   25  1.0 0.0 1.0 1.0 1.0 1.0 0.0
8   RandomForest    FPR &lt;= 0.001    0.746667    44  0   0   25  1.0 0.0 1.0 1.0 1.0 1.0 0.0
9   SVM(Linear+Calib)   FPR &lt;= 0.001    0.635238    44  0   0   25  1.0 0.0 1.0 1.0 1.0 1.0 0.0
10  Tree    FPR &lt;= 0.001    1.000000    44  0   0   25  1.0 0.0 1.0 1.0 1.0 1.0 0.0
11  k-NN    FPR &lt;= 0.001    1.000000    44  0   0   25  1.0 0.0 1.0 1.0 1.0 1.0 0.0
12  GradientBoosting    Youden (TPR-FPR)    0.999803    44  0   0   25  1.0 0.0 1.0 1.0 1.0 1.0 0.0
13  Logit   Youden (TPR-FPR)    0.930046    44  0   0   25  1.0 0.0 1.0 1.0 1.0 1.0 0.0
14  RandomForest    Youden (TPR-FPR)    0.746667    44  0   0   25  1.0 0.0 1.0 1.0 1.0 1.0 0.0
15  SVM(Linear+Calib)   Youden (TPR-FPR)    0.635238    44  0   0   25  1.0 0.0 1.0 1.0 1.0 1.0 0.0
16  Tree    Youden (TPR-FPR)    1.000000    44  0   0   25  1.0 0.0 1.0 1.0 1.0 1.0 0.0
17  k-NN    Youden (TPR-FPR)    1.000000    44  0   0   25  1.0 0.0 1.0 1.0 1.0 1.0 0.0</code></pre>
</section>
<section id="ë‹¤í•­ë¡œì§“" class="level5">
<h5 class="anchored" data-anchor-id="ë‹¤í•­ë¡œì§“">(2) ë‹¤í•­ë¡œì§“</h5>
<p><strong>í˜¼ë™í–‰ë ¬ ì¶œë ¥</strong></p>
<div class="sourceCode" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co">#í˜¼ë™í–‰ë ¬ ì¶œë ¥</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score, confusion_matrix, classification_report, ConfusionMatrixDisplay</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ì˜ˆì¸¡</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>y_pred_logit <span class="op">=</span> logit_model.predict(X_test)</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="co"># âœ… ë¼ë²¨(í´ë˜ìŠ¤ ì´ë¦„) ê°€ì ¸ì˜¤ê¸°: data.target_names ëŒ€ì‹  ì‚¬ìš©</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> logit_model.named_steps[<span class="st">"logit"</span>].classes_   <span class="co"># ì˜ˆ: ['Adelie','Chinstrap','Gentoo']</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="co"># í‰ê°€</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"[logit]] Accuracy:"</span>, accuracy_score(y_test, y_pred_logit))</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>cm <span class="op">=</span> confusion_matrix(y_test, y_pred_logit, labels<span class="op">=</span>labels)</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"[logit] Confusion matrix:</span><span class="ch">\n</span><span class="st">"</span>, cm)</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"[logi] Classification report:</span><span class="ch">\n</span><span class="st">"</span>,</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>      classification_report(y_test, y_pred_logit,</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>                            labels<span class="op">=</span>labels,</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>                            target_names<span class="op">=</span>labels.tolist()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre class="text"><code>[logit]] Accuracy: 1.0
[logit] Confusion matrix:
 [[30  0  0]
 [ 0 14  0]
 [ 0  0 25]]
[logi] Classification report:
               precision    recall  f1-score   support

      Adelie       1.00      1.00      1.00        30
   Chinstrap       1.00      1.00      1.00        14
      Gentoo       1.00      1.00      1.00        25

    accuracy                           1.00        69
   macro avg       1.00      1.00      1.00        69
weighted avg       1.00      1.00      1.00        69</code></pre>
<p><strong>ì‚¬í›„í™•ë¥  ë° íšŒê·€ê³„ìˆ˜ ì¶œë ¥</strong></p>
<div class="sourceCode" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">#ì‚¬í›„í™•ë¥  ì¶œë ¥ ë° íšŒê·€ê³„ìˆ˜</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="co"># ===== 1) ì‚¬í›„í™•ë¥ (Posterior probabilities) =====</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>proba <span class="op">=</span> logit_model.predict_proba(X_test)  <span class="co"># (n_samples, n_classes)</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>classes <span class="op">=</span> logit_model.named_steps[<span class="st">"logit"</span>].classes_</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>proba_df <span class="op">=</span> pd.DataFrame(proba, columns<span class="op">=</span>classes)</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>display(proba_df.head())</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a><span class="co"># íŠ¹ì • í´ë˜ìŠ¤(ì˜ˆ: POS_LABEL) í™•ë¥ ë§Œ ë³´ê³  ì‹¶ìœ¼ë©´:</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>POS_LABEL <span class="op">=</span> <span class="st">"Gentoo"</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>pos_proba <span class="op">=</span> proba_df[POS_LABEL]</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>display(pos_proba.head())</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a><span class="co"># ===== 2) íšŒê·€ê³„ìˆ˜(coef) + ì ˆí¸(intercept) =====</span></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>logit <span class="op">=</span> logit_model.named_steps[<span class="st">"logit"</span>]</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>pre  <span class="op">=</span> logit_model.named_steps[<span class="st">"preprocess"</span>]</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a><span class="co"># ì „ì²˜ë¦¬ í›„ feature ì´ë¦„ ë½‘ê¸° (sklearn ìµœì‹  ë²„ì „ ê¸°ì¤€)</span></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>feat_names <span class="op">=</span> pre.get_feature_names_out()</span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>coef <span class="op">=</span> logit.coef_               <span class="co"># (n_classes, n_features) ë˜ëŠ” (1, n_features)</span></span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>intercept <span class="op">=</span> logit.intercept_     <span class="co"># (n_classes,) ë˜ëŠ” (1,)</span></span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a>coef_df <span class="op">=</span> pd.DataFrame(coef, columns<span class="op">=</span>feat_names, index<span class="op">=</span>classes)</span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a>intercept_s <span class="op">=</span> pd.Series(intercept, index<span class="op">=</span>classes, name<span class="op">=</span><span class="st">"intercept"</span>)</span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a>display(intercept_s)</span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a>display(coef_df.iloc[:, :<span class="dv">10</span>].head())  <span class="co"># ì¼ë¶€ë§Œ ë¯¸ë¦¬ë³´ê¸°</span></span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a><span class="co"># ê° í´ë˜ìŠ¤ë³„ë¡œ |ê³„ìˆ˜| í° ìƒìœ„ 15ê°œ ë³´ê¸°</span></span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a>topk <span class="op">=</span> <span class="dv">15</span></span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> c <span class="kw">in</span> classes:</span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a>    s <span class="op">=</span> coef_df.loc[c].sort_values(key<span class="op">=</span><span class="kw">lambda</span> x: np.<span class="bu">abs</span>(x), ascending<span class="op">=</span><span class="va">False</span>).head(topk)</span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">=== Top </span><span class="sc">{</span>topk<span class="sc">}</span><span class="ss"> coefficients for class: </span><span class="sc">{</span>c<span class="sc">}</span><span class="ss"> ==="</span>)</span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true" tabindex="-1"></a>    display(s)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>í‘œì— ë‚˜ì˜¨ ê°’(ì˜ˆ: 0ë²ˆ ê°œì²´: Adelie 0.918, Chinstrap 0.069, Gentoo 0.012)ì€ ê·¸ ê°œì²´ê°€ ê° ì¢…ì¼ â€˜í™•ë¥ â€™(ëª¨ë¸ì˜ ì¶”ì • í™•ë¥ )ì´ë‹¤. ì¦‰ 0ë²ˆì€ Adelieì¼ ê°€ëŠ¥ì„±ì´ ì•½ 91.8%ë¡œ ê°€ì¥ í¬ë¯€ë¡œ ìµœì¢… ë¶„ë¥˜ëŠ” Adelieë¡œ ë¶„ë¥˜ëœë‹¤.</p>
<p>ì´ëŸ° ì‹ìœ¼ë¡œ ì‚¬í›„í™•ë¥ ì€ â€œë§í˜”ë‹¤/í‹€ë ¸ë‹¤â€ë¥¼ ë„˜ì–´ì„œ, ëª¨ë¸ì´ ì–¼ë§ˆë‚˜ í™•ì‹ í•˜ëŠ”ì§€(ë¶ˆí™•ì‹¤ì„±)ê¹Œì§€ ë³´ì—¬ì£¼ê³ , í™•ë¥ ì´ í•œ í´ë˜ìŠ¤ì— ì ë¦¬ë©´(0.95 ì´ìƒ ë“±) íŒì •ì´ ë§¤ìš° ê²¬ê³ í•˜ê³ , ì„¸ ê°’ì´ ë¹„ìŠ·í•˜ë©´ ê²½ê³„ ì‚¬ë¡€(ì• ë§¤í•œ ê°œì²´)ì´ë‹¤.</p>
<pre class="text"><code>Adelie  Chinstrap   Gentoo
0   0.918290    0.069404    0.012307
1   0.988199    0.008662    0.003139
2   0.001760    0.008249    0.989991
3   0.000773    0.000746    0.998481
4   0.036945    0.962263    0.000792

Gentoo
0   0.012307
1   0.003139
2   0.989991
3   0.998481
4   0.000792</code></pre>
<p>ë‹¤í•­ ë¡œì§“ì€ ê° í´ë˜ìŠ¤ <span class="math inline">\(Î·_kâ€‹(x)=Î±kâ€‹+xâŠ¤Î²_kâ€‹\)</span> ë¥¼ ë§Œë“  ë’¤, softmaxë¡œ í™•ë¥ , <span class="math inline">\(P(Y=kâˆ£x)=\frac{exp(Î·kâ€‹)-max_j n_j}{âˆ‘_jâ€‹ exp(Î·jâ€‹ - max_j n_j)}\)</span>â€‹ ê³„ì‚°í•œë‹¤.</p>
<p>ë”°ë¼ì„œ ê³„ìˆ˜ <span class="math inline">\(\beta_k\)</span> ëŠ” ë³€ìˆ˜ xê°€ ì»¤ì§ˆ ë•Œ í´ë˜ìŠ¤ kì˜ ì ìˆ˜(ë¡œê·¸ì˜¤ì¦ˆ)ê°€ ì–¼ë§ˆë‚˜ ì¦ê°€/ê°ì†Œí•˜ëŠ”ì§€ë¥¼ ëœ»í•œë‹¤. ê³„ìˆ˜ ì–‘(+): ê·¸ ë³€ìˆ˜ê°€ ì¦ê°€í• ìˆ˜ë¡ ê·¸ í´ë˜ìŠ¤ì¼ ê°€ëŠ¥ì„±ì´ ì»¤ì§€ëŠ” ë°©í–¥ìœ¼ë¡œ ê³„ìˆ˜ ìŒ(-): ê·¸ ë³€ìˆ˜ê°€ ì¦ê°€í• ìˆ˜ë¡ ê·¸ í´ë˜ìŠ¤ì¼ ê°€ëŠ¥ì„±ì´ ì‘ì•„ì§€ëŠ” ë°©í–¥ì´ë‹¤. í¬ê¸°(ì ˆëŒ€ê°’)ê°€ í´ìˆ˜ë¡ ì˜í–¥ì´ í¬ë‹¤.</p>
<p>ì§€ê¸ˆ ì¶œë ¥ëœ ë³€ìˆ˜ë“¤ì€ num__â€¦ëŠ” í‘œì¤€í™”(í‰ê· 0, í‘œì¤€í¸ì°¨1) ëœ ê°’ì´ë¼, â€œ1 ì¦ê°€â€ëŠ” ì› ë‹¨ìœ„ 1mmê°€ ì•„ë‹ˆë¼ 1í‘œì¤€í¸ì°¨ ì¦ê°€ì´ë‹¤. ê·¸ë¦¬ê³  ë²”ì£¼í˜•(ì„¬/ì„±ë³„)ì€ ì›í•«ì´ë¯€ë¡œ ê³„ìˆ˜ëŠ” â€œê·¸ ë²”ì£¼ì¼ ë•Œ(1ì¼ ë•Œ) vs ì•„ë‹ ë•Œ(0ì¼ ë•Œ)â€ì˜ íš¨ê³¼ì´ë‹¤.</p>
<p><strong>Adelie í´ë˜ìŠ¤</strong></p>
<p>bill_length_mm ê³„ìˆ˜ -2.344 (í° ìŒìˆ˜): ë¶€ë¦¬ ê¸¸ì´ê°€(í‘œì¤€í™” ê¸°ì¤€ìœ¼ë¡œ) ê¸¸ì–´ì§ˆìˆ˜ë¡ Adelieì¼ ê°€ëŠ¥ì„±ì€ ëšœë ·í•˜ê²Œ ê°ì†Œí•œë‹¤. ì¦‰, ì§§ì€ ë¶€ë¦¬ê°€ Adelie ìª½ìœ¼ë¡œ ê°•í•˜ê²Œ ì‘ìš©í•œë‹¤.</p>
<p>bill_depth_mm ê³„ìˆ˜ +0.991 (ì–‘ìˆ˜): ë¶€ë¦¬ ê¹Šì´ê°€ ê¹Šì–´ì§ˆìˆ˜ë¡ Adelieì¼ í™•ë¥ ì´ ì¦ê°€í•œë‹¤. (ê¹Šì€ ë¶€ë¦¬ â†’ Adelie ìª½)</p>
<p>island_Torgersen ê³„ìˆ˜ +0.649 (ì–‘ìˆ˜): ì„œì‹ì§€ê°€ Torgersenì´ë©´ Adelieì¼ ê°€ëŠ¥ì„±ì´ ìƒëŒ€ì ìœ¼ë¡œ ë†’ì•„ì§„ë‹¤.</p>
<p>flipper_length_mm ê³„ìˆ˜ -0.572 (ìŒìˆ˜): ë‚ ê°œ(í”Œë¦¬í¼) ê¸¸ì´ê°€ ê¸¸ìˆ˜ë¡ Adelieì¼ ê°€ëŠ¥ì„±ì€ ê°ì†Œí•œë‹¤. ì¦‰, í”Œë¦¬í¼ê°€ ìƒëŒ€ì ìœ¼ë¡œ ì§§ì€ ê°œì²´ê°€ Adelie ì¼ ê°€ëŠ¥ì„± ë†’ë‹¤.</p>
<p>island_Dream ê³„ìˆ˜ -0.548 (ìŒìˆ˜): Dream ì„¬ì´ë©´ Adelie í™•ë¥ ì€ ë‚®ì•„ì§€ëŠ” ë°©í–¥ì´ë‹¤.</p>
<p>sex_Male +0.468 / sex_Female -0.462 ë‚¨ì„±(ìˆ˜ì»·) í‘œì‹œëŠ” Adelie ìª½ìœ¼ë¡œ ì•½ê°„ ë°€ê³ , ì•”ì»·ì€ ë°˜ëŒ€ ë°©í–¥ì´ì§€ë§Œ, ì´ ì„±ë³„ íš¨ê³¼ëŠ” ë¶€ë¦¬/í”Œë¦¬í¼ ë³€ìˆ˜ë“¤ì— ë¹„í•´ â€œê²°ì •íƒ€â€ë¼ê¸°ë³´ë‹¤ëŠ” ë³´ì¡°ì ì…ë‹ˆë‹¤.</p>
<p>ğŸ‘‰ ìš”ì•½í•˜ë©´, ì´ ëª¨ë¸ì—ì„œ AdelieëŠ” â€œì§§ì€ ë¶€ë¦¬ ê¸¸ì´ + ê¹Šì€ ë¶€ë¦¬ + ì§§ì€ í”Œë¦¬í¼ + (Torgersen)â€ì˜ ì¡°í•©ìœ¼ë¡œ ì„¤ëª…ëœë‹¤.</p>
<p><strong>ë‹¤ë¥¸ 2ì¢…ì— ëŒ€í•´ì„œë„ ë™ì¼í•œ í•´ì„ì´ ê°€ëŠ¥í•˜ë‹¤.</strong> ì´ ë‹¤í•­ ë¡œì§“ ëª¨ë¸ì€ í­ê·„ ì¢…ì„ êµ¬ë¶„í•  ë•Œ, ë¶€ë¦¬ ê¸¸ì´/ê¹Šì´ì™€ í”Œë¦¬í¼ ê¸¸ì´, ì²´ì¤‘, ê·¸ë¦¬ê³  ì„¬(island) ì •ë³´ê°€ í•µì‹¬ ê²°ì •ìš”ì¸ìœ¼ë¡œ ì‘ë™í•œë‹¤.</p>
<p>AdelieëŠ” ìƒëŒ€ì ìœ¼ë¡œ ì§§ì€ ë¶€ë¦¬ ê¸¸ì´ì™€ ê¹Šì€ ë¶€ë¦¬, ì§§ì€ í”Œë¦¬í¼(íŠ¹íˆ Torgersen) íŠ¹ì§•ì„ ë³´ì´ë©°, Chinstrapì€ ê¸´ ë¶€ë¦¬ì™€ Dream ì„¬, ë¹„êµì  ê°€ë²¼ìš´ ì²´ì¤‘ì´ íŠ¹ì§•ì ì´ë‹¤. GentooëŠ” Biscoe ì„¬ì— ìˆì„ ë•Œ í™•ë¥ ì´ í¬ê²Œ ì¦ê°€í•˜ê³ , ê¸´ í”Œë¦¬í¼ì™€ í° ì²´ì¤‘ì´ Gentoo ìª½ìœ¼ë¡œ ê°•í•˜ê²Œ ì‘ë™í•˜ëŠ” ë°˜ë©´, ë¶€ë¦¬ ê¹Šì´ëŠ” Gentooì— ë¶ˆë¦¬í•˜ê²Œ(ì–•ì„ìˆ˜ë¡ Gentoo ìœ ë¦¬) ì‘ë™í•œë‹¤.</p>
<pre class="text"><code>dtype: float64
intercept
Adelie  0.626198
Chinstrap   -0.487019
Gentoo  -0.139179

num__bill_length_mm num__bill_depth_mm  num__flipper_length_mm  num__body_mass_g    cat__island_Biscoe  cat__island_Dream   cat__island_Torgersen   cat__sex_Female cat__sex_Male
Adelie  -2.344400   0.990900    -0.571682   0.00089 -0.094988   -0.548209   0.649429    -0.461786   0.468019
Chinstrap   1.882937    0.344919    -0.287865   -0.74111    -0.770085   1.189199    -0.421828   0.516992    -0.519705
Gentoo  0.461463    -1.335819   0.859546    0.74022 0.865073    -0.640990   -0.227602   -0.055206   0.051687

=== Top 15 coefficients for class: Adelie ===
Adelie
num__bill_length_mm -2.344400
num__bill_depth_mm  0.990900
cat__island_Torgersen   0.649429
num__flipper_length_mm  -0.571682
cat__island_Dream   -0.548209
cat__sex_Male   0.468019
cat__sex_Female -0.461786
cat__island_Biscoe  -0.094988
num__body_mass_g    0.000890

=== Top 15 coefficients for class: Chinstrap ===
Chinstrap
num__bill_length_mm 1.882937
cat__island_Dream   1.189199
cat__island_Biscoe  -0.770085
num__body_mass_g    -0.741110
cat__sex_Male   -0.519705
cat__sex_Female 0.516992
cat__island_Torgersen   -0.421828
num__bill_depth_mm  0.344919
num__flipper_length_mm  -0.287865

=== Top 15 coefficients for class: Gentoo ===
Gentoo
num__bill_depth_mm  -1.335819
cat__island_Biscoe  0.865073
num__flipper_length_mm  0.859546
num__body_mass_g    0.740220
cat__island_Dream   -0.640990
num__bill_length_mm 0.461463
cat__island_Torgersen   -0.227602
cat__sex_Female -0.055206
cat__sex_Male   0.051687</code></pre>
</section>
<section id="tree-ê¸°ë°˜" class="level5">
<h5 class="anchored" data-anchor-id="tree-ê¸°ë°˜">(3) tree ê¸°ë°˜</h5>
<p><strong>í˜¼ë™í–‰ë ¬ ì¶œë ¥</strong></p>
<div class="sourceCode" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score, confusion_matrix, classification_report, ConfusionMatrixDisplay</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ì˜ˆì¸¡</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>y_pred_tree <span class="op">=</span> tree_model.predict(X_test)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="co"># âœ… ë¼ë²¨(í´ë˜ìŠ¤ ì´ë¦„) ê°€ì ¸ì˜¤ê¸°: data.target_names ëŒ€ì‹  ì‚¬ìš©</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> tree_model.named_steps[<span class="st">"tree"</span>].classes_   <span class="co"># ì˜ˆ: ['Adelie','Chinstrap','Gentoo']</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="co"># í‰ê°€</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"[tree] Accuracy:"</span>, accuracy_score(y_test, y_pred_tree))</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>cm <span class="op">=</span> confusion_matrix(y_test, y_pred_tree, labels<span class="op">=</span>labels)</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"[tree] Confusion matrix:</span><span class="ch">\n</span><span class="st">"</span>, cm)</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"[tree] Classification report:</span><span class="ch">\n</span><span class="st">"</span>,</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>      classification_report(y_test, y_pred_tree,</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>                            labels<span class="op">=</span>labels,</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>                            target_names<span class="op">=</span>labels.tolist()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre class="text"><code>[tree] Accuracy: 1.0
[tree] Confusion matrix:
 [[30  0  0]
 [ 0 14  0]
 [ 0  0 25]]
[tree] Classification report:
               precision    recall  f1-score   support

      Adelie       1.00      1.00      1.00        30
   Chinstrap       1.00      1.00      1.00        14
      Gentoo       1.00      1.00      1.00        25

    accuracy                           1.00        69
   macro avg       1.00      1.00      1.00        69
weighted avg       1.00      1.00      1.00        69</code></pre>
<p><strong>ì‚¬í›„í™•ë¥  ì¶œë ¥</strong></p>
<div class="sourceCode" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co">#ì‚¬í›„ í™•ë¥  ì¶œë ¥</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co"># (n_samples, n_classes)</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>proba_tree <span class="op">=</span> tree_model.predict_proba(X_test)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>tree_clf <span class="op">=</span> tree_model.named_steps[<span class="st">"tree"</span>]</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>classes_tree <span class="op">=</span> tree_clf.classes_</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>proba_tree_df <span class="op">=</span> pd.DataFrame(proba_tree, columns<span class="op">=</span>classes_tree)</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>display(proba_tree_df.head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre class="text"><code>Adelie  Chinstrap   Gentoo
0   1.0 0.0 0.0
1   1.0 0.0 0.0
2   0.0 0.0 1.0
3   0.0 0.0 1.0
4   0.0 1.0 0.0</code></pre>
<p><strong>ì˜ì‚¬ê²°ì • ì¶œë ¥</strong></p>
<div class="sourceCode" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> explain_tree_path(pipeline, X_row, feature_names<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="co">    pipeline: tree_model (preprocess + tree)</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="co">    X_row: DataFrame 1í–‰ (ì˜ˆ: X_test.iloc[[i]])</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>    pre <span class="op">=</span> pipeline.named_steps[<span class="st">"preprocess"</span>]</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>    clf <span class="op">=</span> pipeline.named_steps[<span class="st">"tree"</span>]</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ì „ì²˜ë¦¬ëœ 2D í–‰ë ¬</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>    Xt <span class="op">=</span> pre.transform(X_row)</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># feature name</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> feature_names <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>        feature_names <span class="op">=</span> pre.get_feature_names_out()</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># decision path</span></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>    node_indicator <span class="op">=</span> clf.decision_path(Xt)</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>    leaf_id <span class="op">=</span> clf.<span class="bu">apply</span>(Xt)[<span class="dv">0</span>]</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>    tree_ <span class="op">=</span> clf.tree_</span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>    node_index <span class="op">=</span> node_indicator.indices[</span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>        node_indicator.indptr[<span class="dv">0</span>] : node_indicator.indptr[<span class="dv">1</span>]</span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>    rows <span class="op">=</span> []</span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> node_id <span class="kw">in</span> node_index:</span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> node_id <span class="op">==</span> leaf_id:</span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a>            <span class="co"># leafì—ì„œì˜ class count / posterior</span></span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a>            counts <span class="op">=</span> tree_.value[node_id][<span class="dv">0</span>]  <span class="co"># (n_classes,)</span></span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a>            probs <span class="op">=</span> counts <span class="op">/</span> counts.<span class="bu">sum</span>() <span class="cf">if</span> counts.<span class="bu">sum</span>() <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> counts</span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a>            rows.append({</span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true" tabindex="-1"></a>                <span class="st">"node"</span>: <span class="bu">int</span>(node_id),</span>
<span id="cb33-36"><a href="#cb33-36" aria-hidden="true" tabindex="-1"></a>                <span class="st">"type"</span>: <span class="st">"LEAF"</span>,</span>
<span id="cb33-37"><a href="#cb33-37" aria-hidden="true" tabindex="-1"></a>                <span class="st">"class_counts"</span>: counts.tolist(),</span>
<span id="cb33-38"><a href="#cb33-38" aria-hidden="true" tabindex="-1"></a>                <span class="st">"posterior"</span>: {<span class="bu">str</span>(c): <span class="bu">float</span>(p) <span class="cf">for</span> c, p <span class="kw">in</span> <span class="bu">zip</span>(clf.classes_, probs)}</span>
<span id="cb33-39"><a href="#cb33-39" aria-hidden="true" tabindex="-1"></a>            })</span>
<span id="cb33-40"><a href="#cb33-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb33-41"><a href="#cb33-41" aria-hidden="true" tabindex="-1"></a>            f <span class="op">=</span> tree_.feature[node_id]</span>
<span id="cb33-42"><a href="#cb33-42" aria-hidden="true" tabindex="-1"></a>            thr <span class="op">=</span> tree_.threshold[node_id]</span>
<span id="cb33-43"><a href="#cb33-43" aria-hidden="true" tabindex="-1"></a>            feat_name <span class="op">=</span> feature_names[f]</span>
<span id="cb33-44"><a href="#cb33-44" aria-hidden="true" tabindex="-1"></a>            val <span class="op">=</span> Xt[<span class="dv">0</span>, f]</span>
<span id="cb33-45"><a href="#cb33-45" aria-hidden="true" tabindex="-1"></a>            direction <span class="op">=</span> <span class="st">"LEFT (&lt;=)"</span> <span class="cf">if</span> val <span class="op">&lt;=</span> thr <span class="cf">else</span> <span class="st">"RIGHT (&gt;)"</span></span>
<span id="cb33-46"><a href="#cb33-46" aria-hidden="true" tabindex="-1"></a>            rows.append({</span>
<span id="cb33-47"><a href="#cb33-47" aria-hidden="true" tabindex="-1"></a>                <span class="st">"node"</span>: <span class="bu">int</span>(node_id),</span>
<span id="cb33-48"><a href="#cb33-48" aria-hidden="true" tabindex="-1"></a>                <span class="st">"type"</span>: <span class="st">"SPLIT"</span>,</span>
<span id="cb33-49"><a href="#cb33-49" aria-hidden="true" tabindex="-1"></a>                <span class="st">"feature"</span>: feat_name,</span>
<span id="cb33-50"><a href="#cb33-50" aria-hidden="true" tabindex="-1"></a>                <span class="st">"value_in_node"</span>: <span class="bu">float</span>(val),</span>
<span id="cb33-51"><a href="#cb33-51" aria-hidden="true" tabindex="-1"></a>                <span class="st">"threshold"</span>: <span class="bu">float</span>(thr),</span>
<span id="cb33-52"><a href="#cb33-52" aria-hidden="true" tabindex="-1"></a>                <span class="st">"go"</span>: direction</span>
<span id="cb33-53"><a href="#cb33-53" aria-hidden="true" tabindex="-1"></a>            })</span>
<span id="cb33-54"><a href="#cb33-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-55"><a href="#cb33-55" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.DataFrame(rows), <span class="bu">int</span>(leaf_id)</span>
<span id="cb33-56"><a href="#cb33-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-57"><a href="#cb33-57" aria-hidden="true" tabindex="-1"></a><span class="co"># ì‚¬ìš© ì˜ˆì‹œ: ië²ˆì§¸ í…ŒìŠ¤íŠ¸ ìƒ˜í”Œ ê²½ë¡œ ë³´ê¸°</span></span>
<span id="cb33-58"><a href="#cb33-58" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb33-59"><a href="#cb33-59" aria-hidden="true" tabindex="-1"></a>path_df, leaf <span class="op">=</span> explain_tree_path(tree_model, X_test.iloc[[i]])</span>
<span id="cb33-60"><a href="#cb33-60" aria-hidden="true" tabindex="-1"></a>display(path_df)</span>
<span id="cb33-61"><a href="#cb33-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-62"><a href="#cb33-62" aria-hidden="true" tabindex="-1"></a><span class="co"># ì˜ˆì¸¡/í™•ë¥ ë„ ê°™ì´ í™•ì¸</span></span>
<span id="cb33-63"><a href="#cb33-63" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"pred ="</span>, tree_model.predict(X_test.iloc[[i]])[<span class="dv">0</span>])</span>
<span id="cb33-64"><a href="#cb33-64" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"proba ="</span>, <span class="bu">dict</span>(<span class="bu">zip</span>(tree_model.named_steps[<span class="st">"tree"</span>].classes_,</span>
<span id="cb33-65"><a href="#cb33-65" aria-hidden="true" tabindex="-1"></a>                         tree_model.predict_proba(X_test.iloc[[i]])[<span class="dv">0</span>])))</span>
<span id="cb33-66"><a href="#cb33-66" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"leaf ="</span>, leaf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>ëª¨ë¸: ê²°ì •íŠ¸ë¦¬(ì „ì²˜ë¦¬ í¬í•¨)</strong></p>
<p>ëŒ€ìƒ: í…ŒìŠ¤íŠ¸ ë°ì´í„° ì¤‘ íŠ¹ì • ê°œì²´ 1ê°œ <br> ê²°ê³¼: ì˜ˆì¸¡ í´ë˜ìŠ¤: Adelie <br> ì‚¬í›„í™•ë¥ : P(Adelie)=1.0,P(Chinstrap)=0,P(Gentoo)=0 <br> ìµœì¢… ë„ì°© ë¦¬í”„: leaf = 7</p>
<p><strong>ë‹¨ê³„ë³„ ë¶„ê¸° í•´ì„ (ì˜ì‚¬ê²°ì • ê³¼ì •)</strong></p>
<p>ì²« ë²ˆì§¸ ë¶„ê¸°: ì¡°ê±´ flipper_length_mmâ‰¤0.409, ì´ ê°’ì€ í‘œì¤€í™”ëœ ê°’(z-score)ì´ë‹¤. â†’ í”Œë¦¬í¼ ê¸¸ì´ê°€ í‰ê· ë³´ë‹¤ ê¸¸ì§€ ì•Šë‹¤. GentooëŠ” í”Œë¦¬í¼ê°€ ë§¤ìš° ê¸´ ì¢…ì´ë¯€ë¡œ ì´ ì¡°ê±´ì„ ë§Œì¡±í•˜ë©´ Gentoo ê°€ëŠ¥ì„±ì´ í¬ê²Œ ê°ì†Œí•œë‹¤. ë”°ë¼ì„œ íŠ¸ë¦¬ëŠ” Gentooë¥¼ 1ì°¨ì ìœ¼ë¡œ ë°°ì œí•˜ê³  ì™¼ìª½ìœ¼ë¡œ ì´ë™í•œë‹¤.</p>
<p>ë‘ ë²ˆì§¸ ë¶„ê¸°: ì¡°ê±´ bill_length_mmâ‰¤0.178 â†’ ë¶€ë¦¬ ê¸¸ì´ê°€ í‰ê· ë³´ë‹¤ ì•½ê°„ ì§§ê±°ë‚˜ ë¹„ìŠ·í•œ ìˆ˜ì¤€ì´ë‹¤. Chinstrapì€ ë¶€ë¦¬ ê¸¸ì´ê°€ ê¸´ í¸ì´ë¯€ë¡œ ì´ ì¡°ê±´ì€ Chinstrap ê°€ëŠ¥ì„±ì„ ë‚®ì¶”ëŠ” ë°©í–¥ì´ë‹¤. íŠ¸ë¦¬ëŠ” Adelie/Chinstrap ì¤‘ì—ì„œë„ Adelie ìª½ìœ¼ë¡œ ê¸°ìš¸ê¸° ì‹œì‘í•œë‹¤.</p>
<p>ì„¸ ë²ˆì§¸ ë¶„ê¸°: ì¡°ê±´ bill_length_mmâ‰¤âˆ’0.315 â†’ ë¶€ë¦¬ ê¸¸ì´ê°€ í‰ê· ë³´ë‹¤ ìƒë‹¹íˆ ì§§ìŒ. ì§§ì€ ë¶€ë¦¬ëŠ” Adelieì˜ í•µì‹¬ íŠ¹ì§•ì„ ê°€ì§€ë¯€ë¡œ Chinstrap ê°€ëŠ¥ì„±ì€ ì—¬ê¸°ì„œ ê±°ì˜ ì œê±°ëœë‹¤.</p>
<p>ë„¤ ë²ˆì§¸ ë¶„ê¸°: ì¡°ê±´ bill_depth_mm&gt;âˆ’0.260 â†’ ë¶€ë¦¬ ê¹Šì´ê°€ ë„ˆë¬´ ì–•ì§€ ì•ŠìŒ(ì¦‰, ìƒëŒ€ì ìœ¼ë¡œ ë‘êº¼ìš´ ë¶€ë¦¬). AdelieëŠ” ì§§ê³  ê¹Šì€ ë¶€ë¦¬ë¥¼ ê°€ì§€ë¯€ë¡œ ì´ ì¡°ê±´ì€ Adelieì˜ ì „í˜•ì  í˜•ì§ˆê³¼ ì •í™•íˆ ì¼ì¹˜í•œë‹¤.</p>
<p>ë¦¬í”„ ë…¸ë“œ ë„ì°©: ë¦¬í”„ ì •ë³´ class_counts = [1, 0, 0] posterior = {Adelie: 1.0} â†’ ì´ ê²½ë¡œë¡œ ë„ë‹¬í•œ í•™ìŠµ ë°ì´í„°ê°€ ëª¨ë‘ Adelie. ëª¨ë¸ì€ í™•ë¥  1.0ìœ¼ë¡œ Adelie íŒì •</p>
<p>ë³¸ ê°œì²´ëŠ” í”Œë¦¬í¼ ê¸¸ì´ê°€ í‰ê· ë³´ë‹¤ ê¸¸ì§€ ì•Šì•„ Gentooì¼ ê°€ëŠ¥ì„±ì´ ì´ˆê¸° ë‹¨ê³„ì—ì„œ ë°°ì œë˜ì—ˆìœ¼ë©°, ë¶€ë¦¬ ê¸¸ì´ê°€ í‰ê· ë³´ë‹¤ ìƒë‹¹íˆ ì§§ì•„ Chinstrap ê°€ëŠ¥ì„± ë˜í•œ ë‹¨ê³„ì ìœ¼ë¡œ ê°ì†Œí•˜ì˜€ë‹¤.</p>
<p>ì´í›„ ë¶€ë¦¬ ê¹Šì´ê°€ ìƒëŒ€ì ìœ¼ë¡œ ê¹Šì€ íŠ¹ì„±ì„ ë³´ì„ì— ë”°ë¼, í•´ë‹¹ ê°œì²´ëŠ” Adelieì˜ ì „í˜•ì ì¸ í˜•íƒœì  íŠ¹ì„±ì„ ì¶©ì¡±í•˜ëŠ” ê²ƒìœ¼ë¡œ íŒë‹¨ë˜ì—ˆê³ , ì´ì— ë”°ë¼ ë³¸ ê²°ì •íŠ¸ë¦¬ëŠ” í•´ë‹¹ ê°œì²´ë¥¼ Adelieë¡œ í™•ë¥  1.0ìœ¼ë¡œ ë¶„ë¥˜í•˜ì˜€ë‹¤.</p>
<pre class="text"><code>node    type    feature value_in_node   threshold   go  class_counts    posterior
0   0   SPLIT   num__flipper_length_mm  0.013088    0.409002    LEFT (&lt;=)   NaN NaN
1   1   SPLIT   num__bill_length_mm -0.470502   0.178449    LEFT (&lt;=)   NaN NaN
2   2   SPLIT   num__bill_length_mm -0.470502   -0.315119   LEFT (&lt;=)   NaN NaN
3   3   SPLIT   num__bill_depth_mm  0.663008    -0.260357   RIGHT (&gt;)   NaN NaN
4   7   LEAF    NaN NaN NaN NaN [1.0, 0.0, 0.0] {'Adelie': 1.0, 'Chinstrap': 0.0, 'Gentoo': 0.0}
pred = Adelie
proba = {'Adelie': np.float64(1.0), 'Chinstrap': np.float64(0.0), 'Gentoo': np.float64(0.0)}
leaf = 7</code></pre>
<div class="sourceCode" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.tree <span class="im">import</span> export_text</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>pre <span class="op">=</span> tree_model.named_steps[<span class="st">"preprocess"</span>]</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>clf <span class="op">=</span> tree_model.named_steps[<span class="st">"tree"</span>]</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>feat_names <span class="op">=</span> pre.get_feature_names_out()</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(export_text(clf, feature_names<span class="op">=</span><span class="bu">list</span>(feat_names), max_depth<span class="op">=</span><span class="dv">4</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>ì œì‹œëœ ì¶œë ¥ì€ í­ê·„ ë°ì´í„°ì…‹ì„ ì „ì²˜ë¦¬(ìˆ˜ì¹˜í˜• í‘œì¤€í™”, ë²”ì£¼í˜• ì›í•«ì¸ì½”ë”©)í•œ ë’¤, ì˜ì‚¬ê²°ì •ë‚˜ë¬´(DecisionTreeClassifier)ê°€ ë¶„ë¥˜ë¥¼ ìˆ˜í–‰í•˜ëŠ” ê·œì¹™ì„ í…ìŠ¤íŠ¸ë¡œ í¼ì³ ë†“ì€ ê²°ê³¼ì´ë‹¤. ë§¨ ì•ì˜ |â€”ëŠ” ë¶„ê¸° ì¡°ê±´ì„ ëœ»í•˜ë©°, ìœ„ì—ì„œ ì•„ë˜ë¡œ ë‚´ë ¤ê°€ë©´ì„œ ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ê²½ë¡œë¥¼ ë”°ë¼ê°€ë©´ ìµœì¢… ì˜ˆì¸¡ í´ë˜ìŠ¤ê°€ ê²°ì •ë˜ëŠ” êµ¬ì¡°ì´ë‹¤.</p>
<p>num__ë¡œ ì‹œì‘í•˜ëŠ” ë³€ìˆ˜ëŠ” í‘œì¤€í™”ëœ ìˆ˜ì¹˜í˜• íŠ¹ì„±(í‰ê·  0, í‘œì¤€í¸ì°¨ 1 ê¸°ì¤€ì˜ ê°’)ì´ê³ , cat__ë¡œ ì‹œì‘í•˜ëŠ” ë³€ìˆ˜ëŠ” ì›í•«ì¸ì½”ë”©ëœ ë²”ì£¼í˜• ë”ë¯¸ ë³€ìˆ˜ì´ë‹¤. ë”°ë¼ì„œ cat__sex_Male &lt;= 0.500ì€ â€œMale ë”ë¯¸ê°€ 0ì¸ ê²½ìš°â€, ì¦‰ ë‚¨ì„±ì´ ì•„ë‹Œ ê²½ìš°(ëŒ€ê°œ Female ë˜ëŠ” ê²°ì¸¡ì´ ë‹¤ë¥¸ ê°’ìœ¼ë¡œ ì²˜ë¦¬ëœ ê²½ìš°)ë¼ëŠ” ëœ»ì´ë‹¤.</p>
<p>ê°€ì¥ ë¨¼ì € ëª¨ë¸ì€ num__flipper_length_mmë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì „ì²´ë¥¼ ë‘ ê°ˆë˜ë¡œ ë‚˜ëˆ„ëŠ” êµ¬ì¡°ì´ë‹¤. num__flipper_length_mm &lt;= 0.409ì´ë©´ ìƒëŒ€ì ìœ¼ë¡œ ì§€ëŠëŸ¬ë¯¸ ê¸¸ì´ê°€ ì§§ì€ ìª½ ì§‘ë‹¨ìœ¼ë¡œ ë“¤ì–´ê°€ê³ , num__flipper_length_mm &gt; 0.409ì´ë©´ ìƒëŒ€ì ìœ¼ë¡œ ì§€ëŠëŸ¬ë¯¸ ê¸¸ì´ê°€ ê¸´ ìª½ ì§‘ë‹¨ìœ¼ë¡œ ë“¤ì–´ê°€ëŠ” ë°©ì‹ì´ë‹¤. ì´ ë¶„ê¸° ìì²´ê°€ â€œì§€ëŠëŸ¬ë¯¸ ê¸¸ì´ê°€ ê¸¸ë©´ Gentooì¼ ê°€ëŠ¥ì„±ì´ í¬ë‹¤â€ëŠ” í° íŒ¨í„´ì„ ë°˜ì˜í•œ ê·œì¹™ì´ë¼ê³  ë³¼ ìˆ˜ ìˆë‹¤.</p>
<p>ì§€ëŠëŸ¬ë¯¸ ê¸¸ì´ê°€ ì§§ì€ ì§‘ë‹¨(&lt;= 0.409) ì•ˆì—ì„œëŠ” num__bill_length_mm(ë¶€ë¦¬ ê¸¸ì´)ë¡œ ë‹¤ì‹œ ê°ˆë¼ì§€ëŠ” êµ¬ì¡°ì´ë‹¤. num__bill_length_mm &lt;= 0.178ì´ë©´ ë¶€ë¦¬ ê¸¸ì´ê°€ ìƒëŒ€ì ìœ¼ë¡œ ì§§ê±°ë‚˜ ë³´í†µì¸ ìª½ì´ë©°, ì—¬ê¸°ì„œ num__bill_length_mm &lt;= -0.315ì²˜ëŸ¼ ë” ì§§ì€ êµ¬ê°„ìœ¼ë¡œ ë“¤ì–´ê°€ë©´ num__bill_depth_mm(ë¶€ë¦¬ ê¹Šì´) ì¡°ê±´ì´ ì¶”ê°€ë¡œ ë¶™ëŠ”ë‹¤.</p>
<p>íŠ¹íˆ num__bill_depth_mm &gt; -0.260ì¸ ê²½ìš°ì—ëŠ” ìë…¸ë“œì—ì„œ weights: [103.000, 0.000, 0.000] class: Adelieë¡œ ëë‚˜ëŠ”ë°, ì´ëŠ” ê·¸ ì§€ì ê¹Œì§€ ë„ë‹¬í•œ í•™ìŠµ í‘œë³¸ì˜ í´ë˜ìŠ¤ ë¶„í¬ê°€ Adelie 103, Chinstrap 0, Gentoo 0ì´ë©° ìµœì¢… ì˜ˆì¸¡ì´ Adelieë¼ëŠ” ëœ»ì´ë‹¤. ë°˜ëŒ€ë¡œ num__bill_depth_mm &lt;= -0.260ì²˜ëŸ¼ ë” ì–•ì€ ê²½ìš°ì—ëŠ” ë¶€ë¦¬ ê¸¸ì´ë¥¼ í•œ ë²ˆ ë” ìª¼ê°œì–´ Adelie 7ê°œê°€ ëª¨ì¸ ììœ¼ë¡œ ê°€ê±°ë‚˜, ë§¤ìš° ë“œë¬¼ê²Œ Chinstrap 1ê°œê°€ ëª¨ì¸ ììœ¼ë¡œ ê°€ëŠ” êµ¬ì¡°ë„ ë‚˜íƒ€ë‚œë‹¤.</p>
<p>ê°™ì€ â€œì§€ëŠëŸ¬ë¯¸ ì§§ìŒâ€ ê°€ì§€ì—ì„œ num__bill_length_mm &gt; -0.315ë¡œ ë„˜ì–´ê°€ë©´ cat__sex_Maleì´ ë“±ì¥í•œë‹¤. cat__sex_Male &lt;= 0.500ì´ë©´ weights: [0.000, 4.000, 0.000] class: Chinstrapìœ¼ë¡œ ëë‚˜ì„œ Chinstrapìœ¼ë¡œ ì˜ˆì¸¡ë˜ëŠ” êµ¬ê°„ì´ ìƒê¸´ë‹¤.</p>
<p>cat__sex_Male &gt; 0.500ì´ë©´ ë‹¤ì‹œ num__bill_depth_mmë¡œ ê°ˆë¼ì§€ëŠ”ë°, ì¼ë¶€ëŠ” truncated branch of depth 2ë¡œ í‘œì‹œë˜ì–´ ì¶œë ¥ì—ì„œ ë” ê¹Šì€ ë¶„ê¸°ê°€ ìƒëµëœ ë¶€ë¶„ì´ë‹¤. ì¶œë ¥ì— ë³´ì´ëŠ” ë²”ìœ„ì—ì„œëŠ” num__bill_depth_mm &gt; 0.139ì¸ ê²½ìš° weights: [7.000, 0.000, 0.000] class: Adelieë¡œ ê·€ê²°ë˜ëŠ” êµ¬ê°„ì´ ì¡´ì¬í•œë‹¤.</p>
<p>í•œí¸ num__bill_length_mm &gt; 0.178ì¸ ìª½(ë¶€ë¦¬ ê¸¸ì´ê°€ ìƒëŒ€ì ìœ¼ë¡œ ê¸´ ìª½)ì—ì„œëŠ” cat__island_Dreamì´ í•µì‹¬ ë¶„ê¸°ì´ë‹¤. cat__island_Dream &gt; 0.500ì´ë©´ weights: [0.000, 44.000, 0.000] class: Chinstrapìœ¼ë¡œ ë°”ë¡œ ëë‚˜ë©°, Dream ì„¬ìœ¼ë¡œ ì¸ì½”ë”©ëœ ê²½ìš° Chinstrapì´ ë§¤ìš° ê°•í•˜ê²Œ ì˜ˆì¸¡ë˜ëŠ” ê·œì¹™ì„ì„ ë³´ì—¬ì¤€ë‹¤.</p>
<p>cat__island_Dream &lt;= 0.500ì¸ ê²½ìš°ì—ëŠ” ë‹¤ì‹œ cat__sex_Maleë¡œ ê°ˆë¼ì§€ë©´ì„œ, ë‚¨ì„±ì´ ì•„ë‹ˆë©´ Gentoo 1ê°œê°€ ëª¨ì¸ ììœ¼ë¡œ, ë‚¨ì„±ì´ë©´ Adelie 3ê°œê°€ ëª¨ì¸ ììœ¼ë¡œ ê°€ëŠ” ì‘ì€ ë³´ì¡° ê·œì¹™ì´ ë¶™ì–´ ìˆë‹¤.</p>
<p>ì§€ëŠëŸ¬ë¯¸ ê¸¸ì´ê°€ ê¸´ ì§‘ë‹¨(&gt; 0.409)ì—ì„œëŠ” ëª¨ë¸ì´ ë¨¼ì € num__bill_depth_mmë¡œ ë¶„ê¸°í•œë‹¤. num__bill_depth_mm &lt;= 0.413ì´ë©´ weights: [0.000, 0.000, 97.000] class: Gentooë¡œ ëë‚˜ë©°, ì´ êµ¬ê°„ì€ ê±°ì˜ ìˆœìˆ˜í•˜ê²Œ Gentooë¡œ êµ¬ì„±ëœ ë§¤ìš° ê°•í•œ ê·œì¹™ì´ë‹¤.</p>
<p>ë°˜ëŒ€ë¡œ num__bill_depth_mm &gt; 0.413ì´ë©´ num__bill_length_mmë¡œ í•œ ë²ˆ ë” ê°ˆë¼ì ¸ì„œ, &lt;= 0.151ì¸ ê²½ìš° Adelie 1ê°œê°€ ëª¨ì¸ ììœ¼ë¡œ, &gt; 0.151ì¸ ê²½ìš° Chinstrap 5ê°œê°€ ëª¨ì¸ ììœ¼ë¡œ ê°€ëŠ” ì˜ˆì™¸ ê·œì¹™ì´ ì¡´ì¬í•œë‹¤.</p>
<p>ì •ë¦¬í•˜ë©´, ì´ ì˜ì‚¬ê²°ì •ë‚˜ë¬´ëŠ” ì§€ëŠëŸ¬ë¯¸ ê¸¸ì´ë¡œ í° í‹€ì„ ë¨¼ì € ë‚˜ëˆ„ê³ , ê·¸ ë‹¤ìŒì— ë¶€ë¦¬ ê¸¸ì´/ë¶€ë¦¬ ê¹Šì´ ë° ì„¬(Dream)ê³¼ ì„±ë³„(Male ë”ë¯¸) ê°™ì€ ì •ë³´ë¡œ ì„¸ ì¢…(Adelie, Chinstrap, Gentoo)ì„ íŒë³„í•˜ëŠ” êµ¬ì¡°ì´ë‹¤.</p>
<p>ê° ìë…¸ë“œì˜ weights: [a, b, c]ëŠ” í•´ë‹¹ ê·œì¹™ê¹Œì§€ ë„ë‹¬í•œ í•™ìŠµ ë°ì´í„°ì˜ í´ë˜ìŠ¤ ë¶„í¬ì´ë©°, ê·¸ ë¶„í¬ì—ì„œ ê°€ì¥ ë§ì€ í´ë˜ìŠ¤ë¥¼ class:ë¡œ ì˜ˆì¸¡í•˜ëŠ” ë°©ì‹ì¸ ê²ƒì´ë‹¤. ë˜í•œ ìˆ˜ì¹˜í˜• ê¸°ì¤€ê°’ë“¤ì´ í‘œì¤€í™” ì¢Œí‘œì´ë¯€ë¡œ, ì„ê³„ê°’ì˜ í¬ê¸° ìì²´ëŠ” â€œì›ë˜ ë‹¨ìœ„(mm)â€ê°€ ì•„ë‹ˆë¼ â€œí‰ê·  ëŒ€ë¹„ ëª‡ í‘œì¤€í¸ì°¨ì¸ê°€â€ë¥¼ ì˜ë¯¸í•˜ëŠ” ê°’ì´ë¼ëŠ” ì ì´ í•µì‹¬ ì „ì œì´ë‹¤.</p>
<pre class="text"><code>|--- num__flipper_length_mm &lt;= 0.409
|   |--- num__bill_length_mm &lt;= 0.178
|   |   |--- num__bill_length_mm &lt;= -0.315
|   |   |   |--- num__bill_depth_mm &lt;= -0.260
|   |   |   |   |--- num__bill_length_mm &lt;= -0.836
|   |   |   |   |   |--- weights: [7.000, 0.000, 0.000] class: Adelie
|   |   |   |   |--- num__bill_length_mm &gt;  -0.836
|   |   |   |   |   |--- weights: [0.000, 1.000, 0.000] class: Chinstrap
|   |   |   |--- num__bill_depth_mm &gt;  -0.260
|   |   |   |   |--- weights: [103.000, 0.000, 0.000] class: Adelie
|   |   |--- num__bill_length_mm &gt;  -0.315
|   |   |   |--- cat__sex_Male &lt;= 0.500
|   |   |   |   |--- weights: [0.000, 4.000, 0.000] class: Chinstrap
|   |   |   |--- cat__sex_Male &gt;  0.500
|   |   |   |   |--- num__bill_depth_mm &lt;= 0.139
|   |   |   |   |   |--- truncated branch of depth 2
|   |   |   |   |--- num__bill_depth_mm &gt;  0.139
|   |   |   |   |   |--- weights: [7.000, 0.000, 0.000] class: Adelie
|   |--- num__bill_length_mm &gt;  0.178
|   |   |--- cat__island_Dream &lt;= 0.500
|   |   |   |--- cat__sex_Male &lt;= 0.500
|   |   |   |   |--- weights: [0.000, 0.000, 1.000] class: Gentoo
|   |   |   |--- cat__sex_Male &gt;  0.500
|   |   |   |   |--- weights: [3.000, 0.000, 0.000] class: Adelie
|   |   |--- cat__island_Dream &gt;  0.500
|   |   |   |--- weights: [0.000, 44.000, 0.000] class: Chinstrap
|--- num__flipper_length_mm &gt;  0.409
|   |--- num__bill_depth_mm &lt;= 0.413
|   |   |--- weights: [0.000, 0.000, 97.000] class: Gentoo
|   |--- num__bill_depth_mm &gt;  0.413
|   |   |--- num__bill_length_mm &lt;= 0.151
|   |   |   |--- weights: [1.000, 0.000, 0.000] class: Adelie
|   |   |--- num__bill_length_mm &gt;  0.151
|   |   |   |--- weights: [0.000, 5.000, 0.000] class: Chinstrap</code></pre>
<div class="sourceCode" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.tree <span class="im">import</span> plot_tree</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>pre <span class="op">=</span> tree_model.named_steps[<span class="st">"preprocess"</span>]</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>clf <span class="op">=</span> tree_model.named_steps[<span class="st">"tree"</span>]</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>feat_names <span class="op">=</span> pre.get_feature_names_out()</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">18</span>, <span class="dv">8</span>))</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>plot_tree(clf, feature_names<span class="op">=</span>feat_names, class_names<span class="op">=</span>clf.classes_, filled<span class="op">=</span><span class="va">True</span>, max_depth<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/classification_ml_category_treeprocess.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</section>
<section id="random-forest" class="level5">
<h5 class="anchored" data-anchor-id="random-forest">(4) random forest</h5>
<p><strong>í˜¼ë™í–‰ë ¬ ì¶œë ¥</strong></p>
<div class="sourceCode" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score, confusion_matrix, classification_report, ConfusionMatrixDisplay</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ì˜ˆì¸¡</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>y_pred_tree <span class="op">=</span> rf_model.predict(X_test)</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="co"># âœ… ë¼ë²¨(í´ë˜ìŠ¤ ì´ë¦„) ê°€ì ¸ì˜¤ê¸°: data.target_names ëŒ€ì‹  ì‚¬ìš©</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> tree_model.named_steps[<span class="st">"tree"</span>].classes_   <span class="co"># ì˜ˆ: ['Adelie','Chinstrap','Gentoo']</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="co"># í‰ê°€</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"[Random Forest] Accuracy:"</span>, accuracy_score(y_test, y_pred_tree))</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>cm <span class="op">=</span> confusion_matrix(y_test, y_pred_tree, labels<span class="op">=</span>labels)</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"[Random Forest] Confusion matrix:</span><span class="ch">\n</span><span class="st">"</span>, cm)</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"[Random Forest] Classification report:</span><span class="ch">\n</span><span class="st">"</span>,</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>      classification_report(y_test, y_pred_tree,</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>                            labels<span class="op">=</span>labels,</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>                            target_names<span class="op">=</span>labels.tolist()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre class="text"><code>[Random Forest] Accuracy: 1.0
[Random Forest] Confusion matrix:
 [[30  0  0]
 [ 0 14  0]
 [ 0  0 25]]
[Random Forest] Classification report:
               precision    recall  f1-score   support

      Adelie       1.00      1.00      1.00        30
   Chinstrap       1.00      1.00      1.00        14
      Gentoo       1.00      1.00      1.00        25

    accuracy                           1.00        69
   macro avg       1.00      1.00      1.00        69
weighted avg       1.00      1.00      1.00        69</code></pre>
<p><strong>ì‚¬í›„í™•ë¥  ì¶œë ¥</strong></p>
<div class="sourceCode" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="co"># (n_samples, n_classes)</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>proba_rf <span class="op">=</span> rf_model.predict_proba(X_test)</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>rf_clf <span class="op">=</span> rf_model.named_steps[<span class="st">"rf"</span>]</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>classes_rf <span class="op">=</span> rf_clf.classes_</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>proba_rf_df <span class="op">=</span> pd.DataFrame(proba_rf, columns<span class="op">=</span>classes_rf)</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>display(proba_rf_df.head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre class="text"><code>Adelie  Chinstrap   Gentoo
0   0.853333    0.146667    0.0
1   0.986667    0.013333    0.0
2   0.000000    0.000000    1.0
3   0.000000    0.000000    1.0
4   0.060000    0.940000    0.0</code></pre>
<p><strong>ì˜ì‚¬ê²°ì • ê³¼ì •</strong></p>
<div class="sourceCode" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.tree <span class="im">import</span> export_text</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> explain_one_tree(rf_pipeline, tree_idx<span class="op">=</span><span class="dv">0</span>, max_depth<span class="op">=</span><span class="dv">4</span>):</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>    pre <span class="op">=</span> rf_pipeline.named_steps[<span class="st">"preprocess"</span>]</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>    rf  <span class="op">=</span> rf_pipeline.named_steps[<span class="st">"rf"</span>]</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>    feat_names <span class="op">=</span> <span class="bu">list</span>(pre.get_feature_names_out())</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>    tree <span class="op">=</span> rf.estimators_[tree_idx]</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(export_text(tree, feature_names<span class="op">=</span>feat_names, max_depth<span class="op">=</span>max_depth))</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>explain_one_tree(rf_model, tree_idx<span class="op">=</span><span class="dv">0</span>, max_depth<span class="op">=</span><span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>ì´ ê·œì¹™ì€ ì „ì²˜ë¦¬ëœ ë³€ìˆ˜(ìˆ˜ì¹˜í˜•ì€ í‘œì¤€í™”ëœ ê°’, ë²”ì£¼í˜•ì€ ì›-í•« ì¸ì½”ë”©ëœ 0/1 ê°’)ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ìµœì¢… í´ë˜ìŠ¤ë¥¼ ê²°ì •í•˜ëŠ” ë¶„ê¸° ê·œì¹™ì´ë‹¤. ì—¬ê¸°ì„œ cat__island_Torgersen, cat__island_Dreamì€ ì›-í•« ë³€ìˆ˜ì´ë¯€ë¡œ ê°’ì´ 0.50 ì´í•˜ì´ë©´ í•´ë‹¹ ì„¬ì´ ì•„ë‹Œ ê²½ìš°ì´ê³ , 0.50 ì´ˆê³¼ì´ë©´ í•´ë‹¹ ì„¬ì¸ ê²½ìš°ë¡œ í•´ì„í•˜ëŠ” ê²ƒì´ ìì—°ìŠ¤ëŸ¬ìš´ ê·œì¹™ì´ë‹¤.</p>
<p>ë˜í•œ num__bill_length_mm, num__bill_depth_mm, num__body_mass_gëŠ” í‘œì¤€í™”ëœ ìˆ˜ì¹˜ì¼ ê°€ëŠ¥ì„±ì´ ë†’ìœ¼ë¯€ë¡œ ì„ê³„ê°’ -0.32, -0.24, -1.35, 0.41 ë“±ì€ ì› ë‹¨ìœ„(mm, g)ê°€ ì•„ë‹ˆë¼ í‘œì¤€í™” ìŠ¤ì¼€ì¼ ê¸°ì¤€ì˜ ê²½ê³„ê°’ì¸ í•´ì„ì´ë‹¤.</p>
<p>ì²« ë²ˆì§¸ í° ë¶„ê¸°ëŠ” num__bill_length_mmì´ -0.32 ì´í•˜ì¸ì§€ ì—¬ë¶€ë¡œ ë‚˜ë‰˜ëŠ” ê·œì¹™ì´ë‹¤.</p>
<ul>
<li>num__bill_length_mmì´ -0.32 ì´í•˜ì´ë©´, ë‹¤ìŒìœ¼ë¡œ num__bill_depth_mmì´ -0.24 ì´í•˜ì¸ì§€ í™•ì¸í•˜ëŠ” ê·œì¹™ì´ë‹¤.</li>
<li>num__bill_depth_mmì´ -0.24 ì´í•˜ì´ë©´, num__body_mass_gì´ -1.35 ì´í•˜ì¸ì§€ í™•ì¸í•˜ëŠ” ê·œì¹™ì´ë‹¤.</li>
<li>num__body_mass_gì´ -1.35 ì´í•˜ì´ë©´ ìµœì¢… í´ë˜ìŠ¤ëŠ” 0.0ì¸ ê·œì¹™ì´ë‹¤.</li>
<li>num__body_mass_gì´ -1.35 ì´ˆê³¼ì´ë©´ cat__island_Torgersenì´ 0.50 ì´í•˜ì¸ì§€ í™•ì¸í•˜ëŠ” ê·œì¹™ì´ë‹¤.</li>
<li>cat__island_Torgersenì´ 0.50 ì´í•˜ì´ë©´ ìµœì¢… í´ë˜ìŠ¤ëŠ” 1.0ì¸ ê·œì¹™ì´ë‹¤.</li>
<li>cat__island_Torgersenì´ 0.50 ì´ˆê³¼ì´ë©´ ìµœì¢… í´ë˜ìŠ¤ëŠ” 0.0ì¸ ê·œì¹™ì´ë‹¤.</li>
<li>num__bill_length_mmì´ -0.32 ì´í•˜ì´ë©´ì„œ num__bill_depth_mmì´ -0.24 ì´ˆê³¼ì´ë©´ ìµœì¢… í´ë˜ìŠ¤ëŠ” 0.0ì¸ ê·œì¹™ì´ë‹¤.</li>
</ul>
<p>ë‘ ë²ˆì§¸ í° ë¶„ê¸°ëŠ” num__bill_length_mmì´ -0.32 ì´ˆê³¼ì¸ ê²½ìš°ì˜ ê·œì¹™ì´ë‹¤.</p>
<ul>
<li>num__bill_length_mmì´ -0.32 ì´ˆê³¼ì´ë©´, cat__island_Dreamì´ 0.50 ì´í•˜ì¸ì§€ í™•ì¸í•˜ëŠ” ê·œì¹™ì´ë‹¤.</li>
<li>cat__island_Dreamì´ 0.50 ì´í•˜ì´ë©´, cat__island_Torgersenì´ 0.50 ì´í•˜ì¸ì§€ í™•ì¸í•˜ëŠ” ê·œì¹™ì´ë‹¤.</li>
<li>cat__island_Torgersenì´ 0.50 ì´í•˜ì´ë©´, num__bill_depth_mmì´ 0.41 ì´í•˜ì¸ì§€ í™•ì¸í•˜ëŠ” ê·œì¹™ì´ë‹¤.</li>
<li>num__bill_depth_mmì´ 0.41 ì´í•˜ì´ë©´ ìµœì¢… í´ë˜ìŠ¤ëŠ” 2.0ì¸ ê·œì¹™ì´ë‹¤.</li>
<li>num__bill_depth_mmì´ 0.41 ì´ˆê³¼ì´ë©´ ìµœì¢… í´ë˜ìŠ¤ëŠ” 0.0ì¸ ê·œì¹™ì´ë‹¤.</li>
<li>cat__island_Torgersenì´ 0.50 ì´ˆê³¼ì´ë©´ ìµœì¢… í´ë˜ìŠ¤ëŠ” 0.0ì¸ ê·œì¹™ì´ë‹¤.</li>
<li>num__bill_length_mmì´ -0.32 ì´ˆê³¼ì´ë©´ì„œ cat__island_Dreamì´ 0.50 ì´ˆê³¼ì´ë©´ ìµœì¢… í´ë˜ìŠ¤ëŠ” 1.0ì¸ ê·œì¹™ì´ë‹¤.</li>
</ul>
<p>ì •ë¦¬í•˜ë©´, ì´ íŠ¸ë¦¬ëŠ” (1) í‘œì¤€í™”ëœ ë¶€ë¦¬ ê¸¸ì´ì™€ ë¶€ë¦¬ ê¹Šì´, ì²´ì¤‘ ê°™ì€ ìˆ˜ì¹˜í˜• ê²½ê³„ê°’ê³¼ (2) íŠ¹ì • ì„¬ ì—¬ë¶€(ì›-í•«)ë¥¼ ì¡°í•©í•˜ì—¬ ìµœì¢… í´ë˜ìŠ¤ë¥¼ 0.0, 1.0, 2.0ìœ¼ë¡œ ê²°ì •í•˜ëŠ” ê·œì¹™ ì§‘í•©ì¸ í•´ì„ì´ë‹¤.</p>
<pre class="text"><code>|--- num__bill_length_mm &lt;= -0.32
|   |--- num__bill_depth_mm &lt;= -0.24
|   |   |--- num__body_mass_g &lt;= -1.35
|   |   |   |--- class: 0.0
|   |   |--- num__body_mass_g &gt;  -1.35
|   |   |   |--- cat__island_Torgersen &lt;= 0.50
|   |   |   |   |--- class: 1.0
|   |   |   |--- cat__island_Torgersen &gt;  0.50
|   |   |   |   |--- class: 0.0
|   |--- num__bill_depth_mm &gt;  -0.24
|   |   |--- class: 0.0
|--- num__bill_length_mm &gt;  -0.32
|   |--- cat__island_Dream &lt;= 0.50
|   |   |--- cat__island_Torgersen &lt;= 0.50
|   |   |   |--- num__bill_depth_mm &lt;= 0.41
|   |   |   |   |--- class: 2.0
|   |   |   |--- num__bill_depth_mm &gt;  0.41
|   |   |   |   |--- class: 0.0
|   |   |--- cat__island_Torgersen &gt;  0.50
|   |   |   |--- class: 0.0
|   |--- cat__island_Dream &gt;  0.50
|   |   |--- class: 1.0</code></pre>
<div class="sourceCode" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.tree <span class="im">import</span> plot_tree</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================================================</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 0) ì…ë ¥: rf_model(Pipeline), X_test(DataFrame) ê°€ ì´ë¯¸ ìˆë‹¤ê³  ê°€ì •</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================================================</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) íŠ¹ì • ìƒ˜í”Œ 1ê°œì— ëŒ€í•´: íŠ¸ë¦¬ë³„ íˆ¬í‘œ(í™•ë¥ ) + í‰ê· /í‘œì¤€í¸ì°¨</span></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------</span></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> rf_vote_summary(rf_pipeline, X_row):</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>    pre <span class="op">=</span> rf_pipeline.named_steps[<span class="st">"preprocess"</span>]</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>    rf  <span class="op">=</span> rf_pipeline.named_steps[<span class="st">"rf"</span>]</span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>    Xt <span class="op">=</span> pre.transform(X_row)</span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>    classes <span class="op">=</span> rf.classes_</span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ê° íŠ¸ë¦¬ì˜ predict_proba</span></span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a>    probs <span class="op">=</span> np.array([est.predict_proba(Xt)[<span class="dv">0</span>] <span class="cf">for</span> est <span class="kw">in</span> rf.estimators_])  <span class="co"># (n_trees, n_classes)</span></span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.DataFrame(probs, columns<span class="op">=</span>classes)</span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a>    mean_proba <span class="op">=</span> df.mean().sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a>    std_proba  <span class="op">=</span> df.std().sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-27"><a href="#cb44-27" aria-hidden="true" tabindex="-1"></a>    pred <span class="op">=</span> mean_proba.index[<span class="dv">0</span>]</span>
<span id="cb44-28"><a href="#cb44-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pred, mean_proba, std_proba, df</span>
<span id="cb44-29"><a href="#cb44-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-30"><a href="#cb44-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-31"><a href="#cb44-31" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------</span></span>
<span id="cb44-32"><a href="#cb44-32" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) "ëŒ€í‘œ íŠ¸ë¦¬" ì„ íƒ: (A) í‰ê· ì˜ˆì¸¡ê³¼ ê°™ì€ í´ë˜ìŠ¤ë¥¼ ë‚´ëŠ” íŠ¸ë¦¬ ì¤‘</span></span>
<span id="cb44-33"><a href="#cb44-33" aria-hidden="true" tabindex="-1"></a><span class="co">#    (B) í•´ë‹¹ ìƒ˜í”Œì—ì„œ ì˜ˆì¸¡í™•ë¥ ì´ ê°€ì¥ ë†’ì€ íŠ¸ë¦¬ 1ê°œë¥¼ ê³ ë¦„</span></span>
<span id="cb44-34"><a href="#cb44-34" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------</span></span>
<span id="cb44-35"><a href="#cb44-35" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> pick_representative_tree(rf_pipeline, X_row, target_class<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb44-36"><a href="#cb44-36" aria-hidden="true" tabindex="-1"></a>    pre <span class="op">=</span> rf_pipeline.named_steps[<span class="st">"preprocess"</span>]</span>
<span id="cb44-37"><a href="#cb44-37" aria-hidden="true" tabindex="-1"></a>    rf  <span class="op">=</span> rf_pipeline.named_steps[<span class="st">"rf"</span>]</span>
<span id="cb44-38"><a href="#cb44-38" aria-hidden="true" tabindex="-1"></a>    Xt <span class="op">=</span> pre.transform(X_row)</span>
<span id="cb44-39"><a href="#cb44-39" aria-hidden="true" tabindex="-1"></a>    classes <span class="op">=</span> <span class="bu">list</span>(rf.classes_)</span>
<span id="cb44-40"><a href="#cb44-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-41"><a href="#cb44-41" aria-hidden="true" tabindex="-1"></a>    <span class="co"># target_classë¥¼ ì•ˆ ì£¼ë©´ RF í‰ê·  ì˜ˆì¸¡ í´ë˜ìŠ¤ë¡œ</span></span>
<span id="cb44-42"><a href="#cb44-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> target_class <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb44-43"><a href="#cb44-43" aria-hidden="true" tabindex="-1"></a>        mean_proba <span class="op">=</span> np.mean([est.predict_proba(Xt)[<span class="dv">0</span>] <span class="cf">for</span> est <span class="kw">in</span> rf.estimators_], axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb44-44"><a href="#cb44-44" aria-hidden="true" tabindex="-1"></a>        target_class <span class="op">=</span> classes[<span class="bu">int</span>(np.argmax(mean_proba))]</span>
<span id="cb44-45"><a href="#cb44-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-46"><a href="#cb44-46" aria-hidden="true" tabindex="-1"></a>    c_idx <span class="op">=</span> classes.index(target_class)</span>
<span id="cb44-47"><a href="#cb44-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-48"><a href="#cb44-48" aria-hidden="true" tabindex="-1"></a>    best_idx, best_p <span class="op">=</span> <span class="va">None</span>, <span class="op">-</span><span class="dv">1</span></span>
<span id="cb44-49"><a href="#cb44-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, est <span class="kw">in</span> <span class="bu">enumerate</span>(rf.estimators_):</span>
<span id="cb44-50"><a href="#cb44-50" aria-hidden="true" tabindex="-1"></a>        proba <span class="op">=</span> est.predict_proba(Xt)[<span class="dv">0</span>]</span>
<span id="cb44-51"><a href="#cb44-51" aria-hidden="true" tabindex="-1"></a>        pred  <span class="op">=</span> classes[<span class="bu">int</span>(np.argmax(proba))]</span>
<span id="cb44-52"><a href="#cb44-52" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> pred <span class="op">==</span> target_class <span class="kw">and</span> proba[c_idx] <span class="op">&gt;</span> best_p:</span>
<span id="cb44-53"><a href="#cb44-53" aria-hidden="true" tabindex="-1"></a>            best_p <span class="op">=</span> <span class="bu">float</span>(proba[c_idx])</span>
<span id="cb44-54"><a href="#cb44-54" aria-hidden="true" tabindex="-1"></a>            best_idx <span class="op">=</span> i</span>
<span id="cb44-55"><a href="#cb44-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-56"><a href="#cb44-56" aria-hidden="true" tabindex="-1"></a>    <span class="co"># í˜¹ì‹œ ì¼ì¹˜ íŠ¸ë¦¬ê°€ ì—†ë‹¤ë©´(ê±°ì˜ ì—†ì§€ë§Œ) ê·¸ëƒ¥ í™•ë¥  ìµœëŒ€ íŠ¸ë¦¬</span></span>
<span id="cb44-57"><a href="#cb44-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> best_idx <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb44-58"><a href="#cb44-58" aria-hidden="true" tabindex="-1"></a>        best_idx <span class="op">=</span> <span class="bu">int</span>(np.argmax([est.predict_proba(Xt)[<span class="dv">0</span>][c_idx] <span class="cf">for</span> est <span class="kw">in</span> rf.estimators_]))</span>
<span id="cb44-59"><a href="#cb44-59" aria-hidden="true" tabindex="-1"></a>        best_p   <span class="op">=</span> <span class="bu">float</span>(rf.estimators_[best_idx].predict_proba(Xt)[<span class="dv">0</span>][c_idx])</span>
<span id="cb44-60"><a href="#cb44-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-61"><a href="#cb44-61" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> best_idx, target_class, best_p</span>
<span id="cb44-62"><a href="#cb44-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-63"><a href="#cb44-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-64"><a href="#cb44-64" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------</span></span>
<span id="cb44-65"><a href="#cb44-65" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) íŠ¹ì • íŠ¸ë¦¬ì—ì„œ "í•œ ìƒ˜í”Œ"ì˜ ê²°ì • ê²½ë¡œ(path) í‘œë¡œ ì¶œë ¥</span></span>
<span id="cb44-66"><a href="#cb44-66" aria-hidden="true" tabindex="-1"></a><span class="co">#    (split feature, threshold, ì‹¤ì œ ê°’, LEFT/RIGHT, ë§ˆì§€ë§‰ leafì˜ posterior)</span></span>
<span id="cb44-67"><a href="#cb44-67" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------</span></span>
<span id="cb44-68"><a href="#cb44-68" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> tree_decision_path_for_one(estimator_tree, Xt_row_2d, feature_names, class_names):</span>
<span id="cb44-69"><a href="#cb44-69" aria-hidden="true" tabindex="-1"></a>    clf <span class="op">=</span> estimator_tree</span>
<span id="cb44-70"><a href="#cb44-70" aria-hidden="true" tabindex="-1"></a>    tree_ <span class="op">=</span> clf.tree_</span>
<span id="cb44-71"><a href="#cb44-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-72"><a href="#cb44-72" aria-hidden="true" tabindex="-1"></a>    node_indicator <span class="op">=</span> clf.decision_path(Xt_row_2d)</span>
<span id="cb44-73"><a href="#cb44-73" aria-hidden="true" tabindex="-1"></a>    leaf_id <span class="op">=</span> clf.<span class="bu">apply</span>(Xt_row_2d)[<span class="dv">0</span>]</span>
<span id="cb44-74"><a href="#cb44-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-75"><a href="#cb44-75" aria-hidden="true" tabindex="-1"></a>    node_index <span class="op">=</span> node_indicator.indices[</span>
<span id="cb44-76"><a href="#cb44-76" aria-hidden="true" tabindex="-1"></a>        node_indicator.indptr[<span class="dv">0</span>]: node_indicator.indptr[<span class="dv">1</span>]</span>
<span id="cb44-77"><a href="#cb44-77" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb44-78"><a href="#cb44-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-79"><a href="#cb44-79" aria-hidden="true" tabindex="-1"></a>    rows <span class="op">=</span> []</span>
<span id="cb44-80"><a href="#cb44-80" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> node_id <span class="kw">in</span> node_index:</span>
<span id="cb44-81"><a href="#cb44-81" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> node_id <span class="op">==</span> leaf_id:</span>
<span id="cb44-82"><a href="#cb44-82" aria-hidden="true" tabindex="-1"></a>            counts <span class="op">=</span> tree_.value[node_id][<span class="dv">0</span>]</span>
<span id="cb44-83"><a href="#cb44-83" aria-hidden="true" tabindex="-1"></a>            probs <span class="op">=</span> counts <span class="op">/</span> counts.<span class="bu">sum</span>() <span class="cf">if</span> counts.<span class="bu">sum</span>() <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> counts</span>
<span id="cb44-84"><a href="#cb44-84" aria-hidden="true" tabindex="-1"></a>            rows.append({</span>
<span id="cb44-85"><a href="#cb44-85" aria-hidden="true" tabindex="-1"></a>                <span class="st">"node"</span>: <span class="bu">int</span>(node_id),</span>
<span id="cb44-86"><a href="#cb44-86" aria-hidden="true" tabindex="-1"></a>                <span class="st">"type"</span>: <span class="st">"LEAF"</span>,</span>
<span id="cb44-87"><a href="#cb44-87" aria-hidden="true" tabindex="-1"></a>                <span class="st">"class_counts"</span>: counts.tolist(),</span>
<span id="cb44-88"><a href="#cb44-88" aria-hidden="true" tabindex="-1"></a>                <span class="st">"posterior"</span>: {<span class="bu">str</span>(c): <span class="bu">float</span>(p) <span class="cf">for</span> c, p <span class="kw">in</span> <span class="bu">zip</span>(class_names, probs)}</span>
<span id="cb44-89"><a href="#cb44-89" aria-hidden="true" tabindex="-1"></a>            })</span>
<span id="cb44-90"><a href="#cb44-90" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb44-91"><a href="#cb44-91" aria-hidden="true" tabindex="-1"></a>            f <span class="op">=</span> tree_.feature[node_id]</span>
<span id="cb44-92"><a href="#cb44-92" aria-hidden="true" tabindex="-1"></a>            thr <span class="op">=</span> tree_.threshold[node_id]</span>
<span id="cb44-93"><a href="#cb44-93" aria-hidden="true" tabindex="-1"></a>            feat_name <span class="op">=</span> feature_names[f]</span>
<span id="cb44-94"><a href="#cb44-94" aria-hidden="true" tabindex="-1"></a>            val <span class="op">=</span> <span class="bu">float</span>(Xt_row_2d[<span class="dv">0</span>, f])</span>
<span id="cb44-95"><a href="#cb44-95" aria-hidden="true" tabindex="-1"></a>            go <span class="op">=</span> <span class="st">"LEFT(&lt;=)"</span> <span class="cf">if</span> val <span class="op">&lt;=</span> thr <span class="cf">else</span> <span class="st">"RIGHT(&gt;)"</span></span>
<span id="cb44-96"><a href="#cb44-96" aria-hidden="true" tabindex="-1"></a>            rows.append({</span>
<span id="cb44-97"><a href="#cb44-97" aria-hidden="true" tabindex="-1"></a>                <span class="st">"node"</span>: <span class="bu">int</span>(node_id),</span>
<span id="cb44-98"><a href="#cb44-98" aria-hidden="true" tabindex="-1"></a>                <span class="st">"type"</span>: <span class="st">"SPLIT"</span>,</span>
<span id="cb44-99"><a href="#cb44-99" aria-hidden="true" tabindex="-1"></a>                <span class="st">"feature"</span>: feat_name,</span>
<span id="cb44-100"><a href="#cb44-100" aria-hidden="true" tabindex="-1"></a>                <span class="st">"value_in_node"</span>: val,</span>
<span id="cb44-101"><a href="#cb44-101" aria-hidden="true" tabindex="-1"></a>                <span class="st">"threshold"</span>: <span class="bu">float</span>(thr),</span>
<span id="cb44-102"><a href="#cb44-102" aria-hidden="true" tabindex="-1"></a>                <span class="st">"go"</span>: go</span>
<span id="cb44-103"><a href="#cb44-103" aria-hidden="true" tabindex="-1"></a>            })</span>
<span id="cb44-104"><a href="#cb44-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-105"><a href="#cb44-105" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.DataFrame(rows), <span class="bu">int</span>(leaf_id)</span>
<span id="cb44-106"><a href="#cb44-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-107"><a href="#cb44-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-108"><a href="#cb44-108" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------</span></span>
<span id="cb44-109"><a href="#cb44-109" aria-hidden="true" tabindex="-1"></a><span class="co"># 4) í•œ ë²ˆì— ì‹¤í–‰: íˆ¬í‘œìš”ì•½ + ëŒ€í‘œíŠ¸ë¦¬ ì‹œê°í™” + path ì¶œë ¥</span></span>
<span id="cb44-110"><a href="#cb44-110" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------</span></span>
<span id="cb44-111"><a href="#cb44-111" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> explain_random_forest_sample(rf_pipeline, X_row, plot_max_depth<span class="op">=</span><span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">22</span>, <span class="dv">10</span>), topn_trees<span class="op">=</span><span class="dv">10</span>):</span>
<span id="cb44-112"><a href="#cb44-112" aria-hidden="true" tabindex="-1"></a>    pre <span class="op">=</span> rf_pipeline.named_steps[<span class="st">"preprocess"</span>]</span>
<span id="cb44-113"><a href="#cb44-113" aria-hidden="true" tabindex="-1"></a>    rf  <span class="op">=</span> rf_pipeline.named_steps[<span class="st">"rf"</span>]</span>
<span id="cb44-114"><a href="#cb44-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-115"><a href="#cb44-115" aria-hidden="true" tabindex="-1"></a>    <span class="co"># (A) RF íˆ¬í‘œ ìš”ì•½</span></span>
<span id="cb44-116"><a href="#cb44-116" aria-hidden="true" tabindex="-1"></a>    pred, mean_proba, std_proba, all_tree_df <span class="op">=</span> rf_vote_summary(rf_pipeline, X_row)</span>
<span id="cb44-117"><a href="#cb44-117" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"=== RandomForest final prediction (mean proba) ==="</span>)</span>
<span id="cb44-118"><a href="#cb44-118" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"pred ="</span>, pred)</span>
<span id="cb44-119"><a href="#cb44-119" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">[mean proba]"</span>)</span>
<span id="cb44-120"><a href="#cb44-120" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(mean_proba)</span>
<span id="cb44-121"><a href="#cb44-121" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">[std proba]  (íŠ¸ë¦¬ë“¤ ì˜ê²¬ ë¶ˆì¼ì¹˜ ì •ë„)"</span>)</span>
<span id="cb44-122"><a href="#cb44-122" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(std_proba)</span>
<span id="cb44-123"><a href="#cb44-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-124"><a href="#cb44-124" aria-hidden="true" tabindex="-1"></a>    <span class="co"># íŠ¸ë¦¬ë³„ë¡œ 'ì˜ˆì¸¡ëœ í´ë˜ìŠ¤' ì§‘ê³„(ë‹¤ìˆ˜ê²° ëŠë‚Œ)</span></span>
<span id="cb44-125"><a href="#cb44-125" aria-hidden="true" tabindex="-1"></a>    tree_preds <span class="op">=</span> all_tree_df.idxmax(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb44-126"><a href="#cb44-126" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">[top class vote count]"</span>)</span>
<span id="cb44-127"><a href="#cb44-127" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(tree_preds.value_counts())</span>
<span id="cb44-128"><a href="#cb44-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-129"><a href="#cb44-129" aria-hidden="true" tabindex="-1"></a>    <span class="co"># (B) ëŒ€í‘œ íŠ¸ë¦¬ ì„ íƒ</span></span>
<span id="cb44-130"><a href="#cb44-130" aria-hidden="true" tabindex="-1"></a>    rep_idx, target_class, rep_p <span class="op">=</span> pick_representative_tree(rf_pipeline, X_row, target_class<span class="op">=</span>pred)</span>
<span id="cb44-131"><a href="#cb44-131" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">=== Representative tree ===</span><span class="ch">\n</span><span class="ss">index=</span><span class="sc">{</span>rep_idx<span class="sc">}</span><span class="ss">, target_class=</span><span class="sc">{</span>target_class<span class="sc">}</span><span class="ss">, tree_proba=</span><span class="sc">{</span>rep_p<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb44-132"><a href="#cb44-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-133"><a href="#cb44-133" aria-hidden="true" tabindex="-1"></a>    <span class="co"># (C) ëŒ€í‘œ íŠ¸ë¦¬ ì‹œê°í™”</span></span>
<span id="cb44-134"><a href="#cb44-134" aria-hidden="true" tabindex="-1"></a>    feat_names <span class="op">=</span> pre.get_feature_names_out()</span>
<span id="cb44-135"><a href="#cb44-135" aria-hidden="true" tabindex="-1"></a>    rep_tree <span class="op">=</span> rf.estimators_[rep_idx]</span>
<span id="cb44-136"><a href="#cb44-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-137"><a href="#cb44-137" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>figsize)</span>
<span id="cb44-138"><a href="#cb44-138" aria-hidden="true" tabindex="-1"></a>    plot_tree(</span>
<span id="cb44-139"><a href="#cb44-139" aria-hidden="true" tabindex="-1"></a>        rep_tree,</span>
<span id="cb44-140"><a href="#cb44-140" aria-hidden="true" tabindex="-1"></a>        feature_names<span class="op">=</span>feat_names,</span>
<span id="cb44-141"><a href="#cb44-141" aria-hidden="true" tabindex="-1"></a>        class_names<span class="op">=</span>[<span class="bu">str</span>(c) <span class="cf">for</span> c <span class="kw">in</span> rf.classes_],</span>
<span id="cb44-142"><a href="#cb44-142" aria-hidden="true" tabindex="-1"></a>        filled<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb44-143"><a href="#cb44-143" aria-hidden="true" tabindex="-1"></a>        max_depth<span class="op">=</span>plot_max_depth</span>
<span id="cb44-144"><a href="#cb44-144" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb44-145"><a href="#cb44-145" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f"Representative Tree #</span><span class="sc">{</span>rep_idx<span class="sc">}</span><span class="ss"> (max_depth=</span><span class="sc">{</span>plot_max_depth<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb44-146"><a href="#cb44-146" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb44-147"><a href="#cb44-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-148"><a href="#cb44-148" aria-hidden="true" tabindex="-1"></a>    <span class="co"># (D) ëŒ€í‘œ íŠ¸ë¦¬ì—ì„œ í•´ë‹¹ ìƒ˜í”Œì˜ ê²°ì • ê²½ë¡œ</span></span>
<span id="cb44-149"><a href="#cb44-149" aria-hidden="true" tabindex="-1"></a>    Xt <span class="op">=</span> pre.transform(X_row)</span>
<span id="cb44-150"><a href="#cb44-150" aria-hidden="true" tabindex="-1"></a>    path_df, leaf_id <span class="op">=</span> tree_decision_path_for_one(rep_tree, Xt, feat_names, rf.classes_)</span>
<span id="cb44-151"><a href="#cb44-151" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">=== Decision path in representative tree ==="</span>)</span>
<span id="cb44-152"><a href="#cb44-152" aria-hidden="true" tabindex="-1"></a>    display(path_df)</span>
<span id="cb44-153"><a href="#cb44-153" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"leaf_id ="</span>, leaf_id)</span>
<span id="cb44-154"><a href="#cb44-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-155"><a href="#cb44-155" aria-hidden="true" tabindex="-1"></a>    <span class="co"># (E) ì°¸ê³ : target_classì— ë†’ì€ í™•ë¥ ì„ ì¤€ íŠ¸ë¦¬ TOP-N</span></span>
<span id="cb44-156"><a href="#cb44-156" aria-hidden="true" tabindex="-1"></a>    c_idx <span class="op">=</span> <span class="bu">list</span>(rf.classes_).index(target_class)</span>
<span id="cb44-157"><a href="#cb44-157" aria-hidden="true" tabindex="-1"></a>    tree_scores <span class="op">=</span> all_tree_df[target_class].sort_values(ascending<span class="op">=</span><span class="va">False</span>).head(topn_trees)</span>
<span id="cb44-158"><a href="#cb44-158" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">=== Top-</span><span class="sc">{</span>topn_trees<span class="sc">}</span><span class="ss"> trees by P(</span><span class="sc">{</span>target_class<span class="sc">}</span><span class="ss">) ==="</span>)</span>
<span id="cb44-159"><a href="#cb44-159" aria-hidden="true" tabindex="-1"></a>    display(tree_scores)</span>
<span id="cb44-160"><a href="#cb44-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-161"><a href="#cb44-161" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb44-162"><a href="#cb44-162" aria-hidden="true" tabindex="-1"></a>        <span class="st">"pred"</span>: pred,</span>
<span id="cb44-163"><a href="#cb44-163" aria-hidden="true" tabindex="-1"></a>        <span class="st">"mean_proba"</span>: mean_proba,</span>
<span id="cb44-164"><a href="#cb44-164" aria-hidden="true" tabindex="-1"></a>        <span class="st">"std_proba"</span>: std_proba,</span>
<span id="cb44-165"><a href="#cb44-165" aria-hidden="true" tabindex="-1"></a>        <span class="st">"tree_proba_table"</span>: all_tree_df,</span>
<span id="cb44-166"><a href="#cb44-166" aria-hidden="true" tabindex="-1"></a>        <span class="st">"rep_tree_idx"</span>: rep_idx,</span>
<span id="cb44-167"><a href="#cb44-167" aria-hidden="true" tabindex="-1"></a>        <span class="st">"path_df"</span>: path_df</span>
<span id="cb44-168"><a href="#cb44-168" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb44-169"><a href="#cb44-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-170"><a href="#cb44-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-171"><a href="#cb44-171" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================</span></span>
<span id="cb44-172"><a href="#cb44-172" aria-hidden="true" tabindex="-1"></a><span class="co"># ì‚¬ìš© ì˜ˆì‹œ</span></span>
<span id="cb44-173"><a href="#cb44-173" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================</span></span>
<span id="cb44-174"><a href="#cb44-174" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb44-175"><a href="#cb44-175" aria-hidden="true" tabindex="-1"></a>x0 <span class="op">=</span> X_test.iloc[[i]]          <span class="co"># DataFrame 1í–‰ ìœ ì§€ê°€ í¬ì¸íŠ¸!</span></span>
<span id="cb44-176"><a href="#cb44-176" aria-hidden="true" tabindex="-1"></a>out <span class="op">=</span> explain_random_forest_sample(rf_model, x0, plot_max_depth<span class="op">=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>ëœë¤í¬ë ˆìŠ¤íŠ¸(RandomForest)ëŠ” ì—¬ëŸ¬ ê°œì˜ ê²°ì •íŠ¸ë¦¬ì˜ ì˜ˆì¸¡ì„ í‰ê· ë‚´ì–´ ìµœì¢… í´ë˜ìŠ¤ë¥¼ ê²°ì •í•˜ëŠ” ì•™ìƒë¸” ëª¨ë¸ì´ë‹¤. ë³¸ ìƒ˜í”Œì— ëŒ€í•´ íŠ¸ë¦¬ë“¤ì˜ ì˜ˆì¸¡í™•ë¥ ì„ í‰ê· ë‚¸ ê²°ê³¼, ìµœì¢… ì˜ˆì¸¡ í´ë˜ìŠ¤ëŠ” Adelieì´ë‹¤. í‰ê·  ì‚¬í›„í™•ë¥ (mean proba)ì€ Adelie 0.853333, Chinstrap 0.146667, Gentoo 0.000000ìœ¼ë¡œ ë‚˜íƒ€ë‚˜ Adelieì¼ ê°€ëŠ¥ì„±ì´ ê°€ì¥ ë†’ë‹¤ê³  íŒë‹¨ëœë‹¤.</p>
<p>íŠ¸ë¦¬ë³„ ì˜ˆì¸¡í™•ë¥ ì˜ í‘œì¤€í¸ì°¨(std proba)ëŠ” Adelie 0.354364, Chinstrap 0.354364, Gentoo 0.000000ì´ë‹¤. ì´ëŠ” Adelieì™€ Chinstrapì— ëŒ€í•´ íŠ¸ë¦¬ë“¤ ì‚¬ì´ì˜ ì˜ê²¬ ë¶ˆì¼ì¹˜ê°€ ì¡´ì¬í•¨ì„ ì˜ë¯¸í•œë‹¤. íŠ¹íˆ í™•ë¥ ì´ 0 ë˜ëŠ” 1ì²˜ëŸ¼ ê·¹ë‹¨ì ìœ¼ë¡œ ê°ˆë¦¬ëŠ” íŠ¸ë¦¬ê°€ ì„ì—¬ ìˆì„ ë•Œ í‘œì¤€í¸ì°¨ê°€ í¬ê²Œ ë‚˜íƒ€ë‚˜ëŠ” ê²½í–¥ì´ ìˆë‹¤. ë°˜ë©´ GentooëŠ” í‰ê· ë„ 0ì´ê³  í‘œì¤€í¸ì°¨ë„ 0ì´ë¯€ë¡œ, ê±°ì˜ ëª¨ë“  íŠ¸ë¦¬ê°€ Gentoo ê°€ëŠ¥ì„±ì„ ì‚¬ì‹¤ìƒ ë°°ì œí•œ ìƒíƒœì´ë‹¤.</p>
<p>ë‹¤ìˆ˜ê²° ê´€ì ì˜ ì§‘ê³„(top class vote count)ì—ì„œ ì „ì²´ 300ê°œ íŠ¸ë¦¬ ì¤‘ 256ê°œ íŠ¸ë¦¬ê°€ Adelie, 44ê°œ íŠ¸ë¦¬ê°€ Chinstrapì„ ìµœì¢… í´ë˜ìŠ¤ë¡œ ì„ íƒí•˜ì˜€ë‹¤. Gentooë¥¼ ìµœì¢… í´ë˜ìŠ¤ë¡œ ì„ íƒí•œ íŠ¸ë¦¬ëŠ” ì—†ì—ˆë‹¤. ë”°ë¼ì„œ â€˜ëŒ€ë¶€ë¶„ì˜ íŠ¸ë¦¬ëŠ” Adelieë¡œ ë¶„ë¥˜í•˜ë˜, ì¼ë¶€ íŠ¸ë¦¬ëŠ” Chinstrapìœ¼ë¡œ ë¶„ë¥˜í•˜ëŠ”â€™ êµ¬ì¡°ë¼ê³  í•´ì„ëœë‹¤.</p>
<p>ëŒ€í‘œ íŠ¸ë¦¬(representative tree)ëŠ” ì „ì²´ í‰ê·  ì˜ˆì¸¡ê³¼ ë™ì¼í•œ ëª©í‘œ í´ë˜ìŠ¤(Adelie)ë¥¼ ë‚´ëŠ” íŠ¸ë¦¬ë“¤ ì¤‘ì—ì„œ, í•´ë‹¹ ìƒ˜í”Œì— ëŒ€í•´ Adelie í™•ë¥ ì„ ê°€ì¥ ë†’ê²Œ ì‚°ì¶œí•œ íŠ¸ë¦¬ë¡œ ì„ íƒëœ ê²ƒì´ë‹¤. ì„ íƒëœ ëŒ€í‘œ íŠ¸ë¦¬ëŠ” index=0ì´ë©°, ì´ íŠ¸ë¦¬ì—ì„œì˜ Adelie ì˜ˆì¸¡í™•ë¥ (tree_proba)ì€ 1.0000ìœ¼ë¡œ ì™„ì „ í™•ì‹ ì— í•´ë‹¹í•œë‹¤.</p>
<p>ëŒ€í‘œ íŠ¸ë¦¬ì—ì„œì˜ ê²°ì • ê²½ë¡œ(decision path)ëŠ” ì „ì²˜ë¦¬(í‘œì¤€í™” ë° ì›í•«ì¸ì½”ë”©) ì´í›„ì˜ íŠ¹ì§• ê³µê°„ì—ì„œ ì´ë£¨ì–´ì§„ ë¶„ê¸° ê·œì¹™ì˜ ì—°ì‡„ì´ë‹¤. ì²« ë¶„ê¸°ì—ì„œ num__bill_length_mmì˜ í‘œì¤€í™” ê°’ì´ -0.470502ì´ê³  ì„ê³„ê°’ -0.315119 ì´í•˜ì´ë¯€ë¡œ ì™¼ìª½(LEFT)ìœ¼ë¡œ ì´ë™í•œë‹¤.</p>
<p>ë‹¤ìŒ ë¶„ê¸°ì—ì„œ num__bill_depth_mmì˜ í‘œì¤€í™” ê°’ì´ 0.663008ì´ê³  ì„ê³„ê°’ -0.235401ë³´ë‹¤ í¬ë¯€ë¡œ ì˜¤ë¥¸ìª½(RIGHT)ìœ¼ë¡œ ì´ë™í•œë‹¤. ê·¸ ê²°ê³¼ leaf_id=7ì— ë„ë‹¬í•˜ë©°, ì´ ë¦¬í”„ì˜ í´ë˜ìŠ¤ ë¶„í¬(class_counts)ëŠ” [1.0, 0.0, 0.0]ì´ê³  ì‚¬í›„í™•ë¥ (posterior)ì€ {Adelie: 1.0, Chinstrap: 0.0, Gentoo: 0.0}ì´ë‹¤. ì¦‰ ëŒ€í‘œ íŠ¸ë¦¬ ê¸°ì¤€ìœ¼ë¡œëŠ” í•´ë‹¹ ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ë¦¬í”„ì— Adelieë§Œ ì¡´ì¬í•˜ì—¬ Adelieë¡œ ë‹¨ì •í•˜ëŠ” êµ¬ì¡°ì´ë‹¤.</p>
<p>ì¶”ê°€ë¡œ, Adelieì— ëŒ€í•œ í™•ë¥ ì´ 1.0ì¸ íŠ¸ë¦¬ê°€ ìƒìœ„ 10ê°œ(ì˜ˆ: 298, 0, 1, 2, 3, 297, 5, 6, 7, 8 ë“±)ë¡œ í™•ì¸ëœë‹¤. ì´ëŠ” ì¼ë¶€ íŠ¸ë¦¬ë“¤ì´ í•´ë‹¹ ìƒ˜í”Œì„ Adelieë¡œ ë§¤ìš° ê°•í•˜ê²Œ(í™•ë¥  1.0) ë¶„ë¥˜í•˜ê³  ìˆìŒì„ ë³´ì—¬ì£¼ëŠ” ê·¼ê±°ì´ë‹¤. ë‹¤ë§Œ ì „ì²´ì ìœ¼ë¡œëŠ” Chinstrapìœ¼ë¡œ ë¶„ë¥˜í•˜ëŠ” íŠ¸ë¦¬ë„ ì¼ì • ë¹„ìœ¨ ì¡´ì¬í•˜ë¯€ë¡œ, ëª¨ë¸ ë‚´ë¶€ì—ì„œëŠ” Adelieì™€ Chinstrapì˜ ê²½ê³„ ê·¼ì²˜ì— ìœ„ì¹˜í•œ ìƒ˜í”Œì¼ ê°€ëŠ¥ì„±ì´ ìˆìŒì„ ì‹œì‚¬í•œë‹¤.</p>
<pre class="text"><code>=== RandomForest final prediction (mean proba) ===
pred = Adelie

[mean proba]
Adelie       0.853333
Chinstrap    0.146667
Gentoo       0.000000
dtype: float64

[std proba]  (íŠ¸ë¦¬ë“¤ ì˜ê²¬ ë¶ˆì¼ì¹˜ ì •ë„)
Adelie       0.354364
Chinstrap    0.354364
Gentoo       0.000000
dtype: float64

[top class vote count]
Adelie       256
Chinstrap     44
Name: count, dtype: int64

=== Representative tree ===
index=0, target_class=Adelie, tree_proba=1.0000</code></pre>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/classification_ml_category_rfprocess.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
<p>node 0ì—ì„œ num__bill_length_mm = -0.4705 ì´ê³  ê¸°ì¤€ì´ -0.3151ì´ë‹ˆê¹Œ -0.4705 &lt;= -0.3151 â†’ LEFTë¡œ ê°</p>
<p>node 1ì—ì„œ num__bill_depth_mm = 0.6630 ê¸°ì¤€ -0.2354ë³´ë‹¤ í¬ë‹ˆê¹Œ â†’ RIGHTë¡œ ê°</p>
<p>node 7 (LEAF) ë„ì°© class_counts = [1.0, 0.0, 0.0] â†’ ì´ ì ë…¸ë“œì— ë„ë‹¬í•œ (í•™ìŠµ ë°ì´í„° ê¸°ì¤€) í´ë˜ìŠ¤ ë¶„í¬ê°€ Adelieë§Œ ìˆì—ˆë‹¤ëŠ” ëœ»ì´ë‹¤. ê·¸ë˜ì„œ posterior = {â€˜Adelieâ€™: 1.0, â€¦}ë¡œ Adelie í™•ë¥  100%ê°€ ëœë‹¤.</p>
<p>class_counts/posteriorëŠ” â€œí…ŒìŠ¤íŠ¸ ìƒ˜í”Œì˜ ì§„ì§œ ì •ë‹µâ€ì´ ì•„ë‹ˆë¼, ê·¸ leafì— ëª¨ì¸ í•™ìŠµ ìƒ˜í”Œ(ë˜ëŠ” ê°€ì¤‘ì¹˜)ì˜ ë¶„í¬ë¼ì„œ íŠ¸ë¦¬ê°€ ê·¸ë ‡ê²Œ â€œë¯¿ëŠ”ë‹¤â€ëŠ” ê·¼ê±°ì˜ˆìš”.</p>
<p>leaf_id = 7: ì´ ìƒ˜í”Œì´ ëŒ€í‘œ íŠ¸ë¦¬ì—ì„œ ìµœì¢…ì ìœ¼ë¡œ ë„ì°©í•œ ì ë…¸ë“œì˜ IDê°€ 7ì´ë¼ëŠ” ì˜ë¯¸ì…ë‹ˆë‹¤.</p>
<p>=== Top-10 trees by P(Adelie) ===: ëœë¤í¬ë ˆìŠ¤íŠ¸ì—ëŠ” íŠ¸ë¦¬ê°€ ì—„ì²­ ë§ë‹¤(ì˜ˆ: 300ê°œ). ê·¸ì¤‘ì—ì„œ ì´ ìƒ˜í”Œì— ëŒ€í•´ Adelie í™•ë¥ ì„ ê°€ì¥ ë†’ê²Œ ì¤€ íŠ¸ë¦¬ 10ê°œë¥¼ ë³´ì—¬ì¤€ ê±°ì˜ˆìš”.</p>
<p>ì˜ˆë¥¼ ë“¤ì–´: íŠ¸ë¦¬ 298ë²ˆì€ ì´ ìƒ˜í”Œì„ Adelie í™•ë¥  1.0ìœ¼ë¡œ ë´¤ë‹¤ íŠ¸ë¦¬ 0,1,2,â€¦ë„ 1.0ìœ¼ë¡œ ë´¤ë‹¤. ì¦‰, ì—¬ëŸ¬ íŠ¸ë¦¬ê°€ ì•„ì£¼ ê°•í•˜ê²Œ Adelieë¡œ ë™ì˜í•˜ê³  ìˆëŠ” ìƒí™©ì´ë¼ ëœë¤í¬ë ˆìŠ¤íŠ¸ ìµœì¢… ì˜ˆì¸¡ë„ í”ë“¤ë¦¼ì´ ì ìŠµë‹ˆë‹¤.</p>
<pre class="text"><code>=== Decision path in representative tree ===
node    type    feature value_in_node   threshold   go  class_counts    posterior
0   0   SPLIT   num__bill_length_mm -0.470502   -0.315119   LEFT(&lt;=)    NaN NaN
1   1   SPLIT   num__bill_depth_mm  0.663008    -0.235401   RIGHT(&gt;)    NaN NaN
2   7   LEAF    NaN NaN NaN NaN [1.0, 0.0, 0.0] {'Adelie': 1.0, 'Chinstrap': 0.0, 'Gentoo': 0.0}

leaf_id = 7

=== Top-10 trees by P(Adelie) ===
Adelie
298 1.0
0   1.0
1   1.0
2   1.0
3   1.0
297 1.0
5   1.0
6   1.0
7   1.0
8   1.0</code></pre>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "î§‹";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>