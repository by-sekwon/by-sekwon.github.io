<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>MLDL ë”¥ëŸ¬ë‹ ë¶„ë¥˜ - ì‚¬ë¡€ë¶„ì„ ì´ë¯¸ì§€ ë¶„ë¥˜ â€“ ì„¸ìƒì˜ ëª¨ë“  í†µê³„ ì´ì•¼ê¸°</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-44962e3d41ec9ccc254fd50f1af5efbe.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-sidebar docked nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">ì„¸ìƒì˜ ëª¨ë“  í†µê³„ ì´ì•¼ê¸°</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../notes/math_stat/index.html"> 
<span class="menu-text">ê¸°ì´ˆìˆ˜í•™Â·ìˆ˜ë¦¬í†µê³„</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../notes/intro_stat/index.html"> 
<span class="menu-text">ê¸°ì´ˆí†µê³„Â·ì¡°ì‚¬ë°©ë²•</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../notes/linear_model/index.html"> 
<span class="menu-text">íšŒê·€Â·ë‹¤ë³€ëŸ‰</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../notes/mldl_intro/index.html"> 
<span class="menu-text">MLDLê°œë…</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../notes/mldl_prediction/index.html"> 
<span class="menu-text">MLDLì˜ˆì¸¡</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../../notes/mldl_classification/index.html" aria-current="page"> 
<span class="menu-text">MLDLë¶„ë¥˜</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../notes/data_reduction/index.html"> 
<span class="menu-text">MLDLì°¨ì›ì¶•ì†Œ</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../cardnews/index.html"> 
<span class="menu-text">ì¹´ë“œë‰´ìŠ¤</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../consult.html"> 
<span class="menu-text">í†µê³„ìƒë‹´</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../notes/mldl_classification/classification_dl_image_case.html">ğŸ“„ ë”¥ëŸ¬ë‹ ë¶„ë¥˜ (ì´ë¯¸ì§€)ì‚¬ë¡€</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notes/mldl_classification/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ã€ë¨¸ì‹ Â·ë”¥ëŸ¬ë‹ ë¶„ë¥˜ë¬¸ì œã€‘</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notes/mldl_classification/classification_intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ğŸ“„ ë¶„ë¥˜ë¬¸ì œ: ì •ì˜</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notes/mldl_classification/lm_logistic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ğŸ“„ ì˜ˆì¸¡ë¶„ë¥˜-ë¡œì§€ìŠ¤í‹±íšŒê·€</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notes/mldl_classification/mda_discriminant.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ğŸ“„ ì˜ˆì¸¡ë¶„ë¥˜-íŒë³„ë¶„ì„</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notes/mldl_classification/prediction_treebase.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ğŸ“„ ì˜ˆì¸¡ë¶„ë¥˜-ML íŠ¸ë¦¬ê¸°ë°˜</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notes/mldl_classification/classification_ml_methods.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ğŸ“„ ë¨¸ì‹ ëŸ¬ë‹ kNNSVM ì´ë¡ </span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notes/mldl_classification/classification_evaluation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ğŸ“„ ë¶„ë¥˜ëª¨ë¸ í‰ê°€</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notes/mldl_classification/classification_ml_case_binary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ğŸ“„ ë¨¸ì‹ ëŸ¬ë‹ ì´ì§„í˜• ì‚¬ë¡€</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notes/mldl_classification/classification_ml_case_category.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ğŸ“„ ë¨¸ì‹ ëŸ¬ë‹ k&gt;=3 ì‚¬ë¡€</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notes/mldl_classification/classification_deeplearning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ğŸ“„ ë”¥ëŸ¬ë‹ ë¶„ë¥˜ ì´ë¡ </span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notes/mldl_classification/classification_dl_rare_case.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ğŸ“„ ë”¥ëŸ¬ë‹ ë¶„ë¥˜ (í¬ì†Œì„±ê³µ)ì‚¬ë¡€</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notes/mldl_classification/classification_dl_image_case.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">ğŸ“„ ë”¥ëŸ¬ë‹ ë¶„ë¥˜ (ì´ë¯¸ì§€)ì‚¬ë¡€</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notes/mldl_classification/classification_dl_text_case.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ğŸ“„ ë”¥ëŸ¬ë‹ ë¶„ë¥˜ (í…ìŠ¤íŠ¸)ì‚¬ë¡€</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">ëª©ì°¨</h2>
   
  <ul>
  <li><a href="#ë”¥ëŸ¬ë‹-ë¶„ë¥˜-ì‚¬ë¡€ë¶„ì„-ì´ë¯¸ì§€-ë¶„ë¥˜" id="toc-ë”¥ëŸ¬ë‹-ë¶„ë¥˜-ì‚¬ë¡€ë¶„ì„-ì´ë¯¸ì§€-ë¶„ë¥˜" class="nav-link active" data-scroll-target="#ë”¥ëŸ¬ë‹-ë¶„ë¥˜-ì‚¬ë¡€ë¶„ì„-ì´ë¯¸ì§€-ë¶„ë¥˜">ë”¥ëŸ¬ë‹ ë¶„ë¥˜ ì‚¬ë¡€ë¶„ì„ (ì´ë¯¸ì§€ ë¶„ë¥˜)</a>
  <ul>
  <li><a href="#ë°ì´í„°" id="toc-ë°ì´í„°" class="nav-link" data-scroll-target="#ë°ì´í„°">1. ë°ì´í„°</a></li>
  <li><a href="#cnn-ëª¨ë¸-í•™ìŠµ-ë°-í‰ê°€" id="toc-cnn-ëª¨ë¸-í•™ìŠµ-ë°-í‰ê°€" class="nav-link" data-scroll-target="#cnn-ëª¨ë¸-í•™ìŠµ-ë°-í‰ê°€">2. CNN ëª¨ë¸ í•™ìŠµ ë° í‰ê°€</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">MLDL ë”¥ëŸ¬ë‹ ë¶„ë¥˜ - ì‚¬ë¡€ë¶„ì„ ì´ë¯¸ì§€ ë¶„ë¥˜</h1>
</div>



<div class="quarto-title-meta column-body">

    
  
    
  </div>
  


</header>


<section id="ë”¥ëŸ¬ë‹-ë¶„ë¥˜-ì‚¬ë¡€ë¶„ì„-ì´ë¯¸ì§€-ë¶„ë¥˜" class="level3">
<h3 class="anchored" data-anchor-id="ë”¥ëŸ¬ë‹-ë¶„ë¥˜-ì‚¬ë¡€ë¶„ì„-ì´ë¯¸ì§€-ë¶„ë¥˜">ë”¥ëŸ¬ë‹ ë¶„ë¥˜ ì‚¬ë¡€ë¶„ì„ (ì´ë¯¸ì§€ ë¶„ë¥˜)</h3>
<section id="ë°ì´í„°" class="level4">
<h4 class="anchored" data-anchor-id="ë°ì´í„°">1. ë°ì´í„°</h4>
<section id="ë©”íƒ€-ë°ì´í„°-ë°-ë°ì´í„°-ë¶„í• " class="level5">
<h5 class="anchored" data-anchor-id="ë©”íƒ€-ë°ì´í„°-ë°-ë°ì´í„°-ë¶„í• ">ë©”íƒ€ ë°ì´í„° ë° ë°ì´í„° ë¶„í• </h5>
<p>ë³¸ ì‹¤ìŠµì—ì„œëŠ” TensorFlow/Kerasì—ì„œ ì œê³µí•˜ëŠ” ë‚´ì¥ ë°ì´í„°ì…‹ì¸ CIFAR-10ì„ ì‚¬ìš©í•œë‹¤. CIFAR-10ì€ 32Ã—32 í¬ê¸°ì˜ RGB ì»¬ëŸ¬ ì´ë¯¸ì§€ë¡œ êµ¬ì„±ëœ 10ê°œ í´ë˜ìŠ¤ ë¶„ë¥˜ ë¬¸ì œì´ë©°, ê° ì´ë¯¸ì§€ëŠ” (ë†’ì´ 32, ë„ˆë¹„ 32, ì±„ë„ 3)ì˜ í˜•íƒœë¥¼ ê°€ì§„ë‹¤(NHWC í¬ë§·).</p>
<p>ì½”ë“œì—ì„œ keras.datasets.cifar10.load_data()ë¥¼ í†µí•´ í•™ìŠµìš© ë°ì´í„° 50,000ì¥ê³¼ í…ŒìŠ¤íŠ¸ ë°ì´í„° 10,000ì¥ì„ ë¡œë“œí•˜ì˜€ë‹¤. ë¡œë“œ ì§í›„ ì…ë ¥ ë°ì´í„°ëŠ” x_train_rawì˜ í¬ê¸°ê°€ (50000, 32, 32, 3), x_test_rawì˜ í¬ê¸°ê°€ (10000, 32, 32, 3)ì´ë©°, ìë£Œí˜•(dtype)ì€ uint8ì´ë‹¤. ì´ëŠ” ê° í”½ì…€ì´ 0~255 ë²”ìœ„ì˜ ì •ìˆ˜ ê°’(ì›ì‹œ ì´ë¯¸ì§€ ê°’)ìœ¼ë¡œ ì €ì¥ë˜ì–´ ìˆìŒì„ ì˜ë¯¸í•œë‹¤.</p>
<p>ì •ë‹µ ë ˆì´ë¸”ì€ y_train, y_testë¡œ ì œê³µë˜ë©°, ì›ë˜ (N, 1) í˜•íƒœë¡œ ë¡œë“œë˜ê¸° ë•Œë¬¸ì— reshape(-1)ì„ ì ìš©í•´ (N,) í˜•íƒœì˜ 1ì°¨ì› ë²¡í„°ë¡œ ë³€í™˜í•˜ì˜€ë‹¤. ë³€í™˜ ì´í›„ y_trainì˜ í¬ê¸°ëŠ” (50000,), y_testì˜ í¬ê¸°ëŠ” (10000,)ì´ë©°, ë ˆì´ë¸” ê°’ì€ 0ë¶€í„° 9ê¹Œì§€ì˜ ì •ìˆ˜ë¡œ êµ¬ì„±ëœë‹¤. ê° ì •ìˆ˜ ë ˆì´ë¸”ì€ class_names ë¦¬ìŠ¤íŠ¸ì— ë”°ë¼ 0=airplane, 1=automobile, 2=bird, 3=cat, 4=deer, 5=dog, 6=frog, 7=horse, 8=ship, 9=truckì— ëŒ€ì‘í•œë‹¤.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># (1) ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tensorflow <span class="im">as</span> tf</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow <span class="im">import</span> keras</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># ì¬í˜„ì„±</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>SEED <span class="op">=</span> <span class="dv">42</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>tf.keras.backend.clear_session()</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>np.random.seed(SEED)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>tf.random.set_seed(SEED)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co"># CIFAR-10 ë¡œë“œ</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>(x_train_raw, y_train), (x_test_raw, y_test) <span class="op">=</span> keras.datasets.cifar10.load_data()</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>y_train <span class="op">=</span> y_train.reshape(<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>y_test  <span class="op">=</span> y_test.reshape(<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>class_names <span class="op">=</span> [<span class="st">"airplane"</span>,<span class="st">"automobile"</span>,<span class="st">"bird"</span>,<span class="st">"cat"</span>,<span class="st">"deer"</span>,<span class="st">"dog"</span>,<span class="st">"frog"</span>,<span class="st">"horse"</span>,<span class="st">"ship"</span>,<span class="st">"truck"</span>]</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train raw:"</span>, x_train_raw.shape, y_train.shape, x_train_raw.dtype)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test  raw:"</span>, x_test_raw.shape,  y_test.shape,  x_test_raw.dtype)</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Labels:"</span>, np.unique(y_train))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre class="text"><code>Train raw: (50000, 32, 32, 3) (50000,) uint8
Test  raw: (10000, 32, 32, 3) (10000,) uint8
Labels: [0 1 2 3 4 5 6 7 8 9]</code></pre>
</section>
<section id="ì›ë³¸-ì´ë¯¸ì§€-ë³´ê¸°optional" class="level5">
<h5 class="anchored" data-anchor-id="ì›ë³¸-ì´ë¯¸ì§€-ë³´ê¸°optional">ì›ë³¸ ì´ë¯¸ì§€ ë³´ê¸°(optional)</h5>
<div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tensorflow <span class="im">as</span> tf</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow <span class="im">import</span> keras</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) CIFAR-10 ë¡œë“œ</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>(x_train, y_train), (x_test, y_test) <span class="op">=</span> keras.datasets.cifar10.load_data()</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>y_train <span class="op">=</span> y_train.reshape(<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>y_test  <span class="op">=</span> y_test.reshape(<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>class_names <span class="op">=</span> [<span class="st">"airplane"</span>,<span class="st">"automobile"</span>,<span class="st">"bird"</span>,<span class="st">"cat"</span>,<span class="st">"deer"</span>,<span class="st">"dog"</span>,<span class="st">"frog"</span>,<span class="st">"horse"</span>,<span class="st">"ship"</span>,<span class="st">"truck"</span>]</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) ì›ë³¸(0~255, uint8) ë³´ì¡´</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>x_train_raw <span class="op">=</span> x_train.copy()</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>x_test_raw  <span class="op">=</span> x_test.copy()</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="co"># (ì„ íƒ) ì´í›„ í•™ìŠµìš© ì •ê·œí™”ëŠ” ë³„ë„ë¡œ ìˆ˜í–‰</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>x_train <span class="op">=</span> x_train.astype(<span class="st">"float32"</span>) <span class="op">/</span> <span class="fl">255.0</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>x_test  <span class="op">=</span> x_test.astype(<span class="st">"float32"</span>) <span class="op">/</span> <span class="fl">255.0</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> show_grid_original(X_raw, y, n<span class="op">=</span><span class="dv">25</span>, seed<span class="op">=</span><span class="dv">1</span>, scale<span class="op">=</span><span class="dv">6</span>):</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    rng <span class="op">=</span> np.random.default_rng(seed)</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    idx <span class="op">=</span> rng.choice(<span class="bu">len</span>(X_raw), size<span class="op">=</span>n, replace<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>    ncols <span class="op">=</span> <span class="bu">int</span>(np.ceil(np.sqrt(n)))</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    nrows <span class="op">=</span> <span class="bu">int</span>(np.ceil(n <span class="op">/</span> ncols))</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># scaleì„ í‚¤ìš¸ìˆ˜ë¡ í¬ê²Œ ë³´ì´ì§€ë§Œ í”½ì…€ì€ ê·¸ëŒ€ë¡œ(í¬ë¯¸í•´ì§€ì§€ ì•ŠìŒ)</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>    fig, axes <span class="op">=</span> plt.subplots(nrows, ncols, figsize<span class="op">=</span>(ncols<span class="op">*</span>scale, nrows<span class="op">*</span>scale))</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>    axes <span class="op">=</span> np.array(axes).reshape(<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> ax, i <span class="kw">in</span> <span class="bu">zip</span>(axes, idx):</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>        ax.imshow(X_raw[i], interpolation<span class="op">=</span><span class="st">"nearest"</span>)  <span class="co"># í•µì‹¬: ë³´ê°„ ë”</span></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>        ax.set_title(class_names[<span class="bu">int</span>(y[i])], fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>        ax.axis(<span class="st">"off"</span>)</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ë‚¨ëŠ” ì¹¸ ì§€ìš°ê¸°</span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> ax <span class="kw">in</span> axes[<span class="bu">len</span>(idx):]:</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>        ax.axis(<span class="st">"off"</span>)</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>show_grid_original(x_train_raw, y_train, n<span class="op">=</span><span class="dv">25</span>, seed<span class="op">=</span><span class="dv">1</span>, scale<span class="op">=</span><span class="fl">2.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/classification_dl_case_image.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</section>
<section id="ì „ì²˜ë¦¬-ì „ì²˜ë¦¬-ì •ê·œí™”-01-trainvalid-ë¶„ë¦¬-augmentation" class="level5">
<h5 class="anchored" data-anchor-id="ì „ì²˜ë¦¬-ì „ì²˜ë¦¬-ì •ê·œí™”-01-trainvalid-ë¶„ë¦¬-augmentation">ì „ì²˜ë¦¬: ì „ì²˜ë¦¬ (ì •ê·œí™” 0~1 + train/valid ë¶„ë¦¬ + augmentation)</h5>
<p>ì´ ì½”ë“œëŠ” CIFAR-10 ì´ë¯¸ì§€ ë¶„ë¥˜ ì‹¤í—˜ì„ ìœ„í•´ í•™ìŠµ/í‰ê°€ì— ì‚¬ìš©í•  ì…ë ¥ ë°ì´í„°ë¥¼ ì „ì²˜ë¦¬í•˜ëŠ” ë‹¨ê³„ë¡œ, (1) í”½ì…€ê°’ ì •ê·œí™”, (2) í•™ìŠµ/ê²€ì¦ ë¶„ë¦¬, (3) í•™ìŠµìš© ë°ì´í„° ì¦ê°• ëª¨ë“ˆ ì •ì˜ì˜ ì„¸ ë¶€ë¶„ìœ¼ë¡œ êµ¬ì„±ëœë‹¤.</p>
<p>ë¨¼ì € x_train_raw, x_test_rawëŠ” ì›ë³¸ ì´ë¯¸ì§€ ë°°ì—´(ìë£Œí˜• uint8, í”½ì…€ ë²”ìœ„ 0~255)ë¡œ ìœ ì§€í•´ ë‘ê³ , ëª¨ë¸ í•™ìŠµì— ì‚¬ìš©í•  x_train, x_testë¥¼ ìƒˆë¡œ ë§Œë“ ë‹¤. ì´ë•Œ x_train_rawì™€ x_test_rawë¥¼ float32ë¡œ ë³€í™˜í•œ ë’¤ 255.0ìœ¼ë¡œ ë‚˜ëˆ„ì–´ í”½ì…€ ê°’ì„ 0~1 ë²”ìœ„ë¡œ ìŠ¤ì¼€ì¼ë§í•œë‹¤. ì´ë ‡ê²Œ ì •ê·œí™”ë¥¼ í•˜ë©´ ì…ë ¥ ìŠ¤ì¼€ì¼ì´ ì•ˆì •í™”ë˜ì–´ ìµœì í™”(ê²½ì‚¬í•˜ê°•) ê³¼ì •ì´ ìˆ˜ì¹˜ì ìœ¼ë¡œ ë” ì•ˆì •ì ì´ê³ , í•™ìŠµ ì†ë„ ë° ìˆ˜ë ´ íŠ¹ì„±ì´ ì¢‹ì•„ì§€ëŠ” ê²½í–¥ì´ ìˆë‹¤. ì½”ë“œì— â€œì •ê·œí™”ëŠ” ë”± 1ë²ˆë§Œâ€ì´ë¼ê³  ì£¼ì„ì„ ë‘” ì´ìœ ëŠ”, ì´ë¯¸ 0~1ë¡œ ìŠ¤ì¼€ì¼ë§ëœ ë°ì´í„°ë¥¼ ì´í›„ ë‹¨ê³„ì—ì„œ ë‹¤ì‹œ ë‚˜ëˆ„ê±°ë‚˜ ë³€í™˜í•˜ëŠ” ì¤‘ë³µ ì²˜ë¦¬ê°€ ìƒê¸°ë©´ ì…ë ¥ ë¶„í¬ê°€ ì˜ë„ì™€ ë‹¤ë¥´ê²Œ ë°”ë€Œì–´ ì„±ëŠ¥ ì €í•˜ë‚˜ ë¹„êµ ë¶ˆê°€ëŠ¥ ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì´ë‹¤.</p>
<p>ë‹¤ìŒìœ¼ë¡œ ì •ê·œí™”ê°€ ì˜¬ë°”ë¥´ê²Œ ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•´ x_trainê³¼ x_testì˜ ìµœì†Œê°’/ìµœëŒ€ê°’ì„ ì¶œë ¥í•œë‹¤. ì •ìƒì ì¸ ê²½ìš° ìµœì†Œê°’ì€ 0.0, ìµœëŒ€ê°’ì€ 1.0 ê·¼ì²˜(ì •í™•íˆ 1.0ê¹Œì§€ ê°€ëŠ¥)ê°€ ë˜ì–´ì•¼ í•˜ë©°, ì´ ì¶œë ¥ì€ ì „ì²˜ë¦¬ ì˜¤ë¥˜(ì˜ˆ: ì •ê·œí™” ëˆ„ë½, ìë£Œí˜• ë¬¸ì œ, ì˜ëª»ëœ ìŠ¤ì¼€ì¼ë§)ê°€ ì—†ëŠ”ì§€ ë¹ ë¥´ê²Œ ì ê²€í•˜ëŠ” ì•ˆì „ì¥ì¹˜ ì—­í• ì„ í•œë‹¤.</p>
<p>ê·¸ ë‹¤ìŒ train_test_splitì„ ì‚¬ìš©í•˜ì—¬ í•™ìŠµ ë°ì´í„°ë¥¼ í•™ìŠµìš©(train_sub)ê³¼ ê²€ì¦ìš©(val)ìœ¼ë¡œ 8:2 ë¹„ìœ¨ë¡œ ë¶„ë¦¬í•œë‹¤. random_state=SEEDë¡œ ë‚œìˆ˜ ì‹œë“œë¥¼ ê³ ì •í•´ ë§¤ë²ˆ ë™ì¼í•œ ë¶„í• ì´ ì¬í˜„ë˜ë„ë¡ í•˜ê³ , stratify=y_train ì˜µì…˜ì„ ì‚¬ìš©í•´ í´ë˜ìŠ¤ ë¶„í¬ê°€ í•™ìŠµ/ê²€ì¦ ì„¸íŠ¸ì—ì„œ ì›ë³¸ê³¼ ìœ ì‚¬í•˜ê²Œ ìœ ì§€ë˜ë„ë¡ í•œë‹¤. CIFAR-10ì€ 10ê°œ í´ë˜ìŠ¤ì˜ ê· í˜• ë°ì´í„°ì— ê°€ê¹ì§€ë§Œ, ì‹¤í—˜ ì¬í˜„ì„±ê³¼ ê³µì •í•œ ì„±ëŠ¥ ë¹„êµë¥¼ ìœ„í•´ ì¸µí™” ë¶„ë¦¬ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ì¢‹ì€ ìŠµê´€ì´ë‹¤. ë¶„ë¦¬ í›„ì—ëŠ” ê° ì„¸íŠ¸ì˜ shapeë¥¼ ì¶œë ¥í•´ ë¶„í• ì´ ê¸°ëŒ€í•œ í¬ê¸°(ì˜ˆ: 40000/10000)ë¡œ ë˜ì—ˆëŠ”ì§€ í™•ì¸í•œë‹¤.</p>
<p>ë§ˆì§€ë§‰ìœ¼ë¡œ data_augmentationì´ë¼ëŠ” ì´ë¦„ì˜ keras.Sequential ëª¨ë“ˆì„ ì •ì˜í•œë‹¤. ì—¬ê¸°ì—ëŠ” (1) ì¢Œìš° ë°˜ì „(RandomFlip), (2) ì‘ì€ íšŒì „(RandomRotation), (3) ì•½ê°„ì˜ í™•ëŒ€/ì¶•ì†Œ(RandomZoom)ê°€ í¬í•¨ë˜ì–´ ìˆìœ¼ë©°, ì´ëŠ” í•™ìŠµ ê³¼ì •ì—ì„œ ì…ë ¥ ì´ë¯¸ì§€ë¥¼ í™•ë¥ ì ìœ¼ë¡œ ë³€í˜•í•´ ëª¨ë¸ì´ ë°ì´í„°ì˜ ì‘ì€ ë³€í˜•ì— ëœ ë¯¼ê°í•˜ê³  ì¼ë°˜í™” ì„±ëŠ¥ì´ ì¢‹ì•„ì§€ë„ë¡ ë•ëŠ” ëª©ì ì´ë‹¤. ì´ ëª¨ë“ˆì€ ì •ì˜ë§Œ í•´ë‘ë©´ ë‹¨ë…ìœ¼ë¡œëŠ” ì•„ë¬´ ë³€í™”ë„ ì¼ìœ¼í‚¤ì§€ ì•Šìœ¼ë©°, ì´í›„ ëª¨ë¸ ì„¤ê³„ ë‹¨ê³„ì—ì„œ ì…ë ¥ë‹¨ì— ì—°ê²°í•˜ì—¬ í•™ìŠµ ì‹œì—ë§Œ ì ìš©ë˜ë„ë¡ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¼ë°˜ì ì´ë‹¤. ê²€ì¦/í…ŒìŠ¤íŠ¸ ë°ì´í„°ì—ëŠ” ì¦ê°•ì„ ì ìš©í•˜ì§€ ì•Šê³  ì›ë³¸ ë¶„í¬ ê·¸ëŒ€ë¡œ í‰ê°€í•´ì•¼ ëª¨ë¸ì˜ ì‹¤ì œ ì„±ëŠ¥ì„ ì˜¬ë°”ë¥´ê²Œ ì¸¡ì •í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ, â€œí›ˆë ¨ì‹œì—ë§Œ ëª¨ë¸ ë‚´ë¶€ì—ì„œ ì ìš©â€ì´ë¼ëŠ” ìš´ì˜ ì›ì¹™ê³¼ ë§ë¬¼ë ¤ ì„¤ê³„ëœë‹¤.</p>
<p>ìš”ì•½í•˜ë©´, ì´ ì „ì²˜ë¦¬ ì½”ë“œëŠ” ì›ë³¸ ì´ë¯¸ì§€ë¥¼ 0~1 ë²”ìœ„ë¡œ í‘œì¤€ ì…ë ¥ í˜•íƒœë¡œ ë³€í™˜í•˜ê³ (ì •ê·œí™”), í•™ìŠµ ì¤‘ ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ì„ ìœ„í•œ ê²€ì¦ ì„¸íŠ¸ë¥¼ ì¸µí™” ë¶„ë¦¬ë¡œ í™•ë³´í•˜ë©°, í•™ìŠµ ì „ìš© ë°ì´í„° ì¦ê°• ëª¨ë“ˆì„ ì •ì˜í•´ ì¼ë°˜í™” ì„±ëŠ¥ í–¥ìƒì„ ì¤€ë¹„í•˜ëŠ” ë‹¨ê³„ì´ë‹¤.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co"># (2) ì „ì²˜ë¦¬: ì •ê·œí™” + train/valid ë¶„ë¦¬ + ì¦ê°•</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow <span class="im">import</span> keras</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co"># (ì¤‘ìš”) ì •ê·œí™”ëŠ” "ë”± 1ë²ˆë§Œ"</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>x_train <span class="op">=</span> x_train_raw.astype(<span class="st">"float32"</span>) <span class="op">/</span> <span class="fl">255.0</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>x_test  <span class="op">=</span> x_test_raw.astype(<span class="st">"float32"</span>) <span class="op">/</span> <span class="fl">255.0</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co"># ë²”ìœ„ ì²´í¬(0~1ì´ì–´ì•¼ ì •ìƒ)</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Range train:"</span>, <span class="bu">float</span>(x_train.<span class="bu">min</span>()), <span class="bu">float</span>(x_train.<span class="bu">max</span>()))</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Range test :"</span>, <span class="bu">float</span>(x_test.<span class="bu">min</span>()),  <span class="bu">float</span>(x_test.<span class="bu">max</span>()))</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="co"># train/valid ë¶„ë¦¬</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>x_train_sub, x_val, y_train_sub, y_val <span class="op">=</span> train_test_split(</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    x_train, y_train,</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    test_size<span class="op">=</span><span class="fl">0.2</span>,</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>    random_state<span class="op">=</span>SEED,</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>    stratify<span class="op">=</span>y_train</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train sub:"</span>, x_train_sub.shape, y_train_sub.shape)</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Valid    :"</span>, x_val.shape,      y_val.shape)</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="co"># ë°ì´í„° ì¦ê°•(í›ˆë ¨ì‹œì—ë§Œ ëª¨ë¸ ë‚´ë¶€ì—ì„œ ì ìš©í•˜ëŠ” ìš©ë„)</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>data_augmentation <span class="op">=</span> keras.Sequential(</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>        keras.layers.RandomFlip(<span class="st">"horizontal"</span>),</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>        keras.layers.RandomRotation(<span class="fl">0.1</span>),</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>        keras.layers.RandomZoom(<span class="fl">0.1</span>),</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>    name<span class="op">=</span><span class="st">"data_augmentation"</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>data_augmentation</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre class="text"><code>Range train: 0.0 1.0
Range test : 0.0 1.0
Train sub: (40000, 32, 32, 3) (40000,)
Valid    : (10000, 32, 32, 3) (10000,)</code></pre>
</section>
</section>
<section id="cnn-ëª¨ë¸-í•™ìŠµ-ë°-í‰ê°€" class="level4">
<h4 class="anchored" data-anchor-id="cnn-ëª¨ë¸-í•™ìŠµ-ë°-í‰ê°€">2. CNN ëª¨ë¸ í•™ìŠµ ë° í‰ê°€</h4>
<section id="baseline-cnn" class="level5">
<h5 class="anchored" data-anchor-id="baseline-cnn">(1) Baseline CNN</h5>
<p><strong>ëª¨ë¸ í•™ìŠµ</strong></p>
<p>ì´ ì½”ë“œëŠ” CIFAR-10 ì´ë¯¸ì§€ ë¶„ë¥˜ë¥¼ ìœ„í•œ ê¸°ë³¸í˜•(Baseline) CNNì„ êµ¬ì„±í•˜ê³ , í•™ìŠµìš©/ê²€ì¦ìš© ë°ì´í„°ë¡œ í•™ìŠµì„ ìˆ˜í–‰í•˜ëŠ” ì „ì²´ íë¦„ì„ ë‹´ê³  ìˆë‹¤. ì½”ë“œì˜ ëª©ì ì€ ê°„ë‹¨í•œ í•©ì„±ê³± ì‹ ê²½ë§ì„ ê¸°ì¤€ì„  ëª¨ë¸ë¡œ í•™ìŠµì‹œì¼œ ì´í›„ ê°œì„  ëª¨ë¸ê³¼ ì„±ëŠ¥ì„ ë¹„êµí•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ê²ƒì´ë‹¤.</p>
<ol type="1">
<li><p>ì¬í˜„ì„± ì„¤ì • ë° ì„¸ì…˜ ì´ˆê¸°í™” ì½”ë“œ ì²« ë¶€ë¶„ì—ì„œëŠ” NumPyì™€ TensorFlow ê´€ë ¨ ëª¨ë“ˆì„ ë¶ˆëŸ¬ì˜¨ ë’¤, SEED ê°’ì„ ê³ ì •í•œë‹¤. tf.keras.backend.clear_session()ìœ¼ë¡œ ê¸°ì¡´ ê·¸ë˜í”„/ëª¨ë¸ ìƒíƒœë¥¼ ì´ˆê¸°í™”í•˜ê³ , np.random.seedì™€ tf.random.set_seedë¥¼ í†µí•´ ë‚œìˆ˜ ìƒì„±ì´ ê°€ëŠ¥í•œ í•œ ë™ì¼í•˜ê²Œ ë‚˜ì˜¤ë„ë¡ ì„¤ì •í•œë‹¤. ì´ë ‡ê²Œ í•˜ë©´ ê°™ì€ ë°ì´í„°ì™€ ê°™ì€ ì½”ë“œë¡œ ì‹¤í–‰í–ˆì„ ë•Œ ëª¨ë¸ í•™ìŠµ ê²°ê³¼ê°€ í¬ê²Œ í”ë“¤ë¦¬ì§€ ì•Šë„ë¡ ë„ì›€ì„ ì¤€ë‹¤.</p></li>
<li><p>ì „ì²˜ë¦¬/ë¶„í•  ë³€ìˆ˜ ì¡´ì¬ ì—¬ë¶€ í™•ì¸(ì•ˆì „ì¥ì¹˜) ì´ ì½”ë“œëŠ” í•™ìŠµì— í•„ìš”í•œ x_train_sub, x_val, y_train_sub, y_val ë³€ìˆ˜ê°€ ì´ë¯¸ ì• ì…€ì—ì„œ ë§Œë“¤ì–´ì¡Œë‹¤ê³  ê°€ì •í•œë‹¤. ë‹¤ë§Œ, í•´ë‹¹ ë³€ìˆ˜ê°€ í˜„ì¬ ëŸ°íƒ€ì„ì— ì—†ì„ ê²½ìš°ë¥¼ ëŒ€ë¹„í•˜ì—¬ if â€œx_train_subâ€ not in globals(): ì¡°ê±´ë¬¸ì„ ë‘ê³  ìˆë‹¤. ì¡°ê±´ì´ ì°¸ì´ë©´, ì›ë³¸ í•™ìŠµ/í…ŒìŠ¤íŠ¸ ì´ë¯¸ì§€(x_train_raw, x_test_raw)ë¥¼ 0~1 ë²”ìœ„ë¡œ ì •ê·œí™”í•œ ë’¤(trainê³¼ testë¥¼ ê°ê° float32ë¡œ ë³€í™˜ í›„ 255ë¡œ ë‚˜ëˆ”), train_test_splitì„ ì´ìš©í•´ í•™ìŠµìš©(train_sub)ê³¼ ê²€ì¦ìš©(val)ì„ 8:2 ë¹„ìœ¨ë¡œ ë¶„ë¦¬í•œë‹¤. ì´ë•Œ stratify=y_trainì„ ì‚¬ìš©í•˜ì—¬ í´ë˜ìŠ¤ ë¹„ìœ¨ì´ í•™ìŠµ/ê²€ì¦ì— ìœ ì‚¬í•˜ê²Œ ìœ ì§€ë˜ë„ë¡ í•œë‹¤.</p></li>
<li><p>Baseline CNN êµ¬ì¡° ì •ì˜(build_baseline_cnn) build_baseline_cnn í•¨ìˆ˜ëŠ” ì…ë ¥ ì´ë¯¸ì§€(32Ã—32Ã—3)ë¥¼ ë°›ì•„ 10ê°œ í´ë˜ìŠ¤ì— ëŒ€í•œ í™•ë¥ (softmax)ì„ ì¶œë ¥í•˜ëŠ” CNN ëª¨ë¸ì„ ë§Œë“ ë‹¤. ëª¨ë¸ì˜ í•©ì„±ê³± ë¸”ë¡ì€ Conv2D(3Ã—3, same padding, ReLU)ì™€ MaxPooling2Dë¥¼ ë°˜ë³µí•˜ëŠ” í˜•íƒœë¡œ êµ¬ì„±ëœë‹¤. êµ¬ì²´ì ìœ¼ë¡œëŠ” 32ì±„ë„ â†’ 64ì±„ë„ â†’ 128ì±„ë„ ìˆœìœ¼ë¡œ íŠ¹ì„± ë§µì˜ ì±„ë„ ìˆ˜ë¥¼ ëŠ˜ë¦¬ë©°, ê° ë‹¨ê³„ì—ì„œ í’€ë§ìœ¼ë¡œ ê³µê°„ í•´ìƒë„ë¥¼ ì¤„ì—¬ê°€ë©´ì„œ ë” ì¶”ìƒì ì¸ íŠ¹ì§•ì„ í•™ìŠµí•œë‹¤. ì´í›„ Flattenìœ¼ë¡œ 2ì°¨ì› íŠ¹ì„±ë§µì„ 1ì°¨ì› ë²¡í„°ë¡œ í¼ì¹œ ë’¤ Dense(128, ReLU)ë¡œ ë¶„ë¥˜ì— í•„ìš”í•œ í‘œí˜„ì„ ë§Œë“¤ê³ , Dropout(0.3)ìœ¼ë¡œ ê³¼ì í•©ì„ ì™„í™”í•œë‹¤. ë§ˆì§€ë§‰ Dense(num_classes, softmax) ì¸µì€ 10ê°œ í´ë˜ìŠ¤ì— ëŒ€í•œ ì‚¬í›„í™•ë¥ (ëª¨ë¸ì´ ì¶”ì •í•œ í´ë˜ìŠ¤ í™•ë¥ )ì„ ì¶œë ¥í•œë‹¤.</p></li>
<li><p>ì»´íŒŒì¼(ìµœì í™”/ì†ì‹¤/í‰ê°€ì§€í‘œ) model.compile ë‹¨ê³„ì—ì„œëŠ” Adam(í•™ìŠµë¥  1e-3)ì„ ì‚¬ìš©í•˜ê³ , ë‹¤ì¤‘ë¶„ë¥˜ì— í‘œì¤€ì ìœ¼ë¡œ ì“°ì´ëŠ” SparseCategoricalCrossentropy ì†ì‹¤ì„ ì‚¬ìš©í•œë‹¤. ë¼ë²¨ì´ ì›-í•« ì¸ì½”ë”©ì´ ì•„ë‹ˆë¼ ì •ìˆ˜ í´ë˜ìŠ¤(0~9)ì´ë¯€ë¡œ sparse ë²„ì „ì˜ ì†ì‹¤í•¨ìˆ˜ë¥¼ ì„ íƒí•œ ê²ƒì´ë‹¤. í‰ê°€ì§€í‘œëŠ” accuracyë¥¼ ì‚¬ìš©í•´ ë¶„ë¥˜ ì •í™•ë„ë¥¼ ëª¨ë‹ˆí„°ë§í•œë‹¤.</p></li>
<li><p>ì½œë°± ì„¤ì •(ReduceLROnPlateau, EarlyStopping) cb_baselineì—ëŠ” ë‘ ê°€ì§€ ì½œë°±ì´ ë“¤ì–´ ìˆë‹¤.</p></li>
</ol>
<ul>
<li>ReduceLROnPlateau: ê²€ì¦ ì •í™•ë„(val_accuracy)ê°€ ê°œì„ ë˜ì§€ ì•Šìœ¼ë©´ í•™ìŠµë¥ ì„ factor=0.5ë§Œí¼ ì¤„ì—¬ ë” ë¯¸ì„¸í•œ íƒìƒ‰ì„ ìœ ë„í•œë‹¤. patience=2ëŠ” 2ë²ˆ ì—°ì† ê°œì„ ì´ ì—†ì„ ë•Œ í•™ìŠµë¥ ì„ ë‚®ì¶˜ë‹¤ëŠ” ì˜ë¯¸ì´ë©°, min_lr=1e-5ë¡œ í•™ìŠµë¥  í•˜í•œì„ ë‘”ë‹¤.</li>
<li>EarlyStopping: ê²€ì¦ ì •í™•ë„ ê¸°ì¤€ìœ¼ë¡œ ì„±ëŠ¥ í–¥ìƒì´ ì¼ì • ê¸°ê°„ ì—†ìœ¼ë©´ í•™ìŠµì„ ì¡°ê¸° ì¢…ë£Œí•œë‹¤. patience=6ì€ 6 epoch ë™ì•ˆ ê°œì„ ì´ ì—†ìœ¼ë©´ ë©ˆì¶˜ë‹¤ëŠ” ì˜ë¯¸ì´ë©°, restore_best_weights=TrueëŠ” ê°€ì¥ ì„±ëŠ¥ì´ ì¢‹ì•˜ë˜ ì‹œì ì˜ ê°€ì¤‘ì¹˜ë¥¼ ë§ˆì§€ë§‰ì— ë³µì›í•œë‹¤.</li>
</ul>
<ol start="6" type="1">
<li>í•™ìŠµ ì‹¤í–‰(fit) baseline_cnn.fitì—ì„œëŠ” í•™ìŠµ ë°ì´í„°(x_train_sub, y_train_sub)ë¡œ ëª¨ë¸ì„ í•™ìŠµí•˜ê³ , validation_data=(x_val, y_val)ë¡œ ë§¤ epochë§ˆë‹¤ ê²€ì¦ ì„±ëŠ¥ì„ ê³„ì‚°í•œë‹¤. epochs=30ì€ ìµœëŒ€ ë°˜ë³µ íšŸìˆ˜ì´ë©°, ì‹¤ì œë¡œëŠ” EarlyStopping ì¡°ê±´ì´ ë¨¼ì € ë§Œì¡±ë˜ë©´ 30ë³´ë‹¤ ë¹¨ë¦¬ ì¢…ë£Œë  ìˆ˜ ìˆë‹¤. batch_size=128ì€ í•œ ë²ˆì˜ ì—…ë°ì´íŠ¸ì— ì‚¬ìš©í•˜ëŠ” ìƒ˜í”Œ ë¬¶ìŒ í¬ê¸°ì´ë©°, ê°’ì´ í´ìˆ˜ë¡ í•™ìŠµì€ ë¹ ë¥¼ ìˆ˜ ìˆìœ¼ë‚˜ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì´ ì¦ê°€í•œë‹¤. í•™ìŠµ ê²°ê³¼ëŠ” hist_baselineì— ì €ì¥ë˜ì–´ epochë³„ train/val lossì™€ accuracy ë³€í™” ì¶”ì´ë¥¼ ì´í›„ì— ê·¸ë˜í”„ë¡œ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</li>
</ol>
<p>ì •ë¦¬í•˜ë©´, ì´ Baseline CNN ì½”ë“œëŠ” (ì¬í˜„ì„± ì„¤ì •) â†’ (ë°ì´í„° ì •ê·œí™” ë° í•™ìŠµ/ê²€ì¦ ë¶„í•  ë³´ì¥) â†’ (ê°„ë‹¨í•œ CNN ëª¨ë¸ ì„¤ê³„) â†’ (í‘œì¤€ ì†ì‹¤í•¨ìˆ˜/ìµœì í™”ë¡œ ì»´íŒŒì¼) â†’ (í•™ìŠµë¥  ì¡°ì •ê³¼ ì¡°ê¸° ì¢…ë£Œë¡œ í•™ìŠµ ì•ˆì •í™”) â†’ (í•™ìŠµ ìˆ˜í–‰)ì´ë¼ëŠ” íë¦„ìœ¼ë¡œ êµ¬ì„±ë˜ì–´ ìˆìœ¼ë©°, ê°œì„  ëª¨ë¸ ëŒ€ë¹„ ë¹„êµ ê¸°ì¤€ì„ ì„ ë§Œë“¤ê¸° ìœ„í•œ ëª©ì ì— ë§ê²Œ ì„¤ê³„ë˜ì–´ ìˆë‹¤.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tensorflow <span class="im">as</span> tf</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow <span class="im">import</span> keras</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras <span class="im">import</span> layers</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>SEED <span class="op">=</span> <span class="dv">42</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>tf.keras.backend.clear_session()</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>np.random.seed(SEED)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>tf.random.set_seed(SEED)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co"># (ì•ˆì „ì¥ì¹˜) ì „ì²˜ë¦¬/ë¶„í•  ë³€ìˆ˜ê°€ ì—†ìœ¼ë©´ ì—¬ê¸°ì„œ ë§Œë“¤ì–´ì¤Œ</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">"x_train_sub"</span> <span class="kw">not</span> <span class="kw">in</span> <span class="bu">globals</span>():</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    x_train <span class="op">=</span> x_train_raw.astype(<span class="st">"float32"</span>) <span class="op">/</span> <span class="fl">255.0</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    x_test  <span class="op">=</span> x_test_raw.astype(<span class="st">"float32"</span>) <span class="op">/</span> <span class="fl">255.0</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    x_train_sub, x_val, y_train_sub, y_val <span class="op">=</span> train_test_split(</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>        x_train, y_train, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state<span class="op">=</span>SEED, stratify<span class="op">=</span>y_train</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="co"># (Baseline) Conv-ReLU-Pool ì¤‘ì‹¬ + (Flatten) + Softmax</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>num_classes <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>input_shape <span class="op">=</span> (<span class="dv">32</span>, <span class="dv">32</span>, <span class="dv">3</span>)</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> build_baseline_cnn():</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>    inputs <span class="op">=</span> keras.Input(shape<span class="op">=</span>input_shape)</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> inputs</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># (ì„ íƒ) ë°ì´í„° ì¦ê°•ì„ Baselineì—ëŠ” "ë¹¼ëŠ”" ê²Œ ë¹„êµê°€ ê¹”ë”í•©ë‹ˆë‹¤.</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ë§Œì•½ ë„£ê³  ì‹¶ìœ¼ë©´ ì•„ë˜ 2ì¤„ ì£¼ì„ í•´ì œí•˜ê³ , data_augmentation ë³€ìˆ˜ê°€ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># if "data_augmentation" in globals():</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     x = data_augmentation(x)</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> layers.Conv2D(<span class="dv">32</span>, <span class="dv">3</span>, padding<span class="op">=</span><span class="st">"same"</span>, activation<span class="op">=</span><span class="st">"relu"</span>)(x)</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> layers.MaxPooling2D()(x)</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> layers.Conv2D(<span class="dv">64</span>, <span class="dv">3</span>, padding<span class="op">=</span><span class="st">"same"</span>, activation<span class="op">=</span><span class="st">"relu"</span>)(x)</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> layers.MaxPooling2D()(x)</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> layers.Conv2D(<span class="dv">128</span>, <span class="dv">3</span>, padding<span class="op">=</span><span class="st">"same"</span>, activation<span class="op">=</span><span class="st">"relu"</span>)(x)</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> layers.MaxPooling2D()(x)</span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> layers.Flatten()(x)</span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> layers.Dense(<span class="dv">128</span>, activation<span class="op">=</span><span class="st">"relu"</span>)(x)</span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> layers.Dropout(<span class="fl">0.3</span>)(x)</span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>    outputs <span class="op">=</span> layers.Dense(num_classes, activation<span class="op">=</span><span class="st">"softmax"</span>)(x)</span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> keras.Model(inputs, outputs, name<span class="op">=</span><span class="st">"baseline_cnn"</span>)</span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>    model.<span class="bu">compile</span>(</span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>        optimizer<span class="op">=</span>keras.optimizers.Adam(<span class="fl">1e-3</span>),</span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>        loss<span class="op">=</span>keras.losses.SparseCategoricalCrossentropy(),</span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>        metrics<span class="op">=</span>[<span class="st">"accuracy"</span>],</span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> model</span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>baseline_cnn <span class="op">=</span> build_baseline_cnn()</span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>baseline_cnn.summary()</span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a>cb_baseline <span class="op">=</span> [</span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a>    keras.callbacks.ReduceLROnPlateau(</span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a>        monitor<span class="op">=</span><span class="st">"val_accuracy"</span>, mode<span class="op">=</span><span class="st">"max"</span>,</span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a>        factor<span class="op">=</span><span class="fl">0.5</span>, patience<span class="op">=</span><span class="dv">2</span>, min_lr<span class="op">=</span><span class="fl">1e-5</span>, verbose<span class="op">=</span><span class="dv">1</span></span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a>    keras.callbacks.EarlyStopping(</span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a>        monitor<span class="op">=</span><span class="st">"val_accuracy"</span>, mode<span class="op">=</span><span class="st">"max"</span>,</span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a>        patience<span class="op">=</span><span class="dv">6</span>, restore_best_weights<span class="op">=</span><span class="va">True</span></span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-71"><a href="#cb6-71" aria-hidden="true" tabindex="-1"></a>hist_baseline <span class="op">=</span> baseline_cnn.fit(</span>
<span id="cb6-72"><a href="#cb6-72" aria-hidden="true" tabindex="-1"></a>    x_train_sub, y_train_sub,</span>
<span id="cb6-73"><a href="#cb6-73" aria-hidden="true" tabindex="-1"></a>    validation_data<span class="op">=</span>(x_val, y_val),</span>
<span id="cb6-74"><a href="#cb6-74" aria-hidden="true" tabindex="-1"></a>    epochs<span class="op">=</span><span class="dv">30</span>,</span>
<span id="cb6-75"><a href="#cb6-75" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span><span class="dv">128</span>,</span>
<span id="cb6-76"><a href="#cb6-76" aria-hidden="true" tabindex="-1"></a>    callbacks<span class="op">=</span>cb_baseline,</span>
<span id="cb6-77"><a href="#cb6-77" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="dv">1</span></span>
<span id="cb6-78"><a href="#cb6-78" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>ì´ë²ˆ Baseline CNN ëª¨ë¸ì€ CIFAR-10(32Ã—32Ã—3) ì´ë¯¸ì§€ë¥¼ ì…ë ¥ìœ¼ë¡œ ë°›ì•„, Convâ€“ReLUâ€“MaxPool ë¸”ë¡ì„ 3íšŒ(ì±„ë„ 32â†’64â†’128) ë°˜ë³µí•œ ë’¤ Flatten â†’ Dense(128) â†’ Dropout(0.3) â†’ Softmax(10)ë¡œ ë¶„ë¥˜í•˜ëŠ” êµ¬ì¡°ë¡œ ì„¤ê³„ë˜ì—ˆë‹¤. ì „ì²´ íŒŒë¼ë¯¸í„° ìˆ˜ëŠ” 356,810ê°œ(ì•½ 1.36MB)ì´ë©°, ëª¨ë‘ í•™ìŠµ ê°€ëŠ¥í•œ(trainable) íŒŒë¼ë¯¸í„°ë¡œ êµ¬ì„±ë˜ì–´ ìˆë‹¤.</p>
<p>í•™ìŠµì€ ì´ˆê¸° í•™ìŠµë¥  1e-3(Adam)ë¡œ ì‹œì‘ë˜ì—ˆë‹¤. Epoch 1ì—ì„œëŠ” ì •í™•ë„ 0.2787, ê²€ì¦ ì •í™•ë„ 0.5203ìœ¼ë¡œ ì¶œë°œí–ˆì§€ë§Œ, ì´ˆë°˜ ëª‡ epoch ë™ì•ˆ ì†ì‹¤ì´ ë¹ ë¥´ê²Œ ê°ì†Œí•˜ë©° ì„±ëŠ¥ì´ ê¸‰ê²©íˆ í–¥ìƒë˜ì—ˆë‹¤. Epoch 2~6 êµ¬ê°„ì—ì„œ í›ˆë ¨ ì •í™•ë„ëŠ” ì•½ 0.50 â†’ 0.69ë¡œ ìƒìŠ¹í–ˆê³ , ê²€ì¦ ì •í™•ë„ë„ 0.59 â†’ 0.71 ìˆ˜ì¤€ê¹Œì§€ ì•ˆì •ì ìœ¼ë¡œ ì¦ê°€í•˜ë©´ì„œ ëª¨ë¸ì´ ê¸°ë³¸ì ì¸ íŠ¹ì§•(ì—ì§€/í…ìŠ¤ì²˜ ë“±)ì„ ë¹ ë¥´ê²Œ í•™ìŠµí•˜ëŠ” ëª¨ìŠµì„ ë³´ì˜€ë‹¤.</p>
<p>ì´í›„ Epoch 7~10ì—ì„œëŠ” í›ˆë ¨ ì •í™•ë„ëŠ” ê³„ì† ìƒìŠ¹(ì•½ 0.72 â†’ 0.77)í–ˆì§€ë§Œ, ê²€ì¦ ì •í™•ë„ëŠ” 0.71~0.718 ë¶€ê·¼ì—ì„œ ì •ì²´ë˜ëŠ” ì–‘ìƒì´ ë‚˜íƒ€ë‚¬ë‹¤. ì´ì— ë”°ë¼ Epoch 11ì—ì„œ ReduceLROnPlateauê°€ ë™ì‘í•´ í•™ìŠµë¥ ì´ 0.001 â†’ 0.0005ë¡œ ê°ì†Œí–ˆê³ , ì´ëŠ” â€˜í° ë³´í­ í•™ìŠµâ€™ì—ì„œ â€˜ë¯¸ì„¸ ì¡°ì •â€™ ë‹¨ê³„ë¡œ ì „í™˜ë˜ì—ˆìŒì„ ì˜ë¯¸í•œë‹¤. í•™ìŠµë¥  ê°ì†Œ ì´í›„ Epoch 12~14 êµ¬ê°„ì—ì„œ ê²€ì¦ ì •í™•ë„ëŠ” ë‹¤ì‹œ ê°œì„ ë˜ì–´ ìµœê³  ì•½ 0.7454ê¹Œì§€ ìƒìŠ¹í–ˆë‹¤.</p>
<p>ê·¸ëŸ¬ë‚˜ Epoch 15 ì´í›„ë¶€í„°ëŠ” í›ˆë ¨ ì •í™•ë„ê°€ 0.84 â†’ 0.90+ë¡œ ê¾¸ì¤€íˆ ì˜¤ë¥´ëŠ” ë°˜ë©´, ê²€ì¦ ì •í™•ë„ëŠ” 0.74~0.75ëŒ€ì—ì„œ í° í­ìœ¼ë¡œ ê°œì„ ë˜ì§€ ì•Šê³  ì˜¤íˆë ¤ ë¯¸ì„¸í•œ ë“±ë½ì„ ë°˜ë³µí–ˆë‹¤. ì´ êµ¬ê°„ì—ì„œ ê²€ì¦ ì†ì‹¤(val_loss)ì´ 0.78ëŒ€ì—ì„œ 0.85ëŒ€ë¡œ ë‹¤ì†Œ ì¦ê°€í•˜ëŠ” íë¦„ë„ ë³´ì˜€ëŠ”ë°, ì´ëŠ” í•™ìŠµ ë°ì´í„°ì—ëŠ” ë” ì˜ ë§ì¶”ì§€ë§Œ ì¼ë°˜í™” ì„±ëŠ¥ì€ í¬ê²Œ ì¢‹ì•„ì§€ì§€ ì•ŠëŠ”, ì¦‰ ê³¼ì í•©ì˜ ì‹ í˜¸ë¡œ í•´ì„í•  ìˆ˜ ìˆë‹¤.</p>
<p>ê²€ì¦ ì •í™•ë„ì˜ ì •ì²´ê°€ ë°˜ë³µë˜ë©´ì„œ í•™ìŠµë¥ ì€ ì¶”ê°€ë¡œ ì—¬ëŸ¬ ì°¨ë¡€ ê°ì†Œí–ˆë‹¤(ì˜ˆ: Epoch 16: 0.0005â†’0.00025, Epoch 19: 0.00025â†’0.000125, Epoch 23: 0.000125â†’6.25e-5, Epoch 25: 6.25e-5â†’3.125e-5, Epoch 28: 3.125e-5â†’1.5625e-5). ì´ëŸ¬í•œ ë‹¨ê³„ì  í•™ìŠµë¥  ê°ì†ŒëŠ” í° ê°œì„ ì´ ë‚˜ì˜¤ì§€ ì•ŠëŠ” ìƒí™©ì—ì„œ íŒŒë¼ë¯¸í„°ë¥¼ ë” ì„¸ë°€í•˜ê²Œ ì¡°ì •í•˜ì—¬ ì„±ëŠ¥ì„ â€˜ì¡°ê¸ˆì”©â€™ ëŒì–´ì˜¬ë¦¬ëŠ” ì—­í• ì„ í•œë‹¤. ìµœì¢…ì ìœ¼ë¡œ Epoch 30ì—ì„œ í›ˆë ¨ ì •í™•ë„ëŠ” 0.9080, ê²€ì¦ ì •í™•ë„ëŠ” 0.7578ì„ ê¸°ë¡í•˜ë©° í•™ìŠµì´ ë§ˆë¬´ë¦¬ë˜ì—ˆë‹¤.</p>
<p>ì •ë¦¬í•˜ë©´, ë³¸ í•™ìŠµ ê³¼ì •ì€ (1) ì´ˆë°˜ ë¹ ë¥¸ ìˆ˜ë ´ìœ¼ë¡œ ê¸°ë³¸ ì„±ëŠ¥ í™•ë³´ â†’ (2) ì¤‘ë°˜ ê²€ì¦ ì„±ëŠ¥ ì •ì²´ ë°œìƒ â†’ (3) í•™ìŠµë¥ ì„ ë‹¨ê³„ì ìœ¼ë¡œ ë‚®ì¶”ë©° ë¯¸ì„¸ ì¡°ì • â†’ (4) í›ˆë ¨ ì„±ëŠ¥ì€ ê³„ì† ìƒìŠ¹í•˜ì§€ë§Œ ê²€ì¦ ì„±ëŠ¥ì€ 0.75ëŒ€ì—ì„œ ì œí•œë˜ëŠ” í˜•íƒœë¡œ ì§„í–‰ë˜ì—ˆë‹¤. ë”°ë¼ì„œ Baseline CNNì€ CIFAR-10ì—ì„œ ì¤€ìˆ˜í•œ ì„±ëŠ¥(ê²€ì¦ ì•½ 0.76)ì„ ë³´ì˜€ìœ¼ë‚˜, í›„ë°˜ë¶€ ê³¼ì í•© ê²½í–¥ì„ ì¤„ì´ê¸° ìœ„í•´ì„œëŠ” ë°ì´í„° ì¦ê°• ê°•í™”, ì •ê·œí™”(BN), L2 ê·œì œ, GAP ê¸°ë°˜ í—¤ë“œ ë“± ì¶”ê°€ ê°œì„ ì´ í•„ìš”í•¨ì„ ì‹œì‚¬í•œë‹¤.</p>
<pre class="text"><code>Model: "baseline_cnn"
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ Layer (type)                    â”ƒ Output Shape           â”ƒ       Param # â”ƒ
â”¡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”©
â”‚ input_layer (InputLayer)        â”‚ (None, 32, 32, 3)      â”‚             0 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ conv2d (Conv2D)                 â”‚ (None, 32, 32, 32)     â”‚           896 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ max_pooling2d (MaxPooling2D)    â”‚ (None, 16, 16, 32)     â”‚             0 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ conv2d_1 (Conv2D)               â”‚ (None, 16, 16, 64)     â”‚        18,496 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ max_pooling2d_1 (MaxPooling2D)  â”‚ (None, 8, 8, 64)       â”‚             0 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ conv2d_2 (Conv2D)               â”‚ (None, 8, 8, 128)      â”‚        73,856 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ max_pooling2d_2 (MaxPooling2D)  â”‚ (None, 4, 4, 128)      â”‚             0 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ flatten (Flatten)               â”‚ (None, 2048)           â”‚             0 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ dense (Dense)                   â”‚ (None, 128)            â”‚       262,272 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ dropout (Dropout)               â”‚ (None, 128)            â”‚             0 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ dense_1 (Dense)                 â”‚ (None, 10)             â”‚         1,290 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 Total params: 356,810 (1.36 MB)
 Trainable params: 356,810 (1.36 MB)
 Non-trainable params: 0 (0.00 B)
Epoch 1/30
313/313 â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 109s 336ms/step - accuracy: 0.2787 - loss: 1.9401 - val_accuracy: 0.5203 - val_loss: 1.3502 - learning_rate: 0.0010
Epoch 2/30
(ì¤‘ê°„ ìƒëµ)
Epoch 30/30
313/313 â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 91s 289ms/step - accuracy: 0.9080 - loss: 0.2692 - val_accuracy: 0.7578 - val_loss: 0.8503 - learning_rate: 1.5625e-05</code></pre>
<p><strong>í‰ê°€ê²°ê³¼</strong></p>
<div class="sourceCode" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> confusion_matrix, classification_report, accuracy_score</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) Test accuracy</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>loss, acc <span class="op">=</span> baseline_cnn.evaluate(x_test, y_test, verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"[Baseline CNN] Test accuracy: </span><span class="sc">{</span>acc<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) Prediction</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>y_prob <span class="op">=</span> baseline_cnn.predict(x_test, batch_size<span class="op">=</span><span class="dv">256</span>, verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> np.argmax(y_prob, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) Confusion Matrix (DataFrame)</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>cm <span class="op">=</span> confusion_matrix(y_test, y_pred)</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>cm_df <span class="op">=</span> pd.DataFrame(</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    cm,</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span>[<span class="ss">f"True_</span><span class="sc">{</span>c<span class="sc">}</span><span class="ss">"</span> <span class="cf">for</span> c <span class="kw">in</span> class_names],</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    columns<span class="op">=</span>[<span class="ss">f"Pred_</span><span class="sc">{</span>c<span class="sc">}</span><span class="ss">"</span> <span class="cf">for</span> c <span class="kw">in</span> class_names],</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">[Baseline CNN] Confusion Matrix"</span>)</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>display(cm_df)</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a><span class="co"># 4) Classification Report</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">[Baseline CNN] Classification Report"</span>)</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>    y_test, y_pred,</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>    target_names<span class="op">=</span>class_names,</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>    digits<span class="op">=</span><span class="dv">4</span>,</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>    zero_division<span class="op">=</span><span class="dv">0</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>ì´ë²ˆ Baseline CNNì€ CIFAR-10 í…ŒìŠ¤íŠ¸ì…‹ì—ì„œ ì •í™•ë„ 0.7531ì„ ê¸°ë¡í–ˆìŠµë‹ˆë‹¤. í…ŒìŠ¤íŠ¸ ë°ì´í„°ê°€ ê° í´ë˜ìŠ¤ë‹¹ 1000ì¥ìœ¼ë¡œ ê· ë“±í•˜ë¯€ë¡œ, ì „ì²´ ì •í™•ë„ 75.31%ëŠ” â€œ10ê°œ ì¤‘ 7~8ê°œëŠ” ë§ì¶”ëŠ” ìˆ˜ì¤€â€ìœ¼ë¡œ í•´ì„í•  ìˆ˜ ìˆê³ , í´ë˜ìŠ¤ë³„ ì„±ëŠ¥ ì°¨ì´(ì–´ë–¤ í´ë˜ìŠ¤ê°€ íŠ¹íˆ ì–´ë ¤ìš´ì§€)ê°€ ê²°ê³¼ í•´ì„ì—ì„œ í•µì‹¬ì´ ë©ë‹ˆë‹¤.</p>
<p>ë¶„ë¥˜ ë¦¬í¬íŠ¸ì˜ macro avgì™€ weighted avgê°€ ê±°ì˜ ë™ì¼í•œ ê°’(precision 0.7534, recall 0.7531, f1 0.7531)ìœ¼ë¡œ ë‚˜ì˜¨ ì´ìœ ë„ ë°”ë¡œ í´ë˜ìŠ¤ê°€ ê· í˜•ì´ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ì¦‰, íŠ¹ì • í´ë˜ìŠ¤ê°€ ë°ì´í„° ìˆ˜ê°€ ë§ì•„ì„œ í‰ê· ì„ ëŒì–´ì˜¬ë¦¬ê±°ë‚˜(ë˜ëŠ” ëŒì–´ë‚´ë¦¬ê±°ë‚˜) í•˜ëŠ” íš¨ê³¼ê°€ ê±°ì˜ ì—†ê³ , í´ë˜ìŠ¤ë³„ ì„±ëŠ¥ì„ ê³µí‰í•˜ê²Œ ë°˜ì˜í•œ macro ì§€í‘œê°€ ì „ì²´ ì„±ëŠ¥ì˜ ëŒ€í‘œê°’ìœ¼ë¡œ ë´ë„ ë¬´ë°©í•©ë‹ˆë‹¤.</p>
<p>í´ë˜ìŠ¤ë³„ë¡œ ë³´ë©´ automobile(ì •ë°€ë„ 0.8660, ì¬í˜„ìœ¨ 0.8530, F1 0.8594), ship(0.8604/0.8570/0.8587), truck(0.8451/0.8290/0.8370), horse(0.7994/0.7770/0.7880), frog(0.7854/0.8160/0.8004), airplane(0.7696/0.8050/0.7869)ëŠ” ë¹„êµì  ì•ˆì •ì ìœ¼ë¡œ ë§ì¶”ëŠ” í¸ì…ë‹ˆë‹¤. ë°˜ë©´ cat(0.5778/0.5870/0.5823)ì´ ê°€ì¥ ì–´ë ¤ì› ê³ , bird(0.6636/0.6510/0.6572), dog(0.6680/0.6580/0.6630)ë„ ìƒëŒ€ì ìœ¼ë¡œ ë‚®ì€ ì„±ëŠ¥ì„ ë³´ì…ë‹ˆë‹¤. ì „í˜•ì ìœ¼ë¡œ ë°°ê²½ ë‹¤ì–‘ì„±ì´ í¬ê³ , í˜•íƒœê°€ ë¹„ìŠ·í•˜ê±°ë‚˜(ê³ ì–‘ì´-ê°œ), ì‹œê°ì  ë‹¨ì„œê°€ ì‘ê²Œ ë‚˜íƒ€ë‚˜ëŠ” í´ë˜ìŠ¤(ìƒˆ ë“±)ì—ì„œ ì„±ëŠ¥ì´ ë–¨ì–´ì§„ íŒ¨í„´ì…ë‹ˆë‹¤.</p>
<p>í˜¼ë™í–‰ë ¬ì„ ë³´ë©´ ì–´ë–¤ ì‹¤ìˆ˜ê°€ ë§ì´ ë°œìƒí•˜ëŠ”ì§€ ë” êµ¬ì²´ì ìœ¼ë¡œ í™•ì¸ë©ë‹ˆë‹¤.</p>
<p>cat â†”ï¸ dog í˜¼ë™ì´ ê°€ì¥ ë‘ë“œëŸ¬ì§‘ë‹ˆë‹¤. ê³ ì–‘ì´ë¥¼ ê°œë¡œ ì˜ˆì¸¡í•œ ì‚¬ë¡€ê°€ 145ê±´ì´ê³ (True_cat â†’ Pred_dog), ê°œë¥¼ ê³ ì–‘ì´ë¡œ ì˜ˆì¸¡í•œ ì‚¬ë¡€ê°€ 165ê±´(True_dog â†’ Pred_cat)ì…ë‹ˆë‹¤. ì¦‰, cat í´ë˜ìŠ¤ì˜ ë‚®ì€ ì •ë°€ë„/ì¬í˜„ìœ¨ì€ â€œê°œë¡œ ë¹¨ë ¤ ë“¤ì–´ê°€ëŠ”â€ ì˜¤ë¶„ë¥˜ê°€ í° ë¹„ì¤‘ì„ ì°¨ì§€í•©ë‹ˆë‹¤. CIFAR-10ì˜ í•´ìƒë„(32Ã—32) íŠ¹ì„±ìƒ ì–¼êµ´/ê·€/ë¬´ëŠ¬ ê°™ì€ ë¯¸ì„¸ íŠ¹ì§•ì´ ì•½í•´ì§€ê³ , í¬ì¦ˆì™€ ë°°ê²½ì˜ ì˜í–¥ì´ ì»¤ì ¸ì„œ ì´ëŸ° í˜¼ë™ì´ ì‰½ê²Œ ìƒê¹ë‹ˆë‹¤.</p>
<p>automobile â†”ï¸ truck í˜¼ë™ì´ í½ë‹ˆë‹¤. ìë™ì°¨ë¥¼ íŠ¸ëŸ­ìœ¼ë¡œ 74ê±´, íŠ¸ëŸ­ì„ ìë™ì°¨ë¡œ 56ê±´ ì˜ëª» ì˜ˆì¸¡í–ˆìŠµë‹ˆë‹¤. ë‘ í´ë˜ìŠ¤ëŠ” ëª¨ë‘ ë„ë¡œ/ì°¨ëŸ‰ì´ë¼ëŠ” ê³µí†µ ë°°ê²½ê³¼ í˜•íƒœì  ìœ ì‚¬ì„±ì´ ìˆê³ , íŠ¹íˆ ì‘ì€ ì´ë¯¸ì§€ì—ì„œ í™”ë¬¼ì¹¸/ì°¨ì²´ ë¹„ìœ¨ ê°™ì€ ë‹¨ì„œê°€ íë ¤ì§€ë©´ ìƒí˜¸ í˜¼ë™ì´ ì¦ì•„ì§‘ë‹ˆë‹¤. ê·¸ëŸ¼ì—ë„ ë‘ í´ë˜ìŠ¤ì˜ F1ì´ ë†’ì€ ê²ƒì€, í° í‹€ì—ì„œ â€œì°¨ëŸ‰ ê³„ì—´ì€ ì˜ ì¡ë˜ ì„œë¡œ í—·ê°ˆë¦¬ëŠ”â€ ì„±ê²©ì„ ë³´ì—¬ì¤€ë‹¤ê³  í•´ì„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<p>birdëŠ” ë‹¤ì–‘í•œ ë™ë¬¼/ìì—° í´ë˜ìŠ¤ì™€ ë„“ê²Œ ì„ì…ë‹ˆë‹¤. ìƒˆë¥¼ ì‚¬ìŠ´ìœ¼ë¡œ 80ê±´, ë¹„í–‰ê¸°ë¡œ 63ê±´, ê°œë¡œ 54ê±´, ê³ ì–‘ì´ë¡œ 50ê±´, ê°œêµ¬ë¦¬ë¡œ 52ê±´ ë“± ì˜¤ë¶„ë¥˜ê°€ ì—¬ëŸ¬ ë°©í–¥ìœ¼ë¡œ ë¶„ì‚°ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” bird í´ë˜ìŠ¤ê°€ ë°°ê²½(í•˜ëŠ˜, ë‚˜ë­‡ê°€ì§€, í’€ìˆ² ë“±)ì— ë”°ë¼ ì‹œê°ì  ë‹¨ì„œê°€ ë‹¬ë¼ì§€ê³ , ì‹¤ë£¨ì—£ì´ ì‘ê±°ë‚˜ íë¦¿í•  ë•Œ ë‹¤ë¥¸ í´ë˜ìŠ¤ì˜ ì§ˆê°/ìƒ‰ìƒ ë‹¨ì„œì— ì˜í•´ í”ë“¤ë¦¬ê¸° ì‰¬ì›€ì„ ì‹œì‚¬í•©ë‹ˆë‹¤.</p>
<p>deerëŠ” horse/bird/cat ìª½ìœ¼ë¡œ ìì£¼ ìƒˆì–´ ë‚˜ê°‘ë‹ˆë‹¤. ì‚¬ìŠ´ì„ ë§ë¡œ 63ê±´, ìƒˆë¡œ 63ê±´, ê³ ì–‘ì´ë¡œ 59ê±´, ê°œêµ¬ë¦¬ë¡œ 52ê±´ ì˜¤ë¶„ë¥˜í–ˆìŠµë‹ˆë‹¤. íŠ¹íˆ ì‚¬ìŠ´-ë§ì€ ë‹¤ë¦¬/ì²´í˜• ì‹¤ë£¨ì—£ì´ ë¹„ìŠ·í•˜ê²Œ ì¡íˆëŠ” ê²½ìš°ê°€ ìˆê³ , í’€ë°­ ë°°ê²½ì´ ê³µí†µìœ¼ë¡œ ë‚˜íƒ€ë‚˜ëŠ” ê²½ìš°ë„ ë§ì•„ í˜¼ë™ì´ ì¦ê°€í•©ë‹ˆë‹¤.</p>
<p>airplaneê³¼ shipë„ ì„œë¡œ ë° birdì™€ í˜¼ë™í•©ë‹ˆë‹¤. ë¹„í–‰ê¸°ëŠ” ìƒˆ(50ê±´)ì™€ ë°°(42ê±´)ë¡œ, ë°°ëŠ” ë¹„í–‰ê¸°(59ê±´)ë¡œ ë¹„êµì  ìì£¼ ì˜ëª» ì˜ˆì¸¡ë©ë‹ˆë‹¤. ë¬¼ì²´ê°€ ì‘ê²Œ ë‚˜íƒ€ë‚˜ê±°ë‚˜ ë°°ê²½ì´ ë‹¨ìˆœí•  ë•Œ(í•˜ëŠ˜/ë°”ë‹¤) í…ìŠ¤ì²˜ë³´ë‹¤ í˜•íƒœ ë‹¨ì„œì— ì˜ì¡´í•˜ê²Œ ë˜ê³ , ê·¸ í˜•íƒœ ë‹¨ì„œê°€ ë¶€ì¡±í•˜ë©´ ì´ëŸ° í˜¼ë™ì´ ìƒê¸°ê¸° ì‰½ìŠµë‹ˆë‹¤.</p>
<p>frogëŠ” ìƒëŒ€ì ìœ¼ë¡œ ê°•í•˜ì§€ë§Œ, cat/birdì™€ í˜¼ë™ì´ ë‚¨ì•„ ìˆìŠµë‹ˆë‹¤. ê°œêµ¬ë¦¬ëŠ” ì¬í˜„ìœ¨ì´ 0.816ìœ¼ë¡œ ë†’ì€ í¸(816ê±´ ì •ë‹µ)ì¸ë°, ê³ ì–‘ì´(66ê±´)ì™€ ìƒˆ(48ê±´)ë¡œì˜ ì˜¤ë¶„ë¥˜ê°€ ì£¼ëœ ì‹¤íŒ¨ ì–‘ìƒì…ë‹ˆë‹¤. ì¦‰, â€œê°œêµ¬ë¦¬ë¥¼ ë†“ì¹˜ëŠ” ê²½ìš°â€ê°€ ì™„ì „íˆ ì—†ì§€ëŠ” ì•Šì§€ë§Œ, ë‹¤ë¥¸ ì·¨ì•½ í´ë˜ìŠ¤(cat, bird)ë§Œí¼ êµ¬ì¡°ì ìœ¼ë¡œ ë¬´ë„ˆì§€ì§„ ì•ŠìŠµë‹ˆë‹¤.</p>
<p>ì •ë¦¬í•˜ë©´, ì´ ëª¨ë¸ì€ ì°¨ëŸ‰(automobile/truck), ë°°(ship), ìë™ì°¨/íŠ¸ëŸ­, ê·¸ë¦¬ê³  ë¹„êµì  í˜•íƒœê°€ ëšœë ·í•œ í´ë˜ìŠ¤ì—ì„œ ê°•ì ì„ ë³´ì´ê³ , cat-dogì²˜ëŸ¼ ë¯¸ì„¸ íŠ¹ì§•ì´ ì¤‘ìš”í•œ í´ë˜ìŠ¤, birdì²˜ëŸ¼ ë°°ê²½/í¬ì¦ˆ ë³€ë™ì´ í° í´ë˜ìŠ¤ì—ì„œ ì•½ì ì„ ë³´ì…ë‹ˆë‹¤. ë”°ë¼ì„œ í›„ì† ê°œì„ ì„ í•œë‹¤ë©´ catÂ·dogÂ·birdÂ·deer ìª½ ì„±ëŠ¥ì„ ì˜¬ë¦¬ëŠ” ë°©í–¥(ë” ê°•í•œ ë°ì´í„° ì¦ê°•, ì •ê·œí™”/ê·œì œ ê¸°ë²•, ë” ê¹Šì€ ëª¨ë¸ ë˜ëŠ” BN/GAP/Residual ê³„ì—´, í•™ìŠµë¥  ìŠ¤ì¼€ì¤„, label smoothing ë“±)ì´ ì „ì²´ ì„±ëŠ¥ì„ ëŒì–´ì˜¬ë¦¬ëŠ” ë° ê°€ì¥ íš¨ê³¼ì ì¼ ê°€ëŠ¥ì„±ì´ í½ë‹ˆë‹¤.</p>
<pre class="text"><code>[Baseline CNN] Test accuracy: 0.7531
[Baseline CNN] Confusion Matrix
Pred_airplane   Pred_automobile Pred_bird   Pred_cat    Pred_deer   Pred_dog    Pred_frog   Pred_horse  Pred_ship   Pred_truck
True_airplane   805 16  50  17  24  7   9   5   42  25
True_automobile 16  853 8   6   3   4   13  4   19  74
True_bird   63  10  651 50  80  54  52  28  8   4
True_cat    21  8   65  587 51  145 64  30  18  11
True_deer   17  3   63  59  698 34  52  63  9   2
True_dog    16  4   37  165 41  658 18  47  7   7
True_frog   5   3   48  66  29  17  816 4   6   6
True_horse  12  2   41  31  65  54  6   777 3   9
True_ship   59  30  8   16  6   5   2   3   857 14
True_truck  32  56  10  19  2   7   7   11  27  829
[Baseline CNN] Classification Report
              precision    recall  f1-score   support

    airplane     0.7696    0.8050    0.7869      1000
  automobile     0.8660    0.8530    0.8594      1000
        bird     0.6636    0.6510    0.6572      1000
         cat     0.5778    0.5870    0.5823      1000
        deer     0.6987    0.6980    0.6983      1000
         dog     0.6680    0.6580    0.6630      1000
        frog     0.7854    0.8160    0.8004      1000
       horse     0.7994    0.7770    0.7880      1000
        ship     0.8604    0.8570    0.8587      1000
       truck     0.8451    0.8290    0.8370      1000

    accuracy                         0.7531     10000
   macro avg     0.7534    0.7531    0.7531     10000
weighted avg     0.7534    0.7531    0.7531     10000</code></pre>
<p><strong>ì‚¬í›„í™•ë¥  ì¶œë ¥</strong></p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># âœ… (ì¤‘ìš”) í•™ìŠµí•œ ëª¨ë¸ ë³€ìˆ˜ê°€ baseline_cnnì¸ì§€ í™•ì¸!</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co"># - baseline_cnn.fit(...) ëë‚œ ë’¤ ì‹¤í–‰í•˜ì„¸ìš”.</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co"># - x_testëŠ” ì´ë¯¸ 0~1 ì •ê·œí™”ëœ float32ì—¬ì•¼ í•©ë‹ˆë‹¤.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) í…ŒìŠ¤íŠ¸ì…‹ ì‚¬í›„í™•ë¥  (N, 10)</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>proba <span class="op">=</span> baseline_cnn.predict(x_test, batch_size<span class="op">=</span><span class="dv">256</span>, verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"proba shape:"</span>, proba.shape, <span class="st">"| row sum (first 3):"</span>, proba[:<span class="dv">3</span>].<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>))</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) ì˜ˆì¸¡ í´ë˜ìŠ¤ / ìµœëŒ€í™•ë¥ </span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>pred <span class="op">=</span> np.argmax(proba, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>conf <span class="op">=</span> np.<span class="bu">max</span>(proba, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) Top-3 í´ë˜ìŠ¤/í™•ë¥  ë½‘ê¸°</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>top3_idx <span class="op">=</span> np.argsort(<span class="op">-</span>proba, axis<span class="op">=</span><span class="dv">1</span>)[:, :<span class="dv">3</span>]</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>top3_cls <span class="op">=</span> np.vectorize(<span class="kw">lambda</span> i: class_names[i])(top3_idx)</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>top3_prob <span class="op">=</span> np.take_along_axis(proba, top3_idx, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="co"># 4) ìš”ì•½ í…Œì´ë¸” (ì›í•˜ì‹œë©´ row_idë„ ë¶™ì—¬ë“œë¦´ ìˆ˜ ìˆì–´ìš”)</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>df_post <span class="op">=</span> pd.DataFrame({</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">"y_true"</span>: y_test,</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">"true_class"</span>: [class_names[i] <span class="cf">for</span> i <span class="kw">in</span> y_test],</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">"y_pred"</span>: pred,</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">"pred_class"</span>: [class_names[i] <span class="cf">for</span> i <span class="kw">in</span> pred],</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">"p_max"</span>: conf,</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">"top1"</span>: top3_cls[:,<span class="dv">0</span>], <span class="st">"p1"</span>: top3_prob[:,<span class="dv">0</span>],</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>    <span class="st">"top2"</span>: top3_cls[:,<span class="dv">1</span>], <span class="st">"p2"</span>: top3_prob[:,<span class="dv">1</span>],</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">"top3"</span>: top3_cls[:,<span class="dv">2</span>], <span class="st">"p3"</span>: top3_prob[:,<span class="dv">2</span>],</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>display(df_post.head(<span class="dv">5</span>))</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a><span class="co"># 5) (ì„ íƒ) 10ê°œ í´ë˜ìŠ¤ í™•ë¥ ê¹Œì§€ ë‹¤ í¼ì¹œ í‘œ(í¬ë‹ˆê¹Œ ì¼ë¶€ë§Œ ë¯¸ë¦¬ë³´ê¸°)</span></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>df_proba_full <span class="op">=</span> pd.DataFrame(proba, columns<span class="op">=</span>[<span class="ss">f"p_</span><span class="sc">{</span>c<span class="sc">}</span><span class="ss">"</span> <span class="cf">for</span> c <span class="kw">in</span> class_names])</span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>display(df_proba_full.head(<span class="dv">5</span>))</span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a><span class="co"># 6) (ì„ íƒ) CSVë¡œ ì €ì¥</span></span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a><span class="co"># df_out = pd.concat([df_post, df_proba_full], axis=1)</span></span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a><span class="co"># df_out.to_csv("baseline_posterior_test.csv", index=False)</span></span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a><span class="co"># print("saved:", "baseline_posterior_test.csv")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre class="text"><code>proba shape: (10000, 10) | row sum (first 3): [1.         0.99999994 0.9999998 ]
y_true  true_class  y_pred  pred_class  p_max   top1    p1  top2    p2  top3    p3
0   3   cat 3   cat 0.858937    cat 0.858937    dog 0.138064    ship    2.706298e-03
1   8   ship    8   ship    0.999983    ship    0.999983    automobile  0.000016    airplane    6.444214e-07
2   8   ship    1   automobile  0.575449    automobile  0.575449    airplane    0.181981    ship    1.770541e-01
3   0   airplane    0   airplane    0.978334    airplane    0.978334    ship    0.018194    automobile  2.495502e-03
4   6   frog    6   frog    0.709844    frog    0.709844    cat 0.284362    deer    4.154720e-03

p_airplane  p_automobile    p_bird  p_cat   p_deer  p_dog   p_frog  p_horse p_ship  p_truck
0   8.775511e-06    3.007165e-05    1.263697e-04    8.589367e-01    4.273423e-07    1.380642e-01    8.442276e-05    4.002472e-05    2.706298e-03    2.676775e-06
1   6.444214e-07    1.604075e-05    1.157150e-11    4.172198e-10    4.067237e-15    1.935446e-12    6.580451e-13    9.225259e-15    9.999833e-01    1.616474e-09
2   1.819807e-01    5.754491e-01    3.163953e-04    3.293752e-03    1.416876e-04    1.367454e-03    5.368760e-05    3.820267e-03    1.770541e-01    5.652267e-02
3   9.783342e-01    2.495502e-03    2.775183e-04    1.507238e-05    1.984747e-04    7.650324e-08    8.786704e-06    1.045343e-09    1.819358e-02    4.767261e-04
4   1.966741e-10    7.218498e-08    1.572623e-03    2.843625e-01    4.154720e-03    6.576478e-05    7.098442e-01    1.100643e-08    3.614207e-08    7.421475e-08</code></pre>
</section>
<section id="improved-cnn" class="level5">
<h5 class="anchored" data-anchor-id="improved-cnn">(2) improved CNN</h5>
<p>ë³¸ ê°œì„ í˜• CNNì€ baseline_cnn ëŒ€ë¹„ ì •í™•ë„ë¥¼ ìœ ì§€í•˜ë©´ì„œ í•™ìŠµ ì‹œê°„ì„ ì¤„ì´ê¸° ìœ„í•´ ê³„ì‚°ëŸ‰ê³¼ í•™ìŠµ ë³‘ëª©ì„ ë™ì‹œì— ì¶•ì†Œí•œ ì„¤ê³„ì´ë‹¤. ì†ë„ ì¸¡ë©´ì—ì„œëŠ” (i) WIDTH_MULTë¡œ ì±„ë„ í­ì„ ì¤„ì—¬ í•©ì„±ê³± ì—°ì‚°ëŸ‰ì„ ì§ì ‘ ê°ì†Œì‹œí‚¤ê³ , (ii) ë¸”ë¡ë‹¹ í•©ì„±ê³±ì„ 1íšŒë¡œ ê²½ëŸ‰í™”í•˜ì—¬ ë ˆì´ì–´ ìˆ˜ ëŒ€ë¹„ FLOPsë¥¼ ë‚®ì¶”ë©°, (iii) tf.dataì˜ cache/prefetchë¡œ ì…ë ¥ íŒŒì´í”„ë¼ì¸ ë³‘ëª©ì„ ì¤„ì´ê³ , (iv) mixed precisionì„ í†µí•´ GPUì—ì„œ ì—°ì‚°ê³¼ ë©”ëª¨ë¦¬ íš¨ìœ¨ì„ ê°œì„ í•˜ë©°, (v) steps_per_epoch/validation_stepsë¡œ ì—í­ë‹¹ ì²˜ë¦¬ ìŠ¤í…ì„ ì œí•œí•´ í•™ìŠµ ì‹œê°„ì„ ìƒí•œ ê´€ë¦¬í•˜ëŠ” êµ¬ì¡°ì´ë‹¤.</p>
<p>ì¼ë°˜í™” ì¸¡ë©´ì—ì„œëŠ” BatchNormalizationê³¼ L2 ê°€ì¤‘ì¹˜ ê°ì‡ , Dropout, ë°ì´í„° ì¦ê°•ì´ ê³¼ì í•©ì„ ì™„í™”í•˜ê³ , Flatten ëŒ€ì‹  GAPë¥¼ ì‚¬ìš©í•´ íŒŒë¼ë¯¸í„° ìˆ˜ë¥¼ ì¤„ì—¬ ì‘ì€ ì´ë¯¸ì§€ ë¶„ë¥˜ì—ì„œì˜ ì•ˆì •ì ì¸ ì¼ë°˜í™”ì— ê¸°ì—¬í•˜ëŠ” êµ¬ì„±ì´ë‹¤.</p>
<p><strong>í•™ìŠµ</strong></p>
<div class="sourceCode" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tensorflow <span class="im">as</span> tf</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow <span class="im">import</span> keras</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras <span class="im">import</span> layers, regularizers</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 0) ì¬í˜„ì„± + (ì„ íƒ) ê°€ì† ì„¤ì •</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>SEED <span class="op">=</span> <span class="dv">42</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>keras.utils.set_random_seed(SEED)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>tf.keras.backend.clear_session()</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="co"># (ì„ íƒ) GPUë©´ mixed precisionìœ¼ë¡œ ì†ë„/ë©”ëª¨ë¦¬ ê°œì„  (GPU ì—†ìœ¼ë©´ ìë™ìœ¼ë¡œ float32 ìœ ì§€)</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    gpus <span class="op">=</span> tf.config.list_physical_devices(<span class="st">"GPU"</span>)</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> gpus:</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>        <span class="im">from</span> tensorflow.keras <span class="im">import</span> mixed_precision</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>        mixed_precision.set_global_policy(<span class="st">"mixed_float16"</span>)</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"GPU detected -&gt; mixed precision:"</span>, mixed_precision.global_policy())</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"No GPU -&gt; float32 (CPU)"</span>)</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Mixed precision skipped:"</span>, e)</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) ì†ë„ ìš°ì„  í•˜ì´í¼íŒŒë¼ë¯¸í„°</span></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>FAST_MODE <span class="op">=</span> <span class="va">True</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>num_classes <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>input_shape <span class="op">=</span> (<span class="dv">32</span>, <span class="dv">32</span>, <span class="dv">3</span>)</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> FAST_MODE:</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    BATCH_SIZE <span class="op">=</span> <span class="dv">256</span>         <span class="co"># OOMì´ë©´ 128ë¡œ ë‚®ì¶”ê¸°</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    EPOCHS <span class="op">=</span> <span class="dv">20</span>              <span class="co"># ìƒí•œ. EarlyStoppingì´ ë” ë¹¨ë¦¬ ëŠì„ ìˆ˜ ìˆìŒ</span></span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>    WIDTH_MULT <span class="op">=</span> <span class="fl">0.75</span>        <span class="co"># 1.0ì´ ì›ë˜ í­, 0.75/0.5ë¡œ ì¤„ì´ë©´ ë¹¨ë¼ì§</span></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>    STEPS_PER_EPOCH <span class="op">=</span> <span class="dv">200</span>    <span class="co"># Noneì´ë©´ ì „ì²´ ë°ì´í„° 1 epoch, ìˆ«ìë©´ ì‹œê°„ ìƒí•œ(ë¹ ë¥¸ ì‹¤ìŠµìš©)</span></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>    VAL_STEPS <span class="op">=</span> <span class="dv">50</span></span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>    PATIENCE <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>    BATCH_SIZE <span class="op">=</span> <span class="dv">128</span></span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>    EPOCHS <span class="op">=</span> <span class="dv">50</span></span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a>    WIDTH_MULT <span class="op">=</span> <span class="fl">1.0</span></span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a>    STEPS_PER_EPOCH <span class="op">=</span> <span class="va">None</span></span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>    VAL_STEPS <span class="op">=</span> <span class="va">None</span></span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a>    PATIENCE <span class="op">=</span> <span class="dv">8</span></span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================</span></span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) tf.data íŒŒì´í”„ë¼ì¸ (ì†ë„ ê°œì„ )</span></span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================</span></span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a>AUTOTUNE <span class="op">=</span> tf.data.AUTOTUNE</span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a>SHUFFLE <span class="op">=</span> <span class="dv">20000</span></span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a>train_ds <span class="op">=</span> tf.data.Dataset.from_tensor_slices((x_train_sub, y_train_sub))</span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a>train_ds <span class="op">=</span> train_ds.shuffle(SHUFFLE, seed<span class="op">=</span>SEED, reshuffle_each_iteration<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true" tabindex="-1"></a>train_ds <span class="op">=</span> train_ds.batch(BATCH_SIZE).cache().prefetch(AUTOTUNE)</span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-58"><a href="#cb12-58" aria-hidden="true" tabindex="-1"></a>val_ds <span class="op">=</span> tf.data.Dataset.from_tensor_slices((x_val, y_val))</span>
<span id="cb12-59"><a href="#cb12-59" aria-hidden="true" tabindex="-1"></a>val_ds <span class="op">=</span> val_ds.batch(BATCH_SIZE).cache().prefetch(AUTOTUNE)</span>
<span id="cb12-60"><a href="#cb12-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-61"><a href="#cb12-61" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================</span></span>
<span id="cb12-62"><a href="#cb12-62" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) ì¦ê°•(í›ˆë ¨ì‹œì—ë§Œ ìë™ ì ìš©)</span></span>
<span id="cb12-63"><a href="#cb12-63" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================</span></span>
<span id="cb12-64"><a href="#cb12-64" aria-hidden="true" tabindex="-1"></a>data_augmentation <span class="op">=</span> keras.Sequential(</span>
<span id="cb12-65"><a href="#cb12-65" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb12-66"><a href="#cb12-66" aria-hidden="true" tabindex="-1"></a>        layers.RandomFlip(<span class="st">"horizontal"</span>),</span>
<span id="cb12-67"><a href="#cb12-67" aria-hidden="true" tabindex="-1"></a>        layers.RandomRotation(<span class="fl">0.1</span>),</span>
<span id="cb12-68"><a href="#cb12-68" aria-hidden="true" tabindex="-1"></a>        layers.RandomZoom(<span class="fl">0.1</span>),</span>
<span id="cb12-69"><a href="#cb12-69" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb12-70"><a href="#cb12-70" aria-hidden="true" tabindex="-1"></a>    name<span class="op">=</span><span class="st">"data_augmentation"</span></span>
<span id="cb12-71"><a href="#cb12-71" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-72"><a href="#cb12-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-73"><a href="#cb12-73" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================</span></span>
<span id="cb12-74"><a href="#cb12-74" aria-hidden="true" tabindex="-1"></a><span class="co"># 4) Improved CNN (BN + L2 + GAP) - ì†ë„ìš©ìœ¼ë¡œ ê²½ëŸ‰í™” í¬í•¨</span></span>
<span id="cb12-75"><a href="#cb12-75" aria-hidden="true" tabindex="-1"></a><span class="co">#    - ê° ë¸”ë¡ì„ "Conv 2íšŒ" -&gt; "Conv 1íšŒ"ë¡œ ì¤„ì—¬ ì‹œê°„ ë‹¨ì¶•</span></span>
<span id="cb12-76"><a href="#cb12-76" aria-hidden="true" tabindex="-1"></a><span class="co">#    - WIDTH_MULTë¡œ ì±„ë„ í­ ì¶•ì†Œ ê°€ëŠ¥</span></span>
<span id="cb12-77"><a href="#cb12-77" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================</span></span>
<span id="cb12-78"><a href="#cb12-78" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> conv_block(x, filters, wd<span class="op">=</span><span class="fl">1e-4</span>):</span>
<span id="cb12-79"><a href="#cb12-79" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> layers.Conv2D(</span>
<span id="cb12-80"><a href="#cb12-80" aria-hidden="true" tabindex="-1"></a>        filters, <span class="dv">3</span>, padding<span class="op">=</span><span class="st">"same"</span>,</span>
<span id="cb12-81"><a href="#cb12-81" aria-hidden="true" tabindex="-1"></a>        use_bias<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb12-82"><a href="#cb12-82" aria-hidden="true" tabindex="-1"></a>        kernel_initializer<span class="op">=</span><span class="st">"he_normal"</span>,</span>
<span id="cb12-83"><a href="#cb12-83" aria-hidden="true" tabindex="-1"></a>        kernel_regularizer<span class="op">=</span>regularizers.l2(wd)</span>
<span id="cb12-84"><a href="#cb12-84" aria-hidden="true" tabindex="-1"></a>    )(x)</span>
<span id="cb12-85"><a href="#cb12-85" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> layers.BatchNormalization()(x)</span>
<span id="cb12-86"><a href="#cb12-86" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> layers.Activation(<span class="st">"relu"</span>)(x)</span>
<span id="cb12-87"><a href="#cb12-87" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x</span>
<span id="cb12-88"><a href="#cb12-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-89"><a href="#cb12-89" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> build_improved_cnn(wd<span class="op">=</span><span class="fl">1e-4</span>, dropout<span class="op">=</span><span class="fl">0.2</span>, head_dropout<span class="op">=</span><span class="fl">0.4</span>, width_mult<span class="op">=</span><span class="fl">1.0</span>):</span>
<span id="cb12-90"><a href="#cb12-90" aria-hidden="true" tabindex="-1"></a>    f1 <span class="op">=</span> <span class="bu">int</span>(<span class="dv">32</span> <span class="op">*</span> width_mult)</span>
<span id="cb12-91"><a href="#cb12-91" aria-hidden="true" tabindex="-1"></a>    f2 <span class="op">=</span> <span class="bu">int</span>(<span class="dv">64</span> <span class="op">*</span> width_mult)</span>
<span id="cb12-92"><a href="#cb12-92" aria-hidden="true" tabindex="-1"></a>    f3 <span class="op">=</span> <span class="bu">int</span>(<span class="dv">128</span> <span class="op">*</span> width_mult)</span>
<span id="cb12-93"><a href="#cb12-93" aria-hidden="true" tabindex="-1"></a>    head <span class="op">=</span> <span class="bu">int</span>(<span class="dv">128</span> <span class="op">*</span> width_mult)</span>
<span id="cb12-94"><a href="#cb12-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-95"><a href="#cb12-95" aria-hidden="true" tabindex="-1"></a>    inputs <span class="op">=</span> keras.Input(shape<span class="op">=</span>input_shape)</span>
<span id="cb12-96"><a href="#cb12-96" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> data_augmentation(inputs)  <span class="co"># training=Trueì¼ ë•Œë§Œ ëœë¤ ì ìš©</span></span>
<span id="cb12-97"><a href="#cb12-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-98"><a href="#cb12-98" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Block 1 (ê²½ëŸ‰í™”: conv 1íšŒ)</span></span>
<span id="cb12-99"><a href="#cb12-99" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> conv_block(x, f1, wd)</span>
<span id="cb12-100"><a href="#cb12-100" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> layers.MaxPooling2D()(x)</span>
<span id="cb12-101"><a href="#cb12-101" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> layers.Dropout(dropout)(x)</span>
<span id="cb12-102"><a href="#cb12-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-103"><a href="#cb12-103" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Block 2</span></span>
<span id="cb12-104"><a href="#cb12-104" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> conv_block(x, f2, wd)</span>
<span id="cb12-105"><a href="#cb12-105" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> layers.MaxPooling2D()(x)</span>
<span id="cb12-106"><a href="#cb12-106" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> layers.Dropout(dropout)(x)</span>
<span id="cb12-107"><a href="#cb12-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-108"><a href="#cb12-108" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Block 3</span></span>
<span id="cb12-109"><a href="#cb12-109" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> conv_block(x, f3, wd)</span>
<span id="cb12-110"><a href="#cb12-110" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> layers.MaxPooling2D()(x)</span>
<span id="cb12-111"><a href="#cb12-111" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> layers.Dropout(dropout)(x)</span>
<span id="cb12-112"><a href="#cb12-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-113"><a href="#cb12-113" aria-hidden="true" tabindex="-1"></a>    <span class="co"># GAP Head</span></span>
<span id="cb12-114"><a href="#cb12-114" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> layers.GlobalAveragePooling2D()(x)</span>
<span id="cb12-115"><a href="#cb12-115" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> layers.Dense(</span>
<span id="cb12-116"><a href="#cb12-116" aria-hidden="true" tabindex="-1"></a>        head, use_bias<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb12-117"><a href="#cb12-117" aria-hidden="true" tabindex="-1"></a>        kernel_initializer<span class="op">=</span><span class="st">"he_normal"</span>,</span>
<span id="cb12-118"><a href="#cb12-118" aria-hidden="true" tabindex="-1"></a>        kernel_regularizer<span class="op">=</span>regularizers.l2(wd)</span>
<span id="cb12-119"><a href="#cb12-119" aria-hidden="true" tabindex="-1"></a>    )(x)</span>
<span id="cb12-120"><a href="#cb12-120" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> layers.BatchNormalization()(x)</span>
<span id="cb12-121"><a href="#cb12-121" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> layers.Activation(<span class="st">"relu"</span>)(x)</span>
<span id="cb12-122"><a href="#cb12-122" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> layers.Dropout(head_dropout)(x)</span>
<span id="cb12-123"><a href="#cb12-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-124"><a href="#cb12-124" aria-hidden="true" tabindex="-1"></a>    <span class="co"># mixed precision ì‚¬ìš© ì‹œ ì¶œë ¥ì€ float32ë¡œ ê³ ì •(ì§€í‘œ/ì†ì‹¤ ì•ˆì •)</span></span>
<span id="cb12-125"><a href="#cb12-125" aria-hidden="true" tabindex="-1"></a>    outputs <span class="op">=</span> layers.Dense(num_classes, activation<span class="op">=</span><span class="st">"softmax"</span>, dtype<span class="op">=</span><span class="st">"float32"</span>)(x)</span>
<span id="cb12-126"><a href="#cb12-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-127"><a href="#cb12-127" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> keras.Model(inputs, outputs, name<span class="op">=</span><span class="st">"improved_cnn_bn_l2_gap_fast"</span>)</span>
<span id="cb12-128"><a href="#cb12-128" aria-hidden="true" tabindex="-1"></a>    model.<span class="bu">compile</span>(</span>
<span id="cb12-129"><a href="#cb12-129" aria-hidden="true" tabindex="-1"></a>        optimizer<span class="op">=</span>keras.optimizers.Adam(<span class="fl">1e-3</span>),</span>
<span id="cb12-130"><a href="#cb12-130" aria-hidden="true" tabindex="-1"></a>        loss<span class="op">=</span>keras.losses.SparseCategoricalCrossentropy(),</span>
<span id="cb12-131"><a href="#cb12-131" aria-hidden="true" tabindex="-1"></a>        metrics<span class="op">=</span>[<span class="st">"accuracy"</span>],</span>
<span id="cb12-132"><a href="#cb12-132" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb12-133"><a href="#cb12-133" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> model</span>
<span id="cb12-134"><a href="#cb12-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-135"><a href="#cb12-135" aria-hidden="true" tabindex="-1"></a>improved_cnn <span class="op">=</span> build_improved_cnn(wd<span class="op">=</span><span class="fl">1e-4</span>, width_mult<span class="op">=</span>WIDTH_MULT)</span>
<span id="cb12-136"><a href="#cb12-136" aria-hidden="true" tabindex="-1"></a>improved_cnn.summary()</span>
<span id="cb12-137"><a href="#cb12-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-138"><a href="#cb12-138" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================</span></span>
<span id="cb12-139"><a href="#cb12-139" aria-hidden="true" tabindex="-1"></a><span class="co"># 5) ì½œë°± (ì¡°ê¸° ì¢…ë£Œ + LR ê°ì†Œ)</span></span>
<span id="cb12-140"><a href="#cb12-140" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================</span></span>
<span id="cb12-141"><a href="#cb12-141" aria-hidden="true" tabindex="-1"></a>cb_improved <span class="op">=</span> [</span>
<span id="cb12-142"><a href="#cb12-142" aria-hidden="true" tabindex="-1"></a>    keras.callbacks.ReduceLROnPlateau(</span>
<span id="cb12-143"><a href="#cb12-143" aria-hidden="true" tabindex="-1"></a>        monitor<span class="op">=</span><span class="st">"val_accuracy"</span>, mode<span class="op">=</span><span class="st">"max"</span>,</span>
<span id="cb12-144"><a href="#cb12-144" aria-hidden="true" tabindex="-1"></a>        factor<span class="op">=</span><span class="fl">0.5</span>, patience<span class="op">=</span><span class="dv">2</span>, min_lr<span class="op">=</span><span class="fl">1e-5</span>, verbose<span class="op">=</span><span class="dv">1</span></span>
<span id="cb12-145"><a href="#cb12-145" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb12-146"><a href="#cb12-146" aria-hidden="true" tabindex="-1"></a>    keras.callbacks.EarlyStopping(</span>
<span id="cb12-147"><a href="#cb12-147" aria-hidden="true" tabindex="-1"></a>        monitor<span class="op">=</span><span class="st">"val_accuracy"</span>, mode<span class="op">=</span><span class="st">"max"</span>,</span>
<span id="cb12-148"><a href="#cb12-148" aria-hidden="true" tabindex="-1"></a>        patience<span class="op">=</span>PATIENCE, restore_best_weights<span class="op">=</span><span class="va">True</span></span>
<span id="cb12-149"><a href="#cb12-149" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb12-150"><a href="#cb12-150" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb12-151"><a href="#cb12-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-152"><a href="#cb12-152" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================</span></span>
<span id="cb12-153"><a href="#cb12-153" aria-hidden="true" tabindex="-1"></a><span class="co"># 6) í•™ìŠµ (ì‹œê°„ ìƒí•œ ì˜µì…˜ í¬í•¨)</span></span>
<span id="cb12-154"><a href="#cb12-154" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================</span></span>
<span id="cb12-155"><a href="#cb12-155" aria-hidden="true" tabindex="-1"></a>fit_kwargs <span class="op">=</span> <span class="bu">dict</span>(</span>
<span id="cb12-156"><a href="#cb12-156" aria-hidden="true" tabindex="-1"></a>    validation_data<span class="op">=</span>val_ds,</span>
<span id="cb12-157"><a href="#cb12-157" aria-hidden="true" tabindex="-1"></a>    epochs<span class="op">=</span>EPOCHS,</span>
<span id="cb12-158"><a href="#cb12-158" aria-hidden="true" tabindex="-1"></a>    callbacks<span class="op">=</span>cb_improved,</span>
<span id="cb12-159"><a href="#cb12-159" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb12-160"><a href="#cb12-160" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-161"><a href="#cb12-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-162"><a href="#cb12-162" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> STEPS_PER_EPOCH <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb12-163"><a href="#cb12-163" aria-hidden="true" tabindex="-1"></a>    fit_kwargs[<span class="st">"steps_per_epoch"</span>] <span class="op">=</span> STEPS_PER_EPOCH</span>
<span id="cb12-164"><a href="#cb12-164" aria-hidden="true" tabindex="-1"></a>    fit_kwargs[<span class="st">"validation_steps"</span>] <span class="op">=</span> VAL_STEPS</span>
<span id="cb12-165"><a href="#cb12-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-166"><a href="#cb12-166" aria-hidden="true" tabindex="-1"></a>hist_improved <span class="op">=</span> improved_cnn.fit(train_ds, <span class="op">**</span>fit_kwargs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>GPU ì—†ì´ CPU(float32) í™˜ê²½ì—ì„œ CIFAR-10 í•™ìŠµ/ê²€ì¦ ë°ì´í„°ë¥¼ ì…ë ¥ìœ¼ë¡œ, ë°ì´í„° ì¦ê°•(RandomFlip/Rotation/Zoom)ê³¼ BN+L2 ì •ê·œí™”+GAP(Global Average Pooling)ì„ í¬í•¨í•œ ê²½ëŸ‰ CNN(improved_cnn_bn_l2_gap_fast, ì•½ 6.37ë§Œ íŒŒë¼ë¯¸í„°)ì„ êµ¬ì„±í•´ 20 epoch ë™ì•ˆ í•™ìŠµí•˜ì˜€ë‹¤. ì´ˆê¸° í•™ìŠµë¥  1e-3ì—ì„œ ì‹œì‘í•´ ReduceLROnPlateauê°€ ê²€ì¦ ì •í™•ë„ ì •ì²´ ì‹œì (ì˜ˆ: 5, 9, 14, 17 epoch)ì— í•™ìŠµë¥ ì„ 1/2ë¡œ ë‹¨ê³„ì ìœ¼ë¡œ ê°ì†Œì‹œì¼°ê³ , ê·¸ ê²°ê³¼ ì†ì‹¤ì€ ê°ì†Œí•˜ë©´ì„œ ì •í™•ë„ëŠ” 1 epoch ì•½ 0.24 ìˆ˜ì¤€ì—ì„œ ì ì§„ì ìœ¼ë¡œ ìƒìŠ¹í•´ í›„ë°˜ë¶€ì— í•™ìŠµ ì •í™•ë„ ì•½ 0.52, ê²€ì¦ ì •í™•ë„ ì•½ 0.48~0.49 ìˆ˜ì¤€ì— ë„ë‹¬í•˜ì˜€ë‹¤.</p>
<p>ë¡œê·¸ì— ë‚˜íƒ€ë‚œ â€œinput ran out of dataâ€ ê²½ê³ ëŠ” steps_per_epochë¥¼ ê³ ì •(200 step)í•´ ë‘ì—ˆëŠ”ë° ë°ì´í„°ì…‹ì´ .repeat() ì—†ì´ êµ¬ì„±ë˜ì–´ ì¼ë¶€ epochì—ì„œ ì„¤ì •í•œ stepì„ ì±„ìš°ì§€ ëª»í•´ ì¡°ê¸° ì¢…ë£Œëœ ë°°ì¹˜ê°€ ìˆì—ˆìŒì„ ì˜ë¯¸í•˜ë©°, í•„ìš”í•˜ë©´ train_ds = train_ds.repeat() ë˜ëŠ” steps_per_epoch=Noneë¡œ ì¡°ì •í•´ ê²½ê³  ì—†ì´ ì•ˆì •ì ìœ¼ë¡œ í•™ìŠµì„ ì§„í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<pre class="text"><code>Epoch 1/20
200/200 â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 108s 512ms/step - accuracy: 0.2362 - loss: 2.2105 - val_accuracy: 0.1793 - val_loss: 2.5417 - learning_rate: 0.0010
Epoch 2/20
200/200 â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 101s 506ms/step - accuracy: 0.3467 - loss: 1.8224 - val_accuracy: 0.3290 - val_loss: 1.8517 - learning_rate: 0.0010
(ì¤‘ê°„ ìƒëµ)
Epoch 20/20
200/200 â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 101s 506ms/step - accuracy: 0.5186 - loss: 1.3772 - val_accuracy: 0.4840 - val_loss: 1.5281 - learning_rate: 6.2500e-05</code></pre>
<p><strong>ëª¨ë¸í‰ê°€</strong></p>
<div class="sourceCode" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> confusion_matrix, classification_report</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) Test accuracy</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>loss, acc <span class="op">=</span> improved_cnn.evaluate(x_test, y_test, verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"[Improved CNN] Test accuracy: </span><span class="sc">{</span>acc<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) Prediction</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>y_prob <span class="op">=</span> improved_cnn.predict(x_test, batch_size<span class="op">=</span><span class="dv">256</span>, verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> np.argmax(y_prob, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) Confusion Matrix (DataFrame)</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>cm <span class="op">=</span> confusion_matrix(y_test, y_pred)</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>cm_df <span class="op">=</span> pd.DataFrame(</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>    cm,</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span>[<span class="ss">f"True_</span><span class="sc">{</span>c<span class="sc">}</span><span class="ss">"</span> <span class="cf">for</span> c <span class="kw">in</span> class_names],</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>    columns<span class="op">=</span>[<span class="ss">f"Pred_</span><span class="sc">{</span>c<span class="sc">}</span><span class="ss">"</span> <span class="cf">for</span> c <span class="kw">in</span> class_names],</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">[Improved CNN] Confusion Matrix"</span>)</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>display(cm_df)</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a><span class="co"># 4) Classification Report</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">[Improved CNN] Classification Report"</span>)</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>    y_test, y_pred,</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>    target_names<span class="op">=</span>class_names,</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>    digits<span class="op">=</span><span class="dv">4</span>,</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>    zero_division<span class="op">=</span><span class="dv">0</span></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre class="text"><code>[Improved CNN] Test accuracy: 0.4845
[Improved CNN] Confusion Matrix
Pred_airplane   Pred_automobile Pred_bird   Pred_cat    Pred_deer   Pred_dog    Pred_frog   Pred_horse  Pred_ship   Pred_truck
True_airplane   416 41  12  1   44  0   45  21  353 67
True_automobile 20  624 0   0   2   1   50  7   48  248
True_bird   63  11  106 10  227 16  432 43  70  22
True_cat    7   19  12  76  80  55  596 66  46  43
True_deer   16  5   5   2   381 3   455 93  32  8
True_dog    4   14  11  84  144 182 364 130 41  26
True_frog   2   6   2   5   17  0   943 2   11  12
True_horse  12  6   4   15  143 22  130 591 19  58
True_ship   33  31  2   2   11  0   39  2   819 61
True_truck  21  123 1   0   7   0   64  12  65  707

[Improved CNN] Classification Report
              precision    recall  f1-score   support

    airplane     0.7003    0.4160    0.5220      1000
  automobile     0.7091    0.6240    0.6638      1000
        bird     0.6839    0.1060    0.1835      1000
         cat     0.3897    0.0760    0.1272      1000
        deer     0.3608    0.3810    0.3706      1000
         dog     0.6523    0.1820    0.2846      1000
        frog     0.3024    0.9430    0.4580      1000
       horse     0.6112    0.5910    0.6009      1000
        ship     0.5445    0.8190    0.6542      1000
       truck     0.5647    0.7070    0.6279      1000

    accuracy                         0.4845     10000
   macro avg     0.5519    0.4845    0.4493     10000
weighted avg     0.5519    0.4845    0.4493     10000</code></pre>
</section>
<section id="í•™ìŠµ-ê²°ê³¼-ë¹„êµ" class="level5">
<h5 class="anchored" data-anchor-id="í•™ìŠµ-ê²°ê³¼-ë¹„êµ">(5) í•™ìŠµ ê²°ê³¼ ë¹„êµ</h5>
<div class="sourceCode" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> confusion_matrix, classification_report</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) Test accuracy</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>loss, acc <span class="op">=</span> improved_cnn.evaluate(x_test, y_test, verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"[Improved CNN] Test accuracy: </span><span class="sc">{</span>acc<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) Prediction</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>y_prob <span class="op">=</span> improved_cnn.predict(x_test, batch_size<span class="op">=</span><span class="dv">256</span>, verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> np.argmax(y_prob, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) Confusion Matrix (DataFrame)</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>cm <span class="op">=</span> confusion_matrix(y_test, y_pred)</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>cm_df <span class="op">=</span> pd.DataFrame(</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    cm,</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span>[<span class="ss">f"True_</span><span class="sc">{</span>c<span class="sc">}</span><span class="ss">"</span> <span class="cf">for</span> c <span class="kw">in</span> class_names],</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    columns<span class="op">=</span>[<span class="ss">f"Pred_</span><span class="sc">{</span>c<span class="sc">}</span><span class="ss">"</span> <span class="cf">for</span> c <span class="kw">in</span> class_names],</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">[Improved CNN] Confusion Matrix"</span>)</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>display(cm_df)</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a><span class="co"># 4) Classification Report</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">[Improved CNN] Classification Report"</span>)</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>    y_test, y_pred,</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>    target_names<span class="op">=</span>class_names,</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>    digits<span class="op">=</span><span class="dv">4</span>,</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>    zero_division<span class="op">=</span><span class="dv">0</span></span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>ë¹„êµí‘œ ê²°ê³¼ë§Œ ë†“ê³  ë³´ë©´, Baseline CNNì´ Improved CNN(BN+L2+GAP)ë³´ë‹¤ í…ŒìŠ¤íŠ¸ ì„±ëŠ¥ì´ í›¨ì”¬ ì•ˆì •ì ì´ê³  ìš°ìˆ˜í•©ë‹ˆë‹¤. Baseline CNNì€ í…ŒìŠ¤íŠ¸ ì •í™•ë„(test_acc)ê°€ 0.7531ë¡œ 10ê°œ í´ë˜ìŠ¤ ë¶„ë¥˜ì—ì„œ ì•½ 75% ìˆ˜ì¤€ì˜ ì˜ˆì¸¡ ì„±ê³µë¥ ì„ ë³´ì˜€ê³ , macro F1ê³¼ weighted F1ë„ 0.7531ë¡œ ë™ì¼í•˜ê²Œ ë‚˜íƒ€ë‚¬ë‹¤. CIFAR-10ì²˜ëŸ¼ ê° í´ë˜ìŠ¤ê°€ ê±°ì˜ ë™ì¼í•œ ë¹„ì¤‘(í´ë˜ìŠ¤ ê· í˜•)ì¸ ë°ì´í„°ì—ì„œëŠ” macro/weighted F1ì´ ì„œë¡œ ë¹„ìŠ·í•˜ê²Œ ë‚˜ì˜¤ëŠ” ê²ƒì´ ìì—°ìŠ¤ëŸ¬ìš´ë°, ì´ ê°’ì´ accuracyì™€ë„ ë¹„ìŠ·í•˜ë‹¤ëŠ” ì ì€ Baseline ëª¨ë¸ì´ íŠ¹ì • í´ë˜ìŠ¤ì—ë§Œ í¸í–¥ë˜ì§€ ì•Šê³  ì „ë°˜ì ìœ¼ë¡œ ë¹„êµì  ê³ ë¥´ê²Œ ë¶„ë¥˜í•˜ê³  ìˆìŒì„ ì‹œì‚¬í•œë‹¤.</p>
<p>ë°˜ëŒ€ë¡œ Improved CNNì€ í…ŒìŠ¤íŠ¸ ì •í™•ë„ê°€ 0.4845ë¡œ í¬ê²Œ ë‚®ì•„ì¡Œê³ , macro F1(0.4493)ê³¼ weighted F1(0.4493)ë„ í•¨ê»˜ í•˜ë½í•˜ì˜€ë‹¤. ì´ëŠ” ë‹¨ìˆœíˆ â€œë§ì¶˜ ë¹„ìœ¨ì´ ì¤„ì—ˆë‹¤â€ë¥¼ ë„˜ì–´, í´ë˜ìŠ¤ë³„ë¡œ ì •ë°€ë„Â·ì¬í˜„ìœ¨ì˜ ê· í˜•ê¹Œì§€ ë‚˜ë¹ ì ¸ì„œ í´ë˜ìŠ¤ ì „ë°˜ì—ì„œ ì˜ˆì¸¡ í’ˆì§ˆì´ ë–¨ì–´ì¡ŒìŒì„ ì˜ë¯¸í•œë‹¤. íŠ¹íˆ ê· í˜• ë°ì´í„°ì—ì„œ weighted F1ê³¼ macro F1ì´ ë™ì¼í•˜ê²Œ ë‚®ê²Œ ë‚˜ì˜¨ ì ì€ â€œì¼ë¶€ í´ë˜ìŠ¤ë§Œ ìœ ë… ë‚˜ìœ ê²Œ ì•„ë‹ˆë¼, ì „ì²´ì ìœ¼ë¡œ ë¶„ë¥˜ ì„±ëŠ¥ì´ ì•½í™”ëœ ìƒíƒœâ€ì— ê°€ê¹ë‹¤ëŠ” í•´ì„ì´ ê°€ëŠ¥í•˜ë‹¤.</p>
<p>ë”°ë¼ì„œ ì´ ë¹„êµí‘œì˜ ê²°ë¡ ì€ ëª…í™•íˆ â€™ê°œì„  ëª¨ë¸â€™ì´ í˜„ì¬ ì„¤ì •ì—ì„œëŠ” ê°œì„ ì´ ì•„ë‹ˆë¼ ì„±ëŠ¥ ì €í•˜ë¥¼ ê°€ì ¸ì™”ë‹¤ëŠ” ê²ƒì´ë‹¤. ì¦‰, BN/L2/GAP ìì²´ê°€ ë‚˜ì˜ë‹¤ê¸°ë³´ë‹¤ëŠ”, í˜„ì¬ êµ¬ì„±(ì˜ˆ: ëª¨ë¸ í­ ì¶•ì†Œ, ê·œì œ ê°•ë„, ì¦ê°• ê°•ë„, í•™ìŠµ ìŠ¤í… ì œí•œ ë“±)ì—ì„œ ëª¨ë¸ì´ ì¶©ë¶„íˆ í•™ìŠµí•˜ì§€ ëª»í•´ ê³¼ì†Œì í•©(underfitting) ë˜ëŠ” í•™ìŠµ ì¡°ê±´ ë¶ˆë¦¬ê°€ ë°œìƒí–ˆì„ ê°€ëŠ¥ì„±ì´ í¬ë©°, ì‹¤ë¬´ì ìœ¼ë¡œëŠ” í˜„ ì‹œì ì—ì„œ Baseline CNNì„ ì±„íƒí•˜ëŠ” ê²ƒì´ ë” í•©ë¦¬ì ì´ë¼ê³  ì •ë¦¬í•  ìˆ˜ ìˆë‹¤.</p>
<pre class="text"><code>[Improved CNN] Test accuracy: 0.4845
[Improved CNN] Confusion Matrix
Pred_airplane   Pred_automobile Pred_bird   Pred_cat    Pred_deer   Pred_dog    Pred_frog   Pred_horse  Pred_ship   Pred_truck
True_airplane   416 41  12  1   44  0   45  21  353 67
True_automobile 20  624 0   0   2   1   50  7   48  248
True_bird   63  11  106 10  227 16  432 43  70  22
True_cat    7   19  12  76  80  55  596 66  46  43
True_deer   16  5   5   2   381 3   455 93  32  8
True_dog    4   14  11  84  144 182 364 130 41  26
True_frog   2   6   2   5   17  0   943 2   11  12
True_horse  12  6   4   15  143 22  130 591 19  58
True_ship   33  31  2   2   11  0   39  2   819 61
True_truck  21  123 1   0   7   0   64  12  65  707

[Improved CNN] Classification Report
              precision    recall  f1-score   support

    airplane     0.7003    0.4160    0.5220      1000
  automobile     0.7091    0.6240    0.6638      1000
        bird     0.6839    0.1060    0.1835      1000
         cat     0.3897    0.0760    0.1272      1000
        deer     0.3608    0.3810    0.3706      1000
         dog     0.6523    0.1820    0.2846      1000
        frog     0.3024    0.9430    0.4580      1000
       horse     0.6112    0.5910    0.6009      1000
        ship     0.5445    0.8190    0.6542      1000
       truck     0.5647    0.7070    0.6279      1000

    accuracy                         0.4845     10000
   macro avg     0.5519    0.4845    0.4493     10000
weighted avg     0.5519    0.4845    0.4493     10000</code></pre>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "î§‹";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>