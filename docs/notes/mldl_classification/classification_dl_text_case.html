<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>MLDL ë”¥ëŸ¬ë‹ ë¶„ë¥˜ - ì‚¬ë¡€ë¶„ì„ í…ìŠ¤íŠ¸ ë¶„ë¥˜ â€“ ì„¸ìƒì˜ ëª¨ë“  í†µê³„ ì´ì•¼ê¸°</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-44962e3d41ec9ccc254fd50f1af5efbe.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-sidebar docked nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">ì„¸ìƒì˜ ëª¨ë“  í†µê³„ ì´ì•¼ê¸°</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../notes/math_stat/index.html"> 
<span class="menu-text">ê¸°ì´ˆìˆ˜í•™Â·ìˆ˜ë¦¬í†µê³„</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../notes/intro_stat/index.html"> 
<span class="menu-text">ê¸°ì´ˆí†µê³„Â·ì¡°ì‚¬ë°©ë²•</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../notes/linear_model/index.html"> 
<span class="menu-text">íšŒê·€Â·ë‹¤ë³€ëŸ‰</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../notes/mldl_intro/index.html"> 
<span class="menu-text">MLDLê°œë…</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../notes/mldl_prediction/index.html"> 
<span class="menu-text">MLDLì˜ˆì¸¡</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../../notes/mldl_classification/index.html" aria-current="page"> 
<span class="menu-text">MLDLë¶„ë¥˜</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../cardnews/index.html"> 
<span class="menu-text">ì¹´ë“œë‰´ìŠ¤</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../consult.html"> 
<span class="menu-text">í†µê³„ìƒë‹´</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../notes/mldl_classification/classification_dl_text_case.html">ğŸ“„ ë”¥ëŸ¬ë‹ ë¶„ë¥˜ (í…ìŠ¤íŠ¸)ì‚¬ë¡€</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notes/mldl_classification/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ã€ë¨¸ì‹ Â·ë”¥ëŸ¬ë‹ ë¶„ë¥˜ë¬¸ì œã€‘</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notes/mldl_classification/classification_intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ğŸ“„ ë¶„ë¥˜ë¬¸ì œ: ì •ì˜</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notes/mldl_classification/lm_logistic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ğŸ“„ ì˜ˆì¸¡ë¶„ë¥˜-ë¡œì§€ìŠ¤í‹±íšŒê·€</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notes/mldl_classification/mda_discriminant.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ğŸ“„ ì˜ˆì¸¡ë¶„ë¥˜-íŒë³„ë¶„ì„</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notes/mldl_classification/prediction_treebase.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ğŸ“„ ì˜ˆì¸¡ë¶„ë¥˜-ML íŠ¸ë¦¬ê¸°ë°˜</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notes/mldl_classification/classification_ml_methods.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ğŸ“„ ë¨¸ì‹ ëŸ¬ë‹ kNNSVM ì´ë¡ </span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notes/mldl_classification/classification_evaluation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ğŸ“„ ë¶„ë¥˜ëª¨ë¸ í‰ê°€</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notes/mldl_classification/classification_ml_case_binary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ğŸ“„ ë¨¸ì‹ ëŸ¬ë‹ ì´ì§„í˜• ì‚¬ë¡€</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notes/mldl_classification/classification_ml_case_category.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ğŸ“„ ë¨¸ì‹ ëŸ¬ë‹ k&gt;=3 ì‚¬ë¡€</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notes/mldl_classification/classification_deeplearning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ğŸ“„ ë”¥ëŸ¬ë‹ ë¶„ë¥˜ ì´ë¡ </span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notes/mldl_classification/classification_dl_rare_case.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ğŸ“„ ë”¥ëŸ¬ë‹ ë¶„ë¥˜ (í¬ì†Œì„±ê³µ)ì‚¬ë¡€</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notes/mldl_classification/classification_dl_image_case.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ğŸ“„ ë”¥ëŸ¬ë‹ ë¶„ë¥˜ (ì´ë¯¸ì§€)ì‚¬ë¡€</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notes/mldl_classification/classification_dl_text_case.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">ğŸ“„ ë”¥ëŸ¬ë‹ ë¶„ë¥˜ (í…ìŠ¤íŠ¸)ì‚¬ë¡€</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">ëª©ì°¨</h2>
   
  <ul>
  <li><a href="#ë”¥ëŸ¬ë‹-ë¶„ë¥˜-ì‚¬ë¡€ë¶„ì„-í…ìŠ¤íŠ¸-ë¶„ë¥˜-sentiment-analysis" id="toc-ë”¥ëŸ¬ë‹-ë¶„ë¥˜-ì‚¬ë¡€ë¶„ì„-í…ìŠ¤íŠ¸-ë¶„ë¥˜-sentiment-analysis" class="nav-link active" data-scroll-target="#ë”¥ëŸ¬ë‹-ë¶„ë¥˜-ì‚¬ë¡€ë¶„ì„-í…ìŠ¤íŠ¸-ë¶„ë¥˜-sentiment-analysis">ë”¥ëŸ¬ë‹ ë¶„ë¥˜ ì‚¬ë¡€ë¶„ì„ (í…ìŠ¤íŠ¸ ë¶„ë¥˜ Sentiment Analysis)</a>
  <ul>
  <li><a href="#ë°ì´í„°" id="toc-ë°ì´í„°" class="nav-link" data-scroll-target="#ë°ì´í„°">1. ë°ì´í„°</a></li>
  <li><a href="#ë”¥ëŸ¬ë‹-ë¶„ë¥˜" id="toc-ë”¥ëŸ¬ë‹-ë¶„ë¥˜" class="nav-link" data-scroll-target="#ë”¥ëŸ¬ë‹-ë¶„ë¥˜">2. ë”¥ëŸ¬ë‹ ë¶„ë¥˜</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">MLDL ë”¥ëŸ¬ë‹ ë¶„ë¥˜ - ì‚¬ë¡€ë¶„ì„ í…ìŠ¤íŠ¸ ë¶„ë¥˜</h1>
</div>



<div class="quarto-title-meta column-body">

    
  
    
  </div>
  


</header>


<section id="ë”¥ëŸ¬ë‹-ë¶„ë¥˜-ì‚¬ë¡€ë¶„ì„-í…ìŠ¤íŠ¸-ë¶„ë¥˜-sentiment-analysis" class="level3">
<h3 class="anchored" data-anchor-id="ë”¥ëŸ¬ë‹-ë¶„ë¥˜-ì‚¬ë¡€ë¶„ì„-í…ìŠ¤íŠ¸-ë¶„ë¥˜-sentiment-analysis">ë”¥ëŸ¬ë‹ ë¶„ë¥˜ ì‚¬ë¡€ë¶„ì„ (í…ìŠ¤íŠ¸ ë¶„ë¥˜ Sentiment Analysis)</h3>
<section id="ë°ì´í„°" class="level4">
<h4 class="anchored" data-anchor-id="ë°ì´í„°">1. ë°ì´í„°</h4>
<p>IMDB ë°ì´í„°ì…‹ì€ ë”¥ëŸ¬ë‹ ê¸°ë°˜ í…ìŠ¤íŠ¸ ë¶„ë¥˜(ê°ì„±ë¶„ì„) ëª¨ë¸ì˜ ì„±ëŠ¥ì„ ë¹„êµÂ·í‰ê°€í•˜ê¸° ìœ„í•œ ëŒ€í‘œì  ë²¤ì¹˜ë§ˆí¬ ë°ì´í„°ë¡œ, ì˜í™” ë¦¬ë·° í…ìŠ¤íŠ¸ê°€ ë‹´ê³  ìˆëŠ” ì „ë°˜ì  í‰ê°€ì˜ ê·¹ì„±(polarity)â€”ì¦‰ ê¸ì •(positive)ì¸ì§€ ë¶€ì •(negative)ì¸ì§€â€”ì„ ì˜ˆì¸¡í•˜ëŠ” ê²ƒì„ ë¶„ì„ëª©ì ìœ¼ë¡œ í•œë‹¤. ë³¸ ì‹¤ìŠµì—ì„œëŠ” ë¦¬ë·° í•œ í¸ì„ í•˜ë‚˜ì˜ â€œë¬¸ì„œ(document)â€ë¡œ ë³´ê³ , ë¬¸ì„œ ìˆ˜ì¤€ì—ì„œ ê°ì„±ì„ íŒë³„í•˜ëŠ” ì´ì§„ ë¶„ë¥˜(binary classification) ë¬¸ì œë¡œ ì„¤ì •í•œë‹¤.</p>
<p>ë°ì´í„°ëŠ” Kerasì—ì„œ ê¸°ë³¸ ì œê³µë˜ëŠ” IMDB ë¦¬ë·° ì½”í¼ìŠ¤ë¥¼ ì‚¬ìš©í•˜ë©°, í•™ìŠµìš© 25,000ê°œì™€ í…ŒìŠ¤íŠ¸ìš© 25,000ê°œë¡œ ì´ 50,000ê°œì˜ ë¦¬ë·°ë¡œ êµ¬ì„±ëœë‹¤. ë¼ë²¨ì€ 0(ë¶€ì •)ê³¼ 1(ê¸ì •) ë‘ ë²”ì£¼ë¡œ ì£¼ì–´ì§€ë©°, í•™ìŠµ ë°ì´í„°ì—ì„œ ê° í´ë˜ìŠ¤ê°€ 12,500ê°œì”©ìœ¼ë¡œ <strong>ì™„ì „ ê· í˜•(class-balanced)</strong>ì„ ì´ë£¨ì–´, ëª¨ë¸ ë¹„êµ ì‹œ íŠ¹ì • í´ë˜ìŠ¤ í¸í–¥ì— ì˜í•œ ì„±ëŠ¥ ì™œê³¡ì„ ìµœì†Œí™”í•˜ë„ë¡ ì„¤ê³„ë˜ì–´ ìˆë‹¤. ë³¸ ë…¸íŠ¸ì—ì„œëŠ” í•™ìŠµ ë°ì´í„°(25,000ê°œ) ì¤‘ 20%ë¥¼ ê²€ì¦ìš©ìœ¼ë¡œ ë¶„ë¦¬í•˜ì—¬ Train 20,000 / Valid 5,000 / Test 25,000 êµ¬ì¡°ë¡œ í•™ìŠµâ€“íŠœë‹â€“ìµœì¢…í‰ê°€ì˜ ì—­í• ì„ ëª…í™•íˆ ë¶„ë¦¬í•œë‹¤.</p>
<p>ì…ë ¥ ë°ì´í„°ëŠ” ì›ë¬¸ í…ìŠ¤íŠ¸ê°€ ì•„ë‹ˆë¼, ì‚¬ì „ì— êµ¬ì¶•ëœ ë‹¨ì–´ ì‚¬ì „(word index)ì— ë”°ë¼ ë‹¨ì–´ë¥¼ ì •ìˆ˜ ì¸ë±ìŠ¤ë¡œ ì¹˜í™˜í•œ ì •ìˆ˜ ì‹œí€€ìŠ¤ í˜•íƒœë¡œ ì œê³µëœë‹¤. ì´ëŠ” ëª¨ë¸ì´ ë‹¨ì–´ ì„ë² ë”©(Embedding)ì„ í†µí•´ ì˜ë¯¸ ê³µê°„ìœ¼ë¡œ ë§¤í•‘í•œ ë’¤, CNNÂ·RNNÂ·Transformer ë“± ë‹¤ì–‘í•œ ì‹ ê²½ë§ êµ¬ì¡°ê°€ ë¶„ë¥˜ì— í•„ìš”í•œ í‘œí˜„ì„ í•™ìŠµí•  ìˆ˜ ìˆë„ë¡ í•˜ê¸° ìœ„í•¨ì´ë‹¤. ë˜í•œ ë³¸ ë¶„ì„ì—ì„œëŠ” ìƒìœ„ ë¹ˆë„ ë‹¨ì–´ <strong>20,000ê°œ(vocab_size=20000)</strong>ë§Œ ì‚¬ìš©í•˜ì—¬ í¬ê·€ì–´ì— ë”°ë¥¸ ì¡ìŒì„ ì¤„ì´ê³ , ëª¨ë¸ í•™ìŠµì˜ ì•ˆì •ì„±ê³¼ ê³„ì‚° íš¨ìœ¨ì„ ë†’ì¸ë‹¤. ì°¸ê³ ë¡œ Kerasê°€ ì œê³µí•˜ëŠ” ì „ì²´ ë‹¨ì–´ ì‚¬ì „ í¬ê¸°ëŠ” 88,584ê°œì´ë©°, ë³¸ ì‹¤ìŠµì€ ê·¸ì¤‘ ë¹ˆë„ ìƒìœ„ ë¶€ë¶„ì§‘í•©ì„ ì‚¬ìš©í•œë‹¤.</p>
<p>ë¬¸ì„œ ê¸¸ì´ëŠ” ë¦¬ë·°ë§ˆë‹¤ ìƒì´í•˜ë¯€ë¡œ, ë°°ì¹˜ í•™ìŠµì´ ê°€ëŠ¥í•˜ë„ë¡ ëª¨ë“  ì‹œí€€ìŠ¤ë¥¼ ë™ì¼ ê¸¸ì´ë¡œ ë§ì¶”ëŠ” ì „ì²˜ë¦¬ê°€ í•„ìš”í•˜ë‹¤. ë³¸ ë…¸íŠ¸ëŠ” ìµœëŒ€ ê¸¸ì´ <strong>300(maxlen=300)</strong>ìœ¼ë¡œ ì„¤ì •í•˜ì—¬, ê¸¸ì´ê°€ ì§§ì€ ë¦¬ë·°ëŠ” ë’¤ìª½(post)ìœ¼ë¡œ íŒ¨ë”©ì„ ì¶”ê°€í•˜ê³ , ê¸´ ë¦¬ë·°ëŠ” ë’¤ìª½(post)ì—ì„œ ì ˆë‹¨(truncation)í•œë‹¤. ê²°ê³¼ì ìœ¼ë¡œ ì…ë ¥ í…ì„œëŠ” í•™ìŠµÂ·ê²€ì¦Â·í…ŒìŠ¤íŠ¸ ëª¨ë‘ ê°ê° (ìƒ˜í”Œ ìˆ˜, 300) í˜•íƒœì˜ 2ì°¨ì› ë°°ì—´ì´ ë˜ë©°, ì´ëŠ” â€œê³ ì • ê¸¸ì´ ë¬¸ì„œ í‘œí˜„â€ ìœ„ì—ì„œ ì—¬ëŸ¬ ëª¨ë¸ êµ¬ì¡°ë¥¼ ê³µì •í•˜ê²Œ ë¹„êµí•˜ê¸° ìœ„í•œ í‘œì¤€í™” ë‹¨ê³„ì´ë‹¤.</p>
<p>ì •ë¦¬í•˜ë©´, ë³¸ ë°ì´í„°ëŠ” (1) ë¬¸ì„œ ìˆ˜ì¤€ ì´ì§„ ê°ì„± ë¶„ë¥˜ë¼ëŠ” ëª…í™•í•œ ì˜ˆì¸¡ ëª©í‘œë¥¼ ê°–ê³ , (2) í´ë˜ìŠ¤ ê· í˜•ì´ ë§ì¶°ì§„ ëŒ€ê·œëª¨ ë¦¬ë·° ì½”í¼ìŠ¤ë¡œ êµ¬ì„±ë˜ë©°, (3) ì •ìˆ˜ í† í° ì‹œí€€ìŠ¤ì™€ ê³ ì • ê¸¸ì´ íŒ¨ë”©ì„ í†µí•´ CNN/BiLSTM/Transformer ë“± ì„œë¡œ ë‹¤ë¥¸ ë”¥ëŸ¬ë‹ í…ìŠ¤íŠ¸ ë¶„ë¥˜ ëª¨ë¸ì˜ í‘œí˜„ í•™ìŠµ ëŠ¥ë ¥ê³¼ ì¼ë°˜í™” ì„±ëŠ¥ì„ ë¹„êµí•˜ëŠ” ë° ìµœì í™”ëœ ë©”íƒ€ êµ¬ì¡°ë¥¼ ê°€ì§„ë‹¤. ì´ë¥¼ í†µí•´ â€œë‹¨ì–´ ìˆœì„œ ì •ë³´ í™œìš© ì—¬ë¶€(CNN/RNN/Transformer), íŠ¹ì§• ì¶”ì¶œ ë°©ì‹(Global pooling vs attention), ëª¨ë¸ ë³µì¡ë„â€ê°€ ê°ì„± ë¶„ë¥˜ ì„±ëŠ¥(Accuracy, AUC ë“±)ì— ì–´ë–¤ ì°¨ì´ë¥¼ ë§Œë“œëŠ”ì§€ ì‹¤ì¦ì ìœ¼ë¡œ í‰ê°€í•˜ëŠ” ê²ƒì´ ë³¸ ë¶„ì„ì˜ í•µì‹¬ ëª©ì ì´ë‹¤.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================================================</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 0. Library &amp; Seed ì„¤ì •</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================================================</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tensorflow <span class="im">as</span> tf</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.datasets <span class="im">import</span> imdb</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.preprocessing.sequence <span class="im">import</span> pad_sequences</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow <span class="im">import</span> keras</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras <span class="im">import</span> layers</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>SEED <span class="op">=</span> <span class="dv">42</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>np.random.seed(SEED)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>tf.random.set_seed(SEED)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================================================</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. ë°ì´í„° ë¡œë“œ (IMDB)</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================================================</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>vocab_size <span class="op">=</span> <span class="dv">20000</span>   <span class="co"># ìƒìœ„ ë¹ˆë„ ë‹¨ì–´ë§Œ ì‚¬ìš©</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>maxlen <span class="op">=</span> <span class="dv">300</span>         <span class="co"># ë¬¸ì¥ ìµœëŒ€ ê¸¸ì´</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>(x_train, y_train), (x_test, y_test) <span class="op">=</span> imdb.load_data(</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>    num_words<span class="op">=</span>vocab_size</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================================================</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Padding / Truncation</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================================================</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>x_train <span class="op">=</span> pad_sequences(</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>    x_train,</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>    maxlen<span class="op">=</span>maxlen,</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>    padding<span class="op">=</span><span class="st">"post"</span>,</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>    truncating<span class="op">=</span><span class="st">"post"</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>x_test <span class="op">=</span> pad_sequences(</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>    x_test,</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>    maxlen<span class="op">=</span>maxlen,</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>    padding<span class="op">=</span><span class="st">"post"</span>,</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>    truncating<span class="op">=</span><span class="st">"post"</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================================================</span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Train / Validation ë¶„ë¦¬</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================================================</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>x_tr, x_val, y_tr, y_val <span class="op">=</span> train_test_split(</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>    x_train,</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>    y_train,</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>    test_size<span class="op">=</span><span class="fl">0.2</span>,</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>    random_state<span class="op">=</span>SEED,</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>    stratify<span class="op">=</span>y_train   <span class="co"># í´ë˜ìŠ¤ ë¹„ìœ¨ ìœ ì§€</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Train: </span><span class="sc">{</span>x_tr<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Valid: </span><span class="sc">{</span>x_val<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Test : </span><span class="sc">{</span>x_test<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre class="text"><code>Train: (20000, 300)
Valid: (5000, 300)
Test : (25000, 300)</code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ==========================================</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># IMDB ë°ì´í„° ìƒ˜í”Œ 5ê°œ ì¶œë ¥</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ==========================================</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ì •ìˆ˜ â†’ ë‹¨ì–´ ì‚¬ì „ ë¡œë“œ</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>word_index <span class="op">=</span> imdb.get_word_index()</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>reverse_word_index <span class="op">=</span> {v: k <span class="cf">for</span> k, v <span class="kw">in</span> word_index.items()}</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> decode_review(encoded_review):</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">" "</span>.join(</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>        reverse_word_index.get(i <span class="op">-</span> <span class="dv">3</span>, <span class="st">"?"</span>) <span class="cf">for</span> i <span class="kw">in</span> encoded_review <span class="cf">if</span> i <span class="op">&gt;</span> <span class="dv">3</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 3ê°œ ìƒ˜í”Œ ì¶œë ¥</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">===== Sample </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss"> ====="</span>)</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Label :"</span>, <span class="st">"Positive"</span> <span class="cf">if</span> y_train[i] <span class="op">==</span> <span class="dv">1</span> <span class="cf">else</span> <span class="st">"Negative"</span>)</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Review:"</span>, decode_review(x_train[i])[:<span class="dv">1000</span>])  <span class="co"># ë„ˆë¬´ ê¸¸ì–´ì„œ 1000ìê¹Œì§€ë§Œ</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre class="text"><code>===== Sample 1 =====
Label : Positive
Review: this film was just brilliant casting location scenery story direction everyone's really suited the part they played and you could just imagine being there robert is an amazing actor and now the same being director father came from the same scottish island as myself so i loved the fact there was a real connection with this film the witty remarks throughout the film were great it was just brilliant so much that i bought the film as soon as it was released for retail and would recommend it to everyone to watch and the fly fishing was amazing really cried at the end it was so sad and you know what they say if you cry at a film it must have been good and this definitely was also congratulations to the two little boy's that played the of norman and paul they were just brilliant children are often left out of the praising list i think because the stars that play them all grown up are such a big profile for the whole film but these children are amazing and should be praised for what they have 

===== Sample 2 =====
Label : Negative
Review: big hair big boobs bad music and a giant safety pin these are the words to best describe this terrible movie i love cheesy horror movies and i've seen hundreds but this had got to be on of the worst ever made the plot is paper thin and ridiculous the acting is an abomination the script is completely laughable the best is the end showdown with the cop and how he worked out who the killer is it's just so damn terribly written the clothes are sickening and funny in equal measures the hair is big lots of boobs bounce men wear those cut tee shirts that show off their sickening that men actually wore them and the music is just trash that plays over and over again in almost every scene there is trashy music boobs and taking away bodies and the gym still doesn't close for all joking aside this is a truly bad film whose only charm is to look back on the disaster that was the 80's and have a good old laugh at how bad everything was back then

===== Sample 3 =====
Label : Negative
Review: this has to be one of the worst films of the 1990s when my friends i were watching this film being the target audience it was aimed at we just sat watched the first half an hour with our jaws touching the floor at how bad it really was the rest of the time everyone else in the theatre just started talking to each other leaving or generally crying into their popcorn that they actually paid money they had working to watch this feeble excuse for a film it must have looked like a great idea on paper but on film it looks like no one in the film has a clue what is going on crap acting crap costumes i can't get across how this is to watch save yourself an hour a bit of your life</code></pre>
<section id="ì´ˆê¸°í™”-ì½œë°±-í‰ê°€ì‹œê°í™”ì˜¤ë¶„ë¥˜-í•¨ìˆ˜" class="level5">
<h5 class="anchored" data-anchor-id="ì´ˆê¸°í™”-ì½œë°±-í‰ê°€ì‹œê°í™”ì˜¤ë¶„ë¥˜-í•¨ìˆ˜">ì´ˆê¸°í™” + ì½œë°± + í‰ê°€/ì‹œê°í™”/ì˜¤ë¶„ë¥˜ í•¨ìˆ˜</h5>
<div class="sourceCode" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os, random</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tensorflow <span class="im">as</span> tf</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow <span class="im">import</span> keras</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras <span class="im">import</span> layers</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score, roc_auc_score, confusion_matrix, classification_report</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co"># --- ì•ˆì •í™”: ì¬í˜„ì„± &amp; ì„¸ì…˜ ì •ë¦¬ ---</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>SEED <span class="op">=</span> <span class="dv">42</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>os.environ[<span class="st">"PYTHONHASHSEED"</span>] <span class="op">=</span> <span class="bu">str</span>(SEED)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>random.seed(SEED)</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>np.random.seed(SEED)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>tf.random.set_seed(SEED)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>keras.backend.clear_session()</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="co"># (ì„ íƒ) GPU ì‚¬ìš© ì‹œ ë©”ëª¨ë¦¬ ì¦ê°€ í—ˆìš©</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>gpus <span class="op">=</span> tf.config.list_physical_devices(<span class="st">"GPU"</span>)</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> gpus:</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> gpu <span class="kw">in</span> gpus:</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>            tf.config.experimental.set_memory_growth(gpu, <span class="va">True</span>)</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"GPU memory growth setting skipped:"</span>, e)</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a><span class="co"># --- ê³µí†µ ì½œë°± ---</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>cb <span class="op">=</span> [</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>    keras.callbacks.EarlyStopping(monitor<span class="op">=</span><span class="st">"val_auc"</span>, mode<span class="op">=</span><span class="st">"max"</span>, patience<span class="op">=</span><span class="dv">2</span>, restore_best_weights<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>    keras.callbacks.ReduceLROnPlateau(monitor<span class="op">=</span><span class="st">"val_auc"</span>, mode<span class="op">=</span><span class="st">"max"</span>, factor<span class="op">=</span><span class="fl">0.5</span>, patience<span class="op">=</span><span class="dv">1</span>, min_lr<span class="op">=</span><span class="fl">1e-5</span>),</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a><span class="co"># --- ê³µí†µ í‰ê°€ í•¨ìˆ˜ ---</span></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> eval_binary_model(model, x, y, name):</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> model.predict(x, batch_size<span class="op">=</span><span class="dv">512</span>, verbose<span class="op">=</span><span class="dv">0</span>).ravel()</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>    yhat <span class="op">=</span> (p <span class="op">&gt;=</span> <span class="fl">0.5</span>).astype(<span class="bu">int</span>)</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>    acc <span class="op">=</span> accuracy_score(y, yhat)</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>    auc <span class="op">=</span> roc_auc_score(y, p)</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>    cm  <span class="op">=</span> confusion_matrix(y, yhat)</span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>        <span class="st">"model"</span>: name,</span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>        <span class="st">"test_acc"</span>: <span class="bu">float</span>(acc),</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>        <span class="st">"test_auc"</span>: <span class="bu">float</span>(auc),</span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>        <span class="st">"TN"</span>: <span class="bu">int</span>(cm[<span class="dv">0</span>,<span class="dv">0</span>]), <span class="st">"FP"</span>: <span class="bu">int</span>(cm[<span class="dv">0</span>,<span class="dv">1</span>]),</span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>        <span class="st">"FN"</span>: <span class="bu">int</span>(cm[<span class="dv">1</span>,<span class="dv">0</span>]), <span class="st">"TP"</span>: <span class="bu">int</span>(cm[<span class="dv">1</span>,<span class="dv">1</span>]),</span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a><span class="co"># --- í•™ìŠµê²°ê³¼ ì €ì¥ì†Œ (ì¤‘ìš”: ë”± í•œ ë²ˆë§Œ) ---</span></span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>histories <span class="op">=</span> {}</span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> []</span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>models <span class="op">=</span> {}</span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a><span class="co"># --- í•™ìŠµê³¡ì„  í”Œë¡¯ ---</span></span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_histories(histories, metric<span class="op">=</span><span class="st">"accuracy"</span>, title<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">5</span>))</span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> name, h <span class="kw">in</span> histories.items():</span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> metric <span class="kw">in</span> h.history:</span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a>            plt.plot(h.history[metric], label<span class="op">=</span><span class="ss">f"</span><span class="sc">{</span>name<span class="sc">}</span><span class="ss">-train"</span>)</span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a>        val_key <span class="op">=</span> <span class="ss">f"val_</span><span class="sc">{</span>metric<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> val_key <span class="kw">in</span> h.history:</span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a>            plt.plot(h.history[val_key], linestyle<span class="op">=</span><span class="st">"--"</span>, label<span class="op">=</span><span class="ss">f"</span><span class="sc">{</span>name<span class="sc">}</span><span class="ss">-val"</span>)</span>
<span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">"Epoch"</span>)</span>
<span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(metric)</span>
<span id="cb5-66"><a href="#cb5-66" aria-hidden="true" tabindex="-1"></a>    plt.title(title <span class="cf">if</span> title <span class="cf">else</span> <span class="ss">f"Training curves: </span><span class="sc">{</span>metric<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-67"><a href="#cb5-67" aria-hidden="true" tabindex="-1"></a>    plt.legend()</span>
<span id="cb5-68"><a href="#cb5-68" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb5-69"><a href="#cb5-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-70"><a href="#cb5-70" aria-hidden="true" tabindex="-1"></a><span class="co"># --- ì˜¤ë¶„ë¥˜ Top-k ---</span></span>
<span id="cb5-71"><a href="#cb5-71" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> decode_review_padded(encoded_review, reverse_word_index):</span>
<span id="cb5-72"><a href="#cb5-72" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">" "</span>.join(reverse_word_index.get(i <span class="op">-</span> <span class="dv">3</span>, <span class="st">"?"</span>) <span class="cf">for</span> i <span class="kw">in</span> encoded_review <span class="cf">if</span> i <span class="op">&gt;</span> <span class="dv">3</span>)</span>
<span id="cb5-73"><a href="#cb5-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-74"><a href="#cb5-74" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_misclassified_table(model, x, y, reverse_word_index, topk<span class="op">=</span><span class="dv">20</span>):</span>
<span id="cb5-75"><a href="#cb5-75" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> model.predict(x, batch_size<span class="op">=</span><span class="dv">512</span>, verbose<span class="op">=</span><span class="dv">0</span>).ravel()</span>
<span id="cb5-76"><a href="#cb5-76" aria-hidden="true" tabindex="-1"></a>    yhat <span class="op">=</span> (p <span class="op">&gt;=</span> <span class="fl">0.5</span>).astype(<span class="bu">int</span>)</span>
<span id="cb5-77"><a href="#cb5-77" aria-hidden="true" tabindex="-1"></a>    wrong <span class="op">=</span> (yhat <span class="op">!=</span> y)</span>
<span id="cb5-78"><a href="#cb5-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-79"><a href="#cb5-79" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb5-80"><a href="#cb5-80" aria-hidden="true" tabindex="-1"></a>        <span class="st">"idx"</span>: np.arange(<span class="bu">len</span>(y)),</span>
<span id="cb5-81"><a href="#cb5-81" aria-hidden="true" tabindex="-1"></a>        <span class="st">"y_true"</span>: y,</span>
<span id="cb5-82"><a href="#cb5-82" aria-hidden="true" tabindex="-1"></a>        <span class="st">"y_pred"</span>: yhat,</span>
<span id="cb5-83"><a href="#cb5-83" aria-hidden="true" tabindex="-1"></a>        <span class="st">"p_pos"</span>: p,</span>
<span id="cb5-84"><a href="#cb5-84" aria-hidden="true" tabindex="-1"></a>        <span class="st">"conf"</span>: np.<span class="bu">abs</span>(p <span class="op">-</span> <span class="fl">0.5</span>) <span class="op">*</span> <span class="dv">2</span>,     <span class="co"># 0~1 (1ì¼ìˆ˜ë¡ í™•ì‹ )</span></span>
<span id="cb5-85"><a href="#cb5-85" aria-hidden="true" tabindex="-1"></a>        <span class="st">"len"</span>: (x <span class="op">!=</span> <span class="dv">0</span>).<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb5-86"><a href="#cb5-86" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb5-87"><a href="#cb5-87" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df[wrong].copy().sort_values(<span class="st">"conf"</span>, ascending<span class="op">=</span><span class="va">False</span>).head(topk)</span>
<span id="cb5-88"><a href="#cb5-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-89"><a href="#cb5-89" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"text"</span>] <span class="op">=</span> [decode_review_padded(x[i], reverse_word_index) <span class="cf">for</span> i <span class="kw">in</span> df[<span class="st">"idx"</span>].values]</span>
<span id="cb5-90"><a href="#cb5-90" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"text"</span>] <span class="op">=</span> df[<span class="st">"text"</span>].<span class="bu">str</span>.<span class="bu">slice</span>(<span class="dv">0</span>, <span class="dv">500</span>)</span>
<span id="cb5-91"><a href="#cb5-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-92"><a href="#cb5-92" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df[[<span class="st">"idx"</span>,<span class="st">"y_true"</span>,<span class="st">"y_pred"</span>,<span class="st">"p_pos"</span>,<span class="st">"conf"</span>,<span class="st">"len"</span>,<span class="st">"text"</span>]].reset_index(drop<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="ë”¥ëŸ¬ë‹-ë¶„ë¥˜" class="level4">
<h4 class="anchored" data-anchor-id="ë”¥ëŸ¬ë‹-ë¶„ë¥˜">2. ë”¥ëŸ¬ë‹ ë¶„ë¥˜</h4>
<section id="avg-embedding-dense" class="level5">
<h5 class="anchored" data-anchor-id="avg-embedding-dense">(1) Avg Embedding + Dense</h5>
<p>ì´ ë°©ë²•ì€ ê° ë‹¨ì–´ë¥¼ ì„ë² ë”© ë²¡í„°ë¡œ ë³€í™˜í•œ ë’¤, ë¬¸ì¥ ì „ì²´ì— ëŒ€í•´ <strong>í‰ê· (GlobalAveragePooling)</strong>ì„ ì·¨í•´ í•˜ë‚˜ì˜ ê³ ì • ê¸¸ì´ ë²¡í„°ë¡œ ë§Œë“  í›„, ì´ë¥¼ ì™„ì „ì—°ê²°ì¸µ(Dense layer)ì— ì…ë ¥í•˜ì—¬ ë¶„ë¥˜í•˜ëŠ” êµ¬ì¡°ì´ë‹¤. ì¦‰, ë¬¸ì¥ì„ êµ¬ì„±í•˜ëŠ” ë‹¨ì–´ë“¤ì˜ â€œí‰ê·  ì˜ë¯¸ ë²¡í„°â€ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ê°ì„±ì„ íŒë³„í•œë‹¤.</p>
<p>ì´ ëª¨ë¸ì˜ ì¥ì ì€ êµ¬ì¡°ê°€ ë§¤ìš° ë‹¨ìˆœí•˜ì—¬ ê³„ì‚°ëŸ‰ì´ ì ê³  í•™ìŠµì´ ë¹ ë¥´ë©°, ê³¼ì í•© ìœ„í—˜ë„ ìƒëŒ€ì ìœ¼ë¡œ ë‚®ë‹¤ëŠ” ì ì´ë‹¤. íŠ¹íˆ ëŒ€ê·œëª¨ ë°ì´í„°ì—ì„œ ë² ì´ìŠ¤ë¼ì¸ ëª¨ë¸ë¡œ ì‚¬ìš©í•˜ê¸°ì— ì í•©í•˜ë‹¤. ë˜í•œ í•˜ì´í¼íŒŒë¼ë¯¸í„° íŠœë‹ì´ ë¹„êµì  ê°„ë‹¨í•˜ì—¬ ì•ˆì •ì ì¸ ì´ˆê¸° ì„±ëŠ¥ì„ í™•ë³´í•  ìˆ˜ ìˆë‹¤.</p>
<p>ë°˜ë©´, ê°€ì¥ í° í•œê³„ëŠ” ë‹¨ì–´ ìˆœì„œ ì •ë³´ë¥¼ ê±°ì˜ ë°˜ì˜í•˜ì§€ ëª»í•œë‹¤ëŠ” ì ì´ë‹¤. ì˜ˆë¥¼ ë“¤ì–´ â€œnot goodâ€ê³¼ â€œgoodâ€ì´ í‰ê·  ë²¡í„° ê´€ì ì—ì„œëŠ” í¬ê²Œ ë‹¤ë¥´ì§€ ì•Šê²Œ í‘œí˜„ë  ìˆ˜ ìˆë‹¤. ë”°ë¼ì„œ ë¬¸ë§¥ì´ë‚˜ ì–´ìˆœì´ ì¤‘ìš”í•œ ë¬¸ì¥ì—ì„œëŠ” í‘œí˜„ë ¥ì´ ì œí•œì ì´ë©°, ë¯¸ë¬˜í•œ ê°ì„± ì°¨ì´ë¥¼ í¬ì°©í•˜ê¸° ì–´ë µë‹¤.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>keras.backend.clear_session()</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> build_avg_embedding_model(vocab_size, maxlen, embed_dim<span class="op">=</span><span class="dv">128</span>):</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    inputs <span class="op">=</span> keras.Input(shape<span class="op">=</span>(maxlen,))</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> layers.Embedding(vocab_size, embed_dim)(inputs)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> layers.GlobalAveragePooling1D()(x)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> layers.Dense(<span class="dv">64</span>, activation<span class="op">=</span><span class="st">"relu"</span>)(x)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> layers.Dropout(<span class="fl">0.3</span>)(x)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    outputs <span class="op">=</span> layers.Dense(<span class="dv">1</span>, activation<span class="op">=</span><span class="st">"sigmoid"</span>)(x)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> keras.Model(inputs, outputs, name<span class="op">=</span><span class="st">"AvgEmbedDense"</span>)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>model_avg <span class="op">=</span> build_avg_embedding_model(vocab_size, maxlen, embed_dim<span class="op">=</span><span class="dv">128</span>)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>model_avg.<span class="bu">compile</span>(</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    optimizer<span class="op">=</span>keras.optimizers.Adam(<span class="fl">1e-3</span>),</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    loss<span class="op">=</span><span class="st">"binary_crossentropy"</span>,</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    metrics<span class="op">=</span>[<span class="st">"accuracy"</span>, keras.metrics.AUC(name<span class="op">=</span><span class="st">"auc"</span>)]</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>model_avg.summary()</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>hist_avg <span class="op">=</span> model_avg.fit(</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    x_tr, y_tr,</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>    validation_data<span class="op">=</span>(x_val, y_val),</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>    epochs<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span><span class="dv">256</span>,   <span class="co"># ëŸ°íƒ€ì„ ë¶ˆì•ˆí•˜ë©´ 128ë¡œ ë‚®ì¶”ì„¸ìš”</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>    callbacks<span class="op">=</span>cb,</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="dv">1</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>out_avg <span class="op">=</span> eval_binary_model(model_avg, x_test, y_test, <span class="st">"AvgEmbed+Dense"</span>)</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(out_avg)</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>histories[<span class="st">"AvgEmbed+Dense"</span>] <span class="op">=</span> hist_avg</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>results.append(out_avg)</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>models[<span class="st">"AvgEmbed+Dense"</span>] <span class="op">=</span> model_avg</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre class="text"><code>Model: "AvgEmbedDense"
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ Layer (type)                    â”ƒ Output Shape           â”ƒ       Param # â”ƒ
â”¡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”©
â”‚ input_layer (InputLayer)        â”‚ (None, 300)            â”‚             0 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ embedding (Embedding)           â”‚ (None, 300, 128)       â”‚     2,560,000 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ global_average_pooling1d        â”‚ (None, 128)            â”‚             0 â”‚
â”‚ (GlobalAveragePooling1D)        â”‚                        â”‚               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ dense (Dense)                   â”‚ (None, 64)             â”‚         8,256 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ dropout (Dropout)               â”‚ (None, 64)             â”‚             0 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ dense_1 (Dense)                 â”‚ (None, 1)              â”‚            65 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 Total params: 2,568,321 (9.80 MB)
 Trainable params: 2,568,321 (9.80 MB)
 Non-trainable params: 0 (0.00 B)
Epoch 1/10
79/79 â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 12s 121ms/step - accuracy: 0.5762 - auc: 0.6075 - loss: 0.6815 - val_accuracy: 0.6624 - val_auc: 0.8079 - val_loss: 0.6021 - learning_rate: 0.0010
Epoch 2/10
79/79 â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 8s 107ms/step - accuracy: 0.7667 - auc: 0.8515 - loss: 0.5208 - val_accuracy: 0.7898 - val_auc: 0.9092 - val_loss: 0.4285 - learning_rate: 0.0010
(ì´í•˜ ìƒëµ)</code></pre>
</section>
<section id="textcnn" class="level5">
<h5 class="anchored" data-anchor-id="textcnn">(2) TextCNN</h5>
<p>TextCNNì€ 1ì°¨ì› í•©ì„±ê³±(Conv1D)ì„ ì´ìš©í•˜ì—¬ ë¬¸ì¥ ë‚´ì˜ <strong>ì§€ì—­ì  íŒ¨í„´(local n-gram pattern)</strong>ì„ ì¶”ì¶œí•˜ëŠ” ëª¨ë¸ì´ë‹¤. í•©ì„±ê³± í•„í„°ëŠ” íŠ¹ì • ê¸¸ì´ì˜ ì—°ì†ëœ ë‹¨ì–´ ë¬¶ìŒ(ì˜ˆ: 3-gram, 5-gram)ì„ íƒì§€í•˜ë©°, ì´ëŠ” â€œnot goodâ€, â€œvery impressiveâ€, â€œworst movie everâ€ì™€ ê°™ì€ ê°ì„± í‘œí˜„ì„ íš¨ê³¼ì ìœ¼ë¡œ í¬ì°©í•  ìˆ˜ ìˆë‹¤.</p>
<p>ì´ ëª¨ë¸ì˜ ì¥ì ì€ ë¹„êµì  ê³„ì‚° íš¨ìœ¨ì´ ë†’ìœ¼ë©´ì„œë„ ë‹¨ìˆœ í‰ê·  ëª¨ë¸ë³´ë‹¤ í›¨ì”¬ í’ë¶€í•œ í‘œí˜„ì„ í•™ìŠµí•  ìˆ˜ ìˆë‹¤ëŠ” ì ì´ë‹¤. íŠ¹íˆ ì§§ì€ ê°ì„± ë¬¸êµ¬ë‚˜ íŠ¹ì • í‚¤ì›Œë“œ ì¡°í•©ì´ ì¤‘ìš”í•œ ë¶„ë¥˜ ë¬¸ì œì—ì„œ ê°•í•œ ì„±ëŠ¥ì„ ë³´ì¸ë‹¤. ë³‘ë ¬ ì—°ì‚°ì´ ê°€ëŠ¥í•˜ë¯€ë¡œ RNN ê³„ì—´ë³´ë‹¤ í•™ìŠµ ì†ë„ë„ ë¹ ë¥¸ í¸ì´ë‹¤.</p>
<p>ë‹¤ë§Œ CNNì€ ê¸°ë³¸ì ìœ¼ë¡œ êµ­ì†Œì  ë¬¸ë§¥ë§Œ ë°˜ì˜í•˜ë©°, ë¬¸ì¥ ì „ì²´ì˜ ì¥ê±°ë¦¬ ì˜ì¡´ì„±(long-range dependency)ì„ ì§ì ‘ì ìœ¼ë¡œ ëª¨ë¸ë§í•˜ê¸°ëŠ” ì–´ë µë‹¤. ë¬¸ë§¥ì´ ê¸¸ê²Œ ì´ì–´ì§€ëŠ” ë¬¸ì¥ì´ë‚˜ ë³µì¡í•œ êµ¬ì¡°ì—ì„œëŠ” í‘œí˜„ë ¥ì´ ì œí•œë  ìˆ˜ ìˆë‹¤.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>keras.backend.clear_session()</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> build_text_cnn(vocab_size, maxlen, embed_dim<span class="op">=</span><span class="dv">128</span>, filters<span class="op">=</span><span class="dv">128</span>, kernel_size<span class="op">=</span><span class="dv">5</span>):</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    inputs <span class="op">=</span> keras.Input(shape<span class="op">=</span>(maxlen,))</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> layers.Embedding(vocab_size, embed_dim)(inputs)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> layers.Conv1D(filters, kernel_size, activation<span class="op">=</span><span class="st">"relu"</span>, padding<span class="op">=</span><span class="st">"same"</span>)(x)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> layers.GlobalMaxPooling1D()(x)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> layers.Dense(<span class="dv">64</span>, activation<span class="op">=</span><span class="st">"relu"</span>)(x)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> layers.Dropout(<span class="fl">0.4</span>)(x)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    outputs <span class="op">=</span> layers.Dense(<span class="dv">1</span>, activation<span class="op">=</span><span class="st">"sigmoid"</span>)(x)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> keras.Model(inputs, outputs, name<span class="op">=</span><span class="st">"TextCNN"</span>)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>model_cnn <span class="op">=</span> build_text_cnn(vocab_size, maxlen)</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>model_cnn.<span class="bu">compile</span>(</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    optimizer<span class="op">=</span>keras.optimizers.Adam(<span class="fl">1e-3</span>),</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    loss<span class="op">=</span><span class="st">"binary_crossentropy"</span>,</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    metrics<span class="op">=</span>[<span class="st">"accuracy"</span>, keras.metrics.AUC(name<span class="op">=</span><span class="st">"auc"</span>)]</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>model_cnn.summary()</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>hist_cnn <span class="op">=</span> model_cnn.fit(</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>    x_tr, y_tr,</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>    validation_data<span class="op">=</span>(x_val, y_val),</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>    epochs<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span><span class="dv">256</span>,</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>    callbacks<span class="op">=</span>cb,</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="dv">1</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>out_cnn <span class="op">=</span> eval_binary_model(model_cnn, x_test, y_test, <span class="st">"TextCNN"</span>)</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(out_cnn)</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>histories[<span class="st">"TextCNN"</span>] <span class="op">=</span> hist_cnn</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>results.append(out_cnn)</span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>models[<span class="st">"TextCNN"</span>] <span class="op">=</span> model_cnn</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="bilstm" class="level5">
<h5 class="anchored" data-anchor-id="bilstm">(3) BiLSTM</h5>
<p>BiLSTMì€ ìˆœí™˜ì‹ ê²½ë§(RNN)ì˜ ì¼ì¢…ìœ¼ë¡œ, ë¬¸ì¥ì„ ì•ì—ì„œ ë’¤ë¡œ, ë’¤ì—ì„œ ì•ìœ¼ë¡œ ë™ì‹œì— ì²˜ë¦¬í•˜ì—¬ ë¬¸ì¥ íë¦„ê³¼ ìˆœì„œ ì •ë³´ë¥¼ ë°˜ì˜í•˜ëŠ” ëª¨ë¸ì´ë‹¤. ë‹¨ì–´ê°€ ë“±ì¥í•˜ëŠ” ìœ„ì¹˜ì™€ ì´ì „Â·ì´í›„ ë§¥ë½ì„ í•¨ê»˜ ê³ ë ¤í•˜ì—¬ ê°ì„±ì„ íŒë‹¨í•œë‹¤.</p>
<p>ì´ ëª¨ë¸ì˜ ê°€ì¥ í° ì¥ì ì€ ë¬¸ë§¥ ì˜ì¡´ì„±ì„ ìì—°ìŠ¤ëŸ½ê²Œ í•™ìŠµí•  ìˆ˜ ìˆë‹¤ëŠ” ì ì´ë‹¤. ì˜ˆë¥¼ ë“¤ì–´ â€œI thought it would be great, but it was disappointingâ€ê³¼ ê°™ì€ ë¬¸ì¥ì€ ì•ë¶€ë¶„ê³¼ ë’·ë¶€ë¶„ì˜ ê´€ê³„ë¥¼ ì´í•´í•´ì•¼ ì •í™•íˆ ë¶„ë¥˜í•  ìˆ˜ ìˆëŠ”ë°, BiLSTMì€ ì´ëŸ¬í•œ ìˆœì°¨ì  êµ¬ì¡°ë¥¼ ë¹„êµì  ì˜ ë°˜ì˜í•œë‹¤.</p>
<p>ê·¸ëŸ¬ë‚˜ ë‹¨ì ë„ ëª…í™•í•˜ë‹¤. ìˆœì°¨ ì—°ì‚° íŠ¹ì„±ìƒ ë³‘ë ¬ ì²˜ë¦¬ê°€ ì–´ë µê³  í•™ìŠµ ì†ë„ê°€ ëŠë¦¬ë©°, ë¬¸ì¥ì´ ê¸¸ì–´ì§ˆìˆ˜ë¡ ì •ë³´ê°€ í¬ì„ë  ê°€ëŠ¥ì„±ì´ ìˆë‹¤. ë˜í•œ í•˜ì´í¼íŒŒë¼ë¯¸í„°(ì€ë‹‰ ìœ ë‹› ìˆ˜, ì¸µ ìˆ˜ ë“±)ì— ë”°ë¼ ì„±ëŠ¥ ë³€ë™ì´ ì»¤ íŠœë‹ ë¶€ë‹´ì´ ì¡´ì¬í•œë‹¤.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>keras.backend.clear_session()</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> build_bilstm(vocab_size, maxlen, embed_dim<span class="op">=</span><span class="dv">128</span>, rnn_units<span class="op">=</span><span class="dv">64</span>):</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    inputs <span class="op">=</span> keras.Input(shape<span class="op">=</span>(maxlen,))</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> layers.Embedding(vocab_size, embed_dim)(inputs)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> layers.Bidirectional(layers.LSTM(rnn_units, return_sequences<span class="op">=</span><span class="va">False</span>))(x)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> layers.Dropout(<span class="fl">0.4</span>)(x)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    outputs <span class="op">=</span> layers.Dense(<span class="dv">1</span>, activation<span class="op">=</span><span class="st">"sigmoid"</span>)(x)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> keras.Model(inputs, outputs, name<span class="op">=</span><span class="st">"BiLSTM"</span>)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>model_lstm <span class="op">=</span> build_bilstm(vocab_size, maxlen)</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>model_lstm.<span class="bu">compile</span>(</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    optimizer<span class="op">=</span>keras.optimizers.Adam(<span class="fl">1e-3</span>),</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    loss<span class="op">=</span><span class="st">"binary_crossentropy"</span>,</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    metrics<span class="op">=</span>[<span class="st">"accuracy"</span>, keras.metrics.AUC(name<span class="op">=</span><span class="st">"auc"</span>)]</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>model_lstm.summary()</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>hist_lstm <span class="op">=</span> model_lstm.fit(</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>    x_tr, y_tr,</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>    validation_data<span class="op">=</span>(x_val, y_val),</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>    epochs<span class="op">=</span><span class="dv">8</span>,</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span><span class="dv">256</span>,</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>    callbacks<span class="op">=</span>cb,</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="dv">1</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>out_lstm <span class="op">=</span> eval_binary_model(model_lstm, x_test, y_test, <span class="st">"BiLSTM"</span>)</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(out_lstm)</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>histories[<span class="st">"BiLSTM"</span>] <span class="op">=</span> hist_lstm</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>results.append(out_lstm)</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>models[<span class="st">"BiLSTM"</span>] <span class="op">=</span> model_lstm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="mini-transformer" class="level5">
<h5 class="anchored" data-anchor-id="mini-transformer">(4) Mini Transformer</h5>
<p>Transformer ê¸°ë°˜ ëª¨ë¸ì€ Self-Attention ë©”ì»¤ë‹ˆì¦˜ì„ ì‚¬ìš©í•˜ì—¬ ë¬¸ì¥ ë‚´ ëª¨ë“  ë‹¨ì–´ ìŒ ê°„ì˜ ê´€ê³„ë¥¼ ë™ì‹œì— ê³„ì‚°í•œë‹¤. íŠ¹ì • ë‹¨ì–´ê°€ ë‹¤ë¥¸ ë‹¨ì–´ì— ì–¼ë§ˆë‚˜ ì¤‘ìš”í•œì§€ë¥¼ ê°€ì¤‘ì¹˜ë¡œ í•™ìŠµí•˜ë©°, ì´ë¥¼ í†µí•´ ë¬¸ë§¥ì  ì˜ë¯¸ë¥¼ êµ¬ì„±í•œë‹¤.</p>
<p>ì´ êµ¬ì¡°ì˜ ì¥ì ì€ ì¥ê±°ë¦¬ ì˜ì¡´ì„±ì„ íš¨ê³¼ì ìœ¼ë¡œ ëª¨ë¸ë§í•  ìˆ˜ ìˆë‹¤ëŠ” ì ì´ë‹¤. ë¬¸ì¥ì˜ ì•ê³¼ ë’¤ì— ìœ„ì¹˜í•œ ë‹¨ì–´ ê°„ ê´€ê³„ë„ ì§ì ‘ ì—°ê²°ë˜ì–´ ê³„ì‚°ë˜ë¯€ë¡œ, ë³µì¡í•œ ë¬¸ë§¥ êµ¬ì¡°ë¥¼ ì˜ ë°˜ì˜í•œë‹¤. ë˜í•œ ë³‘ë ¬ ì—°ì‚°ì´ ê°€ëŠ¥í•´ ì´ë¡ ì ìœ¼ë¡œëŠ” RNNë³´ë‹¤ íš¨ìœ¨ì ì´ë©°, ë¸”ë¡ì„ ìŒ“ì•„ í™•ì¥í•˜ê¸° ì‰½ë‹¤ëŠ” êµ¬ì¡°ì  ìœ ì—°ì„±ë„ ê°–ëŠ”ë‹¤.</p>
<p>í•˜ì§€ë§Œ TransformerëŠ” ìƒëŒ€ì ìœ¼ë¡œ ë§ì€ íŒŒë¼ë¯¸í„°ì™€ ê³„ì‚°ëŸ‰ì„ ìš”êµ¬í•˜ë©°, ì¶©ë¶„í•œ ë°ì´í„°ì™€ ì ì ˆí•œ ì •ê·œí™”ê°€ ì—†ìœ¼ë©´ ê³¼ì í•© ìœ„í—˜ì´ ìˆë‹¤. ë˜í•œ íŒ¨ë”© ë§ˆìŠ¤í¬, í•™ìŠµë¥  ìŠ¤ì¼€ì¤„ë§ ë“± ì„¸ë°€í•œ í•™ìŠµ ì„¤ì •ì´ ì„±ëŠ¥ì— í¬ê²Œ ì˜í–¥ì„ ë¯¸ì¹œë‹¤. ì†Œê·œëª¨ ë°ì´í„°ì—ì„œëŠ” ë‹¨ìˆœ CNNì´ë‚˜ LSTMë³´ë‹¤ ë°˜ë“œì‹œ ìš°ìˆ˜í•˜ë‹¤ê³  ë³´ì¥ë˜ì§€ëŠ” ì•ŠëŠ”ë‹¤.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>keras.backend.clear_session()</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> TransformerBlock(layers.Layer):</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, embed_dim, num_heads, ff_dim, rate<span class="op">=</span><span class="fl">0.1</span>):</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>()</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.att <span class="op">=</span> layers.MultiHeadAttention(num_heads<span class="op">=</span>num_heads, key_dim<span class="op">=</span>embed_dim)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.ffn <span class="op">=</span> keras.Sequential([</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>            layers.Dense(ff_dim, activation<span class="op">=</span><span class="st">"relu"</span>),</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>            layers.Dense(embed_dim),</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>        ])</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.ln1 <span class="op">=</span> layers.LayerNormalization(epsilon<span class="op">=</span><span class="fl">1e-6</span>)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.ln2 <span class="op">=</span> layers.LayerNormalization(epsilon<span class="op">=</span><span class="fl">1e-6</span>)</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.do1 <span class="op">=</span> layers.Dropout(rate)</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.do2 <span class="op">=</span> layers.Dropout(rate)</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> call(<span class="va">self</span>, x, attn_mask<span class="op">=</span><span class="va">None</span>, training<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>        attn <span class="op">=</span> <span class="va">self</span>.att(x, x, attention_mask<span class="op">=</span>attn_mask, training<span class="op">=</span>training)</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> <span class="va">self</span>.ln1(x <span class="op">+</span> <span class="va">self</span>.do1(attn, training<span class="op">=</span>training))</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>        ffn <span class="op">=</span> <span class="va">self</span>.ffn(x, training<span class="op">=</span>training)</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.ln2(x <span class="op">+</span> <span class="va">self</span>.do2(ffn, training<span class="op">=</span>training))</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> build_transformer_classifier(vocab_size, maxlen, embed_dim<span class="op">=</span><span class="dv">128</span>, num_heads<span class="op">=</span><span class="dv">4</span>, ff_dim<span class="op">=</span><span class="dv">256</span>, rate<span class="op">=</span><span class="fl">0.1</span>):</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>    inputs <span class="op">=</span> keras.Input(shape<span class="op">=</span>(maxlen,), dtype<span class="op">=</span><span class="st">"int32"</span>)</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># padding mask: token==0ì´ë©´ mask=False</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>    mask <span class="op">=</span> layers.Lambda(<span class="kw">lambda</span> t: tf.cast(tf.not_equal(t, <span class="dv">0</span>), tf.int32))(inputs)  <span class="co"># (B, L)</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>    attn_mask <span class="op">=</span> layers.Lambda(<span class="kw">lambda</span> m: m[:, tf.newaxis, :])(mask)                <span class="co"># (B, 1, L)</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> layers.Embedding(vocab_size, embed_dim)(inputs)</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># positional embedding (í•™ìŠµ ê°€ëŠ¥)</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>    positions <span class="op">=</span> tf.<span class="bu">range</span>(start<span class="op">=</span><span class="dv">0</span>, limit<span class="op">=</span>maxlen, delta<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>    pos_emb <span class="op">=</span> layers.Embedding(input_dim<span class="op">=</span>maxlen, output_dim<span class="op">=</span>embed_dim)(positions)</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> x <span class="op">+</span> pos_emb</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> TransformerBlock(embed_dim, num_heads, ff_dim, rate<span class="op">=</span>rate)(x, attn_mask<span class="op">=</span>attn_mask)</span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> layers.GlobalAveragePooling1D()(x)</span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> layers.Dropout(<span class="fl">0.3</span>)(x)</span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> layers.Dense(<span class="dv">64</span>, activation<span class="op">=</span><span class="st">"relu"</span>)(x)</span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> layers.Dropout(<span class="fl">0.3</span>)(x)</span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>    outputs <span class="op">=</span> layers.Dense(<span class="dv">1</span>, activation<span class="op">=</span><span class="st">"sigmoid"</span>)(x)</span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> keras.Model(inputs, outputs, name<span class="op">=</span><span class="st">"MiniTransformer"</span>)</span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>model_tr <span class="op">=</span> build_transformer_classifier(vocab_size, maxlen)</span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>model_tr.<span class="bu">compile</span>(</span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>    optimizer<span class="op">=</span>keras.optimizers.Adam(<span class="fl">1e-3</span>),</span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>    loss<span class="op">=</span><span class="st">"binary_crossentropy"</span>,</span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>    metrics<span class="op">=</span>[<span class="st">"accuracy"</span>, keras.metrics.AUC(name<span class="op">=</span><span class="st">"auc"</span>)]</span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a>model_tr.summary()</span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a>hist_tr <span class="op">=</span> model_tr.fit(</span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a>    x_tr, y_tr,</span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a>    validation_data<span class="op">=</span>(x_val, y_val),</span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a>    epochs<span class="op">=</span><span class="dv">8</span>,</span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span><span class="dv">256</span>,</span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a>    callbacks<span class="op">=</span>cb,</span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="dv">1</span></span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a>out_tr <span class="op">=</span> eval_binary_model(model_tr, x_test, y_test, <span class="st">"Transformer"</span>)</span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(out_tr)</span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a>histories[<span class="st">"Transformer"</span>] <span class="op">=</span> hist_tr</span>
<span id="cb10-68"><a href="#cb10-68" aria-hidden="true" tabindex="-1"></a>results.append(out_tr)</span>
<span id="cb10-69"><a href="#cb10-69" aria-hidden="true" tabindex="-1"></a>models[<span class="st">"Transformer"</span>] <span class="op">=</span> model_tr</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="ëª¨ë¸í‰ê°€-ë¹„êµ" class="level5">
<h5 class="anchored" data-anchor-id="ëª¨ë¸í‰ê°€-ë¹„êµ">3, ëª¨ë¸í‰ê°€ ë¹„êµ</h5>
<p><strong>ê²°ê³¼í‘œ</strong></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ê²°ê³¼í‘œ</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>df_eval <span class="op">=</span> pd.DataFrame(results)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>df_eval[<span class="st">"test_acc"</span>] <span class="op">=</span> df_eval[<span class="st">"test_acc"</span>].<span class="bu">round</span>(<span class="dv">4</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>df_eval[<span class="st">"test_auc"</span>] <span class="op">=</span> df_eval[<span class="st">"test_auc"</span>].<span class="bu">round</span>(<span class="dv">4</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>df_eval <span class="op">=</span> df_eval.sort_values(<span class="st">"test_auc"</span>, ascending<span class="op">=</span><span class="va">False</span>).reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>df_eval</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre class="text"><code>model   test_acc    test_auc    TN  FP  FN  TP
0   TextCNN 0.8673  0.9527  11628   872 2445    10055
1   AvgEmbed+Dense  0.8762  0.9443  10731   1769    1327    11173
2   Transformer 0.8235  0.9442  8537    3963    449 12051
3   BiLSTM  0.8422  0.9195  10998   1502    2444    10056</code></pre>
<p><strong>í•™ìŠµê³¡ì„  ë¹„êµ</strong></p>
<div class="sourceCode" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># í•™ìŠµ ê³¡ì„  ë¹„êµ</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>plot_histories(histories, metric<span class="op">=</span><span class="st">"accuracy"</span>, title<span class="op">=</span><span class="st">"Accuracy (train/val) - 4 models"</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>plot_histories(histories, metric<span class="op">=</span><span class="st">"auc"</span>, title<span class="op">=</span><span class="st">"AUC (train/val) - 4 models"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/classification_dl_case_text_accuracy.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/classification_dl_case_text_auc.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
<p><strong>ì˜¤ë¶„ë¥˜ Top-20</strong></p>
<div class="sourceCode" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Best ëª¨ë¸ ê¸°ì¤€ ì˜¤ë¶„ë¥˜ Top-20</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>best_name <span class="op">=</span> df_eval.iloc[<span class="dv">0</span>][<span class="st">"model"</span>]</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>best_model <span class="op">=</span> models[best_name]</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"=== Best model ==="</span>, best_name)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> best_model.predict(x_test, batch_size<span class="op">=</span><span class="dv">512</span>, verbose<span class="op">=</span><span class="dv">0</span>).ravel()</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>yhat <span class="op">=</span> (p <span class="op">&gt;=</span> <span class="fl">0.5</span>).astype(<span class="bu">int</span>)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_test, yhat))</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>df_mis <span class="op">=</span> get_misclassified_table(best_model, x_test, y_test, reverse_word_index, topk<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>df_mis</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre class="text"><code>=== Best model === TextCNN
              precision    recall  f1-score   support

           0       0.83      0.93      0.88     12500
           1       0.92      0.80      0.86     12500
    accuracy                           0.87     25000
   macro avg       0.87      0.87      0.87     25000
weighted avg       0.87      0.87      0.87     25000

idx y_true  y_pred  p_pos   conf    len text
0   23849   1   0   0.000230    0.999539    300 haggard the movie is the real life story of ry...
1   12156   1   0   0.000246    0.999509    216 this was laurel and hardy's last silent film f...
2   7500    1   0   0.000288    0.999424    137 right here we go you have probably read in pre...
3   2397    0   1   0.999686    0.999373    61  this is definitely one of the best kung fu mov...
4   6152    1   0   0.000364    0.999273    255 basically an endearingly and moronic 1 50 vers...
5   23325   1   0   0.000396    0.999207    51  great cult flick for mst types richard boone i...
6   10596   0   1   0.999557    0.999115    271 i went to see this 3 nights ago here in irelan...
7   17647   0   1   0.999490    0.998980    187 i didn't hate this one i just couldn't adapt t...
8   13805   1   0   0.000516    0.998968    91  if you're looking for a not so serious mob mov...
9   24863   1   0   0.000684    0.998633    198 miles once again assumes the role of the might...
10  10371   1   0   0.000723    0.998553    300 some spoilers included br br although many com...
11  2981    1   0   0.000739    0.998522    78  despite a silly premise ridiculous plot device...
12  11924   1   0   0.000773    0.998453    236 in a lot of ways this film defines the essence...
13  21988   1   0   0.000793    0.998414    300 lol br br the mere fact that i start off my re...
14  11879   1   0   0.000827    0.998346    206 the lovely yet lethal alexandra stunning blond...
15  13807   1   0   0.000951    0.998098    300 do it yourself indie horror auteur todd sheets...
16  5751    1   0   0.000991    0.998018    279 there's not much anyone can say about this fli...
17  24170   1   0   0.001044    0.997913    31  it's not citizen kane but it does deliver clea...
18  11512   1   0   0.001140    0.997720    93  i will admit that this movie was awful cheesy ...
19  21063   1   0   0.001140    0.997719    125 hey community my question is about the song th...</code></pre>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "î§‹";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>