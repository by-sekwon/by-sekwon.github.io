<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>MLDL ë¨¸ì‹ ëŸ¬ë‹ ë¶„ë¥˜ - kNN SVM ì‚¬ë¡€ë¶„ì„ â€“ ì„¸ìƒì˜ ëª¨ë“  í†µê³„ ì´ì•¼ê¸°</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-44962e3d41ec9ccc254fd50f1af5efbe.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-sidebar docked nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">ì„¸ìƒì˜ ëª¨ë“  í†µê³„ ì´ì•¼ê¸°</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../notes/math_stat/index.html"> 
<span class="menu-text">ê¸°ì´ˆìˆ˜í•™Â·ìˆ˜ë¦¬í†µê³„</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../notes/intro_stat/index.html"> 
<span class="menu-text">ê¸°ì´ˆí†µê³„Â·ì¡°ì‚¬ë°©ë²•</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../notes/linear_model/index.html"> 
<span class="menu-text">íšŒê·€Â·ë‹¤ë³€ëŸ‰</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../notes/mldl_intro/index.html"> 
<span class="menu-text">MLDLê°œë…</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../notes/mldl_prediction/index.html"> 
<span class="menu-text">MLDLì˜ˆì¸¡</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../../notes/mldl_classification/index.html" aria-current="page"> 
<span class="menu-text">MLDLë¶„ë¥˜</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../cardnews/index.html"> 
<span class="menu-text">ì¹´ë“œë‰´ìŠ¤</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../consult.html"> 
<span class="menu-text">í†µê³„ìƒë‹´</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../notes/mldl_classification/classification_ml_case_binary.html">ğŸ“„ ë¨¸ì‹ ëŸ¬ë‹ ì´ì§„í˜•ì‚¬ë¡€</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notes/mldl_classification/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ã€ë¨¸ì‹ Â·ë”¥ëŸ¬ë‹ ë¶„ë¥˜ë¬¸ì œã€‘</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notes/mldl_classification/classification_intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ğŸ“„ ë¶„ë¥˜ë¬¸ì œ: ì •ì˜</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notes/mldl_classification/lm_logistic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ğŸ“„ ì˜ˆì¸¡ë¶„ë¥˜-ë¡œì§€ìŠ¤í‹±íšŒê·€</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notes/mldl_classification/mda_discriminant.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ğŸ“„ ì˜ˆì¸¡ë¶„ë¥˜-íŒë³„ë¶„ì„</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notes/mldl_classification/prediction_treebase.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ğŸ“„ ì˜ˆì¸¡ë¶„ë¥˜-ML íŠ¸ë¦¬ê¸°ë°˜</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notes/mldl_classification/classification_ml_methods.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ğŸ“„ ë¨¸ì‹ ëŸ¬ë‹kNNSVMê°•ì˜</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notes/mldl_classification/classification_ml_case_binary.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">ğŸ“„ ë¨¸ì‹ ëŸ¬ë‹ ì´ì§„í˜•ì‚¬ë¡€</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notes/mldl_classification/classification_deeplearning01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ğŸ“„ ë”¥ëŸ¬ë‹ ë¶„ë¥˜ íŒŒíŠ¸1</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notes/mldl_classification/classification_deeplearning02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ğŸ“„ ë”¥ëŸ¬ë‹ ë¶„ë¥˜ íŒŒíŠ¸2</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notes/mldl_classification/classification_evaluation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ğŸ“„ ë¶„ë¥˜ëª¨ë¸ í‰ê°€</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">ëª©ì°¨</h2>
   
  <ul>
  <li><a href="#chapter-1.-ë¨¸ì‹ ëŸ¬ë‹-ë¶„ë¥˜-k-nn-svm-ì´ì§„í˜•-ë°ì´í„°-ì‚¬ë¡€ë¶„ì„" id="toc-chapter-1.-ë¨¸ì‹ ëŸ¬ë‹-ë¶„ë¥˜-k-nn-svm-ì´ì§„í˜•-ë°ì´í„°-ì‚¬ë¡€ë¶„ì„" class="nav-link active" data-scroll-target="#chapter-1.-ë¨¸ì‹ ëŸ¬ë‹-ë¶„ë¥˜-k-nn-svm-ì´ì§„í˜•-ë°ì´í„°-ì‚¬ë¡€ë¶„ì„">Chapter 1. ë¨¸ì‹ ëŸ¬ë‹ ë¶„ë¥˜ (k-NN | SVM) ì´ì§„í˜• ë°ì´í„° ì‚¬ë¡€ë¶„ì„</a>
  <ul>
  <li><a href="#ì‚¬ë¡€ë¶„ì„-ì´ì§„ë¶„ë¥˜" id="toc-ì‚¬ë¡€ë¶„ì„-ì´ì§„ë¶„ë¥˜" class="nav-link" data-scroll-target="#ì‚¬ë¡€ë¶„ì„-ì´ì§„ë¶„ë¥˜">1. ì‚¬ë¡€ë¶„ì„ (ì´ì§„ë¶„ë¥˜)</a></li>
  <li><a href="#ì‚¬ë¡€ë¶„ì„ì´ì§„ë¶„ë¥˜-íšŒì†Œì„±ê³µ-ë¶ˆê· í˜•" id="toc-ì‚¬ë¡€ë¶„ì„ì´ì§„ë¶„ë¥˜-íšŒì†Œì„±ê³µ-ë¶ˆê· í˜•" class="nav-link" data-scroll-target="#ì‚¬ë¡€ë¶„ì„ì´ì§„ë¶„ë¥˜-íšŒì†Œì„±ê³µ-ë¶ˆê· í˜•">2. ì‚¬ë¡€ë¶„ì„(ì´ì§„ë¶„ë¥˜, íšŒì†Œì„±ê³µ-ë¶ˆê· í˜•)</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">MLDL ë¨¸ì‹ ëŸ¬ë‹ ë¶„ë¥˜ - kNN SVM ì‚¬ë¡€ë¶„ì„</h1>
</div>



<div class="quarto-title-meta column-body">

    
  
    
  </div>
  


</header>


<section id="chapter-1.-ë¨¸ì‹ ëŸ¬ë‹-ë¶„ë¥˜-k-nn-svm-ì´ì§„í˜•-ë°ì´í„°-ì‚¬ë¡€ë¶„ì„" class="level3">
<h3 class="anchored" data-anchor-id="chapter-1.-ë¨¸ì‹ ëŸ¬ë‹-ë¶„ë¥˜-k-nn-svm-ì´ì§„í˜•-ë°ì´í„°-ì‚¬ë¡€ë¶„ì„">Chapter 1. ë¨¸ì‹ ëŸ¬ë‹ ë¶„ë¥˜ (k-NN | SVM) ì´ì§„í˜• ë°ì´í„° ì‚¬ë¡€ë¶„ì„</h3>
<section id="ì‚¬ë¡€ë¶„ì„-ì´ì§„ë¶„ë¥˜" class="level4">
<h4 class="anchored" data-anchor-id="ì‚¬ë¡€ë¶„ì„-ì´ì§„ë¶„ë¥˜">1. ì‚¬ë¡€ë¶„ì„ (ì´ì§„ë¶„ë¥˜)</h4>
<section id="ë°ì´í„°" class="level5">
<h5 class="anchored" data-anchor-id="ë°ì´í„°">(1) ë°ì´í„°</h5>
<p>ë³¸ ì‹¤ìŠµì—ì„œëŠ” ì´ì§„ë¶„ë¥˜ ì˜ˆì œë¡œ ë„ë¦¬ ì‚¬ìš©ë˜ëŠ” Breast Cancer Wisconsin (Diagnostic) ë°ì´í„°ë¥¼ ì‚¬ìš©í•œë‹¤. ì´ ë°ì´í„°ëŠ” ìœ ë°© ì¢…ì–‘ì˜ ì„¸í¬í•µ(nucleus) í˜•íƒœ íŠ¹ì„±ìœ¼ë¡œë¶€í„° ì¢…ì–‘ì´ ì•…ì„±(malignant 0) ì¸ì§€ ì–‘ì„±(benign 1) ì¸ì§€ë¥¼ ë¶„ë¥˜í•˜ëŠ” ë¬¸ì œë¥¼ ë‹¤ë£¬ë‹¤. í‘œë³¸ ìˆ˜ëŠ” ğ‘› = 569, ë³€ìˆ˜(íŠ¹ì§•) ìˆ˜ëŠ” p=30ì´ë‹¤.</p>
<p>30ê°œì˜ ì…ë ¥ ë³€ìˆ˜ëŠ” ëª¨ë‘ ì—°ì†í˜• ìˆ˜ì¹˜ ë³€ìˆ˜ë¡œ, ì¢…ì–‘ì˜ í˜•íƒœë¥¼ ìš”ì•½í•œ í†µê³„ì  íŠ¹ì„±ë“¤ì´ë‹¤. ì˜ˆë¥¼ ë“¤ì–´ í‰ê·  ë°˜ì§€ë¦„(mean radius), ë‘˜ë ˆ(mean perimeter), ë©´ì (mean area) ë“± â€œmean / error / worstâ€ ìœ í˜•ì˜ íŒŒìƒ íŠ¹ì§•ë“¤ì´ í¬í•¨ëœë‹¤.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°: Breast Cancer Wisconsin (Diagnostic)</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.datasets <span class="im">import</span> load_breast_cancer</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> load_breast_cancer()</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> data.data</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> data.target</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>feature_names <span class="op">=</span> data.feature_names</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>target_names <span class="op">=</span> data.target_names</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"X shape:"</span>, X.shape)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"y shape:"</span>, y.shape)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Classes:"</span>, <span class="bu">dict</span>(<span class="bu">enumerate</span>(target_names)))</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Class counts:"</span>, <span class="bu">dict</span>(<span class="bu">zip</span>(<span class="op">*</span>np.unique(y, return_counts<span class="op">=</span><span class="va">True</span>))))</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co"># DataFrameìœ¼ë¡œ ë³´ê¸° ì¢‹ê²Œ(ì„ íƒ)</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(X, columns<span class="op">=</span>feature_names)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"target"</span>] <span class="op">=</span> y</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>df.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="ì „ì²˜ë¦¬" class="level5">
<h5 class="anchored" data-anchor-id="ì „ì²˜ë¦¬">(2) ì „ì²˜ë¦¬</h5>
<p><strong>ì™œ train/test ë¶„í• ì„ ë¨¼ì € í•˜ëŠ”ê°€?</strong></p>
<p>ëª¨í˜• ì„±ëŠ¥ í‰ê°€ëŠ” â€œìƒˆë¡œìš´ ë°ì´í„°ì—ì„œ ì–¼ë§ˆë‚˜ ì˜ ë§ì¶”ëŠ”ê°€â€ë¥¼ ë³´ëŠ” ê²ƒì´ë¯€ë¡œ, ì „ì²´ ë°ì´í„°ë¥¼ í•™ìŠµìš©(train) ê³¼ í‰ê°€ìš©(test) ìœ¼ë¡œ ë‚˜ëˆˆë‹¤. ì´ë•Œ í•µì‹¬ ì›ì¹™ì€ í…ŒìŠ¤íŠ¸ ë°ì´í„°ëŠ” í•™ìŠµ ê³¼ì •ì— ì ˆëŒ€ ì‚¬ìš©ë˜ì§€ ì•Šì•„ì•¼ í•œë‹¤ëŠ” ì ì´ë‹¤. (ë°ì´í„° ëˆ„ìˆ˜ ë°©ì§€)</p>
<p>ì½”ë“œì—ì„œëŠ” ë‹¤ìŒì²˜ëŸ¼ 75%ëŠ” í•™ìŠµ, 25%ëŠ” í…ŒìŠ¤íŠ¸ë¡œ ë¶„í• í–ˆë‹¤.</p>
<p>í•™ìŠµ ë°ì´í„°: 426ê°œ / í…ŒìŠ¤íŠ¸ ë°ì´í„°: 143ê°œ</p>
<p><strong>â€œì¸µí™”(stratify)â€ëŠ” ì™œ í•„ìš”í•œê°€?</strong></p>
<p>ì´ ë°ì´í„°ëŠ” ì´ì§„ë¶„ë¥˜ì´ë©° í´ë˜ìŠ¤(ì•…ì„±/ì–‘ì„±)ì˜ ë¹„ìœ¨ì´ 212:357ë¡œ ì•½ê°„ ë¶ˆê· í˜•ì´ë‹¤. ë¬´ì‘ìœ„ ë¶„í• ë§Œ í•˜ë©´ ìš°ì—°íˆ í•œìª½ í´ë˜ìŠ¤ê°€ í…ŒìŠ¤íŠ¸ì— ê³¼ì†Œ/ê³¼ë‹¤ í¬í•¨ë  ìˆ˜ ìˆì–´ í‰ê°€ê°€ í”ë“¤ë¦´ ìˆ˜ ìˆë‹¤.</p>
<p>train_test_split(â€¦, stratify=y)ëŠ” í›ˆë ¨/í…ŒìŠ¤íŠ¸ ê°ê°ì—ì„œ í´ë˜ìŠ¤ ë¹„ìœ¨ì´ ì› ë°ì´í„°ì™€ ìœ ì‚¬í•˜ê²Œ ìœ ì§€ë˜ë„ë¡ ë¶„í• í•œë‹¤.</p>
<p>ê·¸ë˜ì„œ ì¶œë ¥ì—ì„œ train: (0) 159, (1) 267 / test : (0) 53, (1) 90ì²˜ëŸ¼ ë¹„ìœ¨ì´ í° í­ìœ¼ë¡œ ê¹¨ì§€ì§€ ì•ŠëŠ”ë‹¤.</p>
<p><strong>StandardScaler(í‘œì¤€í™”)ë¥¼ ì™œ í•˜ëŠ”ê°€?</strong></p>
<p>SVM(íŠ¹íˆ RBF ì»¤ë„)ê³¼ k-NNì€ ê±°ë¦¬/ë‚´ì  ê¸°ë°˜ì´ë¼ ë³€ìˆ˜ ìŠ¤ì¼€ì¼ì— ë§¤ìš° ë¯¼ê°í•˜ë‹¤.</p>
<p>ì˜ˆë¥¼ ë“¤ì–´, mean area ê°™ì€ ë³€ìˆ˜ëŠ” ê°’ì˜ ìŠ¤ì¼€ì¼ì´ í¬ê³ , mean smoothness ê°™ì€ ë³€ìˆ˜ëŠ” ìŠ¤ì¼€ì¼ì´ ì‘ë‹¤. í‘œì¤€í™” ì—†ì´ ê±°ë¦¬ ê³„ì‚°ì„ í•˜ë©´ ìŠ¤ì¼€ì¼ì´ í° ë³€ìˆ˜ê°€ ê±°ë¦¬ë¥¼ ì§€ë°°í•´, ëª¨ë¸ì´ â€œí° ë‹¨ìœ„ ë³€ìˆ˜â€ë§Œ ë³´ê³  íŒë‹¨í•˜ëŠ” ë¶€ì‘ìš©ì´ ìƒê¸´ë‹¤.</p>
<p><strong>íŒŒì´í”„ë¼ì¸(Pipeline)ì„ ì“°ëŠ” ì´ìœ : ëˆ„ìˆ˜ ë°©ì§€ + ì¬ì‚¬ìš©ì„±</strong></p>
<p>í‘œì¤€í™”ëŠ” ë°˜ë“œì‹œ í•™ìŠµ ë°ì´í„°ì—ì„œë§Œ í‰ê· /í‘œì¤€í¸ì°¨ë¥¼ ì¶”ì •(fit)í•´ì•¼ í•œë‹¤. ë§Œì•½ í…ŒìŠ¤íŠ¸ ë°ì´í„°ê¹Œì§€ í¬í•¨í•´ ìŠ¤ì¼€ì¼ì„ ë§ì¶”ë©´, í…ŒìŠ¤íŠ¸ ì •ë³´ê°€ í•™ìŠµ ë‹¨ê³„ì— ì„ì´ëŠ” ë°ì´í„° ëˆ„ìˆ˜ê°€ ë°œìƒí•œë‹¤. ì¦‰, í…ŒìŠ¤íŠ¸ ë°ì´í„°ëŠ” â€œë³€í™˜(transform)â€ë§Œ í•œë‹¤.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2ë‹¨ê³„: train/test ë¶„í• (ì¸µí™”) + í‘œì¤€í™”(Standardization) íŒŒì´í”„ë¼ì¸ ì¤€ë¹„</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.datasets <span class="im">import</span> load_breast_cancer</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> Pipeline</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co"># (1) ë°ì´í„° ë¡œë“œ</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> load_breast_cancer()</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> data.data</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> data.target</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co"># (2) train/test ë¶„í•  (ì¸µí™”: stratify=y)</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    X, y,</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    test_size<span class="op">=</span><span class="fl">0.25</span>,</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    random_state<span class="op">=</span><span class="dv">42</span>,</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    stratify<span class="op">=</span>y</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"[Split]"</span>)</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"X_train:"</span>, X_train.shape, <span class="st">"X_test:"</span>, X_test.shape)</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"y_train counts:"</span>, <span class="bu">dict</span>(<span class="bu">zip</span>(<span class="op">*</span>np.unique(y_train, return_counts<span class="op">=</span><span class="va">True</span>))))</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"y_test  counts:"</span>, <span class="bu">dict</span>(<span class="bu">zip</span>(<span class="op">*</span>np.unique(y_test, return_counts<span class="op">=</span><span class="va">True</span>))))</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a><span class="co"># (3) í‘œì¤€í™” íŒŒì´í”„ë¼ì¸(í•™ìŠµ ë°ì´í„°ë¡œ fit, í…ŒìŠ¤íŠ¸ì—ëŠ” transformë§Œ ì ìš©)</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>scaler_pipe <span class="op">=</span> Pipeline([</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"scaler"</span>, StandardScaler())</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a><span class="co"># í‘œì¤€í™” ì ìš©(ì´í›„ k-NN, SVM íŒŒì´í”„ë¼ì¸ì— ê·¸ëŒ€ë¡œ ë¼ì›Œ ë„£ì„ ì˜ˆì •)</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>X_train_scaled <span class="op">=</span> scaler_pipe.fit_transform(X_train)</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>X_test_scaled  <span class="op">=</span> scaler_pipe.transform(X_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>[Split] X_train: (426, 30) X_test: (143, 30) <br> y_train counts: {np.int64(0): np.int64(159), np.int64(1): np.int64(267)} <br> y_test counts: {np.int64(0): np.int64(53), np.int64(1): np.int64(90)}</p>
</section>
<section id="knn" class="level5">
<h5 class="anchored" data-anchor-id="knn">(3) KNN</h5>
<p><strong>kNN ë¶„ì„ ë° ì„±ëŠ¥ ì¶œë ¥</strong></p>
<p>ì´ ì½”ë“œëŠ” Breast Cancer Wisconsin ë°ì´í„°ì— ëŒ€í•´ k-NN ë¶„ë¥˜ê¸°ë¥¼ í•™ìŠµí•˜ê³ , í…ŒìŠ¤íŠ¸ì…‹ì—ì„œ ê¸°ë³¸ ì„±ëŠ¥(ì •í™•ë„/í˜¼ë™í–‰ë ¬/ë¶„ë¥˜ë¦¬í¬íŠ¸)ì„ í™•ì¸í•˜ëŠ” ì ˆì°¨ë¥¼ êµ¬í˜„í•œë‹¤. íŠ¹íˆ k-NNì€ ê±°ë¦¬ ê¸°ë°˜ ë°©ë²•ì´ë¯€ë¡œ í‘œì¤€í™”(Standardization) ë¥¼ ë°˜ë“œì‹œ í¬í•¨í•´ì•¼ í•˜ë©°, ì´ë¥¼ ëˆ„ìˆ˜ ì—†ì´ ìˆ˜í–‰í•˜ê¸° ìœ„í•´ Pipelineì„ ì‚¬ìš©í•œë‹¤.</p>
<p>ë¨¼ì € Pipeline([(â€œscalerâ€, StandardScaler()), (â€œknnâ€, KNeighborsClassifier(â€¦))]) í˜•íƒœë¡œ ì „ì²˜ë¦¬ì™€ ëª¨ë¸ì„ í•˜ë‚˜ì˜ íë¦„ìœ¼ë¡œ ë¬¶ëŠ”ë‹¤. ì—¬ê¸°ì„œ StandardScaler()ëŠ” ê° ë³€ìˆ˜ë¥¼ í›ˆë ¨ ë°ì´í„° ê¸°ì¤€ í‰ê· , í‘œì¤€í¸ì°¨ë¡œ ì •ê·œí™” ë³€í™˜í•œë‹¤.</p>
<p>ì´ ë³€í™˜ì€ ê±°ë¦¬ ê³„ì‚°ì—ì„œ íŠ¹ì • ë³€ìˆ˜(ìŠ¤ì¼€ì¼ì´ í° ë³€ìˆ˜)ê°€ ê³¼ë„í•˜ê²Œ ì˜í–¥ì„ ì£¼ëŠ” ë¬¸ì œë¥¼ ë§‰ê¸° ìœ„í•´ í•„ìˆ˜ì ì´ë‹¤. Pipelineì„ ì“°ë©´ í‘œì¤€í™”ì˜ fitì´ í›ˆë ¨ ë°ì´í„°ì—ì„œë§Œ ìˆ˜í–‰ë˜ê³ , í…ŒìŠ¤íŠ¸ ë°ì´í„°ì—ëŠ” ë™ì¼í•œ ë³€í™˜ì´ transformìœ¼ë¡œë§Œ ì ìš©ë˜ì–´ ë°ì´í„° ëˆ„ìˆ˜(leakage) ë¥¼ ë°©ì§€í•œë‹¤.</p>
<p>KNeighborsClassifierì˜ ì£¼ìš” ì„¤ì •ì€ ë‹¤ìŒ ì˜ë¯¸ë¥¼ ê°–ëŠ”ë‹¤. n_neighbors=15: ì˜ˆì¸¡ ì‹œ ê°€ì¥ ê°€ê¹Œìš´ ì´ì›ƒ k=15ê°œë¥¼ ì‚¬ìš©í•œë‹¤. kê°€ ì‘ìœ¼ë©´ ì¡ìŒì— ë¯¼ê°(ë¶„ì‚°â†‘), ë„ˆë¬´ í¬ë©´ ê²½ê³„ê°€ ê³¼ë„í•˜ê²Œ ë§¤ë„ëŸ¬ì›Œì§(í¸í–¥â†‘)ì´ë¯€ë¡œ ì ì ˆí•œ ê· í˜•ì´ í•„ìš”í•˜ë‹¤.</p>
<p>p=2: ìœ í´ë¦¬ë“œ ê±°ë¦¬(Euclidean)ë¥¼ ê³„ì‚°ëœë‹¤. (p=1ì´ë©´ ë§¨í•´íŠ¼ ê±°ë¦¬)</p>
<p>weights=â€œdistanceâ€: ë‹¨ìˆœ ë‹¤ìˆ˜ê²°ì´ ì•„ë‹ˆë¼ ê°€ê¹Œìš´ ì´ì›ƒì— ë” í° ê°€ì¤‘ì¹˜ë¥¼ ë‘ì–´ íˆ¬í‘œí•œë‹¤. ê²½ê³„ ê·¼ì²˜ì—ì„œ ë” ì•ˆì •ì ì¸ ì˜ˆì¸¡ì„ ê¸°ëŒ€í•  ìˆ˜ ìˆë‹¤.</p>
<p>í•™ìŠµì€ knn_model.fit(X_train, y_train)ë¡œ ìˆ˜í–‰ëœë‹¤. k-NNì€ ì†ì‹¤í•¨ìˆ˜ ìµœì í™”ë¡œ íŒŒë¼ë¯¸í„°ë¥¼ í•™ìŠµí•˜ê¸°ë³´ë‹¤ëŠ” â€œí›ˆë ¨ ë°ì´í„°ë¥¼ ì €ì¥í•´ë‘ê³ â€, ì˜ˆì¸¡ ì‹œ ë§¤ë²ˆ ì´ì›ƒì„ ê²€ìƒ‰í•˜ëŠ” í˜•íƒœì´ë¯€ë¡œ(ê²Œìœ¼ë¥¸ í•™ìŠµ), ì‹¤ì§ˆì  ê³„ì‚° ë¶€ë‹´ì€ ì˜ˆì¸¡ ë‹¨ê³„ì— ë” í¬ê²Œ ë°œìƒí•œë‹¤.</p>
<p>ì´í›„ predict(X_test)ë¡œ í´ë˜ìŠ¤ ë¼ë²¨ì„ ì˜ˆì¸¡í•˜ê³ , accuracy_score, confusion_matrix, classification_reportë¥¼ í†µí•´ ì„±ëŠ¥ì„ ìš”ì•½í•œë‹¤.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> Pipeline</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.neighbors <span class="im">import</span> KNeighborsClassifier</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score, confusion_matrix, classification_report, ConfusionMatrixDisplay</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># k-NN ëª¨ë¸ (í‘œì¤€í™” + kNN)</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>knn_model <span class="op">=</span> Pipeline([</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"scaler"</span>, StandardScaler()),</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"knn"</span>, KNeighborsClassifier(</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>        n_neighbors<span class="op">=</span><span class="dv">15</span>,      <span class="co"># k</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>        weights<span class="op">=</span><span class="st">"distance"</span>,  <span class="co"># ê°€ê¹Œìš´ ì´ì›ƒ ê°€ì¤‘â†‘</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>        p<span class="op">=</span><span class="dv">2</span>                  <span class="co"># p=2: Euclidean, p=1: Manhattan</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="co"># í•™ìŠµ</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>knn_model.fit(X_train, y_train)</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="co"># ì˜ˆì¸¡(í´ë˜ìŠ¤)</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>y_pred_knn <span class="op">=</span> knn_model.predict(X_test)</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="co"># labelsëŠ” 0,1ë¡œ ìœ ì§€</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> knn_model.named_steps[<span class="st">"knn"</span>].classes_   <span class="co"># array([0,1])</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a><span class="co"># labels(0,1)ì— ëŒ€ì‘ë˜ëŠ” "ì´ë¦„"ì„ ë¬¸ìì—´ë¡œ ë§Œë“¤ì–´ ì¤Œ</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>target_names <span class="op">=</span> data.target_names[labels].astype(<span class="bu">str</span>)  <span class="co"># ['malignant','benign']</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"[k-NN] Accuracy:"</span>, accuracy_score(y_test, y_pred_knn))</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>cm <span class="op">=</span> confusion_matrix(y_test, y_pred_knn, labels<span class="op">=</span>labels)</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"[k-NN] Confusion matrix:</span><span class="ch">\n</span><span class="st">"</span>, cm)</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"[k-NN] Classification report:</span><span class="ch">\n</span><span class="st">"</span>,</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>      classification_report(</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>          y_test, y_pred_knn,</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>          labels<span class="op">=</span>labels,</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>          target_names<span class="op">=</span>target_names</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>      ))</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>disp <span class="op">=</span> ConfusionMatrixDisplay(confusion_matrix<span class="op">=</span>cm, display_labels<span class="op">=</span>target_names)</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>disp.plot(values_format<span class="op">=</span><span class="st">"d"</span>)</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre class="text"><code>[k-NN] Accuracy: 0.965034965034965
[k-NN] Confusion matrix:
 [[48  5]
 [ 0 90]]
[k-NN] Classification report:
               precision    recall  f1-score   support

   malignant       1.00      0.91      0.95        53
      benign       0.95      1.00      0.97        90

    accuracy                           0.97       143
   macro avg       0.97      0.95      0.96       143 
weighted avg       0.97      0.97      0.96       143</code></pre>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/classification_ml_knnconfusion.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:60.0%"></p>
</figure>
</div>
<p><strong>ì‚¬í›„ í™•ë¥  ì¶œë ¥</strong></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> posterior_df(model, X, data<span class="op">=</span><span class="va">None</span>, n<span class="op">=</span><span class="dv">10</span>):</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">    model: sklearn estimator or Pipeline (with predict_proba)</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co">    X: feature matrix (e.g., X_test)</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co">    data: load_breast_cancer() ê°ì²´ (ìˆìœ¼ë©´ í´ë˜ìŠ¤ëª… í‘œì‹œ)</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co">    n: ì•ì—ì„œ nê°œë§Œ ë¯¸ë¦¬ë³´ê¸°</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    proba <span class="op">=</span> model.predict_proba(X)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># classes_ ê°€ì ¸ì˜¤ê¸° (Pipelineì´ë©´ ë§ˆì§€ë§‰ step)</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    classes <span class="op">=</span> <span class="bu">getattr</span>(model, <span class="st">"classes_"</span>, <span class="va">None</span>)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> classes <span class="kw">is</span> <span class="va">None</span> <span class="kw">and</span> <span class="bu">hasattr</span>(model, <span class="st">"named_steps"</span>):</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>        classes <span class="op">=</span> <span class="bu">list</span>(model.named_steps.values())[<span class="op">-</span><span class="dv">1</span>].classes_</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    classes <span class="op">=</span> np.array(classes)</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ì»¬ëŸ¼ëª…: ê°€ëŠ¥í•˜ë©´ malignant/benign ê°™ì€ ì´ë¦„ìœ¼ë¡œ</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> data <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="kw">and</span> <span class="bu">hasattr</span>(data, <span class="st">"target_names"</span>):</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>        colnames <span class="op">=</span> [<span class="ss">f"P(</span><span class="sc">{</span>data<span class="sc">.</span>target_names[c]<span class="sc">}</span><span class="ss">)"</span> <span class="cf">for</span> c <span class="kw">in</span> classes]</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>        colnames <span class="op">=</span> [<span class="ss">f"P(class=</span><span class="sc">{</span>c<span class="sc">}</span><span class="ss">)"</span> <span class="cf">for</span> c <span class="kw">in</span> classes]</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.DataFrame(proba, columns<span class="op">=</span>colnames)</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df.head(n), df  <span class="co"># (ë¯¸ë¦¬ë³´ê¸°, ì „ì²´)</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a><span class="co"># ì˜ˆì‹œ) k-NN ì‚¬í›„í™•ë¥ </span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>knn_head, knn_all <span class="op">=</span> posterior_df(knn_model, X_test, data<span class="op">=</span>data, n<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"=== k-NN posterior (head) ==="</span>)</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>display(knn_head)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre class="text"><code>=== k-NN posterior (head) ===
P(malignant)    P(benign)
0   0.061387    0.938613
1   1.000000    0.000000
2   0.319358    0.680642
3   0.134996    0.865004
4   0.422818    0.577182
5   1.000000    0.000000
6   0.940374    0.059626
7   0.934269    0.065731
8   1.000000    0.000000
9   0.000000    1.000000</code></pre>
<p><strong>k-NN: ROC/PR ê³¡ì„ ê³¼ ì„ê³„ê°’(Threshold) ì„ íƒ</strong></p>
<p>ì´ ì½”ë“œëŠ” k-NN ë¶„ë¥˜ê¸°ê°€ ì¶œë ¥í•˜ëŠ” í™•ë¥ (score) ì„ ì´ìš©í•´, (1) ROC ê³¡ì„ ê³¼ PR ê³¡ì„ ì„ ê³„ì‚°í•˜ê³  (2) ì„ê³„ê°’ të¥¼ ë°”ê¿€ ë•Œ í˜¼ë™í–‰ë ¬ê³¼ ì„±ëŠ¥ì§€í‘œê°€ ì–´ë–»ê²Œ ë³€í•˜ëŠ”ì§€ í™•ì¸í•˜ë©° (3) ìš´ì˜ ëª©ì ì— ë§ëŠ” ì„ê³„ê°’ì„ ì„ íƒí•˜ëŠ” ì ˆì°¨ë¥¼ êµ¬í˜„í•œë‹¤.</p>
<p>í•µì‹¬ ì•„ì´ë””ì–´ëŠ” â€œí™•ë¥ ì„ 0/1ë¡œ ë°”ê¾¸ëŠ” ê¸°ì¤€ì´ ì„ê³„ê°’ì´ë©°, ì„ê³„ê°’ì„ ì–´ë””ì— ë‘ëŠëƒì— ë”°ë¼ FP/FNì´ ë‹¬ë¼ì§„ë‹¤â€ëŠ” ì ì´ë‹¤.</p>
<p>ROC/PR ë° ì„ê³„ê°’ ì„ íƒì€ í•­ìƒ â€œì–´ë–¤ í´ë˜ìŠ¤ë¥¼ positive(ê´€ì‹¬ ì´ë²¤íŠ¸)ë¡œ ë³¼ ê²ƒì¸ê°€â€ë¥¼ ë¨¼ì € ì •í•´ì•¼ í•œë‹¤. Breast Cancer ë°ì´í„°ëŠ” ë¼ë²¨ì´ 0=malignant(ì•…ì„±), 1=benign(ì–‘ì„±) ì´ë¯€ë¡œ, ì½”ë“œì˜ ê¸°ë³¸ ì„¤ì •(A)ì€ positive=1(benign) ë¡œ ë‘”ë‹¤. ë”°ë¼ì„œ y_pos = y_test ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ê³ , í™•ë¥ ë„ P(y=1|x)ë¥¼ ì‚¬ìš©í•œë‹¤.</p>
<p>ë‹¤ë§Œ ì˜ë£Œ ì§„ë‹¨ì—ì„œëŠ” ë³´í†µ â€œì•…ì„±(ë†“ì¹˜ë©´ ì¹˜ëª…ì )â€ì„ positiveë¡œ ë‘ëŠ” í•´ì„ì´ ìì—°ìŠ¤ëŸ½ë‹¤. ì´ë¥¼ ìœ„í•´ ì½”ë“œì—ëŠ” ì˜µì…˜(B)ì´ í¬í•¨ë˜ì–´ ìˆìœ¼ë©°, ì´ ê²½ìš° y_pos = (y_test==0)ì²˜ëŸ¼ ì•…ì„±ì„ 1ë¡œ ì¬ì½”ë”©í•˜ê³ , scoreë„ P(malignant|x)ê°€ ë˜ë„ë¡ 1 - P(benign|x)ë¡œ ë’¤ì§‘ì–´ ì‚¬ìš©í•œë‹¤. ì¦‰, ê°™ì€ ëª¨ë¸ì´ë¼ë„ positive ì •ì˜ì— ë”°ë¼ ROC/PRì˜ ì˜ë¯¸ê°€ ë‹¬ë¼ì§„ë‹¤.</p>
<p>k-NNì€ predict_probaë¥¼ ì œê³µí•˜ë¯€ë¡œ, í…ŒìŠ¤íŠ¸ ë°ì´í„°ì— ëŒ€í•´ â€œpositive í´ë˜ìŠ¤ì˜ í™•ë¥ â€ì„ ë‹¤ìŒì²˜ëŸ¼ ë§Œë“ ë‹¤. p_pos1 = knn_model.predict_proba(X_test)[:,1] ì´ í™•ë¥  ë²¡í„°ê°€ ì´í›„ ROC/PR ê³¡ì„ ê³¼ ì„ê³„ê°’ ë¶„ì„ì˜ ìœ ì¼í•œ í•µì‹¬ ì…ë ¥(score) ì´ ëœë‹¤.</p>
<p><strong>ROC ê³¡ì„ ê³¼ AUC ê³„ì‚°</strong></p>
<p>ROCëŠ” ì„ê³„ê°’ të¥¼ 0ì—ì„œ 1ê¹Œì§€ ì›€ì§ì´ë©°, ê° ì„ê³„ê°’ì—ì„œ ë‹¤ìŒ ë‘ ê°’ì„ ê³„ì‚°í•´ ê·¸ë¦° ê³¡ì„ ì´ë‹¤.</p>
<ul>
<li>TPR(ì¬í˜„ìœ¨, ë¯¼ê°ë„) = TP / (TP + FN)</li>
<li>FPR(ìœ„ì–‘ì„±ë¥ ) = FP / (FP + TN)</li>
</ul>
<p>ì½”ë“œì˜ roc_curve(y_pos, score)ëŠ” (FPR ë°°ì—´, TPR ë°°ì—´, ê·¸ë¦¬ê³  ê·¸ë•Œì˜ ì„ê³„ê°’ ë°°ì—´)ì„ ë°˜í™˜í•œë‹¤. ì´ì–´ì„œ auc(fpr, tpr)ëŠ” ROC ê³¡ì„  ì•„ë˜ ë©´ì (AUC)ì„ ê³„ì‚°í•œë‹¤. AUCëŠ” â€œpositive ìƒ˜í”Œì´ negativeë³´ë‹¤ ë” ë†’ì€ ì ìˆ˜(score)ë¥¼ ë°›ë„ë¡ ì •ë ¬ë˜ëŠ” ëŠ¥ë ¥(ìˆœìœ„ ë¶„ë¦¬ ì„±ëŠ¥)â€ì„ ìš”ì•½í•œ ê°’ì´ë‹¤.</p>
<p><strong>PR ê³¡ì„ ê³¼ AP ê³„ì‚°</strong></p>
<p>PR ê³¡ì„ ì€ ì„ê³„ê°’ ë³€í™”ì— ë”°ë¼ ë‹¤ìŒ ë‘ ê°’ì˜ trade-offë¥¼ ë³¸ë‹¤.</p>
<ul>
<li>Precision(ì •ë°€ë„) = TP / (TP + FP)</li>
<li>Recall(ì¬í˜„ìœ¨) = TP / (TP + FN)</li>
</ul>
<p>íŠ¹íˆ ì–‘ì„± í´ë˜ìŠ¤ê°€ í¬ê·€í•œ ìƒí™©ì—ì„œëŠ” ROCë³´ë‹¤ PRì´ ìš´ì˜ í’ˆì§ˆì„ ë” ì§ì ‘ì ìœ¼ë¡œ ë³´ì—¬ì£¼ëŠ” ê²½ìš°ê°€ ë§ë‹¤. average_precision_scoreë¡œ ê³„ì‚°í•œ APëŠ” PR ê³¡ì„ ì„ í•˜ë‚˜ì˜ ìˆ˜ì¹˜ë¡œ ìš”ì•½í•œ ê°’ì´ë‹¤.</p>
<p><strong>â€œì„ê³„ê°’ t í•˜ë‚˜â€ì—ì„œ í˜¼ë™í–‰ë ¬ê³¼ ì§€í‘œë¥¼ ê³„ì‚°í•˜ëŠ” í•¨ìˆ˜</strong></p>
<p>metrics_at_threshold()ëŠ” íŠ¹ì • ì„ê³„ê°’ të¥¼ ì£¼ë©´ ë‹¤ìŒì„ ìˆ˜í–‰í•œë‹¤.</p>
<p>í™•ë¥ ì„ ì´ì§„ ì˜ˆì¸¡ìœ¼ë¡œ ë³€í™˜: y_hat = (score &gt;= t). ì¦‰, scoreê°€ ì„ê³„ê°’ ì´ìƒì´ë©´ positiveë¡œ íŒì •í•œë‹¤.</p>
<p>í˜¼ë™í–‰ë ¬(TN, FP, FN, TP) ê³„ì‚°í•˜ê³  ê·¸ í˜¼ë™í–‰ë ¬ë¡œë¶€í„° ì§€í‘œ recall(TPR), fpr, precision, accuracyì„ ê³„ì‚°í•œë‹¤. ì´ í•¨ìˆ˜ëŠ” ROC/PR ê°™ì€ â€œê³¡ì„ â€ì„ ì‹¤ì œ ìš´ì˜ ê´€ì ì˜ â€œí•œ ì (ì„ê³„ê°’ í•˜ë‚˜)â€ìœ¼ë¡œ í’€ì–´ì£¼ëŠ” ì—­í• ì„ í•œë‹¤.</p>
<p>ì—¬ëŸ¬ ì„ê³„ê°’(grid)ì„ ì°ì–´ë³´ë©° FP/FN trade-offë¥¼ í™•ì¸: ì½”ë“œëŠ” t=0.1,0.2,â€¦,0.9ì— ëŒ€í•´ metrics_at_threshold ê²°ê³¼ë¥¼ ì¶œë ¥í•œë‹¤. ì¼ë°˜ì ìœ¼ë¡œ ì„ê³„ê°’ì„ ì˜¬ë¦¬ë©´ positive íŒì •ì´ ë³´ìˆ˜ì ìœ¼ë¡œ ë³€í•˜ë©´ì„œ: FPëŠ” ê°ì†Œ(ì •ë°€ë„ëŠ” ì¦ê°€í•˜ëŠ” ê²½í–¥), FNì€ ì¦ê°€(ì¬í˜„ìœ¨ì€ ê°ì†Œí•˜ëŠ” ê²½í–¥). ì¦‰, ì„ê³„ê°’ì€ â€œì˜¤ê²½ë³´(FP)ë¥¼ ì¤„ì´ëŠëƒ, ë†“ì¹¨(FN)ì„ ì¤„ì´ëŠëƒâ€ì˜ ê· í˜•ì„ ì¡°ì ˆí•˜ëŠ” ì†ì¡ì´ë‹¤.</p>
<p><strong>ì„ê³„ê°’ ì„ íƒ ê·œì¹™ (A): Youdenâ€™s J ìµœëŒ€í™”</strong></p>
<p>Youdenâ€™s JëŠ” ROC ê´€ì ì—ì„œ ê· í˜•ì ì„ ì¡ëŠ” ë‹¨ìˆœí•œ ê¸°ì¤€ì´ë‹¤.</p>
<p>J(t) = TPR(t) âˆ’ FPR(t)</p>
<p>ì½”ë“œëŠ” ëª¨ë“  ROC ì ì—ì„œ Jë¥¼ ê³„ì‚°í•˜ê³ , Jê°€ ìµœëŒ€ì¸ ì§€ì ì˜ ì„ê³„ê°’ì„ ì„ íƒí•œë‹¤. ì´ ë°©ì‹ì€ â€œì¬í˜„ìœ¨ì„ ë†’ì´ë˜ ìœ„ì–‘ì„±ë¥ ë„ ë„ˆë¬´ í¬ì§€ ì•Šê²Œâ€ ë§Œë“œëŠ” ê· í˜•í˜• ê¸°ì¤€ìœ¼ë¡œ ì´í•´í•˜ë©´ ëœë‹¤.</p>
<p><strong>ì„ê³„ê°’ ì„ íƒ ê·œì¹™ (B): FPR ì œì•½ ì¡°ê±´ í•˜ì—ì„œ ìµœì í™”</strong></p>
<p>ìš´ì˜ì—ì„œ â€œì˜¤ê²½ë³´ëŠ” ìµœëŒ€ Î±ê¹Œì§€ë§Œ í—ˆìš©â€ ê°™ì€ ì •ì±…ì´ ìˆì„ ë•Œ, ë¨¼ì € FPR â‰¤ Î±ë¥¼ ë§Œì¡±í•˜ëŠ” ì„ê³„ê°’ í›„ë³´ë“¤ë§Œ ë‚¨ê¸´ ë’¤, ê·¸ì¤‘ì—ì„œ TPR(ì¬í˜„ìœ¨)ì´ ê°€ì¥ í° ì„ê³„ê°’ì„ ì„ íƒí•œë‹¤. ì¦‰, ì œì•½ ì¡°ê±´ì„ ë¨¼ì € ë§Œì¡±ì‹œí‚¤ê³  ê·¸ ì•ˆì—ì„œ ì„±ëŠ¥ì„ ìµœëŒ€ë¡œ ë§Œë“œëŠ” ë°©ì‹ì´ë‹¤. ì˜ˆì»¨ëŒ€ Î±=0.02ëŠ” ë§¤ìš° ë³´ìˆ˜ì ì¸ ì˜¤ê²½ë³´ ì œí•œì— í•´ë‹¹í•˜ë¯€ë¡œ ì„ê³„ê°’ì´ ìƒëŒ€ì ìœ¼ë¡œ ë†’ì•„ì§€ê³ , ê·¸ ê²°ê³¼ recallì´ ì¼ë¶€ ê°ì†Œí•  ìˆ˜ ìˆë‹¤.</p>
<p><strong>ì„ê³„ê°’ ì„ íƒ ê·œì¹™ (C): ë¹„ìš© ê¸°ë°˜ ìµœì†Œí™”</strong></p>
<p>í˜„ì‹¤ì—ì„œëŠ” FNê³¼ FPì˜ ë¹„ìš©ì´ ë‹¤ë¥´ë¯€ë¡œ, ë¹„ìš©í•¨ìˆ˜ë¥¼ ë‘ê³  ì„ê³„ê°’ì„ ê³ ë¥¼ ìˆ˜ ìˆë‹¤.</p>
<p>Cost(t) = c_fn * FN(t) + c_fp * FP(t)</p>
<p>ì½”ë“œëŠ” ê°€ëŠ¥í•œ ì„ê³„ê°’ í›„ë³´ë“¤ì„ ìˆœíšŒí•˜ë©´ì„œ ë¹„ìš©ì„ ê³„ì‚°í•˜ê³ , ë¹„ìš©ì´ ìµœì†Œì¸ ì„ê³„ê°’ì„ ì„ íƒí•œë‹¤. ì˜ˆë¥¼ ë“¤ì–´ c_fnì„ í¬ê²Œ ë‘ë©´(ë†“ì¹¨ ë¹„ìš©ì´ í¼), ëª¨ë¸ì€ FNì„ ì¤„ì´ê¸° ìœ„í•´ ì„ê³„ê°’ì„ ë‚®ì¶”ëŠ” ë°©í–¥ìœ¼ë¡œ ì„ íƒë˜ëŠ” ê²½í–¥ì´ ê°•í•´ì§„ë‹¤. ë°˜ëŒ€ë¡œ c_fpê°€ í¬ë©´ ì˜¤ê²½ë³´ë¥¼ ì¤„ì´ê¸° ìœ„í•´ ì„ê³„ê°’ì„ ì˜¬ë¦¬ëŠ” ë°©í–¥ì´ ëœë‹¤.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># k-NN: ROC / PR + ì„ê³„ê°’(Threshold) ì„ íƒ ì½”ë“œ</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co"># (ì „ì œ) knn_modelì´ ì´ë¯¸ fit ë˜ì–´ ìˆê³ , X_test, y_testê°€ ì¤€ë¹„ë˜ì–´ ìˆì–´ì•¼ í•¨.</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> (</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    roc_curve, auc,</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    precision_recall_curve, average_precision_score,</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    confusion_matrix</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================================================</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 0) Positive(ê´€ì‹¬ í´ë˜ìŠ¤) ì •ì˜</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="co">#    - ê¸°ë³¸: positive = 1 (benign)  [ë°ì´í„° ë¼ë²¨ ê·¸ëŒ€ë¡œ]</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="co">#    - ì˜ë£Œì§„ë‹¨ ê´€ì : positive = 0 (malignant) ë¡œ ë°”ê¾¸ë ¤ë©´ ì˜µì…˜ B ì‚¬ìš©</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================================================</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) score(í™•ë¥ ): P(y=1 | x)</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>p_pos1 <span class="op">=</span> knn_model.predict_proba(X_test)[:, <span class="dv">1</span>]</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="co"># A) positive = 1(benign)</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>y_pos <span class="op">=</span> y_test</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>score <span class="op">=</span> p_pos1</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a><span class="co"># B) (ì˜µì…˜) positive = malignant(0)ë¡œ ë³€ê²½ ì‹œ</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="co"># y_pos = (y_test == 0).astype(int)</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a><span class="co"># score = 1.0 - p_pos1   # = P(malignant | x)</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================================================</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) ROC curve + AUC</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================================================</span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>fpr, tpr, thr_roc <span class="op">=</span> roc_curve(y_pos, score)</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>roc_auc <span class="op">=</span> auc(fpr, tpr)</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================================================</span></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) PR curve + AP</span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================================================</span></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>precision, recall, thr_pr <span class="op">=</span> precision_recall_curve(y_pos, score)</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>ap <span class="op">=</span> average_precision_score(y_pos, score)</span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"[k-NN] ROC AUC ="</span>, roc_auc)</span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"[k-NN] PR  AP  ="</span>, ap)</span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"ROC thresholds:"</span>, thr_roc.shape, <span class="st">"| PR thresholds:"</span>, thr_pr.shape)</span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================================================</span></span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) ì„ê³„ê°’ tì—ì„œ í˜¼ë™í–‰ë ¬/ì§€í‘œ ê³„ì‚°</span></span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================================================</span></span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> metrics_at_threshold(y_true01, score, t):</span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a><span class="co">    y_true01: {0,1} (1ì´ positive)</span></span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a><span class="co">    score   : positive ì ìˆ˜(í™•ë¥ )</span></span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a><span class="co">    t       : threshold</span></span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>    y_hat <span class="op">=</span> (score <span class="op">&gt;=</span> t).astype(<span class="bu">int</span>)</span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a>    tn, fp, fn, tp <span class="op">=</span> confusion_matrix(y_true01, y_hat).ravel()</span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a>    recall_ <span class="op">=</span> tp <span class="op">/</span> (tp <span class="op">+</span> fn) <span class="cf">if</span> (tp <span class="op">+</span> fn) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="fl">0.0</span>  <span class="co"># TPR</span></span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a>    fpr_    <span class="op">=</span> fp <span class="op">/</span> (fp <span class="op">+</span> tn) <span class="cf">if</span> (fp <span class="op">+</span> tn) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="fl">0.0</span></span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a>    prec_   <span class="op">=</span> tp <span class="op">/</span> (tp <span class="op">+</span> fp) <span class="cf">if</span> (tp <span class="op">+</span> fp) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="fl">0.0</span></span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a>    acc_    <span class="op">=</span> (tp <span class="op">+</span> tn) <span class="op">/</span> (tp <span class="op">+</span> tn <span class="op">+</span> fp <span class="op">+</span> fn)</span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a>        <span class="st">"t"</span>: <span class="bu">float</span>(t),</span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a>        <span class="st">"tn"</span>: <span class="bu">int</span>(tn), <span class="st">"fp"</span>: <span class="bu">int</span>(fp), <span class="st">"fn"</span>: <span class="bu">int</span>(fn), <span class="st">"tp"</span>: <span class="bu">int</span>(tp),</span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a>        <span class="st">"recall(tpr)"</span>: <span class="bu">float</span>(recall_),</span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a>        <span class="st">"fpr"</span>: <span class="bu">float</span>(fpr_),</span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a>        <span class="st">"precision"</span>: <span class="bu">float</span>(prec_),</span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a>        <span class="st">"accuracy"</span>: <span class="bu">float</span>(acc_)</span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-69"><a href="#cb7-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-70"><a href="#cb7-70" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================================================</span></span>
<span id="cb7-71"><a href="#cb7-71" aria-hidden="true" tabindex="-1"></a><span class="co"># 4) ì„ê³„ê°’ gridë¡œ ë³€í™” í™•ì¸(0.1~0.9)</span></span>
<span id="cb7-72"><a href="#cb7-72" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================================================</span></span>
<span id="cb7-73"><a href="#cb7-73" aria-hidden="true" tabindex="-1"></a>grid <span class="op">=</span> np.arange(<span class="fl">0.1</span>, <span class="fl">1.0</span>, <span class="fl">0.1</span>)</span>
<span id="cb7-74"><a href="#cb7-74" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> t <span class="kw">in</span> grid:</span>
<span id="cb7-75"><a href="#cb7-75" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(metrics_at_threshold(y_pos, score, t))</span>
<span id="cb7-76"><a href="#cb7-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-77"><a href="#cb7-77" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================================================</span></span>
<span id="cb7-78"><a href="#cb7-78" aria-hidden="true" tabindex="-1"></a><span class="co"># 5) ì„ê³„ê°’ ì„ íƒ ê·œì¹™ (A) Youden J = TPR - FPR ìµœëŒ€</span></span>
<span id="cb7-79"><a href="#cb7-79" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================================================</span></span>
<span id="cb7-80"><a href="#cb7-80" aria-hidden="true" tabindex="-1"></a>J <span class="op">=</span> tpr <span class="op">-</span> fpr</span>
<span id="cb7-81"><a href="#cb7-81" aria-hidden="true" tabindex="-1"></a>best_idx <span class="op">=</span> np.argmax(J)</span>
<span id="cb7-82"><a href="#cb7-82" aria-hidden="true" tabindex="-1"></a>best_t_youden <span class="op">=</span> thr_roc[best_idx]</span>
<span id="cb7-83"><a href="#cb7-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-84"><a href="#cb7-84" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">[Youden J]"</span>)</span>
<span id="cb7-85"><a href="#cb7-85" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"best t ="</span>, best_t_youden)</span>
<span id="cb7-86"><a href="#cb7-86" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(metrics_at_threshold(y_pos, score, best_t_youden))</span>
<span id="cb7-87"><a href="#cb7-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-88"><a href="#cb7-88" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================================================</span></span>
<span id="cb7-89"><a href="#cb7-89" aria-hidden="true" tabindex="-1"></a><span class="co"># 6) ì„ê³„ê°’ ì„ íƒ ê·œì¹™ (B) FPR &lt;= alpha ì¡°ê±´ì—ì„œ TPR ìµœëŒ€</span></span>
<span id="cb7-90"><a href="#cb7-90" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================================================</span></span>
<span id="cb7-91"><a href="#cb7-91" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> best_threshold_fpr_constraint(y_true01, score, alpha<span class="op">=</span><span class="fl">0.02</span>):</span>
<span id="cb7-92"><a href="#cb7-92" aria-hidden="true" tabindex="-1"></a>    fpr, tpr, thr <span class="op">=</span> roc_curve(y_true01, score)</span>
<span id="cb7-93"><a href="#cb7-93" aria-hidden="true" tabindex="-1"></a>    candidates <span class="op">=</span> np.where(fpr <span class="op">&lt;=</span> alpha)[<span class="dv">0</span>]</span>
<span id="cb7-94"><a href="#cb7-94" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(candidates) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb7-95"><a href="#cb7-95" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb7-96"><a href="#cb7-96" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> candidates[np.argmax(tpr[candidates])]</span>
<span id="cb7-97"><a href="#cb7-97" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> thr[i]</span>
<span id="cb7-98"><a href="#cb7-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-99"><a href="#cb7-99" aria-hidden="true" tabindex="-1"></a>alpha <span class="op">=</span> <span class="fl">0.02</span></span>
<span id="cb7-100"><a href="#cb7-100" aria-hidden="true" tabindex="-1"></a>best_t_fpr <span class="op">=</span> best_threshold_fpr_constraint(y_pos, score, alpha<span class="op">=</span>alpha)</span>
<span id="cb7-101"><a href="#cb7-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-102"><a href="#cb7-102" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">[FPR constraint]"</span>)</span>
<span id="cb7-103"><a href="#cb7-103" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"alpha ="</span>, alpha, <span class="st">"best t ="</span>, best_t_fpr)</span>
<span id="cb7-104"><a href="#cb7-104" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> best_t_fpr <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb7-105"><a href="#cb7-105" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(metrics_at_threshold(y_pos, score, best_t_fpr))</span>
<span id="cb7-106"><a href="#cb7-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-107"><a href="#cb7-107" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================================================</span></span>
<span id="cb7-108"><a href="#cb7-108" aria-hidden="true" tabindex="-1"></a><span class="co"># 7) ì„ê³„ê°’ ì„ íƒ ê·œì¹™ (C) ë¹„ìš© ê¸°ë°˜: c_fn*FN + c_fp*FP ìµœì†Œ</span></span>
<span id="cb7-109"><a href="#cb7-109" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================================================</span></span>
<span id="cb7-110"><a href="#cb7-110" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> best_threshold_cost(y_true01, score, c_fn<span class="op">=</span><span class="fl">10.0</span>, c_fp<span class="op">=</span><span class="fl">1.0</span>):</span>
<span id="cb7-111"><a href="#cb7-111" aria-hidden="true" tabindex="-1"></a>    thresholds <span class="op">=</span> np.unique(np.r_[<span class="fl">0.0</span>, score, <span class="fl">1.0</span>])</span>
<span id="cb7-112"><a href="#cb7-112" aria-hidden="true" tabindex="-1"></a>    best_t, best_m, best_cost <span class="op">=</span> <span class="va">None</span>, <span class="va">None</span>, np.inf</span>
<span id="cb7-113"><a href="#cb7-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-114"><a href="#cb7-114" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> t <span class="kw">in</span> thresholds:</span>
<span id="cb7-115"><a href="#cb7-115" aria-hidden="true" tabindex="-1"></a>        m <span class="op">=</span> metrics_at_threshold(y_true01, score, t)</span>
<span id="cb7-116"><a href="#cb7-116" aria-hidden="true" tabindex="-1"></a>        cost <span class="op">=</span> c_fn <span class="op">*</span> m[<span class="st">"fn"</span>] <span class="op">+</span> c_fp <span class="op">*</span> m[<span class="st">"fp"</span>]</span>
<span id="cb7-117"><a href="#cb7-117" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> cost <span class="op">&lt;</span> best_cost:</span>
<span id="cb7-118"><a href="#cb7-118" aria-hidden="true" tabindex="-1"></a>            best_t, best_m, best_cost <span class="op">=</span> <span class="bu">float</span>(t), m, <span class="bu">float</span>(cost)</span>
<span id="cb7-119"><a href="#cb7-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-120"><a href="#cb7-120" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> best_t, best_m, best_cost</span>
<span id="cb7-121"><a href="#cb7-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-122"><a href="#cb7-122" aria-hidden="true" tabindex="-1"></a>best_t_cost, best_m_cost, best_cost_val <span class="op">=</span> best_threshold_cost(y_pos, score, c_fn<span class="op">=</span><span class="dv">10</span>, c_fp<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb7-123"><a href="#cb7-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-124"><a href="#cb7-124" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">[Cost-based]"</span>)</span>
<span id="cb7-125"><a href="#cb7-125" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"best t ="</span>, best_t_cost, <span class="st">"cost ="</span>, best_cost_val)</span>
<span id="cb7-126"><a href="#cb7-126" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(best_m_cost)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>(A) Youden J ìµœëŒ€:</strong> tâ‰ˆ0.5953 / tn=51, fp=2, fn=2, tp=88</p>
<p>FPR = 0.0377, TPR(recall)=0.9778</p>
<p>ROC ê´€ì ì—ì„œ TPRì„ ë†’ì´ë©´ì„œ FPRë„ ë‚®ì¶”ëŠ” â€œê· í˜•ì â€ì´ë‹¤. t=0.5ë³´ë‹¤ FP(ì•…ì„± ë†“ì¹¨)ê°€ 5â†’2ë¡œ ê°ì†Œí•˜ì§€ë§Œ, FNì´ 0â†’2ë¡œ ì†Œí­ ì¦ê°€í•œë‹¤.</p>
<p><strong>(B) FPR ì œì•½:</strong> Î±=0.02 â†’ tâ‰ˆ0.7527</p>
<p>tn=53, fp=0, fn=11, tp=79</p>
<p>FPR=0 (ì•…ì„±ì„ benignìœ¼ë¡œ ë†“ì¹˜ëŠ” ì¼ì´ 0) ëŒ€ì‹  FN=11 (benignì„ ì•…ì„±ìœ¼ë¡œ ì˜¤ê²½ë³´ ì¦ê°€) â†’ â€œì•…ì„±(malignant)ì„ benignìœ¼ë¡œ ë†“ì¹˜ë©´ ì•ˆ ëœë‹¤â€ ê°™ì€ ì •ì±…ì´ë¼ë©´(ì˜¤ê²½ë³´ ë¹„ìš©ë³´ë‹¤ ë†“ì¹¨ ë¹„ìš©ì´ í° ê²½ìš°) ì´ ë°©ì‹ì´ ìì—°ìŠ¤ëŸ½ë‹¤.</p>
<p><strong>(C) ë¹„ìš© ê¸°ë°˜:</strong> $C_{FN}=10, C_{FP}=1 $ â†’ tâ‰ˆ0.7527</p>
<p>tn=49, fp=4, fn=0, tp=90, cost=4</p>
<p>FN(benignì„ ì•…ì„±ìœ¼ë¡œ ì˜¤ê²½ë³´)ì„ 10ë°°ë¡œ ë²Œì  ì£¼ì—ˆê¸° ë•Œë¬¸ì—, FN=0ì„ ìœ ì§€í•˜ë ¤ê³  tê°€ ìƒëŒ€ì ìœ¼ë¡œ ë‚®ê²Œ ì„ íƒëœë‹¤. ê·¸ ëŒ€ê°€ë¡œ FP=4ë¥¼ í—ˆìš©í•œë‹¤. â†’ ì´ ê²°ê³¼ëŠ” â€œì–‘ì„±(benign)ì„ ì•…ì„±ìœ¼ë¡œ ì˜¤ê²½ë³´ ë‚´ëŠ” ê²Œ ë§¤ìš° ë¹„ì‹¸ë‹¤â€ëŠ” ìš´ì˜ ê°€ì •ì— ë§ì¶˜ ì„ê³„ê°’ì…ë‹ˆë‹¤.</p>
<p>[k-NN] ROC AUC = 0.9947589098532496 <br> [k-NN] PR AP = 0.9968371869230795 <br> ROC thresholds: (11,) | PR thresholds: (52,) {â€˜tâ€™: 0.1, â€˜tnâ€™: 43, â€˜fpâ€™: 10, â€˜fnâ€™: 0, â€˜tpâ€™: 90, â€˜recall(tpr)â€™: 1.0, â€˜fprâ€™: 0.18867924528301888, â€˜precisionâ€™: 0.9, â€˜accuracyâ€™: 0.9300699300699301} <br> (ì¤‘ê°„ìƒëµ) <br> {â€˜tâ€™: 0.9, â€˜tnâ€™: 53, â€˜fpâ€™: 0, â€˜fnâ€™: 18, â€˜tpâ€™: 72, â€˜recall(tpr)â€™: 0.8, â€˜fprâ€™: 0.0, â€˜precisionâ€™: 1.0, â€˜accuracyâ€™: 0.8741258741258742}</p>
<p>[Youden J] <br> best t = 0.5952751094038484 <br> {â€˜tâ€™: 0.5952751094038484, â€˜tnâ€™: 51, â€˜fpâ€™: 2, â€˜fnâ€™: 2, â€˜tpâ€™: 88, â€˜recall(tpr)â€™: 0.9777777777777777, â€˜fprâ€™: 0.03773584905660377, â€˜precisionâ€™: 0.9777777777777777, â€˜accuracyâ€™: 0.972027972027972}</p>
<p>[FPR constraint] <br> alpha = 0.02 best t = 0.7527356507381722 <br> {â€˜tâ€™: 0.7527356507381722, â€˜tnâ€™: 53, â€˜fpâ€™: 0, â€˜fnâ€™: 11, â€˜tpâ€™: 79, â€˜recall(tpr)â€™: 0.8777777777777778, â€˜fprâ€™: 0.0, â€˜precisionâ€™: 1.0, â€˜accuracyâ€™: 0.9230769230769231}</p>
<p>[Cost-based] <br> best t = 0.5563197878398277 cost = 4.0 <br> {â€˜tâ€™: 0.5563197878398277, â€˜tnâ€™: 49, â€˜fpâ€™: 4, â€˜fnâ€™: 0, â€˜tpâ€™: 90, â€˜recall(tpr)â€™: 1.0, â€˜fprâ€™: 0.07547169811320754, â€˜precisionâ€™: 0.9574468085106383, â€˜accuracyâ€™: 0.972027972027972}</p>
</section>
<section id="svm" class="level5">
<h5 class="anchored" data-anchor-id="svm">(4) SVM</h5>
<p>ì´ ì½”ë“œëŠ” Breast Cancer Wisconsin ë°ì´í„°ì— ëŒ€í•´ SVM(ì„œí¬íŠ¸ ë²¡í„° ë¨¸ì‹ ) ë¶„ë¥˜ê¸°ë¥¼ í•™ìŠµí•˜ê³ , í…ŒìŠ¤íŠ¸ ë°ì´í„°ì—ì„œ ê¸°ë³¸ ë¶„ë¥˜ ì„±ëŠ¥(ì •í™•ë„Â·í˜¼ë™í–‰ë ¬Â·ë¶„ë¥˜ë¦¬í¬íŠ¸) ì„ í™•ì¸í•˜ëŠ” ì ˆì°¨ë¥¼ êµ¬í˜„í•œë‹¤.</p>
<p>íŠ¹íˆ SVMì€ ì…ë ¥ ë³€ìˆ˜ì˜ ìŠ¤ì¼€ì¼ì— ë¯¼ê°í•˜ë¯€ë¡œ, í‘œì¤€í™”(Standardization) ì™€ ëª¨ë¸ì„ Pipelineìœ¼ë¡œ ë¬¶ì–´ ì „ì²˜ë¦¬ì™€ í•™ìŠµÂ·ì˜ˆì¸¡ ê³¼ì •ì„ í•œ ë²ˆì— ì²˜ë¦¬í•˜ë„ë¡ êµ¬ì„±í•˜ì˜€ë‹¤.</p>
<p>ë¨¼ì € Pipeline([(â€œscalerâ€, StandardScaler()), (â€œsvmâ€, SVC(â€¦))]) í˜•íƒœë¡œ íŒŒì´í”„ë¼ì¸ì„ ì •ì˜í•œë‹¤. ì—¬ê¸°ì„œ StandardScaler()ëŠ” í›ˆë ¨ ë°ì´í„°ì—ì„œ ê° ë³€ìˆ˜ì˜ í‰ê· ê³¼ í‘œì¤€í¸ì°¨ë¥¼ ì¶”ì •í•œ ë’¤, ëª¨ë“  ë³€ìˆ˜ë¥¼ ì •ê·œ ë³€í™˜í•˜ì—¬ í‰ê·  0, ë¶„ì‚° 1 ìˆ˜ì¤€ìœ¼ë¡œ ë§ì¶˜ë‹¤.</p>
<p>SVMì€ ê±°ë¦¬Â·ë‚´ì  ê¸°ë°˜(íŠ¹íˆ RBF ì»¤ë„ì€ ê±°ë¦¬ ê¸°ë°˜)ì˜ ë¶„ë¥˜ê¸°ì´ë¯€ë¡œ ë³€ìˆ˜ ìŠ¤ì¼€ì¼ì´ ë‹¤ë¥´ë©´ íŠ¹ì • ë³€ìˆ˜ì˜ ì˜í–¥ì´ ê³¼ë„í•´ì§ˆ ìˆ˜ ìˆëŠ”ë°, í‘œì¤€í™”ëŠ” ì´ë¥¼ ë°©ì§€í•˜ì—¬ í•™ìŠµì„ ì•ˆì •í™”í•œë‹¤. ë˜í•œ Pipelineì„ ì‚¬ìš©í•˜ë©´ í‘œì¤€í™”ì˜ fitì€ í›ˆë ¨ ë°ì´í„°ì—ë§Œ ì ìš©ë˜ê³  í…ŒìŠ¤íŠ¸ ë°ì´í„°ì—ëŠ” ê°™ì€ ë³€í™˜ì´ transformìœ¼ë¡œë§Œ ì ìš©ë˜ì–´, í…ŒìŠ¤íŠ¸ ì •ë³´ê°€ í•™ìŠµì— ì„ì´ëŠ” ë°ì´í„° ëˆ„ìˆ˜(leakage) ë¥¼ ë§‰ëŠ”ë‹¤.</p>
<p>ë‘ ë²ˆì§¸ ë‹¨ê³„ì¸ SVC(â€¦)ëŠ” SVM ë¶„ë¥˜ê¸°ë¥¼ ì˜ë¯¸í•œë‹¤. ì—¬ê¸°ì„œ kernel=â€œrbfâ€ëŠ” ë¹„ì„ í˜• ë¶„ë¥˜ë¥¼ ê°€ëŠ¥í•˜ê²Œ í•˜ëŠ” ê°€ìš°ì‹œì•ˆ(RBF) ì»¤ë„ì„ ì‚¬ìš©í•œë‹¤ëŠ” ëœ»ì´ë©°, ì…ë ¥ê³µê°„ì—ì„œ ì„ í˜• ë¶„ë¦¬ê°€ ì–´ë µë”ë¼ë„ ê³ ì°¨ì› íŠ¹ì§•ê³µê°„ì—ì„œì˜ ë¶„ë¦¬ ì´ˆí‰ë©´ì„ í†µí•´ ë³µì¡í•œ ê²°ì •ê²½ê³„ë¥¼ í•™ìŠµí•  ìˆ˜ ìˆë‹¤.</p>
<p>C=1.0ì€ ë§ˆì§„ì„ ë„“ê²Œ ìœ ì§€í•˜ë ¤ëŠ” ì„±í–¥ê³¼ í•™ìŠµ ë°ì´í„° ì˜¤ë¶„ë¥˜ë¥¼ ì¤„ì´ë ¤ëŠ” ì„±í–¥ ì‚¬ì´ì˜ ê· í˜•ì„ ì¡°ì ˆí•˜ëŠ” ê·œì œ(regularization) íŒŒë¼ë¯¸í„°ë¡œ, Cê°€ ì»¤ì§€ë©´ ì˜¤ë¶„ë¥˜ë¥¼ ë” ê°•í•˜ê²Œ ë²Œì  ì£¼ì–´ í›ˆë ¨ ë°ì´í„°ì— ë” ë§ì¶”ë ¤ í•˜ê³ , ì‘ì•„ì§€ë©´ ë§ˆì§„ì„ ë„“ê²Œ ë‘ë©° ì¼ë°˜í™”ë¥¼ ë” ì¤‘ì‹œí•˜ëŠ” ê²½í–¥ì´ ìˆë‹¤.</p>
<p>gamma=â€œscaleâ€ì€ RBF ì»¤ë„ì˜ í­(ì˜í–¥ ë²”ìœ„)ì„ ìë™ìœ¼ë¡œ ì„¤ì •í•˜ëŠ” ì˜µì…˜ìœ¼ë¡œ, ê°’ì´ ì»¤ì§€ë©´ ê²°ì •ê²½ê³„ê°€ ë” êµ¬ë¶ˆêµ¬ë¶ˆí•´ì ¸ ê³¼ì í•© ìœ„í—˜ì´ ì»¤ì§€ê³ , ì‘ì•„ì§€ë©´ ë” ë§¤ëˆí•œ ê²½ê³„ê°€ ëœë‹¤. probability=TrueëŠ” SVMì´ ê¸°ë³¸ì ìœ¼ë¡œëŠ” â€œí™•ë¥ â€ì´ ì•„ë‹ˆë¼ ê²°ì •í•¨ìˆ˜ ê°’(decision score) ì„ ì¶œë ¥í•˜ëŠ” ëª¨ë¸ì´ê¸° ë•Œë¬¸ì—, ROC/PR ê³¡ì„  ë° ì„ê³„ê°’ ì¡°ì •ì„ ìœ„í•´ í™•ë¥  í˜•íƒœì˜ ì¶œë ¥(predict_proba) ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ë‚´ë¶€ì ìœ¼ë¡œ í™•ë¥  ë³´ì •(calibration)ì„ ìˆ˜í–‰í•˜ê² ë‹¤ëŠ” ì„¤ì •ì´ë‹¤.</p>
<p>random_state=42ëŠ” í™•ë¥  ë³´ì • ê³¼ì • ë“±ì—ì„œ ì¬í˜„ì„±ì„ í™•ë³´í•˜ê¸° ìœ„í•œ ë‚œìˆ˜ ì‹œë“œë¡œ ì´í•´í•˜ë©´ ëœë‹¤.</p>
<p>ëª¨ë¸ í•™ìŠµì€ svm_model.fit(X_train, y_train)ì—ì„œ ì´ë£¨ì–´ì§„ë‹¤. ì´ë•Œ íŒŒì´í”„ë¼ì¸ì´ ë¨¼ì € í›ˆë ¨ ë°ì´í„°ë¥¼ í‘œì¤€í™”í•œ ë’¤, í‘œì¤€í™”ëœ ì…ë ¥ìœ¼ë¡œ SVMì„ í•™ìŠµí•œë‹¤. í•™ìŠµì´ ëë‚˜ë©´ svm_model.predict(X_test)ë¡œ í…ŒìŠ¤íŠ¸ ë°ì´í„°ì˜ í´ë˜ìŠ¤ ë¼ë²¨(0/1)ì„ ì˜ˆì¸¡í•œë‹¤.</p>
<p>ë§ˆì§€ë§‰ìœ¼ë¡œ accuracy_scoreëŠ” ì „ì²´ ì •í™•ë„ë¥¼ ê³„ì‚°í•˜ê³ , confusion_matrixëŠ” ì‹¤ì œ ë¼ë²¨ê³¼ ì˜ˆì¸¡ ë¼ë²¨ì„ êµì°¨ ì§‘ê³„í•˜ì—¬ TN, FP, FN, TPì˜ êµ¬ì¡°ë¥¼ ì œê³µí•œë‹¤. classification_reportëŠ” í´ë˜ìŠ¤ë³„ë¡œ precision, recall, F1-scoreë¥¼ ìš”ì•½í•´ì£¼ë¯€ë¡œ, ë‹¨ìˆœ ì •í™•ë„ë¿ ì•„ë‹ˆë¼ â€œì•…ì„±ì„ ì–¼ë§ˆë‚˜ ë†“ì¹˜ëŠ”ì§€(FN)â€ ë˜ëŠ” â€œì–‘ì„±ì„ ì–¼ë§ˆë‚˜ ì•…ì„±ìœ¼ë¡œ ì˜¤ê²½ë³´í•˜ëŠ”ì§€(FP)â€ì™€ ê°™ì€ ì˜¤ë¥˜ ìœ í˜•ì„ ë” ì„¸ë°€í•˜ê²Œ í•´ì„í•  ìˆ˜ ìˆê²Œ í•œë‹¤.</p>
<p>ìš”ì•½í•˜ë©´, ì´ ì½”ë“œëŠ” (í‘œì¤€í™” â†’ RBF SVM í•™ìŠµ â†’ í…ŒìŠ¤íŠ¸ ì˜ˆì¸¡ â†’ ê¸°ë³¸ ì„±ëŠ¥ í‰ê°€) ì˜ ì „í˜•ì ì¸ ì´ì§„ë¶„ë¥˜ ì‹¤ìŠµ íë¦„ì„ íŒŒì´í”„ë¼ì¸ í˜•íƒœë¡œ ê¹”ë”í•˜ê²Œ êµ¬í˜„í•œ ì˜ˆì œì´ë©°, ì´í›„ ROC/PR ë¶„ì„ ë° ì„ê³„ê°’ ì„ íƒìœ¼ë¡œ ìì—°ìŠ¤ëŸ½ê²Œ í™•ì¥í•  ìˆ˜ ìˆëŠ” ê¸°ë³¸ ê³¨ê²©ì„ ì œê³µí•œë‹¤.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> Pipeline</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.svm <span class="im">import</span> SVC</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score, confusion_matrix, classification_report</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co"># SVM ëª¨ë¸ (í‘œì¤€í™” + SVM)</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>svm_model <span class="op">=</span> Pipeline([</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"scaler"</span>, StandardScaler()),</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"svm"</span>, SVC(</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>        kernel<span class="op">=</span><span class="st">"rbf"</span>,        <span class="co"># 'linear', 'rbf' ë“±</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>        C<span class="op">=</span><span class="fl">1.0</span>,</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>        gamma<span class="op">=</span><span class="st">"scale"</span>,</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>        probability<span class="op">=</span><span class="va">True</span>,    <span class="co"># ROC/PRìš© í™•ë¥  í•„ìš”</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>        random_state<span class="op">=</span><span class="dv">42</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="co"># í•™ìŠµ</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>svm_model.fit(X_train, y_train)</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="co"># ì˜ˆì¸¡(í´ë˜ìŠ¤)</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>y_pred_svm <span class="op">=</span> svm_model.predict(X_test)</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a><span class="co"># í‰ê°€(ê¸°ë³¸)</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"[SVM] Accuracy:"</span>, accuracy_score(y_test, y_pred_svm))</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"[SVM] Confusion matrix:</span><span class="ch">\n</span><span class="st">"</span>, confusion_matrix(y_test, y_pred_svm))</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"[SVM] Classification report:</span><span class="ch">\n</span><span class="st">"</span>, classification_report(y_test, y_pred_svm, target_names<span class="op">=</span>data.target_names))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre class="text"><code>[SVM] Accuracy: 0.9790209790209791
[SVM] Confusion matrix:
 [[52  1]
 [ 2 88]]
[SVM] Classification report:
               precision    recall  f1-score   support

   malignant       0.96      0.98      0.97        53
      benign       0.99      0.98      0.98        90

    accuracy                           0.98       143
   macro avg       0.98      0.98      0.98       143
weighted avg       0.98      0.98      0.98       143</code></pre>
<div class="sourceCode" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================================================</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co"># SVM ì„ê³„ê°’(Threshold) ê²°ì • íŒŒíŠ¸</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   - ì§€í‘œ í•¨ìˆ˜(metrics_at_threshold)</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   - Youden J ìµœì </span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   - FPR &lt;= alpha ì œì•½ ìµœì </span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   - ë¹„ìš© ê¸°ë°˜(c_fn*FN + c_fp*FP) ìµœì </span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co"># (ì „ì œ) svm_model.fit(...) ì™„ë£Œ, X_test, y_test ì¡´ì¬</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================================================</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> confusion_matrix, roc_curve</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 0) Positive(ê´€ì‹¬ í´ë˜ìŠ¤) ì •ì˜</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="co">#   - ê¸°ë³¸: positive = 1 (benign)  [ì› ë¼ë²¨ ê·¸ëŒ€ë¡œ]</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="co">#   - ì˜ë£Œì§„ë‹¨ ê´€ì : positive = malignant(0)ë¡œ ë°”ê¾¸ë ¤ë©´ ì˜µì…˜ B ì‚¬ìš©</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="co"># SVM í™•ë¥ (score): P(y=1 | x)</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>p_pos1_svm <span class="op">=</span> svm_model.predict_proba(X_test)[:, <span class="dv">1</span>]</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="co"># A) positive = 1(benign)</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>y_pos <span class="op">=</span> y_test</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>score <span class="op">=</span> p_pos1_svm</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a><span class="co"># B) (ì˜µì…˜) positive = malignant(0)ë¡œ ë³€ê²½ ì‹œ (ì•…ì„±ì„ 1ë¡œ ì¬ì½”ë”©)</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a><span class="co"># y_pos = (y_test == 0).astype(int)</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a><span class="co"># score = 1.0 - p_pos1_svm   # = P(malignant | x)</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------</span></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) ì„ê³„ê°’ tì—ì„œ í˜¼ë™í–‰ë ¬/ì§€í‘œ ê³„ì‚°</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------</span></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> metrics_at_threshold(y_true01, score, t):</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a><span class="co">    y_true01: {0,1} (1ì´ positive)</span></span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a><span class="co">    score   : positive ì ìˆ˜(í™•ë¥ )</span></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a><span class="co">    t       : threshold</span></span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>    y_hat <span class="op">=</span> (score <span class="op">&gt;=</span> t).astype(<span class="bu">int</span>)</span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>    tn, fp, fn, tp <span class="op">=</span> confusion_matrix(y_true01, y_hat).ravel()</span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>    recall_ <span class="op">=</span> tp <span class="op">/</span> (tp <span class="op">+</span> fn) <span class="cf">if</span> (tp <span class="op">+</span> fn) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="fl">0.0</span>  <span class="co"># TPR</span></span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>    fpr_    <span class="op">=</span> fp <span class="op">/</span> (fp <span class="op">+</span> tn) <span class="cf">if</span> (fp <span class="op">+</span> tn) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="fl">0.0</span></span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>    prec_   <span class="op">=</span> tp <span class="op">/</span> (tp <span class="op">+</span> fp) <span class="cf">if</span> (tp <span class="op">+</span> fp) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="fl">0.0</span></span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>    acc_    <span class="op">=</span> (tp <span class="op">+</span> tn) <span class="op">/</span> (tp <span class="op">+</span> tn <span class="op">+</span> fp <span class="op">+</span> fn)</span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>        <span class="st">"t"</span>: <span class="bu">float</span>(t),</span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>        <span class="st">"tn"</span>: <span class="bu">int</span>(tn), <span class="st">"fp"</span>: <span class="bu">int</span>(fp), <span class="st">"fn"</span>: <span class="bu">int</span>(fn), <span class="st">"tp"</span>: <span class="bu">int</span>(tp),</span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>        <span class="st">"recall(tpr)"</span>: <span class="bu">float</span>(recall_),</span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>        <span class="st">"fpr"</span>: <span class="bu">float</span>(fpr_),</span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>        <span class="st">"precision"</span>: <span class="bu">float</span>(prec_),</span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a>        <span class="st">"accuracy"</span>: <span class="bu">float</span>(acc_)</span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"[Default t=0.5]"</span>)</span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(metrics_at_threshold(y_pos, score, <span class="fl">0.5</span>))</span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a><span class="co"># (ì„ íƒ) ì„ê³„ê°’ ë³€í™” ê° í™•ì¸</span></span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">[Grid check]"</span>)</span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> t <span class="kw">in</span> np.arange(<span class="fl">0.1</span>, <span class="fl">1.0</span>, <span class="fl">0.1</span>):</span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(metrics_at_threshold(y_pos, score, t))</span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------</span></span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) (A) Youden's J = TPR - FPR ìµœëŒ€í™”</span></span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------</span></span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a>fpr, tpr, thr_roc <span class="op">=</span> roc_curve(y_pos, score)</span>
<span id="cb10-68"><a href="#cb10-68" aria-hidden="true" tabindex="-1"></a>J <span class="op">=</span> tpr <span class="op">-</span> fpr</span>
<span id="cb10-69"><a href="#cb10-69" aria-hidden="true" tabindex="-1"></a>best_t_youden <span class="op">=</span> <span class="bu">float</span>(thr_roc[np.argmax(J)])</span>
<span id="cb10-70"><a href="#cb10-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-71"><a href="#cb10-71" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">[Youden J]"</span>)</span>
<span id="cb10-72"><a href="#cb10-72" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"best t ="</span>, best_t_youden)</span>
<span id="cb10-73"><a href="#cb10-73" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(metrics_at_threshold(y_pos, score, best_t_youden))</span>
<span id="cb10-74"><a href="#cb10-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-75"><a href="#cb10-75" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------</span></span>
<span id="cb10-76"><a href="#cb10-76" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) (B) FPR &lt;= alpha ì œì•½ì—ì„œ TPR ìµœëŒ€í™”</span></span>
<span id="cb10-77"><a href="#cb10-77" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------</span></span>
<span id="cb10-78"><a href="#cb10-78" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> best_threshold_fpr_constraint(y_true01, score, alpha<span class="op">=</span><span class="fl">0.02</span>):</span>
<span id="cb10-79"><a href="#cb10-79" aria-hidden="true" tabindex="-1"></a>    fpr, tpr, thr <span class="op">=</span> roc_curve(y_true01, score)</span>
<span id="cb10-80"><a href="#cb10-80" aria-hidden="true" tabindex="-1"></a>    candidates <span class="op">=</span> np.where(fpr <span class="op">&lt;=</span> alpha)[<span class="dv">0</span>]</span>
<span id="cb10-81"><a href="#cb10-81" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(candidates) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb10-82"><a href="#cb10-82" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb10-83"><a href="#cb10-83" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> candidates[np.argmax(tpr[candidates])]</span>
<span id="cb10-84"><a href="#cb10-84" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">float</span>(thr[i])</span>
<span id="cb10-85"><a href="#cb10-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-86"><a href="#cb10-86" aria-hidden="true" tabindex="-1"></a>alpha <span class="op">=</span> <span class="fl">0.02</span></span>
<span id="cb10-87"><a href="#cb10-87" aria-hidden="true" tabindex="-1"></a>best_t_fpr <span class="op">=</span> best_threshold_fpr_constraint(y_pos, score, alpha<span class="op">=</span>alpha)</span>
<span id="cb10-88"><a href="#cb10-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-89"><a href="#cb10-89" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">[FPR constraint]"</span>)</span>
<span id="cb10-90"><a href="#cb10-90" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"alpha ="</span>, alpha, <span class="st">"best t ="</span>, best_t_fpr)</span>
<span id="cb10-91"><a href="#cb10-91" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> best_t_fpr <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb10-92"><a href="#cb10-92" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(metrics_at_threshold(y_pos, score, best_t_fpr))</span>
<span id="cb10-93"><a href="#cb10-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-94"><a href="#cb10-94" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------</span></span>
<span id="cb10-95"><a href="#cb10-95" aria-hidden="true" tabindex="-1"></a><span class="co"># 4) (C) ë¹„ìš© ê¸°ë°˜: cost = c_fn*FN + c_fp*FP ìµœì†Œí™”</span></span>
<span id="cb10-96"><a href="#cb10-96" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------</span></span>
<span id="cb10-97"><a href="#cb10-97" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> best_threshold_cost(y_true01, score, c_fn<span class="op">=</span><span class="fl">10.0</span>, c_fp<span class="op">=</span><span class="fl">1.0</span>):</span>
<span id="cb10-98"><a href="#cb10-98" aria-hidden="true" tabindex="-1"></a>    thresholds <span class="op">=</span> np.unique(np.r_[<span class="fl">0.0</span>, score, <span class="fl">1.0</span>])</span>
<span id="cb10-99"><a href="#cb10-99" aria-hidden="true" tabindex="-1"></a>    best_t, best_m, best_cost <span class="op">=</span> <span class="va">None</span>, <span class="va">None</span>, np.inf</span>
<span id="cb10-100"><a href="#cb10-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-101"><a href="#cb10-101" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> t <span class="kw">in</span> thresholds:</span>
<span id="cb10-102"><a href="#cb10-102" aria-hidden="true" tabindex="-1"></a>        m <span class="op">=</span> metrics_at_threshold(y_true01, score, t)</span>
<span id="cb10-103"><a href="#cb10-103" aria-hidden="true" tabindex="-1"></a>        cost <span class="op">=</span> c_fn <span class="op">*</span> m[<span class="st">"fn"</span>] <span class="op">+</span> c_fp <span class="op">*</span> m[<span class="st">"fp"</span>]</span>
<span id="cb10-104"><a href="#cb10-104" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> cost <span class="op">&lt;</span> best_cost:</span>
<span id="cb10-105"><a href="#cb10-105" aria-hidden="true" tabindex="-1"></a>            best_t, best_m, best_cost <span class="op">=</span> <span class="bu">float</span>(t), m, <span class="bu">float</span>(cost)</span>
<span id="cb10-106"><a href="#cb10-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-107"><a href="#cb10-107" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> best_t, best_m, best_cost</span>
<span id="cb10-108"><a href="#cb10-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-109"><a href="#cb10-109" aria-hidden="true" tabindex="-1"></a>best_t_cost, best_m_cost, best_cost_val <span class="op">=</span> best_threshold_cost(</span>
<span id="cb10-110"><a href="#cb10-110" aria-hidden="true" tabindex="-1"></a>    y_pos, score, c_fn<span class="op">=</span><span class="dv">10</span>, c_fp<span class="op">=</span><span class="dv">1</span></span>
<span id="cb10-111"><a href="#cb10-111" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-112"><a href="#cb10-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-113"><a href="#cb10-113" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">[Cost-based]"</span>)</span>
<span id="cb10-114"><a href="#cb10-114" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"best t ="</span>, best_t_cost, <span class="st">"cost ="</span>, best_cost_val)</span>
<span id="cb10-115"><a href="#cb10-115" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(best_m_cost)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>[Default t=0.5] {â€˜tâ€™: 0.5, â€˜tnâ€™: 52, â€˜fpâ€™: 1, â€˜fnâ€™: 2, â€˜tpâ€™: 88, â€˜recall(tpr)â€™: 0.9777777777777777, â€˜fprâ€™: 0.018867924528301886, â€˜precisionâ€™: 0.9887640449438202, â€˜accuracyâ€™: 0.9790209790209791}</p>
<p>[Grid check] {â€˜tâ€™: 0.1, â€˜tnâ€™: 44, â€˜fpâ€™: 9, â€˜fnâ€™: 0, â€˜tpâ€™: 90, â€˜recall(tpr)â€™: 1.0, â€˜fprâ€™: 0.16981132075471697, â€˜precisionâ€™: 0.9090909090909091, â€˜accuracyâ€™: 0.9370629370629371}</p>
<p>(ì´í•˜ ìƒëµ)</p>
<p>[Youden J] best t = 0.4325023552646032</p>
<p>{â€˜tâ€™: 0.4325023552646032, â€˜tnâ€™: 52, â€˜fpâ€™: 1, â€˜fnâ€™: 1, â€˜tpâ€™: 89, â€˜recall(tpr)â€™: 0.9888888888888889, â€˜fprâ€™: 0.018867924528301886, â€˜precisionâ€™: 0.9888888888888889, â€˜accuracyâ€™: 0.986013986013986}</p>
<p>[FPR constraint] alpha = 0.02 best t = 0.4325023552646032</p>
<p>{â€˜tâ€™: 0.4325023552646032, â€˜tnâ€™: 52, â€˜fpâ€™: 1, â€˜fnâ€™: 1, â€˜tpâ€™: 89, â€˜recall(tpr)â€™: 0.9888888888888889, â€˜fprâ€™: 0.018867924528301886, â€˜precisionâ€™: 0.9888888888888889, â€˜accuracyâ€™: 0.986013986013986}</p>
<p>[Cost-based] best t = 0.2980459103264749 cost = 3.0</p>
<p>{â€˜tâ€™: 0.2980459103264749, â€˜tnâ€™: 50, â€˜fpâ€™: 3, â€˜fnâ€™: 0, â€˜tpâ€™: 90, â€˜recall(tpr)â€™: 1.0, â€˜fprâ€™: 0.05660377358490566, â€˜precisionâ€™: 0.967741935483871, â€˜accuracyâ€™: 0.9790209790209791}</p>
</section>
<section id="knn-vs.svm-ë¹„êµ" class="level5">
<h5 class="anchored" data-anchor-id="knn-vs.svm-ë¹„êµ">(5) knn vs.SVM ë¹„êµ</h5>
<div class="sourceCode" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> roc_curve, confusion_matrix</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================================================</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) ì•…ì„±=positive(1)ë¡œ ì¬ì½”ë”© + ëª¨ë¸ score(ì•…ì„± í™•ë¥ ) ì¶”ì¶œ</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================================================</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_score_for_class(model, X, class_label):</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""predict_proba ê¸°ë°˜ìœ¼ë¡œ íŠ¹ì • class_labelì˜ í™•ë¥ ì„ ë°˜í™˜ (Pipeline í¬í•¨)."""</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">hasattr</span>(model, <span class="st">"predict_proba"</span>):</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"This model has no predict_proba. (SVCëŠ” probability=True í•„ìš”)"</span>)</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    proba <span class="op">=</span> model.predict_proba(X)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Pipelineì¸ ê²½ìš° classes_ ì ‘ê·¼ì„ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    classes <span class="op">=</span> <span class="bu">getattr</span>(model, <span class="st">"classes_"</span>, <span class="va">None</span>)</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> classes <span class="kw">is</span> <span class="va">None</span> <span class="kw">and</span> <span class="bu">hasattr</span>(model, <span class="st">"named_steps"</span>):</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>        classes <span class="op">=</span> <span class="bu">list</span>(model.named_steps.values())[<span class="op">-</span><span class="dv">1</span>].classes_</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    classes <span class="op">=</span> np.array(classes)</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    idx <span class="op">=</span> np.where(classes <span class="op">==</span> class_label)[<span class="dv">0</span>][<span class="dv">0</span>]</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> proba[:, idx]</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a><span class="co"># ì•…ì„±(malignant=0)ì„ positive=1ë¡œ ë‘ê¸°</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>y_pos <span class="op">=</span> (y_test <span class="op">==</span> <span class="dv">0</span>).astype(<span class="bu">int</span>)  <span class="co"># 1ì´ë©´ malignant</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a><span class="co"># ê° ëª¨ë¸ì˜ "ì•…ì„± í™•ë¥ " score</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>score_knn <span class="op">=</span> get_score_for_class(knn_model, X_test, class_label<span class="op">=</span><span class="dv">0</span>)  <span class="co"># P(malignant|x)</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>score_svm <span class="op">=</span> get_score_for_class(svm_model, X_test, class_label<span class="op">=</span><span class="dv">0</span>)  <span class="co"># P(malignant|x)</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================================================</span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) ì„ê³„ê°’ tì—ì„œ ì§€í‘œ ê³„ì‚°</span></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================================================</span></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> metrics_at_threshold(y_true01, score, t):</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>    y_hat <span class="op">=</span> (score <span class="op">&gt;=</span> t).astype(<span class="bu">int</span>)</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>    tn, fp, fn, tp <span class="op">=</span> confusion_matrix(y_true01, y_hat).ravel()</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>    recall_ <span class="op">=</span> tp <span class="op">/</span> (tp <span class="op">+</span> fn) <span class="cf">if</span> (tp <span class="op">+</span> fn) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="fl">0.0</span>  <span class="co"># TPR</span></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>    fpr_    <span class="op">=</span> fp <span class="op">/</span> (fp <span class="op">+</span> tn) <span class="cf">if</span> (fp <span class="op">+</span> tn) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="fl">0.0</span></span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>    prec_   <span class="op">=</span> tp <span class="op">/</span> (tp <span class="op">+</span> fp) <span class="cf">if</span> (tp <span class="op">+</span> fp) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="fl">0.0</span></span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>    acc_    <span class="op">=</span> (tp <span class="op">+</span> tn) <span class="op">/</span> (tp <span class="op">+</span> tn <span class="op">+</span> fp <span class="op">+</span> fn)</span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>        <span class="st">"t"</span>: <span class="bu">float</span>(t),</span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>        <span class="st">"tn"</span>: <span class="bu">int</span>(tn), <span class="st">"fp"</span>: <span class="bu">int</span>(fp), <span class="st">"fn"</span>: <span class="bu">int</span>(fn), <span class="st">"tp"</span>: <span class="bu">int</span>(tp),</span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>        <span class="st">"recall(tpr)"</span>: <span class="bu">float</span>(recall_),</span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>        <span class="st">"fpr"</span>: <span class="bu">float</span>(fpr_),</span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>        <span class="st">"precision"</span>: <span class="bu">float</span>(prec_),</span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a>        <span class="st">"accuracy"</span>: <span class="bu">float</span>(acc_)</span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================================================</span></span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) ì„ê³„ê°’ ì„ íƒ ê·œì¹™ 3ì¢…</span></span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================================================</span></span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> threshold_youden(y_true01, score):</span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a>    fpr, tpr, thr <span class="op">=</span> roc_curve(y_true01, score)</span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a>    J <span class="op">=</span> tpr <span class="op">-</span> fpr</span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">float</span>(thr[np.argmax(J)])</span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> threshold_fpr_constraint(y_true01, score, alpha<span class="op">=</span><span class="fl">0.02</span>):</span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a>    fpr, tpr, thr <span class="op">=</span> roc_curve(y_true01, score)</span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a>    cand <span class="op">=</span> np.where(fpr <span class="op">&lt;=</span> alpha)[<span class="dv">0</span>]</span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(cand) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb11-63"><a href="#cb11-63" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb11-64"><a href="#cb11-64" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> cand[np.argmax(tpr[cand])]</span>
<span id="cb11-65"><a href="#cb11-65" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">float</span>(thr[i])</span>
<span id="cb11-66"><a href="#cb11-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-67"><a href="#cb11-67" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> threshold_cost(y_true01, score, c_fn<span class="op">=</span><span class="fl">10.0</span>, c_fp<span class="op">=</span><span class="fl">1.0</span>):</span>
<span id="cb11-68"><a href="#cb11-68" aria-hidden="true" tabindex="-1"></a>    thresholds <span class="op">=</span> np.unique(np.r_[<span class="fl">0.0</span>, score, <span class="fl">1.0</span>])</span>
<span id="cb11-69"><a href="#cb11-69" aria-hidden="true" tabindex="-1"></a>    best_t, best_cost <span class="op">=</span> <span class="va">None</span>, np.inf</span>
<span id="cb11-70"><a href="#cb11-70" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> t <span class="kw">in</span> thresholds:</span>
<span id="cb11-71"><a href="#cb11-71" aria-hidden="true" tabindex="-1"></a>        m <span class="op">=</span> metrics_at_threshold(y_true01, score, t)</span>
<span id="cb11-72"><a href="#cb11-72" aria-hidden="true" tabindex="-1"></a>        cost <span class="op">=</span> c_fn <span class="op">*</span> m[<span class="st">"fn"</span>] <span class="op">+</span> c_fp <span class="op">*</span> m[<span class="st">"fp"</span>]</span>
<span id="cb11-73"><a href="#cb11-73" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> cost <span class="op">&lt;</span> best_cost:</span>
<span id="cb11-74"><a href="#cb11-74" aria-hidden="true" tabindex="-1"></a>            best_cost <span class="op">=</span> cost</span>
<span id="cb11-75"><a href="#cb11-75" aria-hidden="true" tabindex="-1"></a>            best_t <span class="op">=</span> <span class="bu">float</span>(t)</span>
<span id="cb11-76"><a href="#cb11-76" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> best_t, <span class="bu">float</span>(best_cost)</span>
<span id="cb11-77"><a href="#cb11-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-78"><a href="#cb11-78" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================================================</span></span>
<span id="cb11-79"><a href="#cb11-79" aria-hidden="true" tabindex="-1"></a><span class="co"># 4) k-NN vs SVM ë¹„êµí‘œ ìƒì„±</span></span>
<span id="cb11-80"><a href="#cb11-80" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================================================</span></span>
<span id="cb11-81"><a href="#cb11-81" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> build_rows(model_name, y_true01, score, alpha<span class="op">=</span><span class="fl">0.02</span>, c_fn<span class="op">=</span><span class="fl">10.0</span>, c_fp<span class="op">=</span><span class="fl">1.0</span>):</span>
<span id="cb11-82"><a href="#cb11-82" aria-hidden="true" tabindex="-1"></a>    rows <span class="op">=</span> []</span>
<span id="cb11-83"><a href="#cb11-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-84"><a href="#cb11-84" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Youden</span></span>
<span id="cb11-85"><a href="#cb11-85" aria-hidden="true" tabindex="-1"></a>    t_y <span class="op">=</span> threshold_youden(y_true01, score)</span>
<span id="cb11-86"><a href="#cb11-86" aria-hidden="true" tabindex="-1"></a>    m_y <span class="op">=</span> metrics_at_threshold(y_true01, score, t_y)</span>
<span id="cb11-87"><a href="#cb11-87" aria-hidden="true" tabindex="-1"></a>    m_y.update({<span class="st">"model"</span>: model_name, <span class="st">"rule"</span>: <span class="st">"Youden (TPR-FPR)"</span>, <span class="st">"cost"</span>: c_fn<span class="op">*</span>m_y[<span class="st">"fn"</span>] <span class="op">+</span> c_fp<span class="op">*</span>m_y[<span class="st">"fp"</span>]})</span>
<span id="cb11-88"><a href="#cb11-88" aria-hidden="true" tabindex="-1"></a>    rows.append(m_y)</span>
<span id="cb11-89"><a href="#cb11-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-90"><a href="#cb11-90" aria-hidden="true" tabindex="-1"></a>    <span class="co"># FPR constraint</span></span>
<span id="cb11-91"><a href="#cb11-91" aria-hidden="true" tabindex="-1"></a>    t_f <span class="op">=</span> threshold_fpr_constraint(y_true01, score, alpha<span class="op">=</span>alpha)</span>
<span id="cb11-92"><a href="#cb11-92" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> t_f <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb11-93"><a href="#cb11-93" aria-hidden="true" tabindex="-1"></a>        m_f <span class="op">=</span> metrics_at_threshold(y_true01, score, t_f)</span>
<span id="cb11-94"><a href="#cb11-94" aria-hidden="true" tabindex="-1"></a>        m_f.update({<span class="st">"model"</span>: model_name, <span class="st">"rule"</span>: <span class="ss">f"FPR &lt;= </span><span class="sc">{</span>alpha<span class="sc">}</span><span class="ss">"</span>, <span class="st">"cost"</span>: c_fn<span class="op">*</span>m_f[<span class="st">"fn"</span>] <span class="op">+</span> c_fp<span class="op">*</span>m_f[<span class="st">"fp"</span>]})</span>
<span id="cb11-95"><a href="#cb11-95" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb11-96"><a href="#cb11-96" aria-hidden="true" tabindex="-1"></a>        m_f <span class="op">=</span> {<span class="st">"model"</span>: model_name, <span class="st">"rule"</span>: <span class="ss">f"FPR &lt;= </span><span class="sc">{</span>alpha<span class="sc">}</span><span class="ss">"</span>, <span class="st">"t"</span>: <span class="va">None</span>,</span>
<span id="cb11-97"><a href="#cb11-97" aria-hidden="true" tabindex="-1"></a>               <span class="st">"tn"</span>: <span class="va">None</span>, <span class="st">"fp"</span>: <span class="va">None</span>, <span class="st">"fn"</span>: <span class="va">None</span>, <span class="st">"tp"</span>: <span class="va">None</span>,</span>
<span id="cb11-98"><a href="#cb11-98" aria-hidden="true" tabindex="-1"></a>               <span class="st">"recall(tpr)"</span>: <span class="va">None</span>, <span class="st">"fpr"</span>: <span class="va">None</span>, <span class="st">"precision"</span>: <span class="va">None</span>, <span class="st">"accuracy"</span>: <span class="va">None</span>,</span>
<span id="cb11-99"><a href="#cb11-99" aria-hidden="true" tabindex="-1"></a>               <span class="st">"cost"</span>: <span class="va">None</span>}</span>
<span id="cb11-100"><a href="#cb11-100" aria-hidden="true" tabindex="-1"></a>    rows.append(m_f)</span>
<span id="cb11-101"><a href="#cb11-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-102"><a href="#cb11-102" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Cost-based</span></span>
<span id="cb11-103"><a href="#cb11-103" aria-hidden="true" tabindex="-1"></a>    t_c, best_cost <span class="op">=</span> threshold_cost(y_true01, score, c_fn<span class="op">=</span>c_fn, c_fp<span class="op">=</span>c_fp)</span>
<span id="cb11-104"><a href="#cb11-104" aria-hidden="true" tabindex="-1"></a>    m_c <span class="op">=</span> metrics_at_threshold(y_true01, score, t_c)</span>
<span id="cb11-105"><a href="#cb11-105" aria-hidden="true" tabindex="-1"></a>    m_c.update({<span class="st">"model"</span>: model_name, <span class="st">"rule"</span>: <span class="ss">f"Cost (c_fn=</span><span class="sc">{</span>c_fn<span class="sc">}</span><span class="ss">, c_fp=</span><span class="sc">{</span>c_fp<span class="sc">}</span><span class="ss">)"</span>, <span class="st">"cost"</span>: best_cost})</span>
<span id="cb11-106"><a href="#cb11-106" aria-hidden="true" tabindex="-1"></a>    rows.append(m_c)</span>
<span id="cb11-107"><a href="#cb11-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-108"><a href="#cb11-108" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> rows</span>
<span id="cb11-109"><a href="#cb11-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-110"><a href="#cb11-110" aria-hidden="true" tabindex="-1"></a>alpha <span class="op">=</span> <span class="fl">0.02</span></span>
<span id="cb11-111"><a href="#cb11-111" aria-hidden="true" tabindex="-1"></a>c_fn, c_fp <span class="op">=</span> <span class="fl">10.0</span>, <span class="fl">1.0</span></span>
<span id="cb11-112"><a href="#cb11-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-113"><a href="#cb11-113" aria-hidden="true" tabindex="-1"></a>rows <span class="op">=</span> []</span>
<span id="cb11-114"><a href="#cb11-114" aria-hidden="true" tabindex="-1"></a>rows <span class="op">+=</span> build_rows(<span class="st">"k-NN"</span>, y_pos, score_knn, alpha<span class="op">=</span>alpha, c_fn<span class="op">=</span>c_fn, c_fp<span class="op">=</span>c_fp)</span>
<span id="cb11-115"><a href="#cb11-115" aria-hidden="true" tabindex="-1"></a>rows <span class="op">+=</span> build_rows(<span class="st">"SVM"</span>,  y_pos, score_svm, alpha<span class="op">=</span>alpha, c_fn<span class="op">=</span>c_fn, c_fp<span class="op">=</span>c_fp)</span>
<span id="cb11-116"><a href="#cb11-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-117"><a href="#cb11-117" aria-hidden="true" tabindex="-1"></a>df_cmp <span class="op">=</span> pd.DataFrame(rows)[</span>
<span id="cb11-118"><a href="#cb11-118" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"model"</span>,<span class="st">"rule"</span>,<span class="st">"t"</span>,<span class="st">"tn"</span>,<span class="st">"fp"</span>,<span class="st">"fn"</span>,<span class="st">"tp"</span>,<span class="st">"recall(tpr)"</span>,<span class="st">"fpr"</span>,<span class="st">"precision"</span>,<span class="st">"accuracy"</span>,<span class="st">"cost"</span>]</span>
<span id="cb11-119"><a href="#cb11-119" aria-hidden="true" tabindex="-1"></a>].sort_values([<span class="st">"rule"</span>,<span class="st">"model"</span>]).reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb11-120"><a href="#cb11-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-121"><a href="#cb11-121" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"== ì•…ì„±(malignant=0)ì„ positive(=1)ë¡œ í†µì¼í•œ ì„ê³„ê°’ ë¹„êµí‘œ =="</span>)</span>
<span id="cb11-122"><a href="#cb11-122" aria-hidden="true" tabindex="-1"></a>display(df_cmp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>SVMì€ tâ‰ˆ0.593ì—ì„œ TN=89, FP=1, FN=1, TP=52ë¡œ ë‚˜íƒ€ë‚˜ë©°, ì´ëŠ” ì•…ì„± 53ê±´ ì¤‘ 52ê±´ì„ ì°¾ì•„ ì¬í˜„ìœ¨(Recall)=0.981ì„ ë‹¬ì„±í•˜ë©´ì„œë„, ì–‘ì„± 90ê±´ ì¤‘ ì˜¤ê²½ë³´ëŠ” 1ê±´ë¿ì´ë¼ FPR=0.011ë¡œ ë§¤ìš° ë‚®ë‹¤ëŠ” ëœ»ì´ë‹¤. ì •í™•ë„ë„ 0.986ìœ¼ë¡œ ë†’ë‹¤.</p>
<p>ì¦‰ SVMì€ ë†“ì¹¨(FN)ê³¼ ì˜¤ê²½ë³´(FP)ë¥¼ ë™ì‹œì— ì‘ê²Œ ìœ ì§€í•˜ëŠ” ê· í˜•í˜• ìš´ì˜ì ì„ ì œê³µí•œë‹¤. ë˜í•œ ì´ ë°ì´í„°ì—ì„œëŠ” Youden ê¸°ì¤€ê³¼ FPRâ‰¤0.02 ì œì•½ ê¸°ì¤€ì´ ê°™ì€ ì„ê³„ê°’(ë™ì¼í•œ ROC êµ¬ê°„ì˜ ìµœì ì )ìœ¼ë¡œ ìˆ˜ë ´í•˜ì—¬, â€œì˜¤ê²½ë³´ë¥¼ 2% ì´ë‚´ë¡œ ì œí•œâ€í•˜ë”ë¼ë„ ì„±ëŠ¥ ì €í•˜ ì—†ì´ ê°™ì€ ìš´ì˜ì ì´ ì„ íƒë˜ì—ˆë‹¤ê³  í•´ì„í•  ìˆ˜ ìˆë‹¤. (í‘œë³¸ì´ ìœ í•œí•˜ë©´ ROCê°€ ê³„ë‹¨í˜•ì´ì–´ì„œ ì—¬ëŸ¬ ê·œì¹™ì´ ê°™ì€ ì ì„ ì„ íƒí•˜ëŠ” ì¼ì´ í”í•˜ë‹¤.)</p>
<p>ë°˜ë©´ k-NNì€ ë¹„ìš©ê¸°ë°˜(c_FN=10, c_FP=1)ì—ì„œ tâ‰ˆ0.254ë¡œ ì„ê³„ê°’ì´ ë‚®ê²Œ ì„ íƒë˜ë©°, ì´ë•Œ FN=0ì´ ë˜ì–´ ì•…ì„± ë†“ì¹¨ì´ ë°œìƒí•˜ì§€ ì•ŠëŠ”ë‹¤(Recall=1.0). í•˜ì§€ë§Œ ê·¸ ëŒ€ê°€ë¡œ FP=11ì´ ë°œìƒí•´ FPRì´ 0.122ë¡œ ì»¤ì§€ê³ , ì •í™•ë„ë„ 0.923ìœ¼ë¡œ ë–¨ì–´ì§„ë‹¤. ì¦‰ k-NNì˜ ë¹„ìš©ê¸°ë°˜ ì„ íƒì€ â€œì•…ì„±ì„ ì ˆëŒ€ ë†“ì¹˜ì§€ ì•ŠëŠ” ê²ƒâ€ì„ ìš°ì„ í•˜ëŠ” ëŒ€ì‹ , ì–‘ì„±ì— ëŒ€í•œ ì˜¤ê²½ë³´ë¥¼ ë§ì´ ê°ìˆ˜í•˜ëŠ” ìš´ì˜ì ì´ë‹¤.</p>
<p>k-NNì—ì„œ FPRâ‰¤0.02 ì œì•½ì„ ê°•í•˜ê²Œ ì ìš©í•˜ë©´ tâ‰ˆ0.423ì—ì„œ FP=1ë¡œ ì˜¤ê²½ë³´ë¥¼ ê±°ì˜ SVM ìˆ˜ì¤€ê¹Œì§€ ì¤„ì¼ ìˆ˜ ìˆì§€ë§Œ, ê·¸ë•Œ FN=3ìœ¼ë¡œ ì•…ì„± ë†“ì¹¨ì´ ì¦ê°€í•˜ì—¬(Recallâ‰ˆ0.943) ë¹„ìš©(ì—¬ê¸°ì„œëŠ” c_FNì´ í¬ë¯€ë¡œ)ì´ ì»¤ì§„ë‹¤. Youden ê¸°ì¤€ì€ tâ‰ˆ0.406ì—ì„œ FP=2, FN=2ë¡œ ê· í˜•ì„ ì¡ì§€ë§Œ, ì—¬ì „íˆ SVMì˜ ìš´ì˜ì (FP=1, FN=1)ë³´ë‹¤ ì „ì²´ì ìœ¼ë¡œ ë¶ˆë¦¬í•˜ë‹¤.</p>
<p>ë”°ë¼ì„œ ì´ í‘œê°€ ì‹œì‚¬í•˜ëŠ” ê²°ë¡ ì€ ë‹¤ìŒê³¼ ê°™ë‹¤. ì¼ë°˜ì ì¸ ê· í˜• ì„±ëŠ¥(ë‚®ì€ FNê³¼ ë‚®ì€ FPë¥¼ ë™ì‹œì—)ê³¼ ë†’ì€ ì •í™•ë„ë¥¼ ì›í•˜ë©´ SVMì´ ìš°ì„¸í•˜ë©°, íŠ¹íˆ í˜„ì¬ ì„¤ì •ì—ì„œëŠ” SVMì˜ Youden(=FPR ì œì•½) ì„ê³„ê°’ì´ ê°€ì¥ ì•ˆì •ì ì¸ ì„ íƒì´ë‹¤.</p>
<p>ë°˜ëŒ€ë¡œ â€œì•…ì„± ë†“ì¹¨(FN)=0â€ì´ ì •ì±…ì ìœ¼ë¡œ ì ˆëŒ€ì¡°ê±´ì´ë¼ë©´, í˜„ì¬ í‘œì—ì„œëŠ” k-NNì˜ ë¹„ìš©ê¸°ë°˜ ì„ê³„ê°’ì´ ê·¸ ì¡°ê±´ì„ ë§Œì¡±í•˜ì§€ë§Œ, ì˜¤ê²½ë³´(FP)ê°€ í¬ê²Œ ëŠ˜ì–´ë‚˜ëŠ” ì ì„ í•¨ê»˜ ê°ìˆ˜í•´ì•¼ í•œë‹¤. (ì‹¤ë¬´ì ìœ¼ë¡œëŠ” ê°™ì€ ëª©ì ì„ ìœ„í•´ SVMë„ ì„ê³„ê°’ì„ ë” ë‚®ì¶° FN=0ì„ ë§Œì¡±í•˜ëŠ” ì§€ì ì„ ì°¾ëŠ” ë°©ì‹ìœ¼ë¡œ ì¡°ì •í•  ìˆ˜ë„ ìˆë‹¤.)</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/classification_ml_tvalue.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</section>
<section id="íšŒê·€ê¸°ë°˜-ë¶„ë¥˜" class="level5">
<h5 class="anchored" data-anchor-id="íšŒê·€ê¸°ë°˜-ë¶„ë¥˜">(6) íšŒê·€ê¸°ë°˜ ë¶„ë¥˜</h5>
<div class="sourceCode" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> Pipeline</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LogisticRegression</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score, confusion_matrix, classification_report</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co"># ë¡œì§€ìŠ¤í‹± íšŒê·€ ëª¨ë¸ (í‘œì¤€í™” + Logistic Regression)</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>logit_model <span class="op">=</span> Pipeline([</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"scaler"</span>, StandardScaler()),</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"logit"</span>, LogisticRegression(</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>        penalty<span class="op">=</span><span class="st">"l2"</span>,</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>        C<span class="op">=</span><span class="fl">1.0</span>,</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>        solver<span class="op">=</span><span class="st">"lbfgs"</span>,      <span class="co"># ì´ì§„/ë‹¤ì¤‘ ëª¨ë‘ ì•ˆì •ì </span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>        max_iter<span class="op">=</span><span class="dv">5000</span>,</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>        random_state<span class="op">=</span><span class="dv">42</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a><span class="co"># í•™ìŠµ</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>logit_model.fit(X_train, y_train)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="co"># ì˜ˆì¸¡(í´ë˜ìŠ¤)</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>y_pred_logit <span class="op">=</span> logit_model.predict(X_test)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a><span class="co"># í‰ê°€(ê¸°ë³¸)</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"[Logistic] Accuracy:"</span>, accuracy_score(y_test, y_pred_logit))</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"[Logistic] Confusion matrix:</span><span class="ch">\n</span><span class="st">"</span>, confusion_matrix(y_test, y_pred_logit))</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"[Logistic] Classification report:</span><span class="ch">\n</span><span class="st">"</span>,</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>      classification_report(y_test, y_pred_logit, target_names<span class="op">=</span>data.target_names))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre class="text"><code>[Logistic] Accuracy: 0.986013986013986
[Logistic] Confusion matrix:
 [[52  1]
 [ 1 89]]
[Logistic] Classification report:
               precision    recall  f1-score   support

   malignant       0.98      0.98      0.98        53
      benign       0.99      0.99      0.99        90

    accuracy                           0.99       143
   macro avg       0.99      0.99      0.99       143
weighted avg       0.99      0.99      0.99       143</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> (</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    roc_curve, auc,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    precision_recall_curve, average_precision_score,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    confusion_matrix</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="co"># (A) ì•…ì„±(malignant=0)ì„ positive(=1)ë¡œ í†µì¼</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>y_pos <span class="op">=</span> (y_test <span class="op">==</span> <span class="dv">0</span>).astype(<span class="bu">int</span>)  <span class="co"># 1ì´ë©´ malignant</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="co"># ë¡œì§€ìŠ¤í‹± íšŒê·€ í™•ë¥ : P(y=1|x)ì—ì„œ í´ë˜ìŠ¤ 0(malignant) í™•ë¥ ì„ scoreë¡œ ì‚¬ìš©</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>proba <span class="op">=</span> logit_model.predict_proba(X_test)  <span class="co"># shape: (n, 2)</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>classes <span class="op">=</span> logit_model.named_steps[<span class="st">"logit"</span>].classes_</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>idx_malignant <span class="op">=</span> np.where(classes <span class="op">==</span> <span class="dv">0</span>)[<span class="dv">0</span>][<span class="dv">0</span>]</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>score <span class="op">=</span> proba[:, idx_malignant]            <span class="co"># score = P(malignant | x)</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a><span class="co"># (B) ROC / PR</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>fpr, tpr, thr_roc <span class="op">=</span> roc_curve(y_pos, score)</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>roc_auc <span class="op">=</span> auc(fpr, tpr)</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>precision, recall, thr_pr <span class="op">=</span> precision_recall_curve(y_pos, score)</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>ap <span class="op">=</span> average_precision_score(y_pos, score)</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"[Logistic] ROC AUC ="</span>, roc_auc)</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"[Logistic] PR  AP  ="</span>, ap)</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------</span></span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a><span class="co"># (C) ì„ê³„ê°’ tì—ì„œ í˜¼ë™í–‰ë ¬/ì§€í‘œ ê³„ì‚°</span></span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------</span></span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> metrics_at_threshold(y_true01, score, t):</span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>    y_hat <span class="op">=</span> (score <span class="op">&gt;=</span> t).astype(<span class="bu">int</span>)</span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>    tn, fp, fn, tp <span class="op">=</span> confusion_matrix(y_true01, y_hat).ravel()</span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>    recall_ <span class="op">=</span> tp <span class="op">/</span> (tp <span class="op">+</span> fn) <span class="cf">if</span> (tp <span class="op">+</span> fn) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="fl">0.0</span>  <span class="co"># TPR</span></span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>    fpr_    <span class="op">=</span> fp <span class="op">/</span> (fp <span class="op">+</span> tn) <span class="cf">if</span> (fp <span class="op">+</span> tn) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="fl">0.0</span></span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>    prec_   <span class="op">=</span> tp <span class="op">/</span> (tp <span class="op">+</span> fp) <span class="cf">if</span> (tp <span class="op">+</span> fp) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="fl">0.0</span></span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>    acc_    <span class="op">=</span> (tp <span class="op">+</span> tn) <span class="op">/</span> (tp <span class="op">+</span> tn <span class="op">+</span> fp <span class="op">+</span> fn)</span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a>        <span class="st">"t"</span>: <span class="bu">float</span>(t),</span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a>        <span class="st">"tn"</span>: <span class="bu">int</span>(tn), <span class="st">"fp"</span>: <span class="bu">int</span>(fp), <span class="st">"fn"</span>: <span class="bu">int</span>(fn), <span class="st">"tp"</span>: <span class="bu">int</span>(tp),</span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a>        <span class="st">"recall(tpr)"</span>: <span class="bu">float</span>(recall_),</span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a>        <span class="st">"fpr"</span>: <span class="bu">float</span>(fpr_),</span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a>        <span class="st">"precision"</span>: <span class="bu">float</span>(prec_),</span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a>        <span class="st">"accuracy"</span>: <span class="bu">float</span>(acc_)</span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">[Default t=0.5]"</span>)</span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(metrics_at_threshold(y_pos, score, <span class="fl">0.5</span>))</span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">[Grid check]"</span>)</span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> t <span class="kw">in</span> np.arange(<span class="fl">0.1</span>, <span class="fl">1.0</span>, <span class="fl">0.1</span>):</span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(metrics_at_threshold(y_pos, score, t))</span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------</span></span>
<span id="cb14-60"><a href="#cb14-60" aria-hidden="true" tabindex="-1"></a><span class="co"># (D) ì„ê³„ê°’ ì„ íƒ 1: Youden J = TPR - FPR ìµœëŒ€</span></span>
<span id="cb14-61"><a href="#cb14-61" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------</span></span>
<span id="cb14-62"><a href="#cb14-62" aria-hidden="true" tabindex="-1"></a>J <span class="op">=</span> tpr <span class="op">-</span> fpr</span>
<span id="cb14-63"><a href="#cb14-63" aria-hidden="true" tabindex="-1"></a>best_t_youden <span class="op">=</span> <span class="bu">float</span>(thr_roc[np.argmax(J)])</span>
<span id="cb14-64"><a href="#cb14-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-65"><a href="#cb14-65" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">[Youden J]"</span>)</span>
<span id="cb14-66"><a href="#cb14-66" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"best t ="</span>, best_t_youden)</span>
<span id="cb14-67"><a href="#cb14-67" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(metrics_at_threshold(y_pos, score, best_t_youden))</span>
<span id="cb14-68"><a href="#cb14-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-69"><a href="#cb14-69" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------</span></span>
<span id="cb14-70"><a href="#cb14-70" aria-hidden="true" tabindex="-1"></a><span class="co"># (E) ì„ê³„ê°’ ì„ íƒ 2: FPR &lt;= alpha ì œì•½ì—ì„œ TPR ìµœëŒ€</span></span>
<span id="cb14-71"><a href="#cb14-71" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------</span></span>
<span id="cb14-72"><a href="#cb14-72" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> best_threshold_fpr_constraint(y_true01, score, alpha<span class="op">=</span><span class="fl">0.02</span>):</span>
<span id="cb14-73"><a href="#cb14-73" aria-hidden="true" tabindex="-1"></a>    fpr, tpr, thr <span class="op">=</span> roc_curve(y_true01, score)</span>
<span id="cb14-74"><a href="#cb14-74" aria-hidden="true" tabindex="-1"></a>    cand <span class="op">=</span> np.where(fpr <span class="op">&lt;=</span> alpha)[<span class="dv">0</span>]</span>
<span id="cb14-75"><a href="#cb14-75" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(cand) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb14-76"><a href="#cb14-76" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb14-77"><a href="#cb14-77" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> cand[np.argmax(tpr[cand])]</span>
<span id="cb14-78"><a href="#cb14-78" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">float</span>(thr[i])</span>
<span id="cb14-79"><a href="#cb14-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-80"><a href="#cb14-80" aria-hidden="true" tabindex="-1"></a>alpha <span class="op">=</span> <span class="fl">0.02</span></span>
<span id="cb14-81"><a href="#cb14-81" aria-hidden="true" tabindex="-1"></a>best_t_fpr <span class="op">=</span> best_threshold_fpr_constraint(y_pos, score, alpha<span class="op">=</span>alpha)</span>
<span id="cb14-82"><a href="#cb14-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-83"><a href="#cb14-83" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">[FPR constraint]"</span>)</span>
<span id="cb14-84"><a href="#cb14-84" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"alpha ="</span>, alpha, <span class="st">"best t ="</span>, best_t_fpr)</span>
<span id="cb14-85"><a href="#cb14-85" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> best_t_fpr <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb14-86"><a href="#cb14-86" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(metrics_at_threshold(y_pos, score, best_t_fpr))</span>
<span id="cb14-87"><a href="#cb14-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-88"><a href="#cb14-88" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------</span></span>
<span id="cb14-89"><a href="#cb14-89" aria-hidden="true" tabindex="-1"></a><span class="co"># (F) ì„ê³„ê°’ ì„ íƒ 3: ë¹„ìš© ê¸°ë°˜ (c_fn*FN + c_fp*FP) ìµœì†Œ</span></span>
<span id="cb14-90"><a href="#cb14-90" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------</span></span>
<span id="cb14-91"><a href="#cb14-91" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> best_threshold_cost(y_true01, score, c_fn<span class="op">=</span><span class="fl">10.0</span>, c_fp<span class="op">=</span><span class="fl">1.0</span>):</span>
<span id="cb14-92"><a href="#cb14-92" aria-hidden="true" tabindex="-1"></a>    thresholds <span class="op">=</span> np.unique(np.r_[<span class="fl">0.0</span>, score, <span class="fl">1.0</span>])</span>
<span id="cb14-93"><a href="#cb14-93" aria-hidden="true" tabindex="-1"></a>    best_t, best_m, best_cost <span class="op">=</span> <span class="va">None</span>, <span class="va">None</span>, np.inf</span>
<span id="cb14-94"><a href="#cb14-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-95"><a href="#cb14-95" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> t <span class="kw">in</span> thresholds:</span>
<span id="cb14-96"><a href="#cb14-96" aria-hidden="true" tabindex="-1"></a>        m <span class="op">=</span> metrics_at_threshold(y_true01, score, t)</span>
<span id="cb14-97"><a href="#cb14-97" aria-hidden="true" tabindex="-1"></a>        cost <span class="op">=</span> c_fn <span class="op">*</span> m[<span class="st">"fn"</span>] <span class="op">+</span> c_fp <span class="op">*</span> m[<span class="st">"fp"</span>]</span>
<span id="cb14-98"><a href="#cb14-98" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> cost <span class="op">&lt;</span> best_cost:</span>
<span id="cb14-99"><a href="#cb14-99" aria-hidden="true" tabindex="-1"></a>            best_t, best_m, best_cost <span class="op">=</span> <span class="bu">float</span>(t), m, <span class="bu">float</span>(cost)</span>
<span id="cb14-100"><a href="#cb14-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-101"><a href="#cb14-101" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> best_t, best_m, best_cost</span>
<span id="cb14-102"><a href="#cb14-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-103"><a href="#cb14-103" aria-hidden="true" tabindex="-1"></a>best_t_cost, best_m_cost, best_cost_val <span class="op">=</span> best_threshold_cost(y_pos, score, c_fn<span class="op">=</span><span class="dv">10</span>, c_fp<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb14-104"><a href="#cb14-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-105"><a href="#cb14-105" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">[Cost-based]"</span>)</span>
<span id="cb14-106"><a href="#cb14-106" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"best t ="</span>, best_t_cost, <span class="st">"cost ="</span>, best_cost_val)</span>
<span id="cb14-107"><a href="#cb14-107" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(best_m_cost)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>[Logistic] ROC AUC = 0.9976939203354298 [Logistic] PR AP = 0.9967570754716981</p>
<p>[Youden J] best t = 0.636819048492104</p>
<p>{â€˜tâ€™: 0.636819048492104, â€˜tnâ€™: 90, â€˜fpâ€™: 0, â€˜fnâ€™: 1, â€˜tpâ€™: 52, â€˜recall(tpr)â€™: 0.9811320754716981, â€˜fprâ€™: 0.0, â€˜precisionâ€™: 1.0, â€˜accuracyâ€™: 0.993006993006993}</p>
<p>[FPR constraint] alpha = 0.02 best t = 0.636819048492104</p>
<p>{â€˜tâ€™: 0.636819048492104, â€˜tnâ€™: 90, â€˜fpâ€™: 0, â€˜fnâ€™: 1, â€˜tpâ€™: 52, â€˜recall(tpr)â€™: 0.9811320754716981, â€˜fprâ€™: 0.0, â€˜precisionâ€™: 1.0, â€˜accuracyâ€™: 0.993006993006993}</p>
<p>[Cost-based] best t = 0.636819048492104 cost = 10.0</p>
<p>{â€˜tâ€™: 0.636819048492104, â€˜tnâ€™: 90, â€˜fpâ€™: 0, â€˜fnâ€™: 1, â€˜tpâ€™: 52, â€˜recall(tpr)â€™: 0.9811320754716981, â€˜fprâ€™: 0.0, â€˜precisionâ€™: 1.0, â€˜accuracyâ€™: 0.993006993006993}</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># (ì „ì œ) logit_model = Pipeline([("scaler", StandardScaler()), ("logit", LogisticRegression(...))])</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co">#       logit_model.fit(X_train, y_train) ê°€ ì´ë¯¸ ìˆ˜í–‰ë˜ì—ˆë‹¤ê³  ê°€ì •</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) í•™ìŠµëœ ë¡œì§€ìŠ¤í‹± íšŒê·€ ê³„ìˆ˜ êº¼ë‚´ê¸°</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>logit <span class="op">=</span> logit_model.named_steps[<span class="st">"logit"</span>]</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>coef <span class="op">=</span> logit.coef_.ravel()          <span class="co"># shape: (p,)</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>intercept <span class="op">=</span> <span class="bu">float</span>(logit.intercept_[<span class="dv">0</span>])</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) ë³€ìˆ˜ëª… ì¤€ë¹„ (ì•ì—ì„œ feature_namesë¥¼ ë§Œë“¤ì—ˆë‹¤ë©´ ê·¸ëŒ€ë¡œ ì‚¬ìš©)</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="co">#    feature_names = data.feature_names</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>feature_names <span class="op">=</span> <span class="bu">list</span>(feature_names)</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) ì˜¤ì¦ˆë¹„(OR) ê³„ì‚°</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>odds_ratio <span class="op">=</span> np.exp(coef)</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a><span class="co"># 4) ê²°ê³¼ í…Œì´ë¸” ìƒì„±</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>coef_df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">"feature"</span>: feature_names,</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">"beta(coef)"</span>: coef,</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">"odds_ratio(exp(beta))"</span>: odds_ratio</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>}).sort_values(<span class="st">"beta(coef)"</span>, ascending<span class="op">=</span><span class="va">False</span>).reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a><span class="co">#print("Intercept (beta0) =", intercept)</span></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a><span class="co">#display(coef_df.head(10))</span></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a><span class="co"># 5) ìƒìœ„ ì–‘(+) / ìŒ(-) ê³„ìˆ˜ ë³€ìˆ˜ ì¶œë ¥</span></span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>top_k <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>top_pos <span class="op">=</span> coef_df.head(top_k)                  <span class="co"># benign(=1) í™•ë¥ ì„ ë†’ì´ëŠ” ë°©í–¥</span></span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>top_neg <span class="op">=</span> coef_df.tail(top_k).iloc[::<span class="op">-</span><span class="dv">1</span>]       <span class="co"># malignant(=0) ìª½ìœ¼ë¡œ ê¸°ì—¬(benign í™•ë¥  ë‚®ì¶¤)</span></span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">[ìƒìœ„ +ê³„ìˆ˜ </span><span class="sc">{</span>top_k<span class="sc">}</span><span class="ss">ê°œ]  (benign=1 ì˜¤ì¦ˆë¥¼ ì¦ê°€ì‹œí‚¤ëŠ” ë³€ìˆ˜)"</span>)</span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>display(top_pos)</span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">[ìƒìœ„ -ê³„ìˆ˜ </span><span class="sc">{</span>top_k<span class="sc">}</span><span class="ss">ê°œ]  (benign=1 ì˜¤ì¦ˆë¥¼ ê°ì†Œ â†’ malignant ìª½ìœ¼ë¡œ ê¸°ì—¬í•˜ëŠ” ë³€ìˆ˜)"</span>)</span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>display(top_neg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>ë³¸ ë¡œì§€ìŠ¤í‹± íšŒê·€ëª¨í˜•ì—ì„œ ì¢…ì†ë³€ìˆ˜ëŠ” benign = 1ë¡œ ì •ì˜ë˜ì—ˆìœ¼ë©°, íšŒê·€ê³„ìˆ˜ëŠ” ê° ì„¤ëª…ë³€ìˆ˜ê°€ ì–‘ì„± ì¢…ì–‘ì¼ ì˜¤ì¦ˆ(odds)ì— ë¯¸ì¹˜ëŠ” ì˜í–¥ì„ ë‚˜íƒ€ë‚¸ë‹¤. ì–‘(+)ì˜ íšŒê·€ê³„ìˆ˜ëŠ” í•´ë‹¹ ë³€ìˆ˜ê°€ ì¦ê°€í• ìˆ˜ë¡ ì–‘ì„±ì¼ ì˜¤ì¦ˆê°€ ì¦ê°€í•¨ì„, ìŒ(â€“)ì˜ íšŒê·€ê³„ìˆ˜ëŠ” ë°˜ëŒ€ë¡œ ì•…ì„±ì¼ ê°€ëŠ¥ì„±ì´ ìƒëŒ€ì ìœ¼ë¡œ ë†’ì•„ì§ì„ ì˜ë¯¸í•œë‹¤.</p>
<p>ë¨¼ì €, ì–‘ì„±(benign) ì˜¤ì¦ˆë¥¼ ì¦ê°€ì‹œí‚¤ëŠ” ë³€ìˆ˜ë¡œëŠ” mean compactnessê°€ ê°€ì¥ í° ì˜í–¥ì„ ë³´ì˜€ë‹¤. ì´ ë³€ìˆ˜ì˜ íšŒê·€ê³„ìˆ˜ëŠ” 0.694ë¡œ, ë‹¤ë¥¸ ì¡°ê±´ì´ ë™ì¼í•  ë•Œ í‰ê·  compactnessê°€ 1ë‹¨ìœ„ ì¦ê°€í•˜ë©´ ì–‘ì„±ì¼ ì˜¤ì¦ˆëŠ” ì•½ 2.00ë°° ì¦ê°€í•˜ëŠ” ê²ƒìœ¼ë¡œ ë‚˜íƒ€ë‚¬ë‹¤. ì´ëŠ” ì¢…ì–‘ì˜ í˜•íƒœì  ì••ì¶•ë„ê°€ ë†’ì„ìˆ˜ë¡ ìƒëŒ€ì ìœ¼ë¡œ ì–‘ì„±ìœ¼ë¡œ ë¶„ë¥˜ë  ê°€ëŠ¥ì„±ì´ ì»¤ì§ì„ ì‹œì‚¬í•œë‹¤.</p>
<p>ì´ì™¸ì—ë„ compactness error, symmetry error, fractal dimension error ë“± í˜•íƒœì˜ ë¶ˆê·œì¹™ì„±ê³¼ ê´€ë ¨ëœ ì˜¤ì°¨ ë³€ìˆ˜ë“¤ì´ ì–‘ì„± ì˜¤ì¦ˆë¥¼ ìœ ì˜í•˜ê²Œ ì¦ê°€ì‹œí‚¤ëŠ” ë°©í–¥ìœ¼ë¡œ ì‘ìš©í•˜ì˜€ë‹¤. ì „ë°˜ì ìœ¼ë¡œ ë³´ë©´, í‰ê·  ìˆ˜ì¤€ì˜ í˜•íƒœ ì§€í‘œë³´ë‹¤ëŠ” ì¸¡ì • ì˜¤ì°¨(error) ê³„ì—´ ë³€ìˆ˜ë“¤ì´ ì–‘ì„± ë¶„ë¥˜ì— ìƒëŒ€ì ìœ¼ë¡œ ê¸ì •ì ì¸ ê¸°ì—¬ë¥¼ í•˜ê³  ìˆë‹¤ëŠ” ì ì´ íŠ¹ì§•ì ì´ë‹¤.</p>
<p>ë°˜ë©´, ì–‘ì„± ì˜¤ì¦ˆë¥¼ ê°ì†Œì‹œí‚¤ëŠ”(ì¦‰, ì•…ì„± ë°©í–¥ìœ¼ë¡œ ê¸°ì—¬í•˜ëŠ”) ë³€ìˆ˜ë“¤ì€ ì£¼ë¡œ worst ì ‘ë‘ì–´ê°€ ë¶™ì€ ë³€ìˆ˜ë“¤ë¡œ êµ¬ì„±ë˜ì–´ ìˆë‹¤. íŠ¹íˆ worst textureëŠ” íšŒê·€ê³„ìˆ˜ â€“1.25ë¡œ ê°€ì¥ í° ìŒì˜ íš¨ê³¼ë¥¼ ë³´ì˜€ìœ¼ë©°, ì´ëŠ” í•´ë‹¹ ë³€ìˆ˜ê°€ 1ë‹¨ìœ„ ì¦ê°€í•  ë•Œ ì–‘ì„±ì¼ ì˜¤ì¦ˆê°€ ì•½ 0.29ë°°ë¡œ ê°ì†Œí•¨ì„ ì˜ë¯¸í•œë‹¤. ë‹¤ì‹œ ë§í•´, ì¢…ì–‘ì˜ ìµœì•…(worst) ìƒíƒœì—ì„œ ê´€ì¸¡ëœ ì§ˆê°ì´ë‚˜ í¬ê¸°, ë‘˜ë ˆ, ë©´ì  ê´€ë ¨ ì§€í‘œë“¤ì€ ì•…ì„± ì¢…ì–‘ì„ ê°•í•˜ê²Œ ì‹œì‚¬í•˜ëŠ” íŠ¹ì§•ìœ¼ë¡œ ì‘ìš©í•œë‹¤.</p>
<p>worst radius, worst area, worst perimeter, mean concave points ë“±ë„ ëª¨ë‘ ì¼ê´€ë˜ê²Œ ìŒì˜ ê³„ìˆ˜ë¥¼ ë³´ì—¬, ì¢…ì–‘ì˜ í¬ê¸° ë° ê²½ê³„ì˜ ì¹¨ìŠµì„±ì´ ì•…ì„± ì—¬ë¶€ íŒë‹¨ì— í•µì‹¬ì ì¸ ì—­í• ì„ í•¨ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p>
<p>ì¢…í•©í•˜ë©´, ë³¸ ë¶„ì„ ê²°ê³¼ëŠ” ì•…ì„± ì¢…ì–‘ì˜ íŒë³„ì—ëŠ” â€˜worst-caseâ€™ í˜•íƒœ ì§€í‘œë“¤ì´ ê²°ì •ì ì´ë©°, ë°˜ëŒ€ë¡œ ì–‘ì„± ì¢…ì–‘ì˜ ê²½ìš° í‰ê· ì  í˜•íƒœ íŠ¹ì„±ì´ë‚˜ ë³€ë™ì„±(ì˜¤ì°¨) ê´€ë ¨ ì§€í‘œë“¤ì´ ìƒëŒ€ì ìœ¼ë¡œ ì¤‘ìš”í•œ ì—­í• ì„ í•œë‹¤ëŠ” ì ì„ ì‹œì‚¬í•œë‹¤. ì´ëŠ” ì„ìƒì ìœ¼ë¡œë„ ì¢…ì–‘ì˜ ìµœëŒ€ í¬ê¸°ë‚˜ ê°€ì¥ ë¶ˆë¦¬í•œ í˜•íƒœì  íŠ¹ì§•ì´ ì•…ì„± ì—¬ë¶€ íŒë‹¨ì— ìš°ì„ ì ìœ¼ë¡œ ê³ ë ¤ëœë‹¤ëŠ” ê¸°ì¡´ ì˜í•™ì  í•´ì„ê³¼ë„ ì •í•©ì ì¸ ê²°ê³¼ì´ë‹¤.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/classification_ml_regresult.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%"></p>
</figure>
</div>
</section>
<section id="íŠ¸ë¦¬ê¸°ë°˜ë‹¨ì¼-ë¶„ë¥˜" class="level5">
<h5 class="anchored" data-anchor-id="íŠ¸ë¦¬ê¸°ë°˜ë‹¨ì¼-ë¶„ë¥˜">(7) íŠ¸ë¦¬ê¸°ë°˜(ë‹¨ì¼) ë¶„ë¥˜</h5>
<div class="sourceCode" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.tree <span class="im">import</span> DecisionTreeClassifier</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score, confusion_matrix, classification_report</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Decision Tree (ë¶„í•  ê¸°ë°˜)</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>tree_model <span class="op">=</span> DecisionTreeClassifier(</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    criterion<span class="op">=</span><span class="st">"gini"</span>,        <span class="co"># or "entropy"</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    max_depth<span class="op">=</span><span class="dv">4</span>,             <span class="co"># ê³¼ì í•© ë°©ì§€ìš©(ì˜ˆì‹œ). Noneì´ë©´ ëê¹Œì§€ ë¶„í• </span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    min_samples_leaf<span class="op">=</span><span class="dv">5</span>,      <span class="co"># ìë…¸ë“œ ìµœì†Œ í‘œë³¸ìˆ˜</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    random_state<span class="op">=</span><span class="dv">42</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="co"># í•™ìŠµ</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>tree_model.fit(X_train, y_train)</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a><span class="co"># ì˜ˆì¸¡(í´ë˜ìŠ¤)</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>y_pred_tree <span class="op">=</span> tree_model.predict(X_test)</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a><span class="co"># í‰ê°€(ê¸°ë³¸)</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"[Tree] Accuracy:"</span>, accuracy_score(y_test, y_pred_tree))</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"[Tree] Confusion matrix:</span><span class="ch">\n</span><span class="st">"</span>, confusion_matrix(y_test, y_pred_tree))</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"[Tree] Classification report:</span><span class="ch">\n</span><span class="st">"</span>,</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>      classification_report(y_test, y_pred_tree, target_names<span class="op">=</span>data.target_names))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre class="text"><code>[Tree] Accuracy: 0.9300699300699301
[Tree] Confusion matrix:
 [[48  5]
 [ 5 85]]
[Tree] Classification report:
               precision    recall  f1-score   support

   malignant       0.91      0.91      0.91        53
      benign       0.94      0.94      0.94        90

    accuracy                           0.93       143
   macro avg       0.93      0.93      0.93       143
weighted avg       0.93      0.93      0.93       143</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> (</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    roc_curve, auc,</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    precision_recall_curve, average_precision_score,</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    confusion_matrix</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 0) ì•…ì„±(malignant=0)ì„ positive(=1)ë¡œ í†µì¼</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>y_pos <span class="op">=</span> (y_test <span class="op">==</span> <span class="dv">0</span>).astype(<span class="bu">int</span>)  <span class="co"># 1ì´ë©´ malignant</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="co"># DecisionTreeì˜ "ì•…ì„± í™•ë¥ " score = P(malignant | x)</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>proba_tree <span class="op">=</span> tree_model.predict_proba(X_test)</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>idx_malignant <span class="op">=</span> np.where(tree_model.classes_ <span class="op">==</span> <span class="dv">0</span>)[<span class="dv">0</span>][<span class="dv">0</span>]</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>score <span class="op">=</span> proba_tree[:, idx_malignant]</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) ROC / PR</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>fpr, tpr, thr_roc <span class="op">=</span> roc_curve(y_pos, score)</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>roc_auc <span class="op">=</span> auc(fpr, tpr)</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>prec, rec, thr_pr <span class="op">=</span> precision_recall_curve(y_pos, score)</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>ap <span class="op">=</span> average_precision_score(y_pos, score)</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"[Tree] ROC AUC ="</span>, roc_auc)</span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"[Tree] PR  AP  ="</span>, ap)</span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------</span></span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) ì„ê³„ê°’ tì—ì„œ í˜¼ë™í–‰ë ¬/ì§€í‘œ ê³„ì‚°</span></span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------</span></span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> metrics_at_threshold(y_true01, score, t):</span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a>    y_hat <span class="op">=</span> (score <span class="op">&gt;=</span> t).astype(<span class="bu">int</span>)</span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a>    tn, fp, fn, tp <span class="op">=</span> confusion_matrix(y_true01, y_hat).ravel()</span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a>    recall_ <span class="op">=</span> tp <span class="op">/</span> (tp <span class="op">+</span> fn) <span class="cf">if</span> (tp <span class="op">+</span> fn) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="fl">0.0</span>  <span class="co"># TPR</span></span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a>    fpr_    <span class="op">=</span> fp <span class="op">/</span> (fp <span class="op">+</span> tn) <span class="cf">if</span> (fp <span class="op">+</span> tn) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="fl">0.0</span></span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a>    prec_   <span class="op">=</span> tp <span class="op">/</span> (tp <span class="op">+</span> fp) <span class="cf">if</span> (tp <span class="op">+</span> fp) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="fl">0.0</span></span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a>    acc_    <span class="op">=</span> (tp <span class="op">+</span> tn) <span class="op">/</span> (tp <span class="op">+</span> tn <span class="op">+</span> fp <span class="op">+</span> fn)</span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a>        <span class="st">"t"</span>: <span class="bu">float</span>(t),</span>
<span id="cb18-44"><a href="#cb18-44" aria-hidden="true" tabindex="-1"></a>        <span class="st">"tn"</span>: <span class="bu">int</span>(tn), <span class="st">"fp"</span>: <span class="bu">int</span>(fp), <span class="st">"fn"</span>: <span class="bu">int</span>(fn), <span class="st">"tp"</span>: <span class="bu">int</span>(tp),</span>
<span id="cb18-45"><a href="#cb18-45" aria-hidden="true" tabindex="-1"></a>        <span class="st">"recall(tpr)"</span>: <span class="bu">float</span>(recall_),</span>
<span id="cb18-46"><a href="#cb18-46" aria-hidden="true" tabindex="-1"></a>        <span class="st">"fpr"</span>: <span class="bu">float</span>(fpr_),</span>
<span id="cb18-47"><a href="#cb18-47" aria-hidden="true" tabindex="-1"></a>        <span class="st">"precision"</span>: <span class="bu">float</span>(prec_),</span>
<span id="cb18-48"><a href="#cb18-48" aria-hidden="true" tabindex="-1"></a>        <span class="st">"accuracy"</span>: <span class="bu">float</span>(acc_)</span>
<span id="cb18-49"><a href="#cb18-49" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb18-50"><a href="#cb18-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-51"><a href="#cb18-51" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">[Default t=0.5]"</span>)</span>
<span id="cb18-52"><a href="#cb18-52" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(metrics_at_threshold(y_pos, score, <span class="fl">0.5</span>))</span>
<span id="cb18-53"><a href="#cb18-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-54"><a href="#cb18-54" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------</span></span>
<span id="cb18-55"><a href="#cb18-55" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) Youden J = TPR - FPR ìµœëŒ€</span></span>
<span id="cb18-56"><a href="#cb18-56" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------</span></span>
<span id="cb18-57"><a href="#cb18-57" aria-hidden="true" tabindex="-1"></a>J <span class="op">=</span> tpr <span class="op">-</span> fpr</span>
<span id="cb18-58"><a href="#cb18-58" aria-hidden="true" tabindex="-1"></a>best_t_youden <span class="op">=</span> <span class="bu">float</span>(thr_roc[np.argmax(J)])</span>
<span id="cb18-59"><a href="#cb18-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-60"><a href="#cb18-60" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">[Youden J]"</span>)</span>
<span id="cb18-61"><a href="#cb18-61" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"best t ="</span>, best_t_youden)</span>
<span id="cb18-62"><a href="#cb18-62" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(metrics_at_threshold(y_pos, score, best_t_youden))</span>
<span id="cb18-63"><a href="#cb18-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-64"><a href="#cb18-64" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------</span></span>
<span id="cb18-65"><a href="#cb18-65" aria-hidden="true" tabindex="-1"></a><span class="co"># 4) FPR &lt;= alpha ì œì•½ì—ì„œ TPR ìµœëŒ€</span></span>
<span id="cb18-66"><a href="#cb18-66" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------</span></span>
<span id="cb18-67"><a href="#cb18-67" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> best_threshold_fpr_constraint(y_true01, score, alpha<span class="op">=</span><span class="fl">0.02</span>):</span>
<span id="cb18-68"><a href="#cb18-68" aria-hidden="true" tabindex="-1"></a>    fpr, tpr, thr <span class="op">=</span> roc_curve(y_true01, score)</span>
<span id="cb18-69"><a href="#cb18-69" aria-hidden="true" tabindex="-1"></a>    cand <span class="op">=</span> np.where(fpr <span class="op">&lt;=</span> alpha)[<span class="dv">0</span>]</span>
<span id="cb18-70"><a href="#cb18-70" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(cand) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb18-71"><a href="#cb18-71" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb18-72"><a href="#cb18-72" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> cand[np.argmax(tpr[cand])]</span>
<span id="cb18-73"><a href="#cb18-73" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">float</span>(thr[i])</span>
<span id="cb18-74"><a href="#cb18-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-75"><a href="#cb18-75" aria-hidden="true" tabindex="-1"></a>alpha <span class="op">=</span> <span class="fl">0.02</span></span>
<span id="cb18-76"><a href="#cb18-76" aria-hidden="true" tabindex="-1"></a>best_t_fpr <span class="op">=</span> best_threshold_fpr_constraint(y_pos, score, alpha<span class="op">=</span>alpha)</span>
<span id="cb18-77"><a href="#cb18-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-78"><a href="#cb18-78" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">[FPR constraint]"</span>)</span>
<span id="cb18-79"><a href="#cb18-79" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"alpha ="</span>, alpha, <span class="st">"best t ="</span>, best_t_fpr)</span>
<span id="cb18-80"><a href="#cb18-80" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> best_t_fpr <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb18-81"><a href="#cb18-81" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(metrics_at_threshold(y_pos, score, best_t_fpr))</span>
<span id="cb18-82"><a href="#cb18-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-83"><a href="#cb18-83" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------</span></span>
<span id="cb18-84"><a href="#cb18-84" aria-hidden="true" tabindex="-1"></a><span class="co"># 5) ë¹„ìš© ê¸°ë°˜: c_fn*FN + c_fp*FP ìµœì†Œ</span></span>
<span id="cb18-85"><a href="#cb18-85" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------</span></span>
<span id="cb18-86"><a href="#cb18-86" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> best_threshold_cost(y_true01, score, c_fn<span class="op">=</span><span class="fl">10.0</span>, c_fp<span class="op">=</span><span class="fl">1.0</span>):</span>
<span id="cb18-87"><a href="#cb18-87" aria-hidden="true" tabindex="-1"></a>    thresholds <span class="op">=</span> np.unique(np.r_[<span class="fl">0.0</span>, score, <span class="fl">1.0</span>])</span>
<span id="cb18-88"><a href="#cb18-88" aria-hidden="true" tabindex="-1"></a>    best_t, best_m, best_cost <span class="op">=</span> <span class="va">None</span>, <span class="va">None</span>, np.inf</span>
<span id="cb18-89"><a href="#cb18-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-90"><a href="#cb18-90" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> t <span class="kw">in</span> thresholds:</span>
<span id="cb18-91"><a href="#cb18-91" aria-hidden="true" tabindex="-1"></a>        m <span class="op">=</span> metrics_at_threshold(y_true01, score, t)</span>
<span id="cb18-92"><a href="#cb18-92" aria-hidden="true" tabindex="-1"></a>        cost <span class="op">=</span> c_fn <span class="op">*</span> m[<span class="st">"fn"</span>] <span class="op">+</span> c_fp <span class="op">*</span> m[<span class="st">"fp"</span>]</span>
<span id="cb18-93"><a href="#cb18-93" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> cost <span class="op">&lt;</span> best_cost:</span>
<span id="cb18-94"><a href="#cb18-94" aria-hidden="true" tabindex="-1"></a>            best_t, best_m, best_cost <span class="op">=</span> <span class="bu">float</span>(t), m, <span class="bu">float</span>(cost)</span>
<span id="cb18-95"><a href="#cb18-95" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> best_t, best_m, best_cost</span>
<span id="cb18-96"><a href="#cb18-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-97"><a href="#cb18-97" aria-hidden="true" tabindex="-1"></a>best_t_cost, best_m_cost, best_cost_val <span class="op">=</span> best_threshold_cost(y_pos, score, c_fn<span class="op">=</span><span class="dv">10</span>, c_fp<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb18-98"><a href="#cb18-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-99"><a href="#cb18-99" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">[Cost-based]"</span>)</span>
<span id="cb18-100"><a href="#cb18-100" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"best t ="</span>, best_t_cost, <span class="st">"cost ="</span>, best_cost_val)</span>
<span id="cb18-101"><a href="#cb18-101" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(best_m_cost)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>[Tree] ROC AUC = 0.931446540880503 [Tree] PR AP = 0.9139770620510188</p>
<p>[Default t=0.5]</p>
<p>{â€˜tâ€™: 0.5, â€˜tnâ€™: 85, â€˜fpâ€™: 5, â€˜fnâ€™: 5, â€˜tpâ€™: 48, â€˜recall(tpr)â€™: 0.9056603773584906, â€˜fprâ€™: 0.05555555555555555, â€˜precisionâ€™: 0.9056603773584906, â€˜accuracyâ€™: 0.9300699300699301}</p>
<p>[Youden J] best t = 1.0</p>
<p>{â€˜tâ€™: 1.0, â€˜tnâ€™: 88, â€˜fpâ€™: 2, â€˜fnâ€™: 5, â€˜tpâ€™: 48, â€˜recall(tpr)â€™: 0.9056603773584906, â€˜fprâ€™: 0.022222222222222223, â€˜precisionâ€™: 0.96, â€˜accuracyâ€™: 0.951048951048951}</p>
<p>[FPR constraint] alpha = 0.02 best t = inf</p>
<p>{â€˜tâ€™: inf, â€˜tnâ€™: 90, â€˜fpâ€™: 0, â€˜fnâ€™: 53, â€˜tpâ€™: 0, â€˜recall(tpr)â€™: 0.0, â€˜fprâ€™: 0.0, â€˜precisionâ€™: 0.0, â€˜accuracyâ€™: 0.6293706293706294}</p>
<p>[Cost-based] best t = 0.4 cost = 47.0</p>
<p>{â€˜tâ€™: 0.4, â€˜tnâ€™: 83, â€˜fpâ€™: 7, â€˜fnâ€™: 4, â€˜tpâ€™: 49, â€˜recall(tpr)â€™: 0.9245283018867925, â€˜fprâ€™: 0.07777777777777778, â€˜precisionâ€™: 0.875, â€˜accuracyâ€™: 0.9230769230769231}</p>
</section>
<section id="ì•™ìƒë¸”-ê¸°ë²•" class="level5">
<h5 class="anchored" data-anchor-id="ì•™ìƒë¸”-ê¸°ë²•">(8) ì•™ìƒë¸” ê¸°ë²•</h5>
<p><strong>RandomForest í•™ìŠµ</strong></p>
<div class="sourceCode" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score, confusion_matrix, classification_report</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>rf_model <span class="op">=</span> RandomForestClassifier(</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    n_estimators<span class="op">=</span><span class="dv">500</span>,</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    max_depth<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    min_samples_leaf<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    random_state<span class="op">=</span><span class="dv">42</span>,</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    n_jobs<span class="op">=-</span><span class="dv">1</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>rf_model.fit(X_train, y_train)</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>y_pred_rf <span class="op">=</span> rf_model.predict(X_test)</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"[RF] Accuracy:"</span>, accuracy_score(y_test, y_pred_rf))</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"[RF] Confusion matrix:</span><span class="ch">\n</span><span class="st">"</span>, confusion_matrix(y_test, y_pred_rf))</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"[RF] Classification report:</span><span class="ch">\n</span><span class="st">"</span>,</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>      classification_report(y_test, y_pred_rf, target_names<span class="op">=</span>data.target_names))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre class="text"><code>[RF] Accuracy: 0.958041958041958
[RF] Confusion matrix:
 [[49  4]
 [ 2 88]]
[RF] Classification report:
               precision    recall  f1-score   support

   malignant       0.96      0.92      0.94        53
      benign       0.96      0.98      0.97        90

    accuracy                           0.96       143
   macro avg       0.96      0.95      0.95       143
weighted avg       0.96      0.96      0.96       143</code></pre>
<p><strong>GradientBoosting í•™ìŠµ</strong></p>
<div class="sourceCode" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> GradientBoostingClassifier</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score, confusion_matrix, classification_report</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>gb_model <span class="op">=</span> GradientBoostingClassifier(</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    n_estimators<span class="op">=</span><span class="dv">300</span>,</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    learning_rate<span class="op">=</span><span class="fl">0.05</span>,</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    max_depth<span class="op">=</span><span class="dv">2</span>,        <span class="co"># ì•½í•œ íŠ¸ë¦¬(ê¹Šì´ ë‚®ê²Œ) ê¶Œì¥</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    random_state<span class="op">=</span><span class="dv">42</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>gb_model.fit(X_train, y_train)</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>y_pred_gb <span class="op">=</span> gb_model.predict(X_test)</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"[GB] Accuracy:"</span>, accuracy_score(y_test, y_pred_gb))</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"[GB] Confusion matrix:</span><span class="ch">\n</span><span class="st">"</span>, confusion_matrix(y_test, y_pred_gb))</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"[GB] Classification report:</span><span class="ch">\n</span><span class="st">"</span>,</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>      classification_report(y_test, y_pred_gb, target_names<span class="op">=</span>data.target_names))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre class="text"><code>[GB] Accuracy: 0.951048951048951
[GB] Confusion matrix:
 [[48  5]
 [ 2 88]]
[GB] Classification report:
               precision    recall  f1-score   support

   malignant       0.96      0.91      0.93        53
      benign       0.95      0.98      0.96        90

    accuracy                           0.95       143
   macro avg       0.95      0.94      0.95       143
weighted avg       0.95      0.95      0.95       143</code></pre>
<p><strong>RF / GB ê³µí†µ: ROC/PR + ì„ê³„ê°’(Youden / FPRì œì•½ / ë¹„ìš©ê¸°ë°˜)</strong></p>
<div class="sourceCode" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> (</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    roc_curve, auc,</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    precision_recall_curve, average_precision_score,</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    confusion_matrix</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="co"># --------------------------------------------</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 0) ì•…ì„±=positive(1)ë¡œ í†µì¼</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="co"># --------------------------------------------</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>y_pos <span class="op">=</span> (y_test <span class="op">==</span> <span class="dv">0</span>).astype(<span class="bu">int</span>)  <span class="co"># 1ì´ë©´ malignant</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_score_for_class(model, X, class_label<span class="op">=</span><span class="dv">0</span>):</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""íŠ¹ì • í´ë˜ìŠ¤(class_label)ì˜ í™•ë¥  score = P(class_label|x)"""</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>    proba <span class="op">=</span> model.predict_proba(X)</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>    classes <span class="op">=</span> np.array(model.classes_)</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>    idx <span class="op">=</span> np.where(classes <span class="op">==</span> class_label)[<span class="dv">0</span>][<span class="dv">0</span>]</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> proba[:, idx]</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> metrics_at_threshold(y_true01, score, t):</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>    y_hat <span class="op">=</span> (score <span class="op">&gt;=</span> t).astype(<span class="bu">int</span>)</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>    tn, fp, fn, tp <span class="op">=</span> confusion_matrix(y_true01, y_hat).ravel()</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>    recall_ <span class="op">=</span> tp <span class="op">/</span> (tp <span class="op">+</span> fn) <span class="cf">if</span> (tp <span class="op">+</span> fn) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="fl">0.0</span></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>    fpr_    <span class="op">=</span> fp <span class="op">/</span> (fp <span class="op">+</span> tn) <span class="cf">if</span> (fp <span class="op">+</span> tn) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="fl">0.0</span></span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>    prec_   <span class="op">=</span> tp <span class="op">/</span> (tp <span class="op">+</span> fp) <span class="cf">if</span> (tp <span class="op">+</span> fp) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="fl">0.0</span></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>    acc_    <span class="op">=</span> (tp <span class="op">+</span> tn) <span class="op">/</span> (tp <span class="op">+</span> tn <span class="op">+</span> fp <span class="op">+</span> fn)</span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>        <span class="st">"t"</span>: <span class="bu">float</span>(t),</span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>        <span class="st">"tn"</span>: <span class="bu">int</span>(tn), <span class="st">"fp"</span>: <span class="bu">int</span>(fp), <span class="st">"fn"</span>: <span class="bu">int</span>(fn), <span class="st">"tp"</span>: <span class="bu">int</span>(tp),</span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a>        <span class="st">"recall(tpr)"</span>: <span class="bu">float</span>(recall_),</span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a>        <span class="st">"fpr"</span>: <span class="bu">float</span>(fpr_),</span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a>        <span class="st">"precision"</span>: <span class="bu">float</span>(prec_),</span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a>        <span class="st">"accuracy"</span>: <span class="bu">float</span>(acc_)</span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> threshold_youden(y_true01, score):</span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a>    fpr, tpr, thr <span class="op">=</span> roc_curve(y_true01, score)</span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a>    J <span class="op">=</span> tpr <span class="op">-</span> fpr</span>
<span id="cb23-42"><a href="#cb23-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">float</span>(thr[np.argmax(J)])</span>
<span id="cb23-43"><a href="#cb23-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-44"><a href="#cb23-44" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> threshold_fpr_constraint(y_true01, score, alpha<span class="op">=</span><span class="fl">0.02</span>):</span>
<span id="cb23-45"><a href="#cb23-45" aria-hidden="true" tabindex="-1"></a>    fpr, tpr, thr <span class="op">=</span> roc_curve(y_true01, score)</span>
<span id="cb23-46"><a href="#cb23-46" aria-hidden="true" tabindex="-1"></a>    cand <span class="op">=</span> np.where(fpr <span class="op">&lt;=</span> alpha)[<span class="dv">0</span>]</span>
<span id="cb23-47"><a href="#cb23-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(cand) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb23-48"><a href="#cb23-48" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb23-49"><a href="#cb23-49" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> cand[np.argmax(tpr[cand])]</span>
<span id="cb23-50"><a href="#cb23-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">float</span>(thr[i])</span>
<span id="cb23-51"><a href="#cb23-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-52"><a href="#cb23-52" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> threshold_cost(y_true01, score, c_fn<span class="op">=</span><span class="fl">10.0</span>, c_fp<span class="op">=</span><span class="fl">1.0</span>):</span>
<span id="cb23-53"><a href="#cb23-53" aria-hidden="true" tabindex="-1"></a>    thresholds <span class="op">=</span> np.unique(np.r_[<span class="fl">0.0</span>, score, <span class="fl">1.0</span>])</span>
<span id="cb23-54"><a href="#cb23-54" aria-hidden="true" tabindex="-1"></a>    best_t, best_cost <span class="op">=</span> <span class="va">None</span>, np.inf</span>
<span id="cb23-55"><a href="#cb23-55" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> t <span class="kw">in</span> thresholds:</span>
<span id="cb23-56"><a href="#cb23-56" aria-hidden="true" tabindex="-1"></a>        m <span class="op">=</span> metrics_at_threshold(y_true01, score, t)</span>
<span id="cb23-57"><a href="#cb23-57" aria-hidden="true" tabindex="-1"></a>        cost <span class="op">=</span> c_fn<span class="op">*</span>m[<span class="st">"fn"</span>] <span class="op">+</span> c_fp<span class="op">*</span>m[<span class="st">"fp"</span>]</span>
<span id="cb23-58"><a href="#cb23-58" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> cost <span class="op">&lt;</span> best_cost:</span>
<span id="cb23-59"><a href="#cb23-59" aria-hidden="true" tabindex="-1"></a>            best_cost <span class="op">=</span> cost</span>
<span id="cb23-60"><a href="#cb23-60" aria-hidden="true" tabindex="-1"></a>            best_t <span class="op">=</span> <span class="bu">float</span>(t)</span>
<span id="cb23-61"><a href="#cb23-61" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> best_t, <span class="bu">float</span>(best_cost)</span>
<span id="cb23-62"><a href="#cb23-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-63"><a href="#cb23-63" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> build_rows(model_name, y_true01, score, alpha<span class="op">=</span><span class="fl">0.02</span>, c_fn<span class="op">=</span><span class="fl">10.0</span>, c_fp<span class="op">=</span><span class="fl">1.0</span>):</span>
<span id="cb23-64"><a href="#cb23-64" aria-hidden="true" tabindex="-1"></a>    rows <span class="op">=</span> []</span>
<span id="cb23-65"><a href="#cb23-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-66"><a href="#cb23-66" aria-hidden="true" tabindex="-1"></a>    <span class="co"># AUC/AP (ìš”ì•½ìš©)</span></span>
<span id="cb23-67"><a href="#cb23-67" aria-hidden="true" tabindex="-1"></a>    fpr, tpr, _ <span class="op">=</span> roc_curve(y_true01, score)</span>
<span id="cb23-68"><a href="#cb23-68" aria-hidden="true" tabindex="-1"></a>    roc_auc <span class="op">=</span> auc(fpr, tpr)</span>
<span id="cb23-69"><a href="#cb23-69" aria-hidden="true" tabindex="-1"></a>    ap <span class="op">=</span> average_precision_score(y_true01, score)</span>
<span id="cb23-70"><a href="#cb23-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-71"><a href="#cb23-71" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Youden</span></span>
<span id="cb23-72"><a href="#cb23-72" aria-hidden="true" tabindex="-1"></a>    t_y <span class="op">=</span> threshold_youden(y_true01, score)</span>
<span id="cb23-73"><a href="#cb23-73" aria-hidden="true" tabindex="-1"></a>    m_y <span class="op">=</span> metrics_at_threshold(y_true01, score, t_y)</span>
<span id="cb23-74"><a href="#cb23-74" aria-hidden="true" tabindex="-1"></a>    m_y.update({<span class="st">"model"</span>: model_name, <span class="st">"rule"</span>: <span class="st">"Youden (TPR-FPR)"</span>, <span class="st">"roc_auc"</span>: roc_auc, <span class="st">"ap"</span>: ap,</span>
<span id="cb23-75"><a href="#cb23-75" aria-hidden="true" tabindex="-1"></a>                <span class="st">"cost"</span>: c_fn<span class="op">*</span>m_y[<span class="st">"fn"</span>] <span class="op">+</span> c_fp<span class="op">*</span>m_y[<span class="st">"fp"</span>]})</span>
<span id="cb23-76"><a href="#cb23-76" aria-hidden="true" tabindex="-1"></a>    rows.append(m_y)</span>
<span id="cb23-77"><a href="#cb23-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-78"><a href="#cb23-78" aria-hidden="true" tabindex="-1"></a>    <span class="co"># FPR constraint</span></span>
<span id="cb23-79"><a href="#cb23-79" aria-hidden="true" tabindex="-1"></a>    t_f <span class="op">=</span> threshold_fpr_constraint(y_true01, score, alpha<span class="op">=</span>alpha)</span>
<span id="cb23-80"><a href="#cb23-80" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> t_f <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb23-81"><a href="#cb23-81" aria-hidden="true" tabindex="-1"></a>        m_f <span class="op">=</span> metrics_at_threshold(y_true01, score, t_f)</span>
<span id="cb23-82"><a href="#cb23-82" aria-hidden="true" tabindex="-1"></a>        m_f.update({<span class="st">"model"</span>: model_name, <span class="st">"rule"</span>: <span class="ss">f"FPR &lt;= </span><span class="sc">{</span>alpha<span class="sc">}</span><span class="ss">"</span>, <span class="st">"roc_auc"</span>: roc_auc, <span class="st">"ap"</span>: ap,</span>
<span id="cb23-83"><a href="#cb23-83" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"cost"</span>: c_fn<span class="op">*</span>m_f[<span class="st">"fn"</span>] <span class="op">+</span> c_fp<span class="op">*</span>m_f[<span class="st">"fp"</span>]})</span>
<span id="cb23-84"><a href="#cb23-84" aria-hidden="true" tabindex="-1"></a>        rows.append(m_f)</span>
<span id="cb23-85"><a href="#cb23-85" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb23-86"><a href="#cb23-86" aria-hidden="true" tabindex="-1"></a>        rows.append({<span class="st">"model"</span>: model_name, <span class="st">"rule"</span>: <span class="ss">f"FPR &lt;= </span><span class="sc">{</span>alpha<span class="sc">}</span><span class="ss">"</span>, <span class="st">"t"</span>: <span class="va">None</span>,</span>
<span id="cb23-87"><a href="#cb23-87" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"tn"</span>: <span class="va">None</span>, <span class="st">"fp"</span>: <span class="va">None</span>, <span class="st">"fn"</span>: <span class="va">None</span>, <span class="st">"tp"</span>: <span class="va">None</span>,</span>
<span id="cb23-88"><a href="#cb23-88" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"recall(tpr)"</span>: <span class="va">None</span>, <span class="st">"fpr"</span>: <span class="va">None</span>, <span class="st">"precision"</span>: <span class="va">None</span>, <span class="st">"accuracy"</span>: <span class="va">None</span>,</span>
<span id="cb23-89"><a href="#cb23-89" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"roc_auc"</span>: roc_auc, <span class="st">"ap"</span>: ap, <span class="st">"cost"</span>: <span class="va">None</span>})</span>
<span id="cb23-90"><a href="#cb23-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-91"><a href="#cb23-91" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Cost-based</span></span>
<span id="cb23-92"><a href="#cb23-92" aria-hidden="true" tabindex="-1"></a>    t_c, best_cost <span class="op">=</span> threshold_cost(y_true01, score, c_fn<span class="op">=</span>c_fn, c_fp<span class="op">=</span>c_fp)</span>
<span id="cb23-93"><a href="#cb23-93" aria-hidden="true" tabindex="-1"></a>    m_c <span class="op">=</span> metrics_at_threshold(y_true01, score, t_c)</span>
<span id="cb23-94"><a href="#cb23-94" aria-hidden="true" tabindex="-1"></a>    m_c.update({<span class="st">"model"</span>: model_name, <span class="st">"rule"</span>: <span class="ss">f"Cost (c_fn=</span><span class="sc">{</span>c_fn<span class="sc">}</span><span class="ss">, c_fp=</span><span class="sc">{</span>c_fp<span class="sc">}</span><span class="ss">)"</span>,</span>
<span id="cb23-95"><a href="#cb23-95" aria-hidden="true" tabindex="-1"></a>                <span class="st">"roc_auc"</span>: roc_auc, <span class="st">"ap"</span>: ap, <span class="st">"cost"</span>: best_cost})</span>
<span id="cb23-96"><a href="#cb23-96" aria-hidden="true" tabindex="-1"></a>    rows.append(m_c)</span>
<span id="cb23-97"><a href="#cb23-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-98"><a href="#cb23-98" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> rows</span>
<span id="cb23-99"><a href="#cb23-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-100"><a href="#cb23-100" aria-hidden="true" tabindex="-1"></a><span class="co"># --------------------------------------------</span></span>
<span id="cb23-101"><a href="#cb23-101" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) RF / GB score ì¶”ì¶œ (ì•…ì„± í™•ë¥ )</span></span>
<span id="cb23-102"><a href="#cb23-102" aria-hidden="true" tabindex="-1"></a><span class="co"># --------------------------------------------</span></span>
<span id="cb23-103"><a href="#cb23-103" aria-hidden="true" tabindex="-1"></a>score_rf <span class="op">=</span> get_score_for_class(rf_model, X_test, class_label<span class="op">=</span><span class="dv">0</span>)  <span class="co"># P(malignant|x)</span></span>
<span id="cb23-104"><a href="#cb23-104" aria-hidden="true" tabindex="-1"></a>score_gb <span class="op">=</span> get_score_for_class(gb_model, X_test, class_label<span class="op">=</span><span class="dv">0</span>)  <span class="co"># P(malignant|x)</span></span>
<span id="cb23-105"><a href="#cb23-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-106"><a href="#cb23-106" aria-hidden="true" tabindex="-1"></a><span class="co"># --------------------------------------------</span></span>
<span id="cb23-107"><a href="#cb23-107" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) ë¹„êµí‘œ ìƒì„±</span></span>
<span id="cb23-108"><a href="#cb23-108" aria-hidden="true" tabindex="-1"></a><span class="co"># --------------------------------------------</span></span>
<span id="cb23-109"><a href="#cb23-109" aria-hidden="true" tabindex="-1"></a>alpha <span class="op">=</span> <span class="fl">0.02</span></span>
<span id="cb23-110"><a href="#cb23-110" aria-hidden="true" tabindex="-1"></a>c_fn, c_fp <span class="op">=</span> <span class="fl">10.0</span>, <span class="fl">1.0</span></span>
<span id="cb23-111"><a href="#cb23-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-112"><a href="#cb23-112" aria-hidden="true" tabindex="-1"></a>rows <span class="op">=</span> []</span>
<span id="cb23-113"><a href="#cb23-113" aria-hidden="true" tabindex="-1"></a>rows <span class="op">+=</span> build_rows(<span class="st">"RandomForest"</span>, y_pos, score_rf, alpha<span class="op">=</span>alpha, c_fn<span class="op">=</span>c_fn, c_fp<span class="op">=</span>c_fp)</span>
<span id="cb23-114"><a href="#cb23-114" aria-hidden="true" tabindex="-1"></a>rows <span class="op">+=</span> build_rows(<span class="st">"GradientBoosting"</span>, y_pos, score_gb, alpha<span class="op">=</span>alpha, c_fn<span class="op">=</span>c_fn, c_fp<span class="op">=</span>c_fp)</span>
<span id="cb23-115"><a href="#cb23-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-116"><a href="#cb23-116" aria-hidden="true" tabindex="-1"></a>df_cmp_ens <span class="op">=</span> pd.DataFrame(rows)[</span>
<span id="cb23-117"><a href="#cb23-117" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"model"</span>,<span class="st">"rule"</span>,<span class="st">"t"</span>,<span class="st">"tn"</span>,<span class="st">"fp"</span>,<span class="st">"fn"</span>,<span class="st">"tp"</span>,<span class="st">"recall(tpr)"</span>,<span class="st">"fpr"</span>,<span class="st">"precision"</span>,<span class="st">"accuracy"</span>,<span class="st">"roc_auc"</span>,<span class="st">"ap"</span>,<span class="st">"cost"</span>]</span>
<span id="cb23-118"><a href="#cb23-118" aria-hidden="true" tabindex="-1"></a>].sort_values([<span class="st">"rule"</span>,<span class="st">"model"</span>]).reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb23-119"><a href="#cb23-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-120"><a href="#cb23-120" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"== ì•™ìƒë¸”(RF/GB): ì•…ì„±=positive ê¸°ì¤€ ì„ê³„ê°’ ë¹„êµí‘œ =="</span>)</span>
<span id="cb23-121"><a href="#cb23-121" aria-hidden="true" tabindex="-1"></a>display(df_cmp_ens)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/classification_ml_treeresult.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</section>
</section>
<section id="ì‚¬ë¡€ë¶„ì„ì´ì§„ë¶„ë¥˜-íšŒì†Œì„±ê³µ-ë¶ˆê· í˜•" class="level4">
<h4 class="anchored" data-anchor-id="ì‚¬ë¡€ë¶„ì„ì´ì§„ë¶„ë¥˜-íšŒì†Œì„±ê³µ-ë¶ˆê· í˜•">2. ì‚¬ë¡€ë¶„ì„(ì´ì§„ë¶„ë¥˜, íšŒì†Œì„±ê³µ-ë¶ˆê· í˜•)</h4>
<p>ë°ì´í„°ëŠ” í‘œë³¸ì´ ë§¤ìš° ì»¤ì„œ RBF SVM / kNNì€ ê·¸ëŒ€ë¡œ ëŒë¦¬ë©´ ëŠë¦´ ìˆ˜ ìˆì–´ ì‹¤ë¬´ì ìœ¼ë¡œëŠ” (1) Linear SVM + calibration ë˜ëŠ” (2) kNN/SVMì€ í•™ìŠµ ìƒ˜í”Œì„ ì¼ë¶€ë§Œ ì‚¬ìš©ì„ ê¶Œì¥í•©ë‹ˆë‹¤(ì½”ë“œì— ë°˜ì˜).</p>
<section id="ë°ì´í„°-1" class="level5">
<h5 class="anchored" data-anchor-id="ë°ì´í„°-1">(1) ë°ì´í„°</h5>
<p><strong>ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°</strong></p>
<p>Credit Card Fraud(creditcard.csv) ë°ì´í„°ëŠ” ëŒ€í‘œì ì¸ ì´ì§„ ë¶„ë¥˜(surveillance / fraud detection) ë²¤ì¹˜ë§ˆí¬ë¡œ, í•œ ê±´ì˜ ê±°ë˜ê°€ ì‚¬ê¸°(Fraud) ì¸ì§€ ì •ìƒ(Normal) ì¸ì§€ë¥¼ íŒì •í•˜ëŠ” ë¬¸ì œë¥¼ ë‹¤ë£¬ë‹¤.</p>
<p>ë°˜ì‘ë³€ìˆ˜ëŠ” Class í•˜ë‚˜ì´ë©° ë³´í†µ Class=0ì„ ì •ìƒ(negative), Class=1ì„ ì‚¬ê¸°(positive)ë¡œ ì •ì˜í•œë‹¤. ì¦‰ ëª©í‘œëŠ” ê° ê±°ë˜ <span class="math inline">\(P(Y=1âˆ£X=x)\)</span> ì„ ì¶”ì •í•˜ê³ , ìš´ì˜ ëª©ì (ì˜¤íƒ/ë¯¸íƒ ë¹„ìš©, ê²€í† ëŸ‰ ë“±)ì— ë§ëŠ” ì„ê³„ê°’ të¥¼ ì •í•´ <span class="math inline">\(\hat y =1{p(x)â‰¥t}\)</span> í˜•íƒœë¡œ ì˜ì‚¬ê²°ì •ì„ ë‚´ë¦¬ëŠ” ê²ƒì´ë‹¤.</p>
<p>ë°ì´í„° ê·œëª¨ëŠ” 284,807ê±´ì˜ ê±°ë˜ë¡œ êµ¬ì„±ë˜ë©°, ì´ 31ê°œ ë³€ìˆ˜ë¥¼ ê°€ì§„ë‹¤. ì´ ì¤‘ Classê°€ íƒ€ê¹ƒ(y)ì´ê³  ë‚˜ë¨¸ì§€ 30ê°œê°€ ì…ë ¥ ë³€ìˆ˜(X) ë‹¤. ì…ë ¥ ë³€ìˆ˜ëŠ” Time, V1~V28, Amountë¡œ ì´ë£¨ì–´ì§„ë‹¤. ìë£Œí˜• ê´€ì ì—ì„œ ì…ë ¥ ë³€ìˆ˜ë“¤ì€ ëŒ€ë¶€ë¶„ ì—°ì†í˜•ì´ë©°(ì‹¤ìˆ˜í˜•), Classë§Œ ì •ìˆ˜í˜• ë¼ë²¨ì´ë‹¤.</p>
<p>íŠ¹íˆ V1~V28ì€ ì›ë˜ ê±°ë˜ ì†ì„±ë“¤ì„ ê·¸ëŒ€ë¡œ ì œê³µí•œ ê²ƒì´ ì•„ë‹ˆë¼, ê°œì¸ì •ë³´ ë³´í˜¸ ë° ë¹„ì‹ë³„í™”ë¥¼ ìœ„í•´ PCA(ì£¼ì„±ë¶„ ë¶„ì„) ë¡œ ë³€í™˜ëœ íŠ¹ì§•ë“¤ì´ë‹¤. ë”°ë¼ì„œ ê° <span class="math inline">\(V_k\)</span> ëŠ” ì›ë³€ìˆ˜ë“¤ì˜ ì„ í˜•ê²°í•©ìœ¼ë¡œ ì–»ì–´ì§„ ì£¼ì„±ë¶„ ì ìˆ˜ì´ë©°, ì›ë˜ ë³€ìˆ˜ì˜ í•´ì„ ê°€ëŠ¥ì„±ì€ ì œí•œëœë‹¤.</p>
<p>ë°˜ë©´ Timeê³¼ AmountëŠ” ë¹„êµì  ì§ê´€ì ì¸ ì˜ë¯¸ë¥¼ ìœ ì§€í•œë‹¤. Timeì€ ê¸°ì¤€ ì‹œì  ì´í›„ì˜ ê²½ê³¼ ì‹œê°„ìœ¼ë¡œ ì‹œê°„ëŒ€ì— ë”°ë¥¸ íŒ¨í„´ì„ ë°˜ì˜í•  ìˆ˜ ìˆê³ , AmountëŠ” ê±°ë˜ ê¸ˆì•¡ìœ¼ë¡œì„œ ì‚¬ê¸° ì—¬ë¶€ì™€ ì—°ê´€ëœ ì¤‘ìš”í•œ ì‹ í˜¸ê°€ ë  ìˆ˜ ìˆë‹¤.</p>
<p>ì´ ë°ì´í„°ì˜ ê°€ì¥ ê²°ì •ì ì¸ íŠ¹ì„±ì€ ê·¹ì‹¬í•œ í´ë˜ìŠ¤ ë¶ˆê· í˜•(extreme class imbalance) ì´ë‹¤. ì •ìƒ ê±°ë˜(Class=0)ëŠ” 284,315ê±´ìœ¼ë¡œ ì „ì²´ì˜ ì•½ 99.827%ë¥¼ ì°¨ì§€í•˜ëŠ” ë°˜ë©´, ì‚¬ê¸° ê±°ë˜(Class=1)ëŠ” 492ê±´ìœ¼ë¡œ ì•½ 0.173%ì— ë¶ˆê³¼í•˜ë‹¤.</p>
<p>ì´ëŸ° í™˜ê²½ì—ì„œëŠ” ë‹¨ìˆœ ì •í™•ë„(Accuracy)ê°€ ì‰½ê²Œ ê³¼ëŒ€í‰ê°€ëœë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ëª¨ë“  ê±°ë˜ë¥¼ ì •ìƒìœ¼ë¡œë§Œ ì˜ˆì¸¡í•´ë„ ì •í™•ë„ëŠ” ì•½ 99.8%ì— ë‹¬í•  ìˆ˜ ìˆìœ¼ë‚˜, ì´ëŠ” ì‚¬ê¸° íƒì§€ë¼ëŠ” ëª©ì ì„ ì „í˜€ ë‹¬ì„±í•˜ì§€ ëª»í•œë‹¤. ë”°ë¼ì„œ ì‹¤ë¬´ì ìœ¼ë¡œëŠ” ì–‘ì„±(ì‚¬ê¸°) íƒì§€ ì„±ëŠ¥ì„ ì§ì ‘ ë°˜ì˜í•˜ëŠ” ì§€í‘œ, ì˜ˆì»¨ëŒ€ Precisionâ€“Recall(PR) ê´€ì ì˜ í‰ê°€(AP í¬í•¨)ë‚˜, ì˜¤íƒì„ ì¼ì • ìˆ˜ì¤€ ì´í•˜ë¡œ ì œí•œí•˜ëŠ” FPR ì œì•½ ê¸°ë°˜ ì„ê³„ê°’ ì„ íƒ, í˜¹ì€ ë¯¸íƒ(FN)ê³¼ ì˜¤íƒ(FP)ì˜ ë¹„ìš©ì„ ë°˜ì˜í•œ ë¹„ìš©ê¸°ë°˜ ì„ê³„ê°’ ì„¤ê³„ê°€ í•µì‹¬ì´ ëœë‹¤.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip <span class="op">-</span>q install kagglehub</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> kagglehub</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="co"># ë°ì´í„° ë‹¤ìš´ë¡œë“œ (ìºì‹œ ê²½ë¡œ ë°˜í™˜)</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>path <span class="op">=</span> kagglehub.dataset_download(<span class="st">"mlg-ulb/creditcardfraud"</span>)</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"downloaded to:"</span>, path)</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(os.listdir(path)[:<span class="dv">10</span>])</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a><span class="co"># CSV ë¡œë“œ</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(os.path.join(path, <span class="st">"creditcard.csv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>ë°ì´í„° ë©”íƒ€ì •ë³´ (ë¶ˆê· í˜• í™•ì¸)</strong></p>
<div class="sourceCode" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"shape:"</span>, df.shape)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co"># íƒ€ê¹ƒ</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df[<span class="st">"Class"</span>].astype(<span class="bu">int</span>)        <span class="co"># 1=Fraud(positive), 0=Normal</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df.drop(columns<span class="op">=</span>[<span class="st">"Class"</span>])</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="co"># ë¶ˆê· í˜• ì •ë„</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>cnt <span class="op">=</span> y.value_counts().sort_index()</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>ratio <span class="op">=</span> cnt <span class="op">/</span> cnt.<span class="bu">sum</span>()</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Class counts:"</span>)</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(cnt)</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Class ratio:"</span>)</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ratio)</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Fraud rate ="</span>, ratio.loc[<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre class="text"><code>shape: (284807, 31)

Class counts:
Class
0    284315
1       492
Name: count, dtype: int64

Class ratio:
Class
0    0.998273
1    0.001727
Name: count, dtype: float64

Fraud rate = 0.001727485630620034</code></pre>
<p><strong>Train/Test ë¶„í• (ì¸µí™”) + í‘œì¤€í™” íŒŒì´í”„ë¼ì¸</strong></p>
<p>ì´ ì½”ë“œëŠ” (1) ë°ì´í„°ë¥¼ í›ˆë ¨/í…ŒìŠ¤íŠ¸ë¡œ ë‚˜ëˆ„ê³ , (2) ë¶ˆê· í˜• ìƒí™©ì—ì„œë„ ë¼ë²¨ ë¹„ìœ¨ì´ ìœ ì§€ë˜ë„ë¡ ì¸µí™”(stratify) í•˜ë©°, ì´í›„ ëª¨ë¸ë§ì—ì„œ ë°˜ë³µì ìœ¼ë¡œ ì“¸ í‘œì¤€í™”(Standardization) ë„êµ¬ë¥¼ ì¤€ë¹„í•˜ëŠ” ë‹¨ê³„ë‹¤.</p>
<p>ë¨¼ì € train_test_splitì€ ì „ì²´ ë°ì´í„° (X,y)ë¥¼ í›ˆë ¨ìš©(train) ê³¼ í‰ê°€ìš©(test) ìœ¼ë¡œ ë¶„ë¦¬í•œë‹¤. ì—¬ê¸°ì„œ test_size=0.2ëŠ” ì „ì²´ì˜ 20%ë¥¼ í…ŒìŠ¤íŠ¸ ì„¸íŠ¸ë¡œ ë–¼ì–´ë‘ê² ë‹¤ëŠ” ëœ»ì´ë©°, ê²°ê³¼ì ìœ¼ë¡œ í•™ìŠµì€ 80%, í‰ê°€ëŠ” 20% ë°ì´í„°ë¡œ ìˆ˜í–‰ëœë‹¤.</p>
<p>random_state=42ëŠ” ë¶„í•  ê³¼ì •ì—ì„œ ë‚œìˆ˜ ì‹œë“œë¥¼ ê³ ì •í•´, ì½”ë“œë¥¼ ë‹¤ì‹œ ì‹¤í–‰í•´ë„ ë™ì¼í•œ ë¶„í•  ê²°ê³¼ê°€ ë‚˜ì˜¤ë„ë¡ í•œë‹¤. ì¦‰ ì¬í˜„ì„±(reproducibility)ì„ í™•ë³´í•œë‹¤.</p>
<p>íŠ¹íˆ ì¤‘ìš”í•œ ì˜µì…˜ì´ stratify=yë‹¤. Credit Card Fraudì²˜ëŸ¼ ì–‘ì„±(ì‚¬ê¸°) ë¹„ìœ¨ì´ ê·¹ë‹¨ì ìœ¼ë¡œ ì‘ì€ ë°ì´í„°ì—ì„œëŠ”, ë¬´ì‘ìœ„ ë¶„í• ë§Œ í•˜ë©´ í…ŒìŠ¤íŠ¸ ì„¸íŠ¸ì— ì–‘ì„±ì´ ê±°ì˜ ì—†ê±°ë‚˜(í˜¹ì€ ìš°ì—°íˆ ëª°ë¦¬ê±°ë‚˜) í•˜ëŠ” ì¼ì´ ë°œìƒí•  ìˆ˜ ìˆë‹¤.</p>
<p>ê·¸ëŸ¬ë©´ í‰ê°€ ì§€í‘œ(ROC/PR ë“±)ê°€ ë¶ˆì•ˆì •í•´ì§€ê³ , ëª¨ë¸ ë¹„êµë„ ì™œê³¡ëœë‹¤. stratify=yëŠ” ë¶„í• í•  ë•Œ í›ˆë ¨/í…ŒìŠ¤íŠ¸ ê°ê°ì—ì„œ í´ë˜ìŠ¤ ë¹„ìœ¨ì´ ì›ìë£Œì™€ ê±°ì˜ ê°™ë„ë¡ ê°•ì œí•œë‹¤. ì¦‰ <span class="math inline">\(P(Y=1) in trainâ‰ˆP(Y=1) in testâ‰ˆP(Y=1) in full data\)</span> ê°€ ë˜ê²Œ ë§Œë“œëŠ” ì¥ì¹˜ë‹¤. ë¶ˆê· í˜• íƒì§€ ë¬¸ì œì—ì„œëŠ” ì‚¬ì‹¤ìƒ í•„ìˆ˜ ì˜µì…˜ì— ê°€ê¹ë‹¤.</p>
<p>ë§ˆì§€ë§‰ì˜ scaler = StandardScaler()ëŠ” ì…ë ¥ ë³€ìˆ˜ Xë¥¼ í‘œì¤€í™”í•˜ê¸° ìœ„í•œ ê°ì²´ë¥¼ ë§Œë“ ë‹¤. í‘œì¤€í™”ëŠ” ê° ë³€ìˆ˜ë¥¼ í‰ê·  0, ë¶„ì‚° 1ì´ ë˜ë„ë¡ ë³€í™˜í•˜ëŠ” ê²ƒì´ë‹¤. ì´ëŠ” k-NNì²˜ëŸ¼ ê±°ë¦¬(distance) ì— ë¯¼ê°í•œ ëª¨ë¸ì´ë‚˜ SVMì²˜ëŸ¼ ê²°ì •ê²½ê³„ê°€ ìŠ¤ì¼€ì¼ì— ì˜í–¥ì„ ë°›ëŠ” ëª¨ë¸ì—ì„œ íŠ¹íˆ ì¤‘ìš”í•˜ë‹¤.</p>
<p>ì—¬ê¸°ì„œëŠ” scalerë§Œ â€œë”°ë¡œâ€ ë§Œë“¤ì–´ ë‘ì—ˆê³ , ì‹¤ì œë¡œëŠ” ì´í›„ Pipeline([(â€œscalerâ€, StandardScaler()), (â€œmodelâ€, â€¦)]) í˜•íƒœë¡œ ëª¨ë¸ê³¼ í•¨ê»˜ ë¬¶ì–´ í›ˆë ¨ ë°ì´í„°ë¡œë§Œ í‘œì¤€í™” íŒŒë¼ë¯¸í„°(í‰ê· /í‘œì¤€í¸ì°¨)ë¥¼ ì¶”ì •í•˜ê³ , ê·¸ ë³€í™˜ì„ í…ŒìŠ¤íŠ¸ ë°ì´í„°ì— ë™ì¼í•˜ê²Œ ì ìš©í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì‚¬ìš©í•œë‹¤. ì´ë ‡ê²Œ í•´ì•¼ ë°ì´í„° ëˆ„ìˆ˜(data leakage)ê°€ ìƒê¸°ì§€ ì•ŠëŠ”ë‹¤.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> Pipeline</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    X, y,</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    test_size<span class="op">=</span><span class="fl">0.2</span>,</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    stratify<span class="op">=</span>y,          <span class="co"># ê·¹ì‹¬ ë¶ˆê· í˜•ì´ë¯€ë¡œ í•„ìˆ˜</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>    random_state<span class="op">=</span><span class="dv">42</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="co"># í‘œì¤€í™” íŒŒì´í”„ë¼ì¸(ëª¨ë¸ë§ˆë‹¤ ë¶™ì—¬ ì“°ê¸° ìœ„í•´ scalerë§Œ ë”°ë¡œ ì •ì˜)</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="ëª¨ë¸-í•™ìŠµ-k-nn-svm" class="level5">
<h5 class="anchored" data-anchor-id="ëª¨ë¸-í•™ìŠµ-k-nn-svm">(2) ëª¨ë¸ í•™ìŠµ (k-NN / SVM)</h5>
<p><strong>k-NN (ëŒ€ìš©ëŸ‰ì´ë¼ í•™ìŠµ ìƒ˜í”Œ ì¼ë¶€ë§Œ ì‚¬ìš© ê¶Œì¥)</strong></p>
<div class="sourceCode" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.neighbors <span class="im">import</span> KNeighborsClassifier</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> Pipeline</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># kNNì€ ëŒ€ìš©ëŸ‰ì—ì„œ ëŠë¦¬ë¯€ë¡œ í•™ìŠµ ë°ì´í„° ì¼ë¶€ë§Œ ì‚¬ìš©</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>n_sub <span class="op">=</span> <span class="bu">min</span>(<span class="dv">50000</span>, <span class="bu">len</span>(X_train))</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>sub_idx <span class="op">=</span> np.random.RandomState(<span class="dv">42</span>).choice(<span class="bu">len</span>(X_train), size<span class="op">=</span>n_sub, replace<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="co"># âœ… DataFrame/SeriesëŠ” .ilocë¡œ 'í–‰' ì„ íƒ</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>X_train_knn <span class="op">=</span> X_train.iloc[sub_idx]</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>y_train_knn <span class="op">=</span> y_train.iloc[sub_idx]</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>knn_model <span class="op">=</span> Pipeline([</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"scaler"</span>, StandardScaler()),</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"knn"</span>, KNeighborsClassifier(</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>        n_neighbors<span class="op">=</span><span class="dv">15</span>,</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>        weights<span class="op">=</span><span class="st">"distance"</span>,</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>        p<span class="op">=</span><span class="dv">2</span></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>knn_model.fit(X_train_knn, y_train_knn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/classification_ml_knnfit.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:40.0%"></p>
</figure>
</div>
<p><strong>SVM (ì‹¤ë¬´ ê¶Œì¥: Linear SVM + í™•ë¥  ë³´ì •(calibration))</strong></p>
<div class="sourceCode" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.svm <span class="im">import</span> LinearSVC</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.calibration <span class="im">import</span> CalibratedClassifierCV</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Linear SVM (ê²°ì •í•¨ìˆ˜) + í™•ë¥  ë³´ì •(sigmoid)</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>svm_base <span class="op">=</span> Pipeline([</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"scaler"</span>, StandardScaler()),</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"svm"</span>, LinearSVC(</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>        C<span class="op">=</span><span class="fl">1.0</span>,</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>        class_weight<span class="op">=</span><span class="st">"balanced"</span>,   <span class="co"># ë¶ˆê· í˜• ëŒ€ì‘(ê¸°ë³¸ ì˜µì…˜)</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>        random_state<span class="op">=</span><span class="dv">42</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a><span class="co"># CalibratedClassifierCVëŠ” estimatorê°€ ì´ë¯¸ pipelineì´ì–´ë„ ë™ì‘</span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>svm_model <span class="op">=</span> CalibratedClassifierCV(</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>    estimator<span class="op">=</span>svm_base,</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>    method<span class="op">=</span><span class="st">"sigmoid"</span>,</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>    cv<span class="op">=</span><span class="dv">3</span></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>svm_model.fit(X_train, y_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/classification_ml_svmfit.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:40.0%"></p>
</figure>
</div>
<p><strong>ROC/PR + ì„ê³„ê°’(Youden / FPRì œì•½ / ë¹„ìš©ê¸°ë°˜) + ë¹„êµí‘œ</strong></p>
<div class="sourceCode" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> (</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    roc_curve, auc,</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    precision_recall_curve, average_precision_score,</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    confusion_matrix</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="co"># (ì•ˆì „) yë¥¼ numpy 1ì°¨ì›ìœ¼ë¡œ í†µì¼</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>y_train <span class="op">=</span> np.asarray(y_train).ravel()</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>y_test  <span class="op">=</span> np.asarray(y_test).ravel()</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>y_pos   <span class="op">=</span> y_test  <span class="co"># 1=Fraud(positive)</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_pos_score(model, X):</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>    proba <span class="op">=</span> model.predict_proba(X)</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>    classes <span class="op">=</span> np.array(model.classes_)</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>    idx <span class="op">=</span> np.where(classes <span class="op">==</span> <span class="dv">1</span>)[<span class="dv">0</span>][<span class="dv">0</span>]</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> proba[:, idx]</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> metrics_at_threshold(y_true01, score, t):</span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>    y_hat <span class="op">=</span> (score <span class="op">&gt;=</span> t).astype(<span class="bu">int</span>)</span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>    tn, fp, fn, tp <span class="op">=</span> confusion_matrix(y_true01, y_hat).ravel()</span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>    tpr <span class="op">=</span> tp <span class="op">/</span> (tp <span class="op">+</span> fn) <span class="cf">if</span> (tp <span class="op">+</span> fn) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="fl">0.0</span></span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>    fpr <span class="op">=</span> fp <span class="op">/</span> (fp <span class="op">+</span> tn) <span class="cf">if</span> (fp <span class="op">+</span> tn) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="fl">0.0</span></span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>    prec <span class="op">=</span> tp <span class="op">/</span> (tp <span class="op">+</span> fp) <span class="cf">if</span> (tp <span class="op">+</span> fp) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="fl">0.0</span></span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a>    acc <span class="op">=</span> (tp <span class="op">+</span> tn) <span class="op">/</span> (tp <span class="op">+</span> tn <span class="op">+</span> fp <span class="op">+</span> fn)</span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {<span class="st">"t"</span>: <span class="bu">float</span>(t), <span class="st">"tn"</span>: <span class="bu">int</span>(tn), <span class="st">"fp"</span>: <span class="bu">int</span>(fp), <span class="st">"fn"</span>: <span class="bu">int</span>(fn), <span class="st">"tp"</span>: <span class="bu">int</span>(tp),</span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a>            <span class="st">"recall(tpr)"</span>: <span class="bu">float</span>(tpr), <span class="st">"fpr"</span>: <span class="bu">float</span>(fpr), <span class="st">"precision"</span>: <span class="bu">float</span>(prec), <span class="st">"accuracy"</span>: <span class="bu">float</span>(acc)}</span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> threshold_youden(y_true01, score):</span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a>    fpr, tpr, thr <span class="op">=</span> roc_curve(y_true01, score)</span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a>    J <span class="op">=</span> tpr <span class="op">-</span> fpr</span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">float</span>(thr[np.argmax(J)])</span>
<span id="cb30-36"><a href="#cb30-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-37"><a href="#cb30-37" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> threshold_fpr_constraint(y_true01, score, alpha<span class="op">=</span><span class="fl">0.001</span>):</span>
<span id="cb30-38"><a href="#cb30-38" aria-hidden="true" tabindex="-1"></a>    fpr, tpr, thr <span class="op">=</span> roc_curve(y_true01, score)</span>
<span id="cb30-39"><a href="#cb30-39" aria-hidden="true" tabindex="-1"></a>    cand <span class="op">=</span> np.where(fpr <span class="op">&lt;=</span> alpha)[<span class="dv">0</span>]</span>
<span id="cb30-40"><a href="#cb30-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(cand) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb30-41"><a href="#cb30-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb30-42"><a href="#cb30-42" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> cand[np.argmax(tpr[cand])]</span>
<span id="cb30-43"><a href="#cb30-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">float</span>(thr[i])</span>
<span id="cb30-44"><a href="#cb30-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-45"><a href="#cb30-45" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> threshold_cost(y_true01, score, c_fn<span class="op">=</span><span class="fl">100.0</span>, c_fp<span class="op">=</span><span class="fl">1.0</span>):</span>
<span id="cb30-46"><a href="#cb30-46" aria-hidden="true" tabindex="-1"></a>    thresholds <span class="op">=</span> np.unique(np.r_[<span class="fl">0.0</span>, score, <span class="fl">1.0</span>])</span>
<span id="cb30-47"><a href="#cb30-47" aria-hidden="true" tabindex="-1"></a>    best_t, best_cost <span class="op">=</span> <span class="va">None</span>, np.inf</span>
<span id="cb30-48"><a href="#cb30-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> t <span class="kw">in</span> thresholds:</span>
<span id="cb30-49"><a href="#cb30-49" aria-hidden="true" tabindex="-1"></a>        m <span class="op">=</span> metrics_at_threshold(y_true01, score, t)</span>
<span id="cb30-50"><a href="#cb30-50" aria-hidden="true" tabindex="-1"></a>        cost <span class="op">=</span> c_fn<span class="op">*</span>m[<span class="st">"fn"</span>] <span class="op">+</span> c_fp<span class="op">*</span>m[<span class="st">"fp"</span>]</span>
<span id="cb30-51"><a href="#cb30-51" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> cost <span class="op">&lt;</span> best_cost:</span>
<span id="cb30-52"><a href="#cb30-52" aria-hidden="true" tabindex="-1"></a>            best_cost <span class="op">=</span> cost</span>
<span id="cb30-53"><a href="#cb30-53" aria-hidden="true" tabindex="-1"></a>            best_t <span class="op">=</span> <span class="bu">float</span>(t)</span>
<span id="cb30-54"><a href="#cb30-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> best_t, <span class="bu">float</span>(best_cost)</span>
<span id="cb30-55"><a href="#cb30-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-56"><a href="#cb30-56" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> build_rows(model_name, y_true01, score, alpha<span class="op">=</span><span class="fl">0.001</span>, c_fn<span class="op">=</span><span class="fl">100.0</span>, c_fp<span class="op">=</span><span class="fl">1.0</span>):</span>
<span id="cb30-57"><a href="#cb30-57" aria-hidden="true" tabindex="-1"></a>    rows <span class="op">=</span> []</span>
<span id="cb30-58"><a href="#cb30-58" aria-hidden="true" tabindex="-1"></a>    fpr, tpr, _ <span class="op">=</span> roc_curve(y_true01, score)</span>
<span id="cb30-59"><a href="#cb30-59" aria-hidden="true" tabindex="-1"></a>    roc_auc <span class="op">=</span> auc(fpr, tpr)</span>
<span id="cb30-60"><a href="#cb30-60" aria-hidden="true" tabindex="-1"></a>    ap <span class="op">=</span> average_precision_score(y_true01, score)</span>
<span id="cb30-61"><a href="#cb30-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-62"><a href="#cb30-62" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Youden</span></span>
<span id="cb30-63"><a href="#cb30-63" aria-hidden="true" tabindex="-1"></a>    t_y <span class="op">=</span> threshold_youden(y_true01, score)</span>
<span id="cb30-64"><a href="#cb30-64" aria-hidden="true" tabindex="-1"></a>    m_y <span class="op">=</span> metrics_at_threshold(y_true01, score, t_y)</span>
<span id="cb30-65"><a href="#cb30-65" aria-hidden="true" tabindex="-1"></a>    m_y.update({<span class="st">"model"</span>: model_name, <span class="st">"rule"</span>: <span class="st">"Youden (TPR-FPR)"</span>, <span class="st">"roc_auc"</span>: roc_auc, <span class="st">"ap"</span>: ap,</span>
<span id="cb30-66"><a href="#cb30-66" aria-hidden="true" tabindex="-1"></a>                <span class="st">"cost"</span>: c_fn<span class="op">*</span>m_y[<span class="st">"fn"</span>] <span class="op">+</span> c_fp<span class="op">*</span>m_y[<span class="st">"fp"</span>]})</span>
<span id="cb30-67"><a href="#cb30-67" aria-hidden="true" tabindex="-1"></a>    rows.append(m_y)</span>
<span id="cb30-68"><a href="#cb30-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-69"><a href="#cb30-69" aria-hidden="true" tabindex="-1"></a>    <span class="co"># FPR constraint</span></span>
<span id="cb30-70"><a href="#cb30-70" aria-hidden="true" tabindex="-1"></a>    t_f <span class="op">=</span> threshold_fpr_constraint(y_true01, score, alpha<span class="op">=</span>alpha)</span>
<span id="cb30-71"><a href="#cb30-71" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> t_f <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb30-72"><a href="#cb30-72" aria-hidden="true" tabindex="-1"></a>        m_f <span class="op">=</span> metrics_at_threshold(y_true01, score, t_f)</span>
<span id="cb30-73"><a href="#cb30-73" aria-hidden="true" tabindex="-1"></a>        m_f.update({<span class="st">"model"</span>: model_name, <span class="st">"rule"</span>: <span class="ss">f"FPR &lt;= </span><span class="sc">{</span>alpha<span class="sc">}</span><span class="ss">"</span>, <span class="st">"roc_auc"</span>: roc_auc, <span class="st">"ap"</span>: ap,</span>
<span id="cb30-74"><a href="#cb30-74" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"cost"</span>: c_fn<span class="op">*</span>m_f[<span class="st">"fn"</span>] <span class="op">+</span> c_fp<span class="op">*</span>m_f[<span class="st">"fp"</span>]})</span>
<span id="cb30-75"><a href="#cb30-75" aria-hidden="true" tabindex="-1"></a>        rows.append(m_f)</span>
<span id="cb30-76"><a href="#cb30-76" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb30-77"><a href="#cb30-77" aria-hidden="true" tabindex="-1"></a>        rows.append({<span class="st">"model"</span>: model_name, <span class="st">"rule"</span>: <span class="ss">f"FPR &lt;= </span><span class="sc">{</span>alpha<span class="sc">}</span><span class="ss">"</span>, <span class="st">"t"</span>: <span class="va">None</span>,</span>
<span id="cb30-78"><a href="#cb30-78" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"tn"</span>: <span class="va">None</span>, <span class="st">"fp"</span>: <span class="va">None</span>, <span class="st">"fn"</span>: <span class="va">None</span>, <span class="st">"tp"</span>: <span class="va">None</span>,</span>
<span id="cb30-79"><a href="#cb30-79" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"recall(tpr)"</span>: <span class="va">None</span>, <span class="st">"fpr"</span>: <span class="va">None</span>, <span class="st">"precision"</span>: <span class="va">None</span>, <span class="st">"accuracy"</span>: <span class="va">None</span>,</span>
<span id="cb30-80"><a href="#cb30-80" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"roc_auc"</span>: roc_auc, <span class="st">"ap"</span>: ap, <span class="st">"cost"</span>: <span class="va">None</span>})</span>
<span id="cb30-81"><a href="#cb30-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-82"><a href="#cb30-82" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Cost-based</span></span>
<span id="cb30-83"><a href="#cb30-83" aria-hidden="true" tabindex="-1"></a>    t_c, best_cost <span class="op">=</span> threshold_cost(y_true01, score, c_fn<span class="op">=</span>c_fn, c_fp<span class="op">=</span>c_fp)</span>
<span id="cb30-84"><a href="#cb30-84" aria-hidden="true" tabindex="-1"></a>    m_c <span class="op">=</span> metrics_at_threshold(y_true01, score, t_c)</span>
<span id="cb30-85"><a href="#cb30-85" aria-hidden="true" tabindex="-1"></a>    m_c.update({<span class="st">"model"</span>: model_name, <span class="st">"rule"</span>: <span class="ss">f"Cost (c_fn=</span><span class="sc">{</span>c_fn<span class="sc">}</span><span class="ss">, c_fp=</span><span class="sc">{</span>c_fp<span class="sc">}</span><span class="ss">)"</span>,</span>
<span id="cb30-86"><a href="#cb30-86" aria-hidden="true" tabindex="-1"></a>                <span class="st">"roc_auc"</span>: roc_auc, <span class="st">"ap"</span>: ap, <span class="st">"cost"</span>: best_cost})</span>
<span id="cb30-87"><a href="#cb30-87" aria-hidden="true" tabindex="-1"></a>    rows.append(m_c)</span>
<span id="cb30-88"><a href="#cb30-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-89"><a href="#cb30-89" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> rows</span>
<span id="cb30-90"><a href="#cb30-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-91"><a href="#cb30-91" aria-hidden="true" tabindex="-1"></a><span class="co"># score</span></span>
<span id="cb30-92"><a href="#cb30-92" aria-hidden="true" tabindex="-1"></a>score_knn <span class="op">=</span> get_pos_score(knn_model, X_test)</span>
<span id="cb30-93"><a href="#cb30-93" aria-hidden="true" tabindex="-1"></a>score_svm <span class="op">=</span> get_pos_score(svm_model, X_test)</span>
<span id="cb30-94"><a href="#cb30-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-95"><a href="#cb30-95" aria-hidden="true" tabindex="-1"></a>alpha <span class="op">=</span> <span class="fl">0.001</span></span>
<span id="cb30-96"><a href="#cb30-96" aria-hidden="true" tabindex="-1"></a>c_fn, c_fp <span class="op">=</span> <span class="fl">100.0</span>, <span class="fl">1.0</span></span>
<span id="cb30-97"><a href="#cb30-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-98"><a href="#cb30-98" aria-hidden="true" tabindex="-1"></a>rows <span class="op">=</span> []</span>
<span id="cb30-99"><a href="#cb30-99" aria-hidden="true" tabindex="-1"></a>rows <span class="op">+=</span> build_rows(<span class="st">"k-NN"</span>, y_pos, score_knn, alpha<span class="op">=</span>alpha, c_fn<span class="op">=</span>c_fn, c_fp<span class="op">=</span>c_fp)</span>
<span id="cb30-100"><a href="#cb30-100" aria-hidden="true" tabindex="-1"></a>rows <span class="op">+=</span> build_rows(<span class="st">"SVM(Linear+Calib)"</span>, y_pos, score_svm, alpha<span class="op">=</span>alpha, c_fn<span class="op">=</span>c_fn, c_fp<span class="op">=</span>c_fp)</span>
<span id="cb30-101"><a href="#cb30-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-102"><a href="#cb30-102" aria-hidden="true" tabindex="-1"></a>df_cmp <span class="op">=</span> pd.DataFrame(rows)[</span>
<span id="cb30-103"><a href="#cb30-103" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"model"</span>,<span class="st">"rule"</span>,<span class="st">"t"</span>,<span class="st">"tn"</span>,<span class="st">"fp"</span>,<span class="st">"fn"</span>,<span class="st">"tp"</span>,<span class="st">"recall(tpr)"</span>,<span class="st">"fpr"</span>,<span class="st">"precision"</span>,<span class="st">"accuracy"</span>,<span class="st">"roc_auc"</span>,<span class="st">"ap"</span>,<span class="st">"cost"</span>]</span>
<span id="cb30-104"><a href="#cb30-104" aria-hidden="true" tabindex="-1"></a>].sort_values([<span class="st">"rule"</span>,<span class="st">"model"</span>]).reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb30-105"><a href="#cb30-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-106"><a href="#cb30-106" aria-hidden="true" tabindex="-1"></a>display(df_cmp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/classification_ml_knnsvmresult.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</section>
<section id="ëª¨ë¸-í•™ìŠµ-íšŒê·€ê¸°ë°˜-íŠ¸ë¦¬ê¸°ë°˜-ì•™ìƒë¸”" class="level5">
<h5 class="anchored" data-anchor-id="ëª¨ë¸-í•™ìŠµ-íšŒê·€ê¸°ë°˜-íŠ¸ë¦¬ê¸°ë°˜-ì•™ìƒë¸”">(3) ëª¨ë¸ í•™ìŠµ (íšŒê·€ê¸°ë°˜ íŠ¸ë¦¬ê¸°ë°˜ ì•™ìƒë¸”)</h5>
<p><strong>íšŒê·€ê¸°ë°˜</strong></p>
<div class="sourceCode" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> Pipeline</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LogisticRegression</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> confusion_matrix, classification_report</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>logit_model <span class="op">=</span> Pipeline([</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"scaler"</span>, StandardScaler()),</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"logit"</span>, LogisticRegression(</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>        C<span class="op">=</span><span class="fl">1.0</span>,</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>        solver<span class="op">=</span><span class="st">"lbfgs"</span>,</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>        max_iter<span class="op">=</span><span class="dv">5000</span>,</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>        class_weight<span class="op">=</span><span class="st">"balanced"</span>,   <span class="co"># ê·¹ì‹¬ ë¶ˆê· í˜• ëŒ€ì‘(ê¸°ë³¸ ì˜µì…˜)</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>        random_state<span class="op">=</span><span class="dv">42</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>logit_model.fit(X_train, y_train)</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>y_pred_logit <span class="op">=</span> logit_model.predict(X_test)</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"[Logit] Confusion matrix:</span><span class="ch">\n</span><span class="st">"</span>, confusion_matrix(y_test, y_pred_logit))</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"[Logit] Classification report:</span><span class="ch">\n</span><span class="st">"</span>, classification_report(y_test, y_pred_logit, digits<span class="op">=</span><span class="dv">4</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre class="text"><code>[Logit] Confusion matrix:
 [[55478  1386]
 [    8    90]]
[Logit] Classification report:
               precision    recall  f1-score   support

           0     0.9999    0.9756    0.9876     56864
           1     0.0610    0.9184    0.1144        98

    accuracy                         0.9755     56962
   macro avg     0.5304    0.9470    0.5510     56962
weighted avg     0.9982    0.9755    0.9861     56962</code></pre>
<div class="sourceCode" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) ê³„ìˆ˜ êº¼ë‚´ê¸° (í‘œì¤€í™”ëœ ìŠ¤ì¼€ì¼ ê¸°ì¤€)</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>logit  <span class="op">=</span> logit_model.named_steps[<span class="st">"logit"</span>]</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>coef   <span class="op">=</span> logit.coef_.ravel()</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>intercept <span class="op">=</span> <span class="bu">float</span>(logit.intercept_[<span class="dv">0</span>])</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>feature_names <span class="op">=</span> X.columns</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>df_coef <span class="op">=</span> pd.DataFrame({</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"feature"</span>: feature_names,</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"coef"</span>: coef,</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"odds_ratio"</span>: np.exp(coef),        <span class="co"># OR = exp(beta)</span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"abs_coef"</span>: np.<span class="bu">abs</span>(coef),</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"abs_logOR"</span>: np.<span class="bu">abs</span>(coef)          <span class="co"># log(OR)=coef ì´ë¯€ë¡œ ì ˆëŒ“ê°’ì€ ë™ì¼</span></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>}).sort_values(<span class="st">"abs_coef"</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Intercept:"</span>, intercept)</span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) (+) ê³„ìˆ˜ í° ê²ƒ Top10  -&gt; OR &gt; 1</span></span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>top_pos10 <span class="op">=</span> df_coef[df_coef[<span class="st">"coef"</span>] <span class="op">&gt;</span> <span class="dv">0</span>].sort_values(<span class="st">"coef"</span>, ascending<span class="op">=</span><span class="va">False</span>).head(<span class="dv">10</span>)</span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) (-) ê³„ìˆ˜ 'í° ê²ƒ' Top10  -&gt; ê°€ì¥ ìŒìˆ˜(ì ˆëŒ“ê°’ í° ìŒìˆ˜), OR &lt; 1</span></span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>top_neg10 <span class="op">=</span> df_coef[df_coef[<span class="st">"coef"</span>] <span class="op">&lt;</span> <span class="dv">0</span>].sort_values(<span class="st">"coef"</span>, ascending<span class="op">=</span><span class="va">True</span>).head(<span class="dv">10</span>)</span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">[Top 10 POSITIVE coefs] (Fraud=1 odds â†‘, OR&gt;1)"</span>)</span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>display(top_pos10[[<span class="st">"feature"</span>,<span class="st">"coef"</span>,<span class="st">"odds_ratio"</span>]])</span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">[Top 10 NEGATIVE coefs] (Fraud=1 odds â†“, OR&lt;1)"</span>)</span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a>display(top_neg10[[<span class="st">"feature"</span>,<span class="st">"coef"</span>,<span class="st">"odds_ratio"</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/classification_ml_rareregodds.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:60.0%"></p>
</figure>
</div>
<p><strong>íŠ¸ë¦¬ê¸°ë°˜</strong></p>
<div class="sourceCode" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.tree <span class="im">import</span> DecisionTreeClassifier</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> confusion_matrix, classification_report</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>tree_model <span class="op">=</span> DecisionTreeClassifier(</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>    criterion<span class="op">=</span><span class="st">"gini"</span>,</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    max_depth<span class="op">=</span><span class="dv">6</span>,</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>    min_samples_leaf<span class="op">=</span><span class="dv">50</span>,     <span class="co"># fraudì—ì„œëŠ” leafë¥¼ ë„ˆë¬´ ì‘ê²Œ ë‘ë©´ ê³¼ì í•© ì‰¬ì›€</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>    class_weight<span class="op">=</span><span class="st">"balanced"</span>,</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>    random_state<span class="op">=</span><span class="dv">42</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>tree_model.fit(X_train, y_train)</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>y_pred_tree <span class="op">=</span> tree_model.predict(X_test)</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"[Tree] Confusion matrix:</span><span class="ch">\n</span><span class="st">"</span>, confusion_matrix(y_test, y_pred_tree))</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"[Tree] Classification report:</span><span class="ch">\n</span><span class="st">"</span>, classification_report(y_test, y_pred_tree, digits<span class="op">=</span><span class="dv">4</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre class="text"><code>[Tree] Confusion matrix:
 [[55491  1373]
 [   13    85]]
[Tree] Classification report:
               precision    recall  f1-score   support

           0     0.9998    0.9759    0.9877     56864
           1     0.0583    0.8673    0.1093        98

    accuracy                         0.9757     56962
   macro avg     0.5290    0.9216    0.5485     56962
weighted avg     0.9981    0.9757    0.9862     56962</code></pre>
<p><strong>ì•™ìƒë¸”</strong></p>
<div class="sourceCode" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier, GradientBoostingClassifier</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.utils.class_weight <span class="im">import</span> compute_sample_weight</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> confusion_matrix, classification_report</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="co"># (1) RandomForest</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>rf_model <span class="op">=</span> RandomForestClassifier(</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>    n_estimators<span class="op">=</span><span class="dv">300</span>,</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>    max_depth<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>    min_samples_leaf<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>    max_features<span class="op">=</span><span class="st">"sqrt"</span>,</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>    class_weight<span class="op">=</span><span class="st">"balanced_subsample"</span>,</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>    n_jobs<span class="op">=-</span><span class="dv">1</span>,</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>    random_state<span class="op">=</span><span class="dv">42</span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>rf_model.fit(X_train, y_train)</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>y_pred_rf <span class="op">=</span> rf_model.predict(X_test)</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"[RF] Confusion matrix:</span><span class="ch">\n</span><span class="st">"</span>, confusion_matrix(y_test, y_pred_rf))</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"[RF] Classification report:</span><span class="ch">\n</span><span class="st">"</span>, classification_report(y_test, y_pred_rf, digits<span class="op">=</span><span class="dv">4</span>))</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a><span class="co"># (2) GradientBoosting (+ sample_weight)</span></span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>GradientBoostingClassifier(</span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>    n_estimators<span class="op">=</span><span class="dv">150</span>,     <span class="co"># 300 â†’ 150</span></span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>    learning_rate<span class="op">=</span><span class="fl">0.1</span>,    <span class="co"># 0.05 â†’ 0.1</span></span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>    max_depth<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>    subsample<span class="op">=</span><span class="fl">0.7</span>,        <span class="co"># ì¶”ê°€</span></span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>    random_state<span class="op">=</span><span class="dv">42</span></span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a>sw <span class="op">=</span> compute_sample_weight(class_weight<span class="op">=</span><span class="st">"balanced"</span>, y<span class="op">=</span>y_train)  <span class="co"># ë¶ˆê· í˜• ê°€ì¤‘ì¹˜</span></span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a>gb_model.fit(X_train, y_train, sample_weight<span class="op">=</span>sw)</span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a>y_pred_gb <span class="op">=</span> gb_model.predict(X_test)</span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"[GB] Confusion matrix:</span><span class="ch">\n</span><span class="st">"</span>, confusion_matrix(y_test, y_pred_gb))</span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"[GB] Classification report:</span><span class="ch">\n</span><span class="st">"</span>, classification_report(y_test, y_pred_gb, digits<span class="op">=</span><span class="dv">4</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre class="text"><code>[RF] Confusion matrix:
 [[56860     4]
 [   22    76]]
[RF] Classification report:
               precision    recall  f1-score   support

           0     0.9996    0.9999    0.9998     56864
           1     0.9500    0.7755    0.8539        98

    accuracy                         0.9995     56962
   macro avg     0.9748    0.8877    0.9269     56962
weighted avg     0.9995    0.9995    0.9995     56962

[GB] Confusion matrix:
 [[55591  1273]
 [    9    89]]
[GB] Classification report:
               precision    recall  f1-score   support

           0     0.9998    0.9776    0.9886     56864
           1     0.0653    0.9082    0.1219        98

    accuracy                         0.9775     56962
   macro avg     0.5326    0.9429    0.5553     56962
weighted avg     0.9982    0.9775    0.9871     56962</code></pre>
<p><strong>ëª¨ë¸ ë¹„êµ</strong></p>
<div class="sourceCode" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> roc_curve, auc, average_precision_score, confusion_matrix</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="co"># yëŠ” 0/1ë¡œ, 1ì´ Fraud(positive)</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>y_test_np <span class="op">=</span> np.asarray(y_test).ravel()</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_pos_score(model, X):</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>    proba <span class="op">=</span> model.predict_proba(X)</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>    classes <span class="op">=</span> np.array(model.classes_)</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>    pos_idx <span class="op">=</span> np.where(classes <span class="op">==</span> <span class="dv">1</span>)[<span class="dv">0</span>][<span class="dv">0</span>]</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> proba[:, pos_idx]</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> metrics_at_threshold(y_true01, score, t):</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>    y_hat <span class="op">=</span> (score <span class="op">&gt;=</span> t).astype(<span class="bu">int</span>)</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>    tn, fp, fn, tp <span class="op">=</span> confusion_matrix(y_true01, y_hat).ravel()</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>    tpr <span class="op">=</span> tp <span class="op">/</span> (tp <span class="op">+</span> fn) <span class="cf">if</span> (tp <span class="op">+</span> fn) <span class="cf">else</span> <span class="fl">0.0</span></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>    fpr <span class="op">=</span> fp <span class="op">/</span> (fp <span class="op">+</span> tn) <span class="cf">if</span> (fp <span class="op">+</span> tn) <span class="cf">else</span> <span class="fl">0.0</span></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>    prec <span class="op">=</span> tp <span class="op">/</span> (tp <span class="op">+</span> fp) <span class="cf">if</span> (tp <span class="op">+</span> fp) <span class="cf">else</span> <span class="fl">0.0</span></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>    acc <span class="op">=</span> (tp <span class="op">+</span> tn) <span class="op">/</span> (tp <span class="op">+</span> tn <span class="op">+</span> fp <span class="op">+</span> fn)</span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {<span class="st">"t"</span>: <span class="bu">float</span>(t), <span class="st">"tn"</span>: <span class="bu">int</span>(tn), <span class="st">"fp"</span>: <span class="bu">int</span>(fp), <span class="st">"fn"</span>: <span class="bu">int</span>(fn), <span class="st">"tp"</span>: <span class="bu">int</span>(tp),</span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>            <span class="st">"recall(tpr)"</span>: <span class="bu">float</span>(tpr), <span class="st">"fpr"</span>: <span class="bu">float</span>(fpr), <span class="st">"precision"</span>: <span class="bu">float</span>(prec), <span class="st">"accuracy"</span>: <span class="bu">float</span>(acc)}</span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> threshold_youden(y_true01, score):</span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>    fpr, tpr, thr <span class="op">=</span> roc_curve(y_true01, score)</span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># inf(ì•„ë¬´ë„ ì–‘ì„± ì˜ˆì¸¡ ì•ˆ í•¨) ì œì™¸</span></span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a>    mask <span class="op">=</span> np.isfinite(thr)</span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a>    J <span class="op">=</span> (tpr <span class="op">-</span> fpr)</span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a>    J[<span class="op">~</span>mask] <span class="op">=</span> <span class="op">-</span>np.inf</span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">float</span>(thr[np.argmax(J)])</span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> threshold_fpr_constraint(y_true01, score, alpha<span class="op">=</span><span class="fl">0.001</span>):</span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a>    fpr, tpr, thr <span class="op">=</span> roc_curve(y_true01, score)</span>
<span id="cb38-34"><a href="#cb38-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># inf ì œì™¸ + (TPR&gt;0) ì¡°ê±´ìœ¼ë¡œ trivial í•´ ë°©ì§€</span></span>
<span id="cb38-35"><a href="#cb38-35" aria-hidden="true" tabindex="-1"></a>    mask <span class="op">=</span> np.isfinite(thr) <span class="op">&amp;</span> (tpr <span class="op">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb38-36"><a href="#cb38-36" aria-hidden="true" tabindex="-1"></a>    cand <span class="op">=</span> np.where(mask <span class="op">&amp;</span> (fpr <span class="op">&lt;=</span> alpha))[<span class="dv">0</span>]</span>
<span id="cb38-37"><a href="#cb38-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(cand) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb38-38"><a href="#cb38-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb38-39"><a href="#cb38-39" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> cand[np.argmax(tpr[cand])]</span>
<span id="cb38-40"><a href="#cb38-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">float</span>(thr[i])</span>
<span id="cb38-41"><a href="#cb38-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-42"><a href="#cb38-42" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> threshold_cost(y_true01, score, c_fn<span class="op">=</span><span class="fl">100.0</span>, c_fp<span class="op">=</span><span class="fl">1.0</span>):</span>
<span id="cb38-43"><a href="#cb38-43" aria-hidden="true" tabindex="-1"></a>    thresholds <span class="op">=</span> np.unique(score)</span>
<span id="cb38-44"><a href="#cb38-44" aria-hidden="true" tabindex="-1"></a>    thresholds <span class="op">=</span> np.r_[<span class="fl">0.0</span>, thresholds, <span class="fl">1.0</span>]  <span class="co"># ë²”ìœ„ í¬í•¨</span></span>
<span id="cb38-45"><a href="#cb38-45" aria-hidden="true" tabindex="-1"></a>    best_t, best_cost <span class="op">=</span> <span class="va">None</span>, np.inf</span>
<span id="cb38-46"><a href="#cb38-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> t <span class="kw">in</span> thresholds:</span>
<span id="cb38-47"><a href="#cb38-47" aria-hidden="true" tabindex="-1"></a>        m <span class="op">=</span> metrics_at_threshold(y_true01, score, t)</span>
<span id="cb38-48"><a href="#cb38-48" aria-hidden="true" tabindex="-1"></a>        cost <span class="op">=</span> c_fn<span class="op">*</span>m[<span class="st">"fn"</span>] <span class="op">+</span> c_fp<span class="op">*</span>m[<span class="st">"fp"</span>]</span>
<span id="cb38-49"><a href="#cb38-49" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> cost <span class="op">&lt;</span> best_cost:</span>
<span id="cb38-50"><a href="#cb38-50" aria-hidden="true" tabindex="-1"></a>            best_cost, best_t <span class="op">=</span> cost, <span class="bu">float</span>(t)</span>
<span id="cb38-51"><a href="#cb38-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> best_t, <span class="bu">float</span>(best_cost)</span>
<span id="cb38-52"><a href="#cb38-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-53"><a href="#cb38-53" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> summarize_model(model_name, y_true01, score, alpha<span class="op">=</span><span class="fl">0.001</span>, c_fn<span class="op">=</span><span class="fl">100.0</span>, c_fp<span class="op">=</span><span class="fl">1.0</span>):</span>
<span id="cb38-54"><a href="#cb38-54" aria-hidden="true" tabindex="-1"></a>    fpr, tpr, _ <span class="op">=</span> roc_curve(y_true01, score)</span>
<span id="cb38-55"><a href="#cb38-55" aria-hidden="true" tabindex="-1"></a>    roc_auc <span class="op">=</span> auc(fpr, tpr)</span>
<span id="cb38-56"><a href="#cb38-56" aria-hidden="true" tabindex="-1"></a>    ap <span class="op">=</span> average_precision_score(y_true01, score)</span>
<span id="cb38-57"><a href="#cb38-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-58"><a href="#cb38-58" aria-hidden="true" tabindex="-1"></a>    rows <span class="op">=</span> []</span>
<span id="cb38-59"><a href="#cb38-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-60"><a href="#cb38-60" aria-hidden="true" tabindex="-1"></a>    t_y <span class="op">=</span> threshold_youden(y_true01, score)</span>
<span id="cb38-61"><a href="#cb38-61" aria-hidden="true" tabindex="-1"></a>    m_y <span class="op">=</span> metrics_at_threshold(y_true01, score, t_y)</span>
<span id="cb38-62"><a href="#cb38-62" aria-hidden="true" tabindex="-1"></a>    m_y.update({<span class="st">"model"</span>: model_name, <span class="st">"rule"</span>: <span class="st">"Youden (TPR-FPR)"</span>, <span class="st">"roc_auc"</span>: roc_auc, <span class="st">"ap"</span>: ap,</span>
<span id="cb38-63"><a href="#cb38-63" aria-hidden="true" tabindex="-1"></a>                <span class="st">"cost"</span>: c_fn<span class="op">*</span>m_y[<span class="st">"fn"</span>] <span class="op">+</span> c_fp<span class="op">*</span>m_y[<span class="st">"fp"</span>]})</span>
<span id="cb38-64"><a href="#cb38-64" aria-hidden="true" tabindex="-1"></a>    rows.append(m_y)</span>
<span id="cb38-65"><a href="#cb38-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-66"><a href="#cb38-66" aria-hidden="true" tabindex="-1"></a>    t_f <span class="op">=</span> threshold_fpr_constraint(y_true01, score, alpha<span class="op">=</span>alpha)</span>
<span id="cb38-67"><a href="#cb38-67" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> t_f <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb38-68"><a href="#cb38-68" aria-hidden="true" tabindex="-1"></a>        m_f <span class="op">=</span> metrics_at_threshold(y_true01, score, t_f)</span>
<span id="cb38-69"><a href="#cb38-69" aria-hidden="true" tabindex="-1"></a>        m_f.update({<span class="st">"model"</span>: model_name, <span class="st">"rule"</span>: <span class="ss">f"FPR &lt;= </span><span class="sc">{</span>alpha<span class="sc">}</span><span class="ss">"</span>, <span class="st">"roc_auc"</span>: roc_auc, <span class="st">"ap"</span>: ap,</span>
<span id="cb38-70"><a href="#cb38-70" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"cost"</span>: c_fn<span class="op">*</span>m_f[<span class="st">"fn"</span>] <span class="op">+</span> c_fp<span class="op">*</span>m_f[<span class="st">"fp"</span>]})</span>
<span id="cb38-71"><a href="#cb38-71" aria-hidden="true" tabindex="-1"></a>        rows.append(m_f)</span>
<span id="cb38-72"><a href="#cb38-72" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb38-73"><a href="#cb38-73" aria-hidden="true" tabindex="-1"></a>        rows.append({<span class="st">"model"</span>: model_name, <span class="st">"rule"</span>: <span class="ss">f"FPR &lt;= </span><span class="sc">{</span>alpha<span class="sc">}</span><span class="ss">"</span>, <span class="st">"t"</span>: <span class="va">None</span>,</span>
<span id="cb38-74"><a href="#cb38-74" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"tn"</span>: <span class="va">None</span>, <span class="st">"fp"</span>: <span class="va">None</span>, <span class="st">"fn"</span>: <span class="va">None</span>, <span class="st">"tp"</span>: <span class="va">None</span>,</span>
<span id="cb38-75"><a href="#cb38-75" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"recall(tpr)"</span>: <span class="va">None</span>, <span class="st">"fpr"</span>: <span class="va">None</span>, <span class="st">"precision"</span>: <span class="va">None</span>, <span class="st">"accuracy"</span>: <span class="va">None</span>,</span>
<span id="cb38-76"><a href="#cb38-76" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"roc_auc"</span>: roc_auc, <span class="st">"ap"</span>: ap, <span class="st">"cost"</span>: <span class="va">None</span>})</span>
<span id="cb38-77"><a href="#cb38-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-78"><a href="#cb38-78" aria-hidden="true" tabindex="-1"></a>    t_c, best_cost <span class="op">=</span> threshold_cost(y_true01, score, c_fn<span class="op">=</span>c_fn, c_fp<span class="op">=</span>c_fp)</span>
<span id="cb38-79"><a href="#cb38-79" aria-hidden="true" tabindex="-1"></a>    m_c <span class="op">=</span> metrics_at_threshold(y_true01, score, t_c)</span>
<span id="cb38-80"><a href="#cb38-80" aria-hidden="true" tabindex="-1"></a>    m_c.update({<span class="st">"model"</span>: model_name, <span class="st">"rule"</span>: <span class="ss">f"Cost (c_fn=</span><span class="sc">{</span>c_fn<span class="sc">}</span><span class="ss">, c_fp=</span><span class="sc">{</span>c_fp<span class="sc">}</span><span class="ss">)"</span>,</span>
<span id="cb38-81"><a href="#cb38-81" aria-hidden="true" tabindex="-1"></a>                <span class="st">"roc_auc"</span>: roc_auc, <span class="st">"ap"</span>: ap, <span class="st">"cost"</span>: best_cost})</span>
<span id="cb38-82"><a href="#cb38-82" aria-hidden="true" tabindex="-1"></a>    rows.append(m_c)</span>
<span id="cb38-83"><a href="#cb38-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-84"><a href="#cb38-84" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> rows</span>
<span id="cb38-85"><a href="#cb38-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-86"><a href="#cb38-86" aria-hidden="true" tabindex="-1"></a><span class="co"># ===== ëª¨ë¸ score ëª¨ìœ¼ê¸°(ì´ë¯¸ ì•ì—ì„œ í•™ìŠµëœ ê²ƒìœ¼ë¡œ ê°€ì •) =====</span></span>
<span id="cb38-87"><a href="#cb38-87" aria-hidden="true" tabindex="-1"></a>models <span class="op">=</span> {</span>
<span id="cb38-88"><a href="#cb38-88" aria-hidden="true" tabindex="-1"></a>    <span class="st">"k-NN"</span>: knn_model,</span>
<span id="cb38-89"><a href="#cb38-89" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SVM(Linear+Calib)"</span>: svm_model,</span>
<span id="cb38-90"><a href="#cb38-90" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Logit"</span>: logit_model,</span>
<span id="cb38-91"><a href="#cb38-91" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Tree"</span>: tree_model,</span>
<span id="cb38-92"><a href="#cb38-92" aria-hidden="true" tabindex="-1"></a>    <span class="st">"RandomForest"</span>: rf_model,</span>
<span id="cb38-93"><a href="#cb38-93" aria-hidden="true" tabindex="-1"></a>    <span class="st">"GradientBoosting"</span>: gb_model</span>
<span id="cb38-94"><a href="#cb38-94" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb38-95"><a href="#cb38-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-96"><a href="#cb38-96" aria-hidden="true" tabindex="-1"></a>alpha <span class="op">=</span> <span class="fl">0.001</span>          <span class="co"># ì‚¬ê¸°íƒì§€ì—ì„œ í”í•œ FPR ì œì•½(0.1%)</span></span>
<span id="cb38-97"><a href="#cb38-97" aria-hidden="true" tabindex="-1"></a>c_fn, c_fp <span class="op">=</span> <span class="fl">100.0</span>, <span class="fl">1.0</span>  <span class="co"># FN(ì‚¬ê¸° ë†“ì¹¨) ë¹„ìš©ì„ í¬ê²Œ</span></span>
<span id="cb38-98"><a href="#cb38-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-99"><a href="#cb38-99" aria-hidden="true" tabindex="-1"></a>rows <span class="op">=</span> []</span>
<span id="cb38-100"><a href="#cb38-100" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name, m <span class="kw">in</span> models.items():</span>
<span id="cb38-101"><a href="#cb38-101" aria-hidden="true" tabindex="-1"></a>    score <span class="op">=</span> get_pos_score(m, X_test)</span>
<span id="cb38-102"><a href="#cb38-102" aria-hidden="true" tabindex="-1"></a>    rows <span class="op">+=</span> summarize_model(name, y_test_np, score, alpha<span class="op">=</span>alpha, c_fn<span class="op">=</span>c_fn, c_fp<span class="op">=</span>c_fp)</span>
<span id="cb38-103"><a href="#cb38-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-104"><a href="#cb38-104" aria-hidden="true" tabindex="-1"></a>df_all <span class="op">=</span> pd.DataFrame(rows)[</span>
<span id="cb38-105"><a href="#cb38-105" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"model"</span>,<span class="st">"rule"</span>,<span class="st">"t"</span>,<span class="st">"tn"</span>,<span class="st">"fp"</span>,<span class="st">"fn"</span>,<span class="st">"tp"</span>,<span class="st">"recall(tpr)"</span>,<span class="st">"fpr"</span>,<span class="st">"precision"</span>,<span class="st">"accuracy"</span>,<span class="st">"roc_auc"</span>,<span class="st">"ap"</span>,<span class="st">"cost"</span>]</span>
<span id="cb38-106"><a href="#cb38-106" aria-hidden="true" tabindex="-1"></a>].sort_values([<span class="st">"rule"</span>,<span class="st">"model"</span>]).reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb38-107"><a href="#cb38-107" aria-hidden="true" tabindex="-1"></a>display(df_all)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/classification_ml_rareall.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "î§‹";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>